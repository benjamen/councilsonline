var de=Object.defineProperty,ue=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var Z=(_,x,n)=>x in _?de(_,x,{enumerable:!0,configurable:!0,writable:!0,value:n}):_[x]=n,K=(_,x)=>{for(var n in x||(x={}))pe.call(x,n)&&Z(_,n,x[n]);if(Q)for(var n of Q(x))me.call(x,n)&&Z(_,n,x[n]);return _},Y=(_,x)=>ue(_,ce(x));var B=(_,x,n)=>new Promise((q,k)=>{var C=v=>{try{y(n.next(v))}catch(l){k(l)}},R=v=>{try{y(n.throw(v))}catch(l){k(l)}},y=v=>v.done?q(v.value):Promise.resolve(v.value).then(C,R);y((n=n.apply(_,x)).next())});import{j as A,r as $,C as ee,z as ge,o as i,w as S,a as e,n as z,c as u,d as V,b as g,h as D,u as b,I as T,l as O,x as te,v as N,t as d,i as F,D as se,f as oe,k as le,F as J,m as W,q as P,s as H,g as L}from"./index-C2SnbVVU.js";import{D as ve}from"./Dropdown-S1VyruCD.js";import{_ as xe}from"./StatusBadge-CCmtxrMk.js";import{_ as U}from"./StatCard-BUQ6JIqr.js";function E(q,k){return B(this,arguments,function*(_,x,n={}){x||(x={});let C=Object.assign({Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-Frappe-Site-Name":window.location.hostname},n.headers||{});window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&(C["X-Frappe-CSRF-Token"]=window.csrf_token);let R=_.startsWith("/")?_:`/api/method/${_}`;const y=yield fetch(R,{method:"POST",headers:C,body:JSON.stringify(x)});if(y.ok){const v=yield y.json();if(v.docs||_==="login")return v;if(v.exc)try{console.groupCollapsed(_),console.log(`method: ${_}`),console.log("params:",x);let l=JSON.parse(v.exc);for(let f of l)console.log(f);console.groupEnd()}catch(l){console.warn("Error printing debug messages",l)}return v.message}else{let v=yield y.text(),l,f;try{l=JSON.parse(v)}catch(M){}let w=[[_,l.exc_type,l._error_message].filter(Boolean).join(" ")];if(l.exc){f=l.exc;try{f=JSON.parse(f)[0],console.log(f)}catch(M){}}let h=new Error(w.join(`
`));throw h.exc_type=l.exc_type,h.exc=f,h.status=y.status,h.messages=l._server_messages?JSON.parse(l._server_messages):[],h.messages=h.messages.concat(l.message),h.messages=h.messages.map(M=>{try{return JSON.parse(M).message}catch(p){return M}}),h.messages=h.messages.filter(Boolean),h.messages.length||(h.messages=l._error_message?[l._error_message]:["Internal Server Error"]),n.onError&&n.onError({response:y,status:y.status,error:h}),h}})}const ye={class:"grid grid-cols-2 gap-4"},fe={class:"grid grid-cols-2 gap-4"},be={class:"border-t border-gray-200 pt-6"},_e={class:"mb-4"},he={class:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700"},ke={class:"grid grid-cols-3 gap-4"},we={class:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium"},Ce={class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},$e={class:"flex items-center justify-between"},Ve={class:"text-xl font-bold text-blue-900"},Me={class:"text-xs text-gray-600 mt-1"},Re={key:0,class:"mt-4"},De={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},qe={class:"flex items-start"},Se={class:"text-sm text-red-700"},Te={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Ue={__name:"TaskDialog",props:{modelValue:{type:Boolean,default:!1},task:{type:Object,default:null}},emits:["update:modelValue","task-saved"],setup(_,{emit:x}){const n=_,q=x,k=A({get:()=>n.modelValue,set:s=>q("update:modelValue",s)}),C=A(()=>!!n.task),R=$(!1),y=$(""),v=()=>({title:"",description:"",priority:"Medium",status:"Open",due_date:"",assign_to:"",assign_from:"",request:"",activity_type:"",assigned_role:"",estimated_hours:null,actual_hours:null}),l=$(v()),f=$(""),w=$(0),h=A(()=>(l.value.actual_hours||0)*w.value);ee(()=>l.value.assign_to,s=>B(this,null,function*(){if(s)try{const o=yield E("frappe.client.get",{doctype:"User",name:s});if(o&&o.roles&&o.roles.length>0){const m=o.roles.find(j=>!["Guest","All"].includes(j.role));if(m){f.value=m.role,l.value.assigned_role=m.role;const j=yield E("lodgeick.lodgeick.doctype.role_rate.role_rate.get_hourly_rate",{role:m.role});j&&j.hourly_rate&&(w.value=j.hourly_rate)}}}catch(o){console.error("Error fetching user role and rate:",o),f.value="",w.value=0}else f.value="",w.value=0}));const M=()=>{};ee(()=>n.task,s=>{s?(l.value={title:s.title||"",description:s.description||"",priority:s.priority||"Medium",status:s.status||"Open",due_date:s.due_date||"",assign_to:s.assign_to||"",assign_from:s.assign_from||"",request:s.request||"",activity_type:s.activity_type||"",assigned_role:s.assigned_role||"",estimated_hours:s.estimated_hours||null,actual_hours:s.actual_hours||null},s.assigned_role&&(f.value=s.assigned_role),s.hourly_rate&&(w.value=s.hourly_rate)):(l.value=v(),f.value="",w.value=0)},{immediate:!0});const p=()=>B(this,null,function*(){y.value="",R.value=!0;try{if(C.value)yield E("frappe.client.set_value",{doctype:"WB Task",name:n.task.name,fieldname:l.value});else{const s=Y(K({doctype:"WB Task"},l.value),{assign_from:l.value.assign_from||"Administrator"});yield E("frappe.client.insert",{doc:s})}q("task-saved"),r()}catch(s){console.error("Error saving task:",s),y.value=s.message||"Failed to save task. Please try again."}finally{R.value=!1}}),r=()=>{k.value=!1,l.value=v(),y.value=""};return(s,o)=>(i(),ge(b(se),{modelValue:k.value,"onUpdate:modelValue":o[10]||(o[10]=m=>k.value=m),options:{title:C.value?"Edit Task":"Create New Task",size:"3xl"}},{"body-content":S(()=>[e("form",{onSubmit:z(p,["prevent"]),class:"space-y-6"},[e("div",null,[o[11]||(o[11]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Title "),e("span",{class:"text-red-500"},"*")],-1)),g(b(T),{id:"title",modelValue:l.value.title,"onUpdate:modelValue":o[0]||(o[0]=m=>l.value.title=m),type:"text",required:"",placeholder:"Enter task title",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[12]||(o[12]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Description ",-1)),O(e("textarea",{id:"description","onUpdate:modelValue":o[1]||(o[1]=m=>l.value.description=m),rows:"3",placeholder:"Describe the task...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[te,l.value.description]])]),e("div",ye,[e("div",null,[o[14]||(o[14]=e("label",{for:"priority",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Priority "),e("span",{class:"text-red-500"},"*")],-1)),O(e("select",{id:"priority","onUpdate:modelValue":o[2]||(o[2]=m=>l.value.priority=m),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...o[13]||(o[13]=[e("option",{value:"Low"},"Low",-1),e("option",{value:"Medium"},"Medium",-1),e("option",{value:"High"},"High",-1),e("option",{value:"Urgent"},"Urgent",-1)])],512),[[N,l.value.priority]])]),e("div",null,[o[16]||(o[16]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Status "),e("span",{class:"text-red-500"},"*")],-1)),O(e("select",{id:"status","onUpdate:modelValue":o[3]||(o[3]=m=>l.value.status=m),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...o[15]||(o[15]=[e("option",{value:"Open"},"Open",-1),e("option",{value:"Working"},"Working",-1),e("option",{value:"Pending Review"},"Pending Review",-1),e("option",{value:"Completed"},"Completed",-1),e("option",{value:"Cancelled"},"Cancelled",-1)])],512),[[N,l.value.status]])])]),e("div",fe,[e("div",null,[o[17]||(o[17]=e("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Due Date "),e("span",{class:"text-red-500"},"*")],-1)),g(b(T),{id:"due_date",modelValue:l.value.due_date,"onUpdate:modelValue":o[4]||(o[4]=m=>l.value.due_date=m),type:"date",required:"",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[18]||(o[18]=e("label",{for:"assign_to",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Assign To "),e("span",{class:"text-red-500"},"*")],-1)),g(b(T),{id:"assign_to",modelValue:l.value.assign_to,"onUpdate:modelValue":o[5]||(o[5]=m=>l.value.assign_to=m),type:"text",required:"",placeholder:"User email",class:"w-full"},null,8,["modelValue"])])]),e("div",null,[o[19]||(o[19]=e("label",{for:"request",class:"block text-sm font-medium text-gray-700 mb-2"}," Linked Request (Optional) ",-1)),g(b(T),{id:"request",modelValue:l.value.request,"onUpdate:modelValue":o[6]||(o[6]=m=>l.value.request=m),type:"text",placeholder:"Request ID (e.g., RC-2025-001)",class:"w-full"},null,8,["modelValue"])]),e("div",be,[o[26]||(o[26]=e("h3",{class:"text-sm font-medium text-gray-900 mb-4"},"Time Tracking & Costing",-1)),e("div",_e,[o[20]||(o[20]=e("label",{for:"assigned_role",class:"block text-sm font-medium text-gray-700 mb-2"}," User Role (Auto-detected) ",-1)),e("div",he,d(f.value||"Role will be detected from assigned user"),1)]),e("div",ke,[e("div",null,[o[21]||(o[21]=e("label",{for:"estimated_hours",class:"block text-sm font-medium text-gray-700 mb-2"}," Estimated Hours ",-1)),g(b(T),{id:"estimated_hours",modelValue:l.value.estimated_hours,"onUpdate:modelValue":o[7]||(o[7]=m=>l.value.estimated_hours=m),modelModifiers:{number:!0},type:"number",step:"0.25",min:"0",placeholder:"0.00",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[22]||(o[22]=e("label",{for:"actual_hours",class:"block text-sm font-medium text-gray-700 mb-2"}," Actual Hours ",-1)),g(b(T),{id:"actual_hours",modelValue:l.value.actual_hours,"onUpdate:modelValue":o[8]||(o[8]=m=>l.value.actual_hours=m),modelModifiers:{number:!0},type:"number",step:"0.25",min:"0",placeholder:"0.00",onInput:M,class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[23]||(o[23]=e("label",{for:"hourly_rate",class:"block text-sm font-medium text-gray-700 mb-2"}," Hourly Rate ",-1)),e("div",we," $"+d(w.value.toFixed(2)),1)])]),e("div",Ce,[e("div",$e,[o[24]||(o[24]=e("span",{class:"text-sm font-medium text-gray-700"},"Total Cost",-1)),e("span",Ve,"$"+d(h.value.toFixed(2)),1)]),e("p",Me," Calculated as: "+d(l.value.actual_hours||0)+" hours × $"+d(w.value.toFixed(2))+"/hr ",1)]),l.value.request?(i(),u("div",Re,[o[25]||(o[25]=e("label",{for:"activity_type",class:"block text-sm font-medium text-gray-700 mb-2"}," Activity Type (Optional) ",-1)),g(b(T),{id:"activity_type",modelValue:l.value.activity_type,"onUpdate:modelValue":o[9]||(o[9]=m=>l.value.activity_type=m),type:"text",placeholder:"e.g., Site Inspection",class:"w-full"},null,8,["modelValue"])])):V("",!0)]),y.value?(i(),u("div",De,[e("div",qe,[o[27]||(o[27]=e("svg",{class:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Se,d(y.value),1)])])):V("",!0),e("div",Te,[g(b(F),{type:"button",onClick:r,variant:"outline"},{default:S(()=>[...o[28]||(o[28]=[D(" Cancel ",-1)])]),_:1}),g(b(F),{type:"submit",loading:R.value,variant:"solid",theme:"green"},{default:S(()=>[D(d(C.value?"Update Task":"Create Task"),1)]),_:1},8,["loading"])])],32)]),_:1},8,["modelValue","options"]))}},je={class:"space-y-6"},Ae={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},Oe={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Ie={class:"p-6 border-b border-gray-200"},Be={class:"flex justify-between items-center"},Ee={class:"divide-y divide-gray-200"},Ne={key:0,class:"p-12 text-center"},Pe={key:1,class:"p-12 text-center text-gray-500"},Fe={class:"flex items-start justify-between gap-6"},He={class:"flex items-start space-x-4 flex-1"},Le=["checked","onChange"],ze={class:"flex-1"},Je={class:"flex items-center space-x-3 mb-2"},We={class:"text-sm text-gray-600 mb-4"},Xe={class:"flex flex-wrap items-center gap-3"},Ge={key:0,class:"flex items-center text-sm text-gray-600"},Qe={class:"font-medium"},Ze={key:1,class:"inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold"},Ke={key:0,class:"ml-1"},Ye={class:"flex flex-col items-end space-y-3 min-w-[180px]"},et={key:0,class:"px-4 py-2 bg-green-50 border-2 border-green-200 rounded-lg"},tt={class:"text-2xl font-bold text-green-900"},st={key:1,class:"px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg w-full"},ot={class:"flex items-center justify-between"},lt={class:"text-xs text-blue-700 font-medium"},at={class:"text-lg font-bold text-blue-900"},rt={key:0},nt={key:1},it={key:0,class:"text-xs text-blue-600 mt-1"},dt={class:"flex items-center space-x-2"},ut=["onClick"],ct=["onClick"],pt={__name:"TaskManagement",setup(_){const x=oe(),n=$(!1),q=$(null),k=le({url:"lodgeick.lodgeick.doctype.task.task.get_my_tasks",auto:!0}),C=A(()=>{const p=k.data||[],r=new Date().toDateString();return{myTasks:p.length,inProgress:p.filter(s=>s.status==="Open").length,completedToday:p.filter(s=>s.status==="Completed"&&s.date_of_completion&&new Date(s.date_of_completion).toDateString()===r).length,overdue:p.filter(s=>s.status==="Overdue").length}}),R=p=>{const r={Low:"bg-gray-100 text-gray-800",Medium:"bg-blue-100 text-blue-800",High:"bg-orange-100 text-orange-800",Urgent:"bg-red-100 text-red-800"};return r[p]||r.Medium},y=p=>p?new Date(p)<new Date:!1,v=p=>p?new Date(p).toLocaleDateString("en-NZ",{day:"numeric",month:"short",year:"numeric"}):"",l=p=>B(this,null,function*(){const r=p.status==="Completed"?"Open":"Completed";try{yield E("frappe.client.set_value",{doctype:"WB Task",name:p.name,fieldname:"status",value:r}),k.reload()}catch(s){console.error("Error toggling task status:",s)}}),f=p=>{x.push({name:"InternalRequestDetail",params:{id:p}})},w=()=>{q.value=null,n.value=!0},h=p=>{q.value=p,n.value=!0},M=()=>{k.reload()};return(p,r)=>(i(),u("div",je,[e("div",Ae,[g(U,{title:"My Tasks",value:C.value.myTasks,icon:"clipboard",color:"blue"},null,8,["value"]),g(U,{title:"In Progress",value:C.value.inProgress,icon:"clock",color:"yellow"},null,8,["value"]),g(U,{title:"Completed Today",value:C.value.completedToday,icon:"check",color:"green"},null,8,["value"]),g(U,{title:"Overdue",value:C.value.overdue,icon:"alert-triangle",color:"red"},null,8,["value"])]),e("div",Oe,[e("div",Ie,[e("div",Be,[r[3]||(r[3]=e("h2",{class:"text-lg font-semibold text-gray-900"},"My Tasks",-1)),g(b(F),{onClick:w,variant:"solid",theme:"green"},{prefix:S(()=>[...r[1]||(r[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:S(()=>[r[2]||(r[2]=D(" New Task ",-1))]),_:1})])]),e("div",Ee,[b(k).loading?(i(),u("div",Ne,[...r[4]||(r[4]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1)])])):!b(k).data||b(k).data.length===0?(i(),u("div",Pe,[...r[5]||(r[5]=[e("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",null,"No tasks assigned",-1)])])):(i(!0),u(J,{key:2},W(b(k).data,s=>(i(),u("div",{key:s.name,class:"p-6 hover:bg-gray-50 transition-colors"},[e("div",Fe,[e("div",He,[e("input",{type:"checkbox",checked:s.status==="Completed",onChange:o=>l(s),class:"mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer"},null,40,Le),e("div",ze,[e("div",Je,[e("h3",{class:P(["text-base font-semibold",s.status==="Completed"?"text-gray-400 line-through":"text-gray-900"])},d(s.title),3),s.priority?(i(),u("span",{key:0,class:P(["inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold",R(s.priority)])},d(s.priority),3)):V("",!0)]),e("p",We,d(s.description),1),e("div",Xe,[s.request?(i(),u("div",Ge,[r[6]||(r[6]=e("svg",{class:"w-4 h-4 mr-1.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",Qe,d(s.request),1)])):V("",!0),s.assigned_role?(i(),u("div",Ze,[r[7]||(r[7]=e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),D(" "+d(s.assigned_role),1)])):V("",!0),s.due_date?(i(),u("div",{key:2,class:P(["inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold",y(s.due_date)?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},[r[8]||(r[8]=e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),D(" "+d(v(s.due_date))+" ",1),y(s.due_date)?(i(),u("span",Ke,"⚠️")):V("",!0)],2)):V("",!0)])])]),e("div",Ye,[s.total_cost?(i(),u("div",et,[r[9]||(r[9]=e("div",{class:"text-xs text-green-700 font-medium mb-0.5"},"Total Cost",-1)),e("div",tt,"$"+d(s.total_cost.toFixed(2)),1)])):V("",!0),s.estimated_hours||s.actual_hours?(i(),u("div",st,[e("div",ot,[e("div",lt,d(s.actual_hours?"Actual":"Est.")+" Hours ",1),e("div",at,[s.actual_hours?(i(),u("span",rt,d(s.actual_hours)+"h",1)):s.estimated_hours?(i(),u("span",nt,"~"+d(s.estimated_hours)+"h",1)):V("",!0)])]),s.hourly_rate?(i(),u("div",it," @ $"+d(s.hourly_rate.toFixed(2))+"/hr ",1)):V("",!0)])):V("",!0),e("div",dt,[s.request?(i(),u("button",{key:0,onClick:o=>f(s.request),class:"p-2 text-gray-400 hover:text-blue-600 transition rounded-lg hover:bg-blue-50",title:"View Request"},[...r[10]||(r[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,ut)):V("",!0),e("button",{onClick:o=>h(s),class:"p-2 text-gray-400 hover:text-green-600 transition rounded-lg hover:bg-green-50",title:"Edit Task"},[...r[11]||(r[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ct)])])])]))),128))])]),g(Ue,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=s=>n.value=s),task:q.value,onTaskSaved:M},null,8,["modelValue","task"])]))}},mt={class:"min-h-screen bg-gray-50"},gt={class:"bg-white shadow-sm border-b border-gray-200"},vt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},xt={class:"flex justify-between items-center py-4"},yt={class:"flex items-center space-x-4"},ft={class:"flex items-center space-x-2 text-gray-700 hover:text-gray-900"},bt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},_t={class:"text-sm font-medium text-green-600"},ht={class:"text-sm font-medium"},kt={class:"flex space-x-6 border-t border-gray-200 -mb-px"},wt=["onClick"],Ct={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},$t={key:0},Vt={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8"},Mt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6"},Rt={class:"grid md:grid-cols-4 gap-4"},Dt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},qt={class:"overflow-x-auto"},St={class:"min-w-full divide-y divide-gray-200"},Tt={class:"bg-white divide-y divide-gray-200"},Ut={key:0},jt={key:1},At=["onClick"],Ot={class:"text-sm font-medium text-gray-900"},It={class:"text-sm text-gray-500"},Bt={class:"px-6 py-4 whitespace-nowrap"},Et={class:"text-sm text-gray-900"},Nt={class:"text-sm text-gray-500"},Pt={class:"px-6 py-4"},Ft={class:"text-sm text-gray-900"},Ht={class:"px-6 py-4 whitespace-nowrap"},Lt={class:"px-6 py-4 whitespace-nowrap"},zt={key:0,class:"flex items-center"},Jt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-2"},Wt={class:"text-xs font-medium text-green-600"},Xt={class:"text-sm text-gray-900"},Gt={key:1,class:"text-sm text-gray-400"},Qt={class:"px-6 py-4 whitespace-nowrap"},Zt={class:"text-sm text-gray-900"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Yt=["onClick"],es=["onClick"],ts={key:1},ss={key:2},os={key:0,class:"space-y-4"},ls={class:"bg-gray-50 p-4 rounded-lg"},as={class:"text-sm font-medium text-gray-900"},rs={class:"text-sm text-gray-500"},ms={__name:"InternalRequestManagement",setup(_){const x=oe(),n=$("requests"),q=[{id:"requests",label:"All Requests"},{id:"tasks",label:"My Tasks"},{id:"analytics",label:"Analytics"}],k=$(""),C=$(""),R=$(""),y=$(""),v=$(!1),l=$(null),f=$(""),w=$(""),h=$(!1),M=le({url:"lodgeick.lodgeick.doctype.request.request.get_all_requests_for_staff",auto:!0}),p=A(()=>{const c=M.data||[];return{total:c.length,unassigned:c.filter(t=>!t.assigned_to).length,inProgress:c.filter(t=>t.status==="Under Review").length,rfi:c.filter(t=>t.status==="RFI Issued").length,completed:c.filter(t=>["Approved","Declined","Withdrawn"].includes(t.status)).length}}),r=A(()=>{let c=M.data||[];if(k.value){const t=k.value.toLowerCase();c=c.filter(a=>{var I,X,G;return((I=a.request_number)==null?void 0:I.toLowerCase().includes(t))||((X=a.property_address)==null?void 0:X.toLowerCase().includes(t))||((G=a.applicant_name)==null?void 0:G.toLowerCase().includes(t))})}return C.value&&(c=c.filter(t=>t.status===C.value)),R.value==="unassigned"?c=c.filter(t=>!t.assigned_to):R.value==="me"&&(c=c.filter(t=>t.assigned_to===H.user)),y.value&&(c=c.filter(t=>t.request_type===y.value)),c}),s=A(()=>H.user||"User"),o=A(()=>s.value.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)),m=c=>c?c.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"?",j=c=>{x.push({name:"InternalRequestDetail",params:{id:c}})},ae=c=>{l.value=c,f.value=c.assigned_to||"",w.value="",v.value=!0},re=()=>B(this,null,function*(){if(!f.value){alert("Please select a user to assign");return}h.value=!0;try{const t=yield(yield fetch("/api/method/lodgeick.api.assign_request",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:l.value.name,assigned_to:f.value,notes:w.value})})).json();if(t.message&&t.message.success)v.value=!1,l.value=null,f.value="",w.value="",M.reload(),alert("Request assigned successfully!");else throw new Error("Failed to assign request")}catch(c){console.error("Error assigning request:",c),alert("Failed to assign request. Please try again.")}finally{h.value=!1}}),ne=()=>{v.value=!1,l.value=null,f.value="",w.value=""},ie=[{label:"Public Dashboard",onClick:()=>{x.push({name:"Dashboard"})}},{label:"My Profile",onClick:()=>console.log("Profile")},{label:"Settings",onClick:()=>console.log("Settings")},{label:"Logout",onClick:()=>H.logout.submit()}];return(c,t)=>(i(),u("div",mt,[e("header",gt,[e("div",vt,[e("div",xt,[t[8]||(t[8]=L('<div class="flex items-center space-x-3"><div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg></div><div><h1 class="text-xl font-bold text-gray-900">Easy Council</h1><p class="text-xs text-gray-500">Internal Request Management</p></div></div>',1)),e("div",yt,[g(b(ve),{options:ie},{default:S(({open:a})=>[e("button",ft,[e("div",bt,[e("span",_t,d(o.value),1)]),e("span",ht,d(s.value),1),t[7]||(t[7]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))])]),_:1})])]),e("div",kt,[(i(),u(J,null,W(q,a=>e("button",{key:a.id,onClick:I=>n.value=a.id,class:P(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",n.value===a.id?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},d(a.label),11,wt)),64))])])]),e("main",Ct,[n.value==="requests"?(i(),u("div",$t,[e("div",Vt,[g(U,{title:"Total Requests",value:p.value.total,icon:"inbox",color:"blue"},null,8,["value"]),g(U,{title:"New/Unassigned",value:p.value.unassigned,icon:"alert-circle",color:"red"},null,8,["value"]),g(U,{title:"In Progress",value:p.value.inProgress,icon:"clock",color:"yellow"},null,8,["value"]),g(U,{title:"RFI Issued",value:p.value.rfi,icon:"help-circle",color:"orange"},null,8,["value"]),g(U,{title:"Completed",value:p.value.completed,icon:"check-circle",color:"green"},null,8,["value"])]),e("div",Mt,[e("div",Rt,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Search",-1)),g(b(T),{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),placeholder:"Request number, property..."},null,8,["modelValue"])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),O(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>C.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[10]||(t[10]=[L('<option value="">All Statuses</option><option value="Submitted">Submitted</option><option value="Under Review">Under Review</option><option value="RFI Issued">RFI Issued</option><option value="Approved">Approved</option><option value="Declined">Declined</option>',6)])],512),[[N,C.value]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Assigned To",-1)),O(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>R.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[12]||(t[12]=[e("option",{value:""},"All Staff",-1),e("option",{value:"unassigned"},"Unassigned",-1),e("option",{value:"me"},"Assigned to Me",-1)])],512),[[N,R.value]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Request Type",-1)),O(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[14]||(t[14]=[e("option",{value:""},"All Types",-1),e("option",{value:"Building Consent"},"Building Consent",-1),e("option",{value:"Resource Consent"},"Resource Consent",-1),e("option",{value:"LIM"},"LIM Report",-1)])],512),[[N,y.value]])])])]),e("div",Dt,[e("div",qt,[e("table",St,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Request "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Applicant "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Property "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Assigned To "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Days Elapsed "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Tt,[b(M).loading?(i(),u("tr",Ut,[...t[16]||(t[16]=[e("td",{colspan:"7",class:"px-6 py-12 text-center text-gray-500"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})],-1)])])):!b(M).data||b(M).data.length===0?(i(),u("tr",jt,[...t[17]||(t[17]=[e("td",{colspan:"7",class:"px-6 py-12 text-center text-gray-500"}," No requests found ",-1)])])):(i(!0),u(J,{key:2},W(r.value,a=>(i(),u("tr",{key:a.name,class:"hover:bg-gray-50 cursor-pointer"},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:I=>j(a.name)},[e("div",Ot,d(a.request_number),1),e("div",It,d(a.request_type),1)],8,At),e("td",Bt,[e("div",Et,d(a.applicant_name||a.applicant),1),e("div",Nt,d(a.applicant_email),1)]),e("td",Pt,[e("div",Ft,d(a.property_address),1)]),e("td",Ht,[g(xe,{status:a.status},null,8,["status"])]),e("td",Lt,[a.assigned_to?(i(),u("div",zt,[e("div",Jt,[e("span",Wt,d(m(a.assigned_to)),1)]),e("span",Xt,d(a.assigned_to_name||a.assigned_to),1)])):(i(),u("span",Gt,"Unassigned"))]),e("td",Qt,[e("div",Zt,d(a.working_days_elapsed||0)+" days",1),a.working_days_remaining?(i(),u("div",{key:0,class:P(["text-xs",a.is_overdue?"text-red-600":"text-gray-500"])},d(a.working_days_remaining)+" remaining ",3)):V("",!0)]),e("td",Kt,[e("button",{onClick:z(I=>ae(a),["stop"]),class:"text-green-600 hover:text-green-900 mr-3"}," Assign ",8,Yt),e("button",{onClick:z(I=>j(a.name),["stop"]),class:"text-blue-600 hover:text-blue-900"}," View ",8,es)])]))),128))])])])])])):V("",!0),n.value==="tasks"?(i(),u("div",ts,[g(pt)])):V("",!0),n.value==="analytics"?(i(),u("div",ss,[...t[19]||(t[19]=[L('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center"><svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><h3 class="text-lg font-medium text-gray-900 mb-2">Analytics Dashboard</h3><p class="text-gray-500">Performance metrics and reporting coming soon</p></div>',1)])])):V("",!0)]),g(b(se),{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=a=>v.value=a),options:{title:"Assign Request",size:"md"}},{"body-content":S(()=>[l.value?(i(),u("div",os,[e("div",ls,[e("div",as,d(l.value.request_number),1),e("div",rs,d(l.value.brief_description),1)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[D("Assign To "),e("span",{class:"text-red-500"},"*")],-1)),g(b(T),{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),type:"text",placeholder:"Enter email address",class:"w-full"},null,8,["modelValue"]),t[21]||(t[21]=e("p",{class:"mt-1 text-sm text-gray-500"},"Enter the email address of the staff member",-1))]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes (Optional)",-1)),O(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=a=>w.value=a),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Add any notes about this assignment..."},null,512),[[te,w.value]])])])):V("",!0)]),actions:S(()=>[g(b(F),{onClick:ne,variant:"outline"},{default:S(()=>[...t[23]||(t[23]=[D("Cancel",-1)])]),_:1}),g(b(F),{onClick:re,loading:h.value,variant:"solid",theme:"blue"},{default:S(()=>[...t[24]||(t[24]=[D(" Assign Request ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}};export{ms as default};
//# sourceMappingURL=InternalRequestManagement-DJ7w456D.js.map
