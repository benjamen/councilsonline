{"version":3,"file":"useStatutoryClock-DXU6obFS.js","sources":["../../../../frontend/src/composables/useStatutoryClock.js"],"sourcesContent":["import { computed, ref, watch } from 'vue'\nimport { createResource } from 'frappe-ui'\n\n/**\n * Composable for managing statutory clock data\n *\n * For Resource Consent requests, fetches clock data from Resource Consent Application.\n * For other request types (Building Consent, etc.), will fetch from their respective applications.\n * Falls back to Request fields for backward compatibility during migration.\n *\n * @param {Object} request - The request resource from frappe-ui\n * @returns {Object} Statutory clock data and methods\n */\nexport function useStatutoryClock(request) {\n  // Fetch Resource Consent Application if this is a Resource Consent\n  const consentApplication = createResource({\n    url: 'frappe.client.get_list',\n    params: {\n      doctype: 'Resource Consent Application',\n      filters: { request: request.data?.name },\n      fields: [\n        'name',\n        'statutory_clock_started',\n        'statutory_clock_stopped',\n        'working_days_elapsed',\n        'working_days_remaining'\n      ],\n      limit: 1\n    },\n    auto: false\n  })\n\n  // Auto-fetch when request data is available\n  watch(() => request.data, (newData) => {\n    if (newData && newData.request_category === 'Resource Consent' && newData.name) {\n      consentApplication.reload()\n    }\n  }, { immediate: true })\n\n  /**\n   * Get statutory clock data from the appropriate source\n   */\n  const clockData = computed(() => {\n    // For Resource Consent, prefer RC Application data\n    if (request.data?.request_category === 'Resource Consent') {\n      const rcApp = consentApplication.data?.[0]\n      if (rcApp) {\n        return {\n          statutory_clock_started: rcApp.statutory_clock_started,\n          statutory_clock_stopped: rcApp.statutory_clock_stopped,\n          working_days_elapsed: rcApp.working_days_elapsed || 0,\n          working_days_remaining: rcApp.working_days_remaining || 0,\n          source: 'Resource Consent Application'\n        }\n      }\n    }\n\n    // Fallback to Request fields (deprecated, for backward compatibility)\n    return {\n      statutory_clock_started: request.data?.statutory_clock_started,\n      statutory_clock_stopped: request.data?.statutory_clock_stopped,\n      working_days_elapsed: request.data?.working_days_elapsed || 0,\n      working_days_remaining: request.data?.working_days_remaining || 0,\n      source: 'Request (deprecated)'\n    }\n  })\n\n  /**\n   * Calculate progress percentage for visual indicators\n   */\n  const progressPercent = computed(() => {\n    const elapsed = clockData.value.working_days_elapsed\n    const total = request.data?.statutory_timeframe || 20\n    return Math.min((elapsed / total) * 100, 100)\n  })\n\n  /**\n   * Check if clock is currently running\n   */\n  const isClockRunning = computed(() => {\n    return clockData.value.statutory_clock_started && !clockData.value.statutory_clock_stopped\n  })\n\n  /**\n   * Check if request is overdue\n   */\n  const isOverdue = computed(() => {\n    return clockData.value.working_days_remaining < 0 || request.data?.is_overdue\n  })\n\n  return {\n    clockData,\n    progressPercent,\n    isClockRunning,\n    isOverdue,\n    loading: computed(() => consentApplication.loading)\n  }\n}\n"],"names":["useStatutoryClock","request","consentApplication","createResource","_a","watch","newData","clockData","computed","rcApp","_b","_c","_d","_e","_f","progressPercent","elapsed","total","isClockRunning","isOverdue"],"mappings":"sDAaO,SAASA,EAAkBC,EAAS,OAEzC,MAAMC,EAAqBC,EAAe,CACxC,IAAK,yBACL,OAAQ,CACN,QAAS,+BACT,QAAS,CAAE,SAASC,EAAAH,EAAQ,OAAR,YAAAG,EAAc,IAAI,EACtC,OAAQ,CACN,OACA,0BACA,0BACA,uBACA,wBACR,EACM,MAAO,CACb,EACI,KAAM,EACV,CAAG,EAGDC,EAAM,IAAMJ,EAAQ,KAAOK,GAAY,CACjCA,GAAWA,EAAQ,mBAAqB,oBAAsBA,EAAQ,MACxEJ,EAAmB,OAAM,CAE7B,EAAG,CAAE,UAAW,EAAI,CAAE,EAKtB,MAAMK,EAAYC,EAAS,IAAM,iBAE/B,KAAIJ,EAAAH,EAAQ,OAAR,YAAAG,EAAc,oBAAqB,mBAAoB,CACzD,MAAMK,GAAQC,EAAAR,EAAmB,OAAnB,YAAAQ,EAA0B,GACxC,GAAID,EACF,MAAO,CACL,wBAAyBA,EAAM,wBAC/B,wBAAyBA,EAAM,wBAC/B,qBAAsBA,EAAM,sBAAwB,EACpD,uBAAwBA,EAAM,wBAA0B,EACxD,OAAQ,8BAClB,CAEI,CAGA,MAAO,CACL,yBAAyBE,EAAAV,EAAQ,OAAR,YAAAU,EAAc,wBACvC,yBAAyBC,EAAAX,EAAQ,OAAR,YAAAW,EAAc,wBACvC,uBAAsBC,EAAAZ,EAAQ,OAAR,YAAAY,EAAc,uBAAwB,EAC5D,yBAAwBC,EAAAb,EAAQ,OAAR,YAAAa,EAAc,yBAA0B,EAChE,OAAQ,sBACd,CACE,CAAC,EAKKC,EAAkBP,EAAS,IAAM,OACrC,MAAMQ,EAAUT,EAAU,MAAM,qBAC1BU,IAAQb,EAAAH,EAAQ,OAAR,YAAAG,EAAc,sBAAuB,GACnD,OAAO,KAAK,IAAKY,EAAUC,EAAS,IAAK,GAAG,CAC9C,CAAC,EAKKC,EAAiBV,EAAS,IACvBD,EAAU,MAAM,yBAA2B,CAACA,EAAU,MAAM,uBACpE,EAKKY,EAAYX,EAAS,IAAM,OAC/B,OAAOD,EAAU,MAAM,uBAAyB,KAAKH,EAAAH,EAAQ,OAAR,YAAAG,EAAc,WACrE,CAAC,EAED,MAAO,CACL,UAAAG,EACA,gBAAAQ,EACA,eAAAG,EACA,UAAAC,EACA,QAASX,EAAS,IAAMN,EAAmB,OAAO,CACtD,CACA"}