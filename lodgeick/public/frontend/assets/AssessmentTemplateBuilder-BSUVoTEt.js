var p=(V,b,m)=>new Promise((v,y)=>{var x=u=>{try{a(m.next(u))}catch(_){y(_)}},f=u=>{try{a(m.throw(u))}catch(_){y(_)}},a=u=>u.done?v(u.value):Promise.resolve(u.value).then(x,f);a((m=m.apply(V,b)).next())});import{a5 as K,B as g,z as Q,D as X,a as l,o as r,b as t,e as k,t as d,a6 as c,ae as w,ak as R,F as S,W as C,at as D,_ as T,a7 as Y}from"./vue-vendor-D9RCx05D.js";import{a as q}from"./frappe-ui-E4oUKPDc.js";import"./ui-components-88qJBhde.js";const Z={class:"min-h-screen bg-gray-50"},ee={class:"bg-white shadow-sm border-b border-gray-200"},te={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},se={class:"flex items-center justify-between"},oe={class:"flex gap-3"},ae=["disabled"],le=["disabled"],re={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ne={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},de={class:"lg:col-span-1 space-y-6"},ie={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ue={class:"space-y-4"},ce=["value"],ge={class:"flex items-center"},me={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},pe={key:0,class:"text-center py-4 text-gray-500"},be={key:1,class:"text-center py-4 text-gray-500"},ye={key:2,class:"space-y-2"},fe=["onClick"],ve={class:"font-medium text-gray-900"},xe={class:"text-xs text-gray-500 mt-1"},_e={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},he={class:"space-y-3"},we={class:"lg:col-span-2"},ke={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},Se={key:0,class:"text-center py-12 text-gray-500"},Ce={key:1,class:"space-y-4"},qe=["onClick"],Ue={class:"flex items-center gap-3"},Ne={class:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 font-semibold text-sm"},Oe={class:"font-medium text-gray-900"},Te={class:"text-xs text-gray-500"},Ve={class:"flex items-center gap-2"},Le=["onClick"],je=["onClick"],Re=["onClick"],De={class:"text-gray-400"},Fe={class:"p-4 space-y-4"},Je={class:"grid grid-cols-2 gap-4"},$e=["onUpdate:modelValue"],Ae=["value"],Be={key:0,class:"mt-1 text-xs text-gray-500"},Ie=["onUpdate:modelValue"],Ee=["onUpdate:modelValue"],Me={class:"flex items-center"},ze=["onUpdate:modelValue"],Pe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},He={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},We={key:0,class:"text-center py-4 text-gray-500"},Ge={key:1,class:"space-y-2 max-h-96 overflow-y-auto"},Ke=["onClick"],Qe={class:"font-medium text-gray-900"},Xe={class:"text-xs text-gray-500 mt-1"},Ye={class:"mt-4 flex justify-end gap-2"},Ze={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},et={class:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4"},tt={class:"mt-4 flex justify-end gap-2"},rt={__name:"AssessmentTemplateBuilder",setup(V){K();const b=g(!1),m=g(!1),v=g(!1),y=g(!1),x=g(!1),f=g(""),a=Q({name:"",template_name:"",request_type:"",is_active:1,default_budget_hours:null,description:"",stages:[]}),u=g([]),_=g([]),U=g([]),h=g({});X(()=>p(this,null,function*(){yield F(),yield J(),yield L(),O()}));function F(){return p(this,null,function*(){try{const o=yield q("frappe.client.get_list",{doctype:"Request Type",fields:["name","type_name"],filters:{is_active:1},order_by:"type_name"});_.value=o}catch(o){console.error("Failed to load request types:",o)}})}function J(){return p(this,null,function*(){try{const o=yield q("lodgeick.api.get_assessment_stage_types");o.success&&(U.value=o.stage_types)}catch(o){console.error("Failed to load stage types:",o)}})}function L(){return p(this,null,function*(){v.value=!0;try{const o=yield q("lodgeick.api.get_assessment_templates");o.success&&(u.value=o.templates)}catch(o){console.error("Failed to load template library:",o)}finally{v.value=!1}})}function j(o){return p(this,null,function*(){b.value=!0;try{const e=yield q("lodgeick.api.load_assessment_template",{template_name:o});e.success&&(Object.assign(a,e.template),O(),y.value=!1)}catch(e){console.error("Failed to load template:",e),alert("Failed to load template: "+e.message)}finally{b.value=!1}})}function $(o){return p(this,null,function*(){yield j(o)})}function A(){return p(this,null,function*(){if(!a.template_name){alert("Please enter a template name");return}if(a.stages.length===0){alert("Please add at least one stage");return}if(!a.stages.some(e=>e.required)){alert("At least one stage must be marked as required");return}m.value=!0;try{const e=yield q("lodgeick.api.save_assessment_template",{config:a});e.success?(alert("Template saved successfully!"),a.name=e.template_name,yield L()):alert("Failed to save template: "+e.error)}catch(e){console.error("Failed to save template:",e),alert("Failed to save template: "+e.message)}finally{m.value=!1}})}function B(){const o=a.stages.length+1;a.stages.push({stage_number:o,stage_type:"",estimated_hours:null,required:0,description:""}),h.value[a.stages.length-1]=!0}function I(o){confirm("Are you sure you want to delete this stage?")&&(a.stages.splice(o,1),N())}function E(o){if(o>0){const e=a.stages[o];a.stages[o]=a.stages[o-1],a.stages[o-1]=e,N()}}function M(o){if(o<a.stages.length-1){const e=a.stages[o];a.stages[o]=a.stages[o+1],a.stages[o+1]=e,N()}}function N(){a.stages.forEach((o,e)=>{o.stage_number=e+1})}function z(o){h.value[o]=!h.value[o]}function O(){a.stages.forEach((o,e)=>{h.value[e]=!0})}function P(o){const e=U.value.find(s=>s.name===o);return e?e.stage_type_name:""}function H(o){var s;const e=U.value.find(n=>n.name===o);return e?(s=e.description)==null?void 0:s.replace(/<[^>]*>/g,""):""}function W(){const o=JSON.stringify(a,null,2),e=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=`${a.template_name||"template"}.json`,n.click(),URL.revokeObjectURL(s)}function G(){try{const o=JSON.parse(f.value);Object.assign(a,o),O(),x.value=!1,f.value="",alert("Template imported successfully!")}catch(o){alert("Invalid JSON: "+o.message)}}return(o,e)=>(r(),l("div",Z,[t("div",ee,[t("div",te,[t("div",se,[e[10]||(e[10]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"Assessment Template Builder"),t("p",{class:"mt-1 text-sm text-gray-500"},"Visual configuration editor for Assessment Templates")],-1)),t("div",oe,[t("button",{onClick:e[0]||(e[0]=s=>y.value=!0),disabled:b.value,class:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},d(b.value?"Loading...":"Load Template"),9,ae),t("button",{onClick:A,disabled:m.value||b.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},d(m.value?"Saving...":"Save Template"),9,le)])])])]),t("div",re,[t("div",ne,[t("div",de,[t("div",ie,[e[17]||(e[17]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Basic Information",-1)),t("div",ue,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Template Name",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.template_name=s),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Resource Consent - Standard"},null,512),[[w,a.template_name]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Request Type",-1)),c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.request_type=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[12]||(e[12]=t("option",{value:""},"Select Request Type",-1)),(r(!0),l(S,null,C(_.value,s=>(r(),l("option",{key:s.name,value:s.name},d(s.type_name),9,ce))),128))],512),[[R,a.request_type]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Default Budget Hours",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.default_budget_hours=s),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"40"},null,512),[[w,a.default_budget_hours,void 0,{number:!0}]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),c(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.description=s),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Describe this template..."},null,512),[[w,a.description]])]),t("div",ge,[c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.is_active=s),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[D,a.is_active]]),e[16]||(e[16]=t("label",{class:"ml-2 text-sm text-gray-700"},"Is Active",-1))])])]),t("div",me,[e[18]||(e[18]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Template Library",-1)),v.value?(r(),l("div",pe," Loading templates... ")):u.value.length===0?(r(),l("div",be," No templates available ")):(r(),l("div",ye,[(r(!0),l(S,null,C(u.value,s=>(r(),l("button",{key:s.name,onClick:n=>$(s.name),class:"w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"},[t("div",ve,d(s.template_name),1),t("div",xe,d(s.stage_count)+" stages · "+d(s.default_budget_hours)+"h budget ",1)],8,fe))),128))]))]),t("div",_e,[e[19]||(e[19]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"JSON Export/Import",-1)),t("div",he,[t("button",{onClick:W,class:"w-full px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50"}," Export JSON "),t("button",{onClick:e[6]||(e[6]=s=>x.value=!0),class:"w-full px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50"}," Import JSON ")])])]),t("div",we,[t("div",ke,[t("div",{class:"flex items-center justify-between mb-6"},[e[20]||(e[20]=t("h2",{class:"text-lg font-semibold text-gray-900"},"Assessment Stages",-1)),t("button",{onClick:B,class:"px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700"}," + Add Stage ")]),a.stages.length===0?(r(),l("div",Se,[...e[21]||(e[21]=[t("p",null,"No stages configured yet.",-1),t("p",{class:"text-sm mt-2"},'Click "Add Stage" to get started.',-1)])])):(r(),l("div",Ce,[(r(!0),l(S,null,C(a.stages,(s,n)=>(r(),l("div",{key:n,class:"border border-gray-200 rounded-lg"},[t("div",{class:"bg-gray-50 px-4 py-3 flex items-center justify-between cursor-pointer",onClick:i=>z(n)},[t("div",Ue,[t("span",Ne,d(s.stage_number),1),t("div",null,[t("div",Oe,d(P(s.stage_type)||"Unnamed Stage"),1),t("div",Te,d(s.estimated_hours||0)+"h estimated "+d(s.required?"· Required":"· Optional"),1)])]),t("div",Ve,[n>0?(r(),l("button",{key:0,onClick:T(i=>E(n),["stop"]),class:"p-1 text-gray-400 hover:text-gray-600",title:"Move Up"}," ↑ ",8,Le)):k("",!0),n<a.stages.length-1?(r(),l("button",{key:1,onClick:T(i=>M(n),["stop"]),class:"p-1 text-gray-400 hover:text-gray-600",title:"Move Down"}," ↓ ",8,je)):k("",!0),t("button",{onClick:T(i=>I(n),["stop"]),class:"p-1 text-red-400 hover:text-red-600",title:"Delete"}," ✕ ",8,Re),t("span",De,d(h.value[n]?"▼":"▶"),1)])],8,qe),c(t("div",Fe,[t("div",Je,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Stage Type",-1)),c(t("select",{"onUpdate:modelValue":i=>s.stage_type=i,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[22]||(e[22]=t("option",{value:""},"Select Stage Type",-1)),(r(!0),l(S,null,C(U.value,i=>(r(),l("option",{key:i.name,value:i.name},d(i.stage_type_name),9,Ae))),128))],8,$e),[[R,s.stage_type]]),s.stage_type?(r(),l("p",Be,d(H(s.stage_type)),1)):k("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estimated Hours",-1)),c(t("input",{"onUpdate:modelValue":i=>s.estimated_hours=i,type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"8"},null,8,Ie),[[w,s.estimated_hours,void 0,{number:!0}]])])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),c(t("textarea",{"onUpdate:modelValue":i=>s.description=i,rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Optional description for this stage..."},null,8,Ee),[[w,s.description]])]),t("div",Me,[c(t("input",{"onUpdate:modelValue":i=>s.required=i,type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,ze),[[D,s.required]]),e[26]||(e[26]=t("label",{class:"ml-2 text-sm text-gray-700"},"Required Stage",-1))])],512),[[Y,h.value[n]]])]))),128))]))])])])]),y.value?(r(),l("div",Pe,[t("div",He,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold mb-4"},"Load Template",-1)),v.value?(r(),l("div",We," Loading templates... ")):(r(),l("div",Ge,[(r(!0),l(S,null,C(u.value,s=>(r(),l("button",{key:s.name,onClick:n=>j(s.name),class:"w-full text-left px-4 py-3 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50"},[t("div",Qe,d(s.template_name),1),t("div",Xe,d(s.request_type_name||"No request type")+" · "+d(s.stage_count)+" stages ",1)],8,Ke))),128))])),t("div",Ye,[t("button",{onClick:e[7]||(e[7]=s=>y.value=!1),class:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancel ")])])])):k("",!0),x.value?(r(),l("div",Ze,[t("div",et,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold mb-4"},"Import JSON",-1)),c(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>f.value=s),rows:"12",class:"w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm",placeholder:"Paste JSON configuration here..."},null,512),[[w,f.value]]),t("div",tt,[t("button",{onClick:e[9]||(e[9]=s=>{x.value=!1,f.value=""}),class:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50"}," Cancel "),t("button",{onClick:G,class:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700"}," Import ")])])])):k("",!0)]))}};export{rt as default};
//# sourceMappingURL=AssessmentTemplateBuilder-BSUVoTEt.js.map
