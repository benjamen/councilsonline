const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/errorStore-wyYz1zy3.js","assets/index-CeARk7V9.js","assets/index-C34I5Kxa.css"])))=>i.map(i=>d[i]);
var g=Object.defineProperty;var y=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var h=(o,e,t)=>e in o?g(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,_=(o,e)=>{for(var t in e||(e={}))R.call(e,t)&&h(o,t,e[t]);if(y)for(var t of y(e))q.call(e,t)&&h(o,t,e[t]);return o};var c=(o,e,t)=>new Promise((l,n)=>{var d=s=>{try{a(t.next(s))}catch(i){n(i)}},r=s=>{try{a(t.throw(s))}catch(i){n(i)}},a=s=>s.done?l(s.value):Promise.resolve(s.value).then(d,r);a((t=t.apply(o,e)).next())});import{n as x,K as S}from"./index-CeARk7V9.js";class E{constructor(){this.defaultOptions={onError:this.handleError.bind(this),onSuccess:this.handleSuccess.bind(this)}}createResource(e){return x(_(_({},this.defaultOptions),e))}handleError(e){console.error("[API Error]",e);const t=e!=null&&e.exc_type?e.exc_type:(e==null?void 0:e.message)||"An unexpected error occurred";return S(()=>c(this,null,function*(){const{useErrorStore:l}=yield import("./errorStore-wyYz1zy3.js");return{useErrorStore:l}}),__vite__mapDeps([0,1,2])).then(({useErrorStore:l})=>{l().addError({message:t,type:"api_error",context:e})}).catch(l=>{console.error("Could not add error to store:",l)}),{error:t}}handleSuccess(e){return e}call(l){return c(this,arguments,function*(e,t={}){try{console.log(`[BaseAPIClient] Calling ${e} with args:`,t),console.log("[BaseAPIClient] Args JSON:",JSON.stringify(t,null,2));const n={"Content-Type":"application/json"};window.csrf_token&&(n["X-Frappe-CSRF-Token"]=window.csrf_token);const d=yield fetch("/api/method/"+e,{method:"POST",headers:n,credentials:"include",body:JSON.stringify(t)});if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const r=yield d.json();if(r.exc)throw new Error(r.exc);return r.message}catch(n){throw this.handleError(n),n}})}uploadFile(l){return c(this,arguments,function*(e,t={}){for(let r=0;r<=3;r++)try{const a=new FormData;a.append("file",e),t.doctype&&a.append("doctype",t.doctype),t.docname&&a.append("docname",t.docname),t.fieldname&&a.append("fieldname",t.fieldname),t.is_private!==void 0&&a.append("is_private",t.is_private?"1":"0");const s={};window.csrf_token&&(s["X-Frappe-CSRF-Token"]=window.csrf_token);const i=yield fetch("/api/method/upload_file",{method:"POST",headers:s,credentials:"include",body:a});if(!i.ok){const p=yield i.json().catch(()=>({}));if(i.status===500&&p.exc_type==="OSError"&&r<3){const f=1e3*Math.pow(2,r);console.log(`File upload failed (attempt ${r+1}/4). Retrying in ${f}ms...`),yield new Promise(w=>setTimeout(w,f));continue}throw new Error(`Upload failed (${i.status}): ${p.exception||i.statusText}`)}const m=yield i.json();if(m.exc){if(m.exc_type==="OSError"&&r<3){const p=1e3*Math.pow(2,r);console.log(`File upload failed with OSError (attempt ${r+1}/4). Retrying in ${p}ms...`),yield new Promise(f=>setTimeout(f,p));continue}throw new Error(m.exc)}return m.message}catch(a){if(r===3)throw this.handleError(a),a;const s=1e3*Math.pow(2,r);console.log(`Upload error (attempt ${r+1}/4): ${a.message}. Retrying in ${s}ms...`),yield new Promise(i=>setTimeout(i,s))}})}}const u=new E;class T{createDraft(e,t){return c(this,null,function*(){return u.call("lodgeick.api.create_draft_request",{data:e,current_step:t})})}getRequest(e){return u.createResource({url:"frappe.client.get",params:{doctype:"Request",name:e},auto:!0})}getRequestTypeConfig(e){return u.createResource({url:"lodgeick.api.get_request_type_config",params:{request_type_code:e},auto:!0})}updateRequest(e,t){return c(this,null,function*(){return u.call("frappe.client.set_value",{doctype:"Request",name:e,fieldname:t})})}submitRequest(e){return c(this,null,function*(){return u.call("lodgeick.api.submit_request",{request_id:e})})}getUserRequests(){return u.createResource({url:"lodgeick.api.get_user_requests",auto:!0,cache:["user-requests"]})}getRequestsByStatus(e){return u.createResource({url:"frappe.client.get_list",params:{doctype:"Request",filters:{status:e},fields:["name","request_type","requester_name","status","created_at","brief_description"],order_by:"modified desc"},auto:!0})}deleteDraft(e){return c(this,null,function*(){return u.call("frappe.client.delete",{doctype:"Request",name:e})})}getRequestWithApplication(e){return c(this,null,function*(){return u.call("lodgeick.api.get_request_with_application",{request_id:e})})}validateStep(e,t,l){return c(this,null,function*(){return u.call("lodgeick.api.validate_request_step",{request_id:e,step_number:t,step_data:l})})}}const P=new T;export{P as r};
//# sourceMappingURL=request.service-C42Js821.js.map
