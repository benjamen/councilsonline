var h=Object.defineProperty;var f=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var _=(a,e,t)=>e in a?h(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,l=(a,e)=>{for(var t in e||(e={}))m.call(e,t)&&_(a,t,e[t]);if(f)for(var t of f(e))y.call(e,t)&&_(a,t,e[t]);return a};var n=(a,e,t)=>new Promise((o,r)=>{var c=i=>{try{d(t.next(i))}catch(p){r(p)}},u=i=>{try{d(t.throw(i))}catch(p){r(p)}},d=i=>i.done?o(i.value):Promise.resolve(i.value).then(c,u);d((t=t.apply(a,e)).next())});import{n as q}from"./index-DWx27wDU.js";class g{constructor(){this.defaultOptions={onError:this.handleError.bind(this),onSuccess:this.handleSuccess.bind(this)}}createResource(e){return q(l(l({},this.defaultOptions),e))}handleError(e){console.error("[API Error]",e);const t=e!=null&&e.exc_type?e.exc_type:(e==null?void 0:e.message)||"An unexpected error occurred";try{const{useErrorStore:o}=require("../../stores/errorStore");o().addError({message:t,type:"api_error",context:e})}catch(o){console.error("Could not add error to store:",o)}return{error:t}}handleSuccess(e){return e}call(o){return n(this,arguments,function*(e,t={}){try{const r=yield fetch("/api/method/"+e,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify(t)});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const c=yield r.json();if(c.exc)throw new Error(c.exc);return c.message}catch(r){throw this.handleError(r),r}})}uploadFile(o){return n(this,arguments,function*(e,t={}){try{const r=new FormData;r.append("file",e),t.doctype&&r.append("doctype",t.doctype),t.docname&&r.append("docname",t.docname),t.fieldname&&r.append("fieldname",t.fieldname),t.is_private!==void 0&&r.append("is_private",t.is_private?"1":"0");const c=yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":window.csrf_token},body:r});if(!c.ok)throw new Error(`Upload failed: ${c.statusText}`);const u=yield c.json();if(u.exc)throw new Error(u.exc);return u.message}catch(r){throw this.handleError(r),r}})}}const s=new g;class w{createDraft(e,t){return n(this,null,function*(){return s.call("lodgeick.api.create_draft_request",{data:e,current_step:t})})}getRequest(e){return s.createResource({url:"frappe.client.get",params:{doctype:"Request",name:e},auto:!0})}getRequestTypeConfig(e){return s.createResource({url:"lodgeick.api.get_request_type_config",params:{request_type_code:e},auto:!0,cache:["request-type-config",e]})}updateRequest(e,t){return n(this,null,function*(){return s.call("frappe.client.set_value",{doctype:"Request",name:e,fieldname:t})})}submitRequest(e){return n(this,null,function*(){return s.call("lodgeick.api.submit_request",{request_id:e})})}getUserRequests(){return s.createResource({url:"lodgeick.api.get_user_requests",auto:!0,cache:["user-requests"]})}getRequestsByStatus(e){return s.createResource({url:"frappe.client.get_list",params:{doctype:"Request",filters:{status:e},fields:["name","request_type","requester_name","status","created_at","brief_description"],order_by:"modified desc"},auto:!0})}deleteDraft(e){return n(this,null,function*(){return s.call("frappe.client.delete",{doctype:"Request",name:e})})}getRequestWithApplication(e){return n(this,null,function*(){return s.call("lodgeick.api.get_request_with_application",{request_id:e})})}validateStep(e,t,o){return n(this,null,function*(){return s.call("lodgeick.api.validate_request_step",{request_id:e,step_number:t,step_data:o})})}}const k=new w;export{k as r};
//# sourceMappingURL=request.service-BDj7ptlU.js.map
