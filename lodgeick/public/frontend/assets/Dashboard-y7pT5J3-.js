var G=Object.defineProperty;var B=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var U=(i,s,o)=>s in i?G(i,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[s]=o,T=(i,s)=>{for(var o in s||(s={}))J.call(s,o)&&U(i,o,s[o]);if(B)for(var o of B(s))Q.call(s,o)&&U(i,o,s[o]);return i};var x=(i,s,o)=>new Promise((f,n)=>{var l=u=>{try{v(o.next(u))}catch(h){n(h)}},c=u=>{try{v(o.throw(u))}catch(h){n(h)}},v=u=>u.done?f(u.value):Promise.resolve(u.value).then(l,c);v((o=o.apply(i,s)).next())});import{j as Z,f as K,k as b,s as D,r as C,c as p,o as m,a as e,g as M,b as y,w,h as F,u as k,i as $,t as d,I as Y,l as N,v as A,F as P,m as L,d as O,n as H}from"./index-B1OgS4l7.js";import{D as ee}from"./Dropdown-BxwxeWG6.js";import{_ as te}from"./StatusBadge-B9O3TobK.js";import{_ as S}from"./StatCard-xBMeXNrD.js";class se{constructor(){this.defaultOptions={onError:this.handleError.bind(this),onSuccess:this.handleSuccess.bind(this)}}createResource(s){return Z(T(T({},this.defaultOptions),s))}handleError(s){console.error("[API Error]",s);const o=s!=null&&s.exc_type?s.exc_type:(s==null?void 0:s.message)||"An unexpected error occurred";try{const{useErrorStore:f}=require("../../stores/errorStore");f().addError({message:o,type:"api_error",context:s})}catch(f){console.error("Could not add error to store:",f)}return{error:o}}handleSuccess(s){return s}call(f){return x(this,arguments,function*(s,o={}){try{const n=yield fetch("/api/method/"+s,{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify(o)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const l=yield n.json();if(l.exc)throw new Error(l.exc);return l.message}catch(n){throw this.handleError(n),n}})}uploadFile(f){return x(this,arguments,function*(s,o={}){try{const n=new FormData;n.append("file",s),o.doctype&&n.append("doctype",o.doctype),o.docname&&n.append("docname",o.docname),o.fieldname&&n.append("fieldname",o.fieldname),o.is_private!==void 0&&n.append("is_private",o.is_private?"1":"0");const l=yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":window.csrf_token},body:n});if(!l.ok)throw new Error(`Upload failed: ${l.statusText}`);const c=yield l.json();if(c.exc)throw new Error(c.exc);return c.message}catch(n){throw this.handleError(n),n}})}}const g=new se;class oe{createDraft(s,o){return x(this,null,function*(){return g.call("lodgeick.api.create_draft_request",{data:s,current_step:o})})}getRequest(s){return g.createResource({url:"frappe.client.get",params:{doctype:"Request",name:s},auto:!0})}getRequestTypeConfig(s){return g.createResource({url:"lodgeick.api.get_request_type_config",params:{request_type_code:s},auto:!0,cache:["request-type-config",s]})}updateRequest(s,o){return x(this,null,function*(){return g.call("frappe.client.set_value",{doctype:"Request",name:s,fieldname:o})})}submitRequest(s){return x(this,null,function*(){return g.call("lodgeick.api.submit_request",{request_id:s})})}getUserRequests(){return g.createResource({url:"lodgeick.api.get_user_requests",auto:!0,cache:["user-requests"]})}getRequestsByStatus(s){return g.createResource({url:"frappe.client.get_list",params:{doctype:"Request",filters:{status:s},fields:["name","request_type","applicant_name","status","created_at","brief_description"],order_by:"modified desc"},auto:!0})}deleteDraft(s){return x(this,null,function*(){return g.call("frappe.client.delete",{doctype:"Request",name:s})})}getRequestWithApplication(s){return x(this,null,function*(){return g.call("lodgeick.api.get_request_with_application",{request_id:s})})}validateStep(s,o,f){return x(this,null,function*(){return g.call("lodgeick.api.validate_request_step",{request_id:s,step_number:o,step_data:f})})}}const re=new oe;apiClient,requestService,councilService,userService,applicationService,requestTypeService,rfqService,documentService;const ae={class:"min-h-screen bg-gray-50"},ne={class:"bg-white shadow-sm border-b border-gray-200"},le={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},ie={class:"flex justify-between items-center py-4"},ue={class:"flex items-center space-x-4"},de={class:"flex items-center space-x-2 text-gray-700 hover:text-gray-900"},ce={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},pe={class:"text-sm font-medium text-blue-600"},me={class:"text-sm font-medium"},ge={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},fe={class:"mb-8"},xe={class:"text-2xl font-bold text-gray-900 mb-2"},ye={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},ve={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6"},he={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},_e={class:"md:col-span-2"},be=["value"],we={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ke={key:0,class:"p-12 text-center"},Re={key:1,class:"p-12 text-center"},Ce={class:"text-gray-500 mb-6"},Se={key:2,class:"overflow-x-auto"},qe={class:"w-full"},Te={class:"bg-white divide-y divide-gray-200"},De=["onClick"],Ne={class:"px-6 py-4 whitespace-nowrap"},Ae={class:"text-sm font-medium text-blue-600"},Ve={class:"px-6 py-4 whitespace-nowrap"},je={class:"text-sm text-gray-900"},Ee={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"text-sm text-gray-900"},Be={class:"px-6 py-4"},Ue={class:"text-sm text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"px-6 py-4 whitespace-nowrap"},$e={class:"text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap"},Le={class:"text-sm text-gray-900"},Oe={key:0,class:"text-xs text-gray-500"},He={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},ze=["onClick"],We=["onClick"],et={__name:"Dashboard",setup(i){const s=K(),o=b(()=>{var t;return(((t=D.user_info)==null?void 0:t.full_name)||D.user).replace("@"," ").split(".").join(" ")}),f=b(()=>{const a=o.value,t=a.split(" ");return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():a.substring(0,2).toUpperCase()}),n=C(""),l=C(""),c=C(""),v=C(""),u=re.getUserRequests(),h=b(()=>{const a=u.data||[];return[...new Set(a.map(r=>r.council).filter(Boolean))].sort()}),R=b(()=>{const a=u.data||[];return{total:a.length,underReview:a.filter(t=>t.status==="Under Review").length,approved:a.filter(t=>t.status==="Approved").length,rfiPending:a.filter(t=>t.status==="RFI Issued").length}}),q=b(()=>{let a=u.data||[];if(n.value){const t=n.value.toLowerCase();a=a.filter(r=>{var _,E,I;return((_=r.request_number)==null?void 0:_.toLowerCase().includes(t))||((E=r.property_address)==null?void 0:E.toLowerCase().includes(t))||((I=r.brief_description)==null?void 0:I.toLowerCase().includes(t))})}return l.value&&(a=a.filter(t=>t.status===l.value)),c.value&&(a=a.filter(t=>t.council===c.value)),v.value&&(a=a.filter(t=>{var r;return(r=t.request_type)==null?void 0:r.includes(v.value)})),a}),z=a=>a?new Date(a).toLocaleDateString("en-NZ",{year:"numeric",month:"short",day:"numeric"}):"N/A",V=()=>{s.push({name:"NewRequest"})},j=a=>{s.push({name:"RequestDetail",params:{id:a}})},W=a=>{s.push({name:"RequestDetail",params:{id:a}})},X=[{label:"Staff Portal",onClick:()=>{s.push({name:"InternalRequestManagement"})}},{label:"Settings",onClick:()=>{s.push({name:"Settings"})}},{label:"Sign Out",onClick:()=>D.logout.submit()}];return(a,t)=>(m(),p("div",ae,[e("header",ne,[e("div",le,[e("div",ie,[t[7]||(t[7]=M('<div class="flex items-center space-x-3"><div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><div><h1 class="text-xl font-bold text-gray-900">Lodgeick</h1><p class="text-xs text-gray-500">Council Request Management</p></div></div>',1)),e("div",ue,[y(k($),{onClick:V,variant:"solid",theme:"blue"},{prefix:w(()=>[...t[4]||(t[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:w(()=>[t[5]||(t[5]=F(" New Request ",-1))]),_:1}),y(k(ee),{options:X},{default:w(({open:r})=>[e("button",de,[e("div",ce,[e("span",pe,d(f.value),1)]),e("span",me,d(o.value),1),t[6]||(t[6]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))])]),_:1})])])])]),e("main",ge,[e("div",fe,[e("h2",xe,"Welcome back, "+d(o.value)+"!",1),t[8]||(t[8]=e("p",{class:"text-gray-600"},"Manage your council requests and track their progress",-1))]),e("div",ye,[y(S,{title:"Total Requests",value:R.value.total,icon:"file-text",color:"blue"},null,8,["value"]),y(S,{title:"Under Review",value:R.value.underReview,icon:"clock",color:"yellow"},null,8,["value"]),y(S,{title:"Approved",value:R.value.approved,icon:"check-circle",color:"green"},null,8,["value"]),y(S,{title:"Info Requested",value:R.value.rfiPending,icon:"alert-circle",color:"orange"},null,8,["value"])]),e("div",ve,[e("div",he,[e("div",_e,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Search",-1)),y(k(Y),{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=r=>n.value=r),placeholder:"Search by request number or property...",type:"text"},{prefix:w(()=>[...t[9]||(t[9]=[e("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)])]),_:1},8,["modelValue"])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),N(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>l.value=r),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[11]||(t[11]=[M('<option value="">All Statuses</option><option value="Draft">Draft</option><option value="Submitted">Submitted</option><option value="Under Review">Under Review</option><option value="RFI Issued">RFI Issued</option><option value="Approved">Approved</option><option value="Declined">Declined</option>',7)])],512),[[A,l.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Council",-1)),N(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>c.value=r),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[13]||(t[13]=e("option",{value:""},"All Councils",-1)),(m(!0),p(P,null,L(h.value,r=>(m(),p("option",{key:r,value:r},d(r),9,be))),128))],512),[[A,c.value]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type",-1)),N(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>v.value=r),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...t[15]||(t[15]=[e("option",{value:""},"All Types",-1),e("option",{value:"Resource Consent"},"Resource Consent",-1),e("option",{value:"Building Consent"},"Building Consent",-1)])],512),[[A,v.value]])])])]),e("div",we,[t[22]||(t[22]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"My Applications")],-1)),k(u).loading?(m(),p("div",ke,[...t[17]||(t[17]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("p",{class:"mt-4 text-gray-500"},"Loading applications...",-1)])])):!q.value||q.value.length===0?(m(),p("div",Re,[t[19]||(t[19]=e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t[20]||(t[20]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No applications found",-1)),e("p",Ce,d(n.value?"Try adjusting your search or filters":"Get started by creating your first application"),1),y(k($),{onClick:V,variant:"solid",theme:"blue"},{default:w(()=>[...t[18]||(t[18]=[F(" Create New Application ",-1)])]),_:1})])):(m(),p("div",Se,[e("table",qe,[t[21]||(t[21]=e("thead",{class:"bg-gray-50 border-b border-gray-200"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Request #"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Council"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Type"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Property"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Submitted"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Days Elapsed"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",Te,[(m(!0),p(P,null,L(q.value,r=>(m(),p("tr",{key:r.name,class:"hover:bg-gray-50 transition cursor-pointer",onClick:_=>j(r.name)},[e("td",Ne,[e("div",Ae,d(r.request_number),1)]),e("td",Ve,[e("div",je,d(r.council||"N/A"),1)]),e("td",Ee,[e("div",Ie,d(r.request_type),1)]),e("td",Be,[e("div",Ue,d(r.property_address||"N/A"),1)]),e("td",Me,[y(te,{status:r.status},null,8,["status"])]),e("td",Fe,[e("div",$e,d(z(r.creation)),1)]),e("td",Pe,[e("div",Le,d(r.working_days_elapsed||0)+" days",1),r.statutory_clock_started?(m(),p("div",Oe," of 20 day limit ")):O("",!0)]),e("td",He,[e("button",{onClick:H(_=>j(r.name),["stop"]),class:"text-blue-600 hover:text-blue-900 mr-4"}," View ",8,ze),r.status==="Draft"?(m(),p("button",{key:0,onClick:H(_=>W(r.name),["stop"]),class:"text-gray-600 hover:text-gray-900"}," Edit ",8,We)):O("",!0)])],8,De))),128))])])]))])])]))}};export{et as default};
//# sourceMappingURL=Dashboard-y7pT5J3-.js.map
