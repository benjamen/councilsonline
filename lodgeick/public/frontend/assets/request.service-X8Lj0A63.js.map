{"version":3,"file":"request.service-X8Lj0A63.js","sources":["../../../../frontend/src/services/api/base.js","../../../../frontend/src/services/api/request.service.js"],"sourcesContent":["import { createResource } from 'frappe-ui'\n\n/**\n * Base API client with standardized error handling\n * Uses frappe-ui's createResource for consistency\n */\nexport class BaseAPIClient {\n\tconstructor() {\n\t\tthis.defaultOptions = {\n\t\t\tonError: this.handleError.bind(this),\n\t\t\tonSuccess: this.handleSuccess.bind(this)\n\t\t}\n\t}\n\n\t/**\n\t * Create Frappe resource with standard options\n\t * @param {Object} config - Resource configuration\n\t * @returns {Object} Frappe resource instance\n\t */\n\tcreateResource(config) {\n\t\treturn createResource({\n\t\t\t...this.defaultOptions,\n\t\t\t...config\n\t\t})\n\t}\n\n\t/**\n\t * Standardized error handler\n\t * @param {Object|Error} error - Error object\n\t * @returns {Object} Error response\n\t */\n\thandleError(error) {\n\t\tconsole.error('[API Error]', error)\n\n\t\t// Extract error message\n\t\tconst message = error?.exc_type\n\t\t\t? error.exc_type\n\t\t\t: error?.message || 'An unexpected error occurred'\n\n\t\t// Store error in global error state\n\t\ttry {\n\t\t\tconst { useErrorStore } = require('../../stores/errorStore')\n\t\t\tconst errorStore = useErrorStore()\n\t\t\terrorStore.addError({ message, type: 'api_error', context: error })\n\t\t} catch (e) {\n\t\t\t// Fail silently if store not available\n\t\t\tconsole.error('Could not add error to store:', e)\n\t\t}\n\n\t\treturn { error: message }\n\t}\n\n\t/**\n\t * Success handler with optional logging\n\t * @param {*} data - Response data\n\t * @returns {*} Response data\n\t */\n\thandleSuccess(data) {\n\t\treturn data\n\t}\n\n\t/**\n\t * Call Frappe method directly (for non-resource calls)\n\t * @param {string} method - Frappe method path (e.g., 'lodgeick.api.create_draft_request')\n\t * @param {Object} args - Method arguments\n\t * @returns {Promise<*>} Response data\n\t */\n\tasync call(method, args = {}) {\n\t\ttry {\n\t\t\tconst response = await fetch('/api/method/' + method, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'X-Frappe-CSRF-Token': window.csrf_token\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(args)\n\t\t\t})\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`HTTP ${response.status}: ${response.statusText}`)\n\t\t\t}\n\n\t\t\tconst data = await response.json()\n\n\t\t\tif (data.exc) {\n\t\t\t\tthrow new Error(data.exc)\n\t\t\t}\n\n\t\t\treturn data.message\n\t\t} catch (error) {\n\t\t\tthis.handleError(error)\n\t\t\tthrow error\n\t\t}\n\t}\n\n\t/**\n\t * Upload file to Frappe\n\t * @param {File} file - File object\n\t * @param {Object} options - Upload options (doctype, docname, fieldname, etc.)\n\t * @returns {Promise<Object>} File document\n\t */\n\tasync uploadFile(file, options = {}) {\n\t\ttry {\n\t\t\tconst formData = new FormData()\n\t\t\tformData.append('file', file)\n\n\t\t\tif (options.doctype) formData.append('doctype', options.doctype)\n\t\t\tif (options.docname) formData.append('docname', options.docname)\n\t\t\tif (options.fieldname) formData.append('fieldname', options.fieldname)\n\t\t\tif (options.is_private !== undefined) {\n\t\t\t\tformData.append('is_private', options.is_private ? '1' : '0')\n\t\t\t}\n\n\t\t\tconst response = await fetch('/api/method/upload_file', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'X-Frappe-CSRF-Token': window.csrf_token\n\t\t\t\t},\n\t\t\t\tbody: formData\n\t\t\t})\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`Upload failed: ${response.statusText}`)\n\t\t\t}\n\n\t\t\tconst data = await response.json()\n\n\t\t\tif (data.exc) {\n\t\t\t\tthrow new Error(data.exc)\n\t\t\t}\n\n\t\t\treturn data.message\n\t\t} catch (error) {\n\t\t\tthis.handleError(error)\n\t\t\tthrow error\n\t\t}\n\t}\n}\n\nexport const apiClient = new BaseAPIClient()\n","import { apiClient } from './base'\n\n/**\n * Request Service\n * Handles all Request DocType operations (CRUD, submit, drafts)\n */\nexport class RequestService {\n\t/**\n\t * Create or update draft request\n\t * @param {Object} data - Form data\n\t * @param {number} currentStep - Current step number\n\t * @returns {Promise<Object>} Response with request_id\n\t */\n\tasync createDraft(data, currentStep) {\n\t\treturn apiClient.call('lodgeick.api.create_draft_request', {\n\t\t\tdata,\n\t\t\tcurrent_step: currentStep\n\t\t})\n\t}\n\n\t/**\n\t * Get request by ID\n\t * @param {string} requestId - Request name/ID\n\t * @returns {Object} Frappe resource\n\t */\n\tgetRequest(requestId) {\n\t\treturn apiClient.createResource({\n\t\t\turl: 'frappe.client.get',\n\t\t\tparams: {\n\t\t\t\tdoctype: 'Request',\n\t\t\t\tname: requestId\n\t\t\t},\n\t\t\tauto: true\n\t\t})\n\t}\n\n\t/**\n\t * Get request type configuration\n\t * @param {string} requestTypeCode - Request type code\n\t * @returns {Object} Frappe resource\n\t */\n\tgetRequestTypeConfig(requestTypeCode) {\n\t\treturn apiClient.createResource({\n\t\t\turl: 'lodgeick.api.get_request_type_config',\n\t\t\tparams: { request_type_code: requestTypeCode },\n\t\t\tauto: true,\n\t\t\tcache: ['request-type-config', requestTypeCode]\n\t\t})\n\t}\n\n\t/**\n\t * Update request fields\n\t * @param {string} requestId - Request name/ID\n\t * @param {Object} fields - Fields to update (key-value pairs)\n\t * @returns {Promise<void>}\n\t */\n\tasync updateRequest(requestId, fields) {\n\t\treturn apiClient.call('frappe.client.set_value', {\n\t\t\tdoctype: 'Request',\n\t\t\tname: requestId,\n\t\t\tfieldname: fields\n\t\t})\n\t}\n\n\t/**\n\t * Submit request (move from Draft to Submitted state)\n\t * @param {string} requestId - Request name/ID\n\t * @returns {Promise<void>}\n\t */\n\tasync submitRequest(requestId) {\n\t\treturn apiClient.call('lodgeick.api.submit_request', {\n\t\t\trequest_id: requestId\n\t\t})\n\t}\n\n\t/**\n\t * Get all requests for current user\n\t * @returns {Object} Frappe resource\n\t */\n\tgetUserRequests() {\n\t\treturn apiClient.createResource({\n\t\t\turl: 'lodgeick.api.get_user_requests',\n\t\t\tauto: true,\n\t\t\tcache: ['user-requests']\n\t\t})\n\t}\n\n\t/**\n\t * Get requests by status\n\t * @param {string} status - Request status (Draft, Submitted, Under Review, etc.)\n\t * @returns {Object} Frappe resource\n\t */\n\tgetRequestsByStatus(status) {\n\t\treturn apiClient.createResource({\n\t\t\turl: 'frappe.client.get_list',\n\t\t\tparams: {\n\t\t\t\tdoctype: 'Request',\n\t\t\t\tfilters: { status },\n\t\t\t\tfields: ['name', 'request_type', 'requester_name', 'status', 'created_at', 'brief_description'],\n\t\t\t\torder_by: 'modified desc'\n\t\t\t},\n\t\t\tauto: true\n\t\t})\n\t}\n\n\t/**\n\t * Delete draft request\n\t * @param {string} requestId - Request name/ID\n\t * @returns {Promise<void>}\n\t */\n\tasync deleteDraft(requestId) {\n\t\treturn apiClient.call('frappe.client.delete', {\n\t\t\tdoctype: 'Request',\n\t\t\tname: requestId\n\t\t})\n\t}\n\n\t/**\n\t * Get request with related application data\n\t * @param {string} requestId - Request name/ID\n\t * @returns {Promise<Object>} Request with application data\n\t */\n\tasync getRequestWithApplication(requestId) {\n\t\treturn apiClient.call('lodgeick.api.get_request_with_application', {\n\t\t\trequest_id: requestId\n\t\t})\n\t}\n\n\t/**\n\t * Validate request step\n\t * @param {string} requestId - Request name/ID\n\t * @param {number} stepNumber - Step number to validate\n\t * @param {Object} stepData - Step form data\n\t * @returns {Promise<Object>} Validation result { valid: boolean, errors: [] }\n\t */\n\tasync validateStep(requestId, stepNumber, stepData) {\n\t\treturn apiClient.call('lodgeick.api.validate_request_step', {\n\t\t\trequest_id: requestId,\n\t\t\tstep_number: stepNumber,\n\t\t\tstep_data: stepData\n\t\t})\n\t}\n}\n\nexport const requestService = new RequestService()\n"],"names":["BaseAPIClient","config","createResource","__spreadValues","error","message","useErrorStore","e","data","_0","__async","method","args","response","file","options","formData","apiClient","RequestService","currentStep","requestId","requestTypeCode","fields","status","stepNumber","stepData","requestService"],"mappings":"8kBAMO,MAAMA,CAAc,CAC1B,aAAc,CACb,KAAK,eAAiB,CACrB,QAAS,KAAK,YAAY,KAAK,IAAI,EACnC,UAAW,KAAK,cAAc,KAAK,IAAI,CAC1C,CACC,CAOA,eAAeC,EAAQ,CACtB,OAAOC,EAAeC,IAAA,GAClB,KAAK,gBACLF,EACH,CACF,CAOA,YAAYG,EAAO,CAClB,QAAQ,MAAM,cAAeA,CAAK,EAGlC,MAAMC,EAAUD,GAAA,MAAAA,EAAO,SACpBA,EAAM,UACNA,GAAA,YAAAA,EAAO,UAAW,+BAGrB,GAAI,CACH,KAAM,CAAE,cAAAE,GAAkB,QAAQ,yBAAyB,EACxCA,EAAa,EACrB,SAAS,CAAE,QAAAD,EAAS,KAAM,YAAa,QAASD,CAAK,CAAE,CACnE,OAASG,EAAG,CAEX,QAAQ,MAAM,gCAAiCA,CAAC,CACjD,CAEA,MAAO,CAAE,MAAOF,CAAO,CACxB,CAOA,cAAcG,EAAM,CACnB,OAAOA,CACR,CAQM,KAAKC,EAAmB,QAAAC,EAAA,yBAAnBC,EAAQC,EAAO,GAAI,CAC7B,GAAI,CACH,MAAMC,EAAW,MAAM,MAAM,eAAiBF,EAAQ,CACrD,OAAQ,OACR,QAAS,CACR,eAAgB,mBAChB,sBAAuB,OAAO,UACnC,EACI,KAAM,KAAK,UAAUC,CAAI,CAC7B,CAAI,EAED,GAAI,CAACC,EAAS,GACb,MAAM,IAAI,MAAM,QAAQA,EAAS,MAAM,KAAKA,EAAS,UAAU,EAAE,EAGlE,MAAML,EAAO,MAAMK,EAAS,KAAI,EAEhC,GAAIL,EAAK,IACR,MAAM,IAAI,MAAMA,EAAK,GAAG,EAGzB,OAAOA,EAAK,OACb,OAASJ,EAAO,CACf,WAAK,YAAYA,CAAK,EAChBA,CACP,CACD,GAQM,WAAWK,EAAoB,QAAAC,EAAA,yBAApBI,EAAMC,EAAU,GAAI,CACpC,GAAI,CACH,MAAMC,EAAW,IAAI,SACrBA,EAAS,OAAO,OAAQF,CAAI,EAExBC,EAAQ,SAASC,EAAS,OAAO,UAAWD,EAAQ,OAAO,EAC3DA,EAAQ,SAASC,EAAS,OAAO,UAAWD,EAAQ,OAAO,EAC3DA,EAAQ,WAAWC,EAAS,OAAO,YAAaD,EAAQ,SAAS,EACjEA,EAAQ,aAAe,QAC1BC,EAAS,OAAO,aAAcD,EAAQ,WAAa,IAAM,GAAG,EAG7D,MAAMF,EAAW,MAAM,MAAM,0BAA2B,CACvD,OAAQ,OACR,QAAS,CACR,sBAAuB,OAAO,UACnC,EACI,KAAMG,CACV,CAAI,EAED,GAAI,CAACH,EAAS,GACb,MAAM,IAAI,MAAM,kBAAkBA,EAAS,UAAU,EAAE,EAGxD,MAAML,EAAO,MAAMK,EAAS,KAAI,EAEhC,GAAIL,EAAK,IACR,MAAM,IAAI,MAAMA,EAAK,GAAG,EAGzB,OAAOA,EAAK,OACb,OAASJ,EAAO,CACf,WAAK,YAAYA,CAAK,EAChBA,CACP,CACD,GACD,CAEO,MAAMa,EAAY,IAAIjB,ECrItB,MAAMkB,CAAe,CAOrB,YAAYV,EAAMW,EAAa,QAAAT,EAAA,sBACpC,OAAOO,EAAU,KAAK,oCAAqC,CAC1D,KAAAT,EACA,aAAcW,CACjB,CAAG,CACF,GAOA,WAAWC,EAAW,CACrB,OAAOH,EAAU,eAAe,CAC/B,IAAK,oBACL,OAAQ,CACP,QAAS,UACT,KAAMG,CACV,EACG,KAAM,EACT,CAAG,CACF,CAOA,qBAAqBC,EAAiB,CACrC,OAAOJ,EAAU,eAAe,CAC/B,IAAK,uCACL,OAAQ,CAAE,kBAAmBI,CAAe,EAC5C,KAAM,GACN,MAAO,CAAC,sBAAuBA,CAAe,CACjD,CAAG,CACF,CAQM,cAAcD,EAAWE,EAAQ,QAAAZ,EAAA,sBACtC,OAAOO,EAAU,KAAK,0BAA2B,CAChD,QAAS,UACT,KAAMG,EACN,UAAWE,CACd,CAAG,CACF,GAOM,cAAcF,EAAW,QAAAV,EAAA,sBAC9B,OAAOO,EAAU,KAAK,8BAA+B,CACpD,WAAYG,CACf,CAAG,CACF,GAMA,iBAAkB,CACjB,OAAOH,EAAU,eAAe,CAC/B,IAAK,iCACL,KAAM,GACN,MAAO,CAAC,eAAe,CAC1B,CAAG,CACF,CAOA,oBAAoBM,EAAQ,CAC3B,OAAON,EAAU,eAAe,CAC/B,IAAK,yBACL,OAAQ,CACP,QAAS,UACT,QAAS,CAAE,OAAAM,CAAM,EACjB,OAAQ,CAAC,OAAQ,eAAgB,iBAAkB,SAAU,aAAc,mBAAmB,EAC9F,SAAU,eACd,EACG,KAAM,EACT,CAAG,CACF,CAOM,YAAYH,EAAW,QAAAV,EAAA,sBAC5B,OAAOO,EAAU,KAAK,uBAAwB,CAC7C,QAAS,UACT,KAAMG,CACT,CAAG,CACF,GAOM,0BAA0BA,EAAW,QAAAV,EAAA,sBAC1C,OAAOO,EAAU,KAAK,4CAA6C,CAClE,WAAYG,CACf,CAAG,CACF,GASM,aAAaA,EAAWI,EAAYC,EAAU,QAAAf,EAAA,sBACnD,OAAOO,EAAU,KAAK,qCAAsC,CAC3D,WAAYG,EACZ,YAAaI,EACb,UAAWC,CACd,CAAG,CACF,GACD,CAEY,MAACC,EAAiB,IAAIR"}