const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SaveDraftModal-BFY2dWDw.js","assets/index-46vhlORJ.js","assets/index-BlUHqveC.css","assets/ValidationErrorModal-Hy_gEut9.js","assets/BookMeetingModal-DZcl7h9O.js","assets/SubmissionSuccessModal-BkRFecoL.js","assets/SubmissionSuccessModal-ydH3POPv.css","assets/DynamicStepRenderer-CyuCRRXG.js","assets/request.service-Di6WmKlx.js","assets/RequestHeader-KCytT7EI.js","assets/CouncilSelector-BovAElL3.js","assets/CouncilSelector-BQ7mA531.css","assets/DynamicStepRenderer-B3apwizs.css"])))=>i.map(i=>d[i]);
var Ve=Object.defineProperty,Ce=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var ue=(e,o,l)=>o in e?Ve(e,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[o]=l,ee=(e,o)=>{for(var l in o||(o={}))De.call(o,l)&&ue(e,l,o[l]);if(ae)for(var l of ae(o))Re.call(o,l)&&ue(e,l,o[l]);return e},te=(e,o)=>Ce(e,Te(o));var D=(e,o,l)=>new Promise((y,_)=>{var x=s=>{try{v(l.next(s))}catch(q){_(q)}},m=s=>{try{v(l.throw(s))}catch(q){_(q)}},v=s=>s.done?y(s.value):Promise.resolve(s.value).then(x,m);v((l=l.apply(e,o)).next())});import{r as A,j as S,q as $e,c as a,o as i,a as t,x as Ne,t as p,y as B,d as g,w as E,h as C,u as h,i as z,z as de,b as P,F as G,l as J,A as j,f as me,g as Z,s as Fe,e as Me,B as Pe,C as Ae,E as ce,G as Ie,H as Le,J as U,K as Y}from"./index-46vhlORJ.js";import{r as W}from"./request.service-Di6WmKlx.js";import{_ as Ee}from"./RequestHeader-KCytT7EI.js";import{C as je}from"./CouncilSelector-BovAElL3.js";function Be(e){return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e):!0}function ze(e){return e?/^[\+]?[(]?[0-9]{1,4}[)]?[-\s\.]?[(]?[0-9]{1,4}[)]?[-\s\.]?[0-9]{1,9}$/.test(e.replace(/\s/g,"")):!0}function Oe(e){if(!e)return!0;try{return new URL(e),!0}catch(o){return!1}}function He(e){return e===""||e===null||e===void 0?!0:!isNaN(Number.parseFloat(e))&&isFinite(e)}function Ue(e,o,l){let y=e.trim();y.startsWith("eval:")&&(y=y.substring(5).trim());try{return new Function("formData","value",`
			'use strict';
			try {
				return Boolean(${y});
			} catch (e) {
				console.warn('[Field Validation] Evaluation error:', e.message);
				return true; // Fail open on evaluation error
			}
		`)(l,o)}catch(_){return console.error("[Field Validation] Failed to evaluate expression:",e,_),!0}}function Ye(e,o,l={}){if(!o)return{valid:!0,message:""};switch(o.toLowerCase()){case"email":if(!Be(e))return{valid:!1,message:"Please enter a valid email address"};break;case"phone":if(!ze(e))return{valid:!1,message:"Please enter a valid phone number"};break;case"url":if(!Oe(e))return{valid:!1,message:"Please enter a valid URL"};break;case"number":if(!He(e))return{valid:!1,message:"Please enter a valid number"};break;default:if(o.startsWith("eval:")&&!Ue(o,e,l))return{valid:!1,message:"Validation failed"}}return{valid:!0,message:""}}function ne(e,o){if(!e||e.trim()==="")return!0;let l=e.trim();l.startsWith("eval:")&&(l=l.substring(5).trim());try{return new Function("formData","doc",`
      'use strict';
      try {
        return Boolean(${l});
      } catch (e) {
        console.warn('[Conditional Logic] Evaluation error:', e.message);
        return false;
      }
    `)(o,o)}catch(y){return console.error("[Conditional Logic] Failed to evaluate expression:",e,y),!0}}function zo(e,o){return!e||!e.is_enabled?!1:e.depends_on?ne(e.depends_on,o):!0}function Oo(e,o){return e?e.depends_on?ne(e.depends_on,o):!0:!1}function Ge(){const e=A({}),o=A(!1);function l(v,s,q,r={}){const c=Ye(s,q.validation,r);return c.valid?q.is_required&&(s===""||s===null||s===void 0)?(e.value[v]=`${q.field_label} is required`,!1):(delete e.value[v],!0):(e.value[v]=c.message,!1)}function y(v,s){return D(this,null,function*(){o.value=!0,e.value={};let q=!0;for(const r of v.sections||[])if(!(r.depends_on&&!_(r.depends_on,s)))for(const c of r.fields||[]){if(c.depends_on&&!_(c.depends_on,s))continue;let b=s[c.field_name];if(["barangay","municipality","province","city","region","zip_code","postal_code"].includes(c.field_name)&&!b){const f=s.address_line||s.street||s.residential_address||s.property_address;f&&typeof f=="object"&&(b=f[c.field_name])}l(c.field_name,b,c,s)||(q=!1)}return o.value=!1,q})}function _(v,s){try{return ne(v,s)}catch(q){return console.error("Error evaluating depends_on:",q),!0}}function x(){e.value={}}function m(v){delete e.value[v]}return{errors:e,isValidating:o,validateConfigField:l,validateStep:y,clearErrors:x,clearFieldError:m}}const V=A(null),se=A(!1),oe=A(null);function We(){const e=()=>D(this,null,function*(){se.value=!0,oe.value=null;try{const r={"Content-Type":"application/json"};window.csrf_token&&(r["X-Frappe-CSRF-Token"]=window.csrf_token);const b=yield(yield fetch("/api/method/lodgeick.api.get_user_profile",{method:"GET",headers:r,credentials:"include"})).json();if(b.message)return V.value=b.message,V.value;throw new Error("Failed to load profile")}catch(r){return oe.value=r.message,console.error("Error loading user profile:",r),null}finally{se.value=!1}}),o=S(()=>{var r;return(r=V.value)!=null&&r.properties?V.value.properties.find(c=>c.is_default)||V.value.properties[0]:null}),l=S(()=>{var r;return(r=V.value)!=null&&r.councils?V.value.councils.find(c=>c.is_default)||V.value.councils[0]:null}),y=()=>{if(!V.value)return{};const r=V.value,c={};if(l.value&&(c.council=l.value.council_id,c.council_name=l.value.council_name),c.requester_name=r.full_name,c.requester_email=r.user,c.requester_phone=r.phone,c.requester_type=r.user_role,r.user_role==="Individual"&&r.postal_street&&(c.applicant_address=`${r.postal_street}, ${r.postal_suburb||""}, ${r.postal_city||""} ${r.postal_postcode||""}`.trim()),r.user_role==="Agent"&&(c.agent_required=!0,c.agent_id=r.user,c.agent_company=r.company_name,c.agent_email=r.business_email||r.user,c.agent_phone=r.business_phone||r.phone,r.business_street&&(c.agent_address=`${r.business_street}, ${r.business_suburb||""}, ${r.business_city||""} ${r.business_postcode||""}`.trim()),r.default_communication_route&&(c.correspondence_recipient=r.default_communication_route==="Agent Only"?"Agent":"Both"),r.default_invoice_recipient&&(c.invoice_responsible_party=r.default_invoice_recipient)),o.value){const b=o.value;c.property=`${b.street}, ${b.suburb||""}, ${b.city||""} ${b.postcode||""}`.trim(),c.property_address=c.property,c.property_legal_description=b.legal_description,c.ownership_status=b.ownership_status}return(r.comm_email||r.comm_phone||r.comm_post)&&(c.communication_preferences={email:r.comm_email||!1,phone:r.comm_phone||!1,post:r.comm_post||!1}),r.invoice_preference&&(c.invoice_delivery_method=r.invoice_preference),c},_=(r,c={})=>{const{overrideExisting:b=!1,fieldsToSkip:N=[]}=c,R=y();return Object.keys(R).forEach(f=>{N.includes(f)||!b&&r[f]||(r[f]=R[f])}),r},x=S(()=>{var r;return((r=V.value)==null?void 0:r.properties)||[]}),m=S(()=>{var r;return((r=V.value)==null?void 0:r.councils)||[]}),v=S(()=>{var r;return((r=V.value)==null?void 0:r.clients)||[]}),s=S(()=>{var b,N,R;if(!V.value)return!1;const r=V.value,c=r.full_name&&r.phone&&r.user_role;return r.user_role==="Individual"?c&&(((b=r.properties)==null?void 0:b.length)>0||!1)&&(((N=r.councils)==null?void 0:N.length)>0||!1):r.user_role==="Agent"?c&&r.company_name&&(((R=r.councils)==null?void 0:R.length)>0||!1):c}),q=S(()=>{if(!V.value)return 0;const r=V.value;let c=0,b=0;return["full_name","phone","user_role"].forEach(R=>{b++,r[R]&&c++}),b++,(r.comm_email||r.comm_phone||r.comm_post)&&c++,b++,r.properties&&r.properties.length>0&&c++,b++,r.councils&&r.councils.length>0&&c++,r.user_role==="Agent"?(b++,r.company_name&&c++):(b++,r.postal_street&&c++),Math.round(c/b*100)});return{userProfile:V,loading:se,error:oe,loadUserProfile:e,getApplicationAutoFill:y,applyAutoFill:_,defaultProperty:o,defaultCouncil:l,getAllProperties:x,getAllCouncils:m,getAllClients:v,isProfileComplete:s,profileCompletionPercentage:q}}const Je=$e("request",{persist:{key:"requestStore",storage:localStorage,paths:["currentRequestId","formData","currentStep","requestTypeCode"]},state:()=>({currentRequestId:null,requestTypeCode:null,requestTypeConfig:null,formData:{},currentStep:0,stepValidationStatus:{},isSaving:!1,isSubmitting:!1,lastSaved:null,error:null}),getters:{isFirstStep:e=>e.currentStep===0,totalSteps:e=>{var o;return(o=e.requestTypeConfig)!=null&&o.steps?e.requestTypeConfig.steps.length+4:4},isLastStep:e=>e.currentStep===e.totalSteps-1,currentStepConfig:e=>{var o,l;return(l=(o=e.requestTypeConfig)==null?void 0:o.steps)==null?void 0:l[e.currentStep]},canNavigateNext:e=>e.stepValidationStatus[e.currentStep]===!0,completionPercentage:e=>e.totalSteps===0?0:Math.round((e.currentStep+1)/e.totalSteps*100),hasUnsavedChanges:e=>e.lastSaved?new Date-e.lastSaved>3e4:Object.keys(e.formData).length>0},actions:{nextStep(){this.isLastStep||this.currentStep++},previousStep(){this.isFirstStep||this.currentStep--},goToStep(e){e>=0&&e<this.totalSteps&&(this.currentStep=e)},initialize(e,o=null){return D(this,null,function*(){try{this.requestTypeCode=e,this.error=null,console.log("[RequestStore] initialize called:",{requestTypeCode:e,draftId:o});const l=W.getRequestTypeConfig(e);yield new Promise(y=>{const _=setInterval(()=>{l.loading||(clearInterval(_),y())},100)}),this.requestTypeConfig=l.data,o&&(yield this.loadDraft(o))}catch(l){console.error("Failed to initialize request:",l),this.error=l.message||"Failed to load request type"}})},loadDraft(e){return D(this,null,function*(){try{const o=W.getRequest(e);yield new Promise(y=>{const _=setInterval(()=>{o.loading||(clearInterval(_),y())},100)});const l=o.data;if(this.currentRequestId=e,l.draft_full_data)try{this.formData=JSON.parse(l.draft_full_data)}catch(y){console.error("Failed to parse draft_full_data:",y),this.formData=l.form_data||{}}else this.formData=l.form_data||{};this.currentStep=l.draft_current_step||0}catch(o){console.error("Failed to load draft:",o),this.error=o.message||"Failed to load draft"}})},saveProgress(){return D(this,null,function*(){if(this.isSaving){console.log("[RequestStore] Save already in progress, skipping");return}this.currentRequestId&&!this.formData.request_id&&(console.warn("[RequestStore] Syncing request_id to formData"),this.formData.request_id=this.currentRequestId),console.log("[RequestStore] saveProgress called",{hasRequestId:!!this.currentRequestId,formDataHasId:!!this.formData.request_id,currentStep:this.currentStep,isSaving:this.isSaving}),this.isSaving=!0,this.error=null;try{const e={};for(const[l,y]of Object.entries(this.formData)){if(y instanceof File){console.warn(`[RequestStore] Skipping File object for key: ${l}`);continue}if(Array.isArray(y)&&y.length>0&&y.some(x=>x&&typeof x=="object"&&x.file_url)){const x=y[0].file_url;if(x&&typeof x=="string"){console.log(`[RequestStore] Converting file array to URL string for ${l}:`,x),e[l]=x;continue}else{console.warn(`[RequestStore] File array for ${l} does not have valid file_url, skipping`);continue}}y!=null&&(e[l]=y)}if(Object.keys(e).length===0&&!this.currentRequestId)throw new Error("No form data to save. Please fill in at least one field.");console.log("[RequestStore] Sending sanitized data with",Object.keys(e).length,"fields"),console.log("[RequestStore] Sanitized data keys:",Object.keys(e)),console.log("[RequestStore] Sanitized data:",JSON.stringify(e,null,2));const o=yield W.createDraft(e,this.currentStep);return this.currentRequestId||(this.currentRequestId=o.request_id,this.formData.request_id=o.request_id,localStorage.setItem("current_draft_id",o.request_id)),this.lastSaved=new Date,o}catch(e){throw console.error("Save failed:",e),this.error=e.message||"Failed to save progress",e}finally{this.isSaving=!1}})},saveDraft(){return D(this,null,function*(){return this.saveProgress()})},submitRequest(){return D(this,null,function*(){this.isSubmitting=!0,this.error=null;try{this.currentRequestId||(yield this.saveProgress());const e=yield W.submitRequest(this.currentRequestId);return this.reset(),e}catch(e){throw console.error("Submit failed:",e),this.error=e.message||"Failed to submit request",e}finally{this.isSubmitting=!1}})},updateField(e,o){this.formData[e]=o},updateFields(e){Object.assign(this.formData,e)},setStepValidation(e,o){this.stepValidationStatus[e]=o},clearError(){this.error=null},reset(){console.log("[RequestStore] reset() called - clearing all state"),this.currentRequestId=null,this.requestTypeCode=null,this.requestTypeConfig=null,Object.keys(this.formData).forEach(e=>{delete this.formData[e]}),this.formData={},this.currentStep=0,this.stepValidationStatus={},this.isSaving=!1,this.isSubmitting=!1,this.lastSaved=null,this.error=null,localStorage.removeItem("current_draft_id")}}}),Ze={class:"mb-8"},Ke={class:"relative mb-6"},Xe={class:"overflow-hidden h-2 text-xs flex rounded bg-gray-200"},Qe={class:"flex justify-between mt-2"},et={class:"text-sm font-medium text-gray-700"},tt={class:"text-sm font-medium text-gray-700"},st={__name:"RequestProgress",props:{currentStep:{type:Number,required:!0},totalSteps:{type:Number,required:!0},stepTitles:{type:Array,default:()=>[]}},setup(e){const o=e,l=S(()=>o.totalSteps===0?0:Math.round((o.currentStep+1)/o.totalSteps*100));return(y,_)=>(i(),a("div",Ze,[t("div",Ke,[t("div",Xe,[t("div",{style:Ne({width:l.value+"%"}),class:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-600 transition-all duration-500"},null,4)]),t("div",Qe,[t("span",et,p(e.stepTitles[e.currentStep]||`Step ${e.currentStep+1}`),1),t("span",tt,p(l.value)+"% Complete ",1)])])]))}},ot={class:"mt-8 pt-6 border-t border-gray-200"},nt={class:"flex items-center justify-between"},rt={class:"flex items-center space-x-3"},it={__name:"StepNavigation",props:{currentStep:{type:Number,required:!0},totalSteps:{type:Number,required:!0},isLastStep:{type:Boolean,default:!1},canGoNext:{type:Boolean,default:!0},canSaveDraft:{type:Boolean,default:!0},isSaving:{type:Boolean,default:!1},isSubmitting:{type:Boolean,default:!1}},emits:["next","previous","save-draft","submit"],setup(e,{emit:o}){const l=o,y=()=>{l("next")},_=()=>{l("previous")},x=()=>{l("save-draft")},m=()=>{l("submit")};return(v,s)=>(i(),a("div",ot,[t("div",nt,[t("div",null,[e.currentStep>0?(i(),B(h(z),{key:0,onClick:_,variant:"outline",disabled:e.isSaving||e.isSubmitting},{prefix:E(()=>[...s[0]||(s[0]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),default:E(()=>[s[1]||(s[1]=C(" Previous ",-1))]),_:1},8,["disabled"])):g("",!0)]),t("div",rt,[e.canSaveDraft?(i(),B(h(z),{key:0,onClick:x,variant:"outline",loading:e.isSaving,disabled:e.isSubmitting},de({default:E(()=>[C(" "+p(e.isSaving?"Saving...":"Save Draft"),1)]),_:2},[e.isSaving?void 0:{name:"prefix",fn:E(()=>[s[2]||(s[2]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})],-1))]),key:"0"}]),1032,["loading","disabled"])):g("",!0),e.isLastStep?(i(),B(h(z),{key:2,onClick:m,variant:"solid",theme:"green",loading:e.isSubmitting,disabled:!e.canGoNext||e.isSaving},de({default:E(()=>[C(" "+p(e.isSubmitting?"Submitting...":"Submit Application"),1)]),_:2},[e.isSubmitting?void 0:{name:"prefix",fn:E(()=>[s[5]||(s[5]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1))]),key:"0"}]),1032,["loading","disabled"])):(i(),B(h(z),{key:1,onClick:y,variant:"solid",theme:"blue",disabled:!e.canGoNext||e.isSaving||e.isSubmitting},{suffix:E(()=>[...s[3]||(s[3]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),default:E(()=>[s[4]||(s[4]=C(" Next ",-1))]),_:1},8,["disabled"]))])]),s[6]||(s[6]=t("div",{class:"mt-4 text-center"},[t("p",{class:"text-sm text-gray-500"}," Your progress is automatically saved. You can return to complete this application later. ")],-1))]))}},lt={__name:"Step1CouncilSelection",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","council-change"],setup(e,{emit:o}){const l=e,y=o,_=x=>{console.log("[Step1CouncilSelection] updateCouncil called with:",x),console.log("[Step1CouncilSelection] Current modelValue:",l.modelValue),y("update:modelValue",te(ee({},l.modelValue),{council:x})),y("council-change",x),console.log("[Step1CouncilSelection] Emitted events")};return(x,m)=>(i(),a("div",null,[m[0]||(m[0]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Select Council",-1)),m[1]||(m[1]=t("p",{class:"text-gray-600 mb-8"},"Choose the council that will process your application",-1)),P(je,{"model-value":e.modelValue.council,"onUpdate:modelValue":_,"display-mode":"cards",required:!0,"show-selected-info":!0,label:"","show-label":!1},null,8,["model-value"])]))}},at={key:0,class:"text-center py-12"},ut={key:1,class:"grid md:grid-cols-2 gap-4"},dt=["onClick"],ct={class:"flex items-start justify-between"},mt={class:"flex-1"},ft={class:"text-lg font-semibold text-gray-900 mb-2"},pt=["innerHTML"],gt={class:"mt-4 flex items-center space-x-4 text-xs text-gray-500"},yt={key:0},vt={key:1},ht={key:2,class:"px-2 py-1 bg-gray-100 rounded"},xt={key:0,class:"ml-4"},bt={__name:"Step2RequestType",props:{modelValue:{type:Object,required:!0},requestTypes:{type:Object,required:!0}},emits:["update:modelValue","type-selected"],setup(e,{emit:o}){const l=e,y=o,_=x=>{console.log("[Step2RequestType] selectType called with:",x.name),console.log("[Step2RequestType] props.modelValue:",l.modelValue),console.log("[Step2RequestType] props.modelValue.council:",l.modelValue.council);const m=te(ee({},l.modelValue),{request_type:x.name});console.log("[Step2RequestType] Emitting updatedValue:",m),y("update:modelValue",m),y("type-selected",x.name)};return(x,m)=>(i(),a("div",null,[m[2]||(m[2]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Select Application Type",-1)),m[3]||(m[3]=t("p",{class:"text-gray-600 mb-8"},"Choose the type of consent you wish to apply for",-1)),e.requestTypes.loading?(i(),a("div",at,[...m[0]||(m[0]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)])])):(i(),a("div",ut,[(i(!0),a(G,null,J(e.requestTypes.data,v=>(i(),a("div",{key:v.name,onClick:s=>_(v),class:j(["border-2 rounded-lg p-6 cursor-pointer transition-all hover:shadow-md",e.modelValue.request_type===v.name?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-blue-300"])},[t("div",ct,[t("div",mt,[t("h3",ft,p(v.type_name),1),t("p",{class:"text-sm text-gray-600",innerHTML:v.description||"No description available"},null,8,pt),t("div",gt,[v.base_fee?(i(),a("span",yt,"Fee: $"+p(v.base_fee),1)):g("",!0),v.processing_sla_days?(i(),a("span",vt,p(v.processing_sla_days)+" days",1)):g("",!0),v.category?(i(),a("span",ht,p(v.category),1)):g("",!0)])]),e.modelValue.request_type===v.name?(i(),a("div",xt,[...m[1]||(m[1]=[t("div",{class:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center"},[t("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)])])):g("",!0)])],10,dt))),128))]))]))}},_t={class:"text-gray-600 mb-6"},wt={key:0,class:"space-y-6"},St={class:"bg-white border border-gray-200 rounded-lg p-6"},kt={class:"flex items-start justify-between mb-4"},qt={class:"text-xl font-semibold text-gray-900"},Vt={key:0,class:"text-sm text-gray-500 mt-1"},Ct={class:"grid md:grid-cols-3 gap-4 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},Tt={class:"text-2xl font-bold text-blue-900 mt-1"},Dt={class:"text-2xl font-bold text-blue-900 mt-1"},Rt={class:"text-2xl font-bold text-blue-900 mt-1"},$t={key:0,class:"bg-white border border-gray-200 rounded-lg p-6"},Nt=["innerHTML"],Ft={key:1,class:"bg-white border border-gray-200 rounded-lg p-6"},Mt=["innerHTML"],Pt={key:1,class:"text-center py-12"},At={__name:"Step3ProcessInfo",props:{requestTypeDetails:{type:Object,default:null},councilName:{type:String,default:""},modelValue:{type:Object,default:()=>({})}},emits:["continue","update:modelValue"],setup(e,{emit:o}){const l=me(),y=o,_=()=>{if(!Fe.isLoggedIn){const x=window.location.pathname+window.location.search;l.push({name:"Login",query:{redirect:x}});return}y("continue")};return(x,m)=>(i(),a("div",null,[m[11]||(m[11]=t("h2",{class:"text-2xl font-bold text-gray-900 mb-2"},"Council Process Information",-1)),t("p",_t,"Understanding "+p(e.councilName)+"'s process for this application",1),e.requestTypeDetails?(i(),a("div",wt,[t("div",St,[t("div",kt,[t("div",null,[t("h3",qt,p(e.requestTypeDetails.request_type_name),1),e.requestTypeDetails.category?(i(),a("p",Vt,p(e.requestTypeDetails.category),1)):g("",!0)])]),t("div",Ct,[t("div",null,[m[0]||(m[0]=t("div",{class:"text-xs text-blue-600 font-medium uppercase"},"Application Fee",-1)),t("div",Tt," $"+p(e.requestTypeDetails.base_fee||"0"),1),m[1]||(m[1]=t("div",{class:"text-xs text-blue-600 mt-1"},"Plus any additional costs",-1))]),t("div",null,[m[3]||(m[3]=t("div",{class:"text-xs text-blue-600 font-medium uppercase"},"Processing Time",-1)),t("div",Dt,[C(p(e.requestTypeDetails.sla_days||"N/A")+" ",1),m[2]||(m[2]=t("span",{class:"text-base"},"days",-1))]),m[4]||(m[4]=t("div",{class:"text-xs text-blue-600 mt-1"},"Standard timeframe",-1))]),t("div",null,[m[5]||(m[5]=t("div",{class:"text-xs text-blue-600 font-medium uppercase"},"Payment Required",-1)),t("div",Rt,p(e.requestTypeDetails.requires_payment?"Yes":"No"),1),m[6]||(m[6]=t("div",{class:"text-xs text-blue-600 mt-1"},"Before processing",-1))])])]),e.requestTypeDetails.process_description?(i(),a("div",$t,[m[7]||(m[7]=t("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"How This Works",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-700",innerHTML:e.requestTypeDetails.process_description},null,8,Nt)])):e.requestTypeDetails.description?(i(),a("div",Ft,[m[8]||(m[8]=t("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"About This Application",-1)),t("div",{class:"prose prose-sm max-w-none text-gray-700",innerHTML:e.requestTypeDetails.description},null,8,Mt)])):g("",!0),m[9]||(m[9]=Z('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><div class="flex items-start"><svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg><div><h5 class="font-semibold text-yellow-900 text-sm">Before You Continue</h5><p class="text-yellow-800 text-sm mt-1"> Please review this information carefully. Make sure you understand the process, fees, and timeframes before proceeding with your application. </p></div></div></div>',1)),t("div",{class:"flex justify-center pt-4"},[t("button",{type:"button",onClick:_,class:"px-8 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors"}," I Understand - Continue to Application ")])])):(i(),a("div",Pt,[...m[10]||(m[10]=[t("p",{class:"text-gray-500"},"No request type selected. Please go back and select a request type.",-1)])]))]))}},It={class:"px-4 sm:px-0"},Lt={class:"space-y-4 sm:space-y-6"},Et={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 sm:p-6"},jt={class:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-0"},Bt={class:"text-base sm:text-lg font-semibold text-blue-900"},zt={class:"text-xs sm:text-sm text-blue-700 mt-1"},Ot={class:"sm:text-right"},Ht={class:"text-xl sm:text-2xl font-bold text-blue-900"},Ut={class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},Yt={class:"p-4 sm:p-6 space-y-3"},Gt={class:"grid md:grid-cols-2 gap-4"},Wt={class:"font-medium"},Jt={class:"font-medium"},Zt={class:"font-medium"},Kt={key:0},Xt={class:"font-medium"},Qt={key:0,class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},es={class:"p-4 sm:p-6"},ts={key:0,class:"space-y-2"},ss={class:"font-medium"},os={key:0},ns={class:"font-medium"},rs={key:1,class:"text-gray-500"},is={key:1,class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},ls={class:"p-4 sm:p-6 space-y-3"},as={class:"font-medium"},us={class:"font-medium"},ds={class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},cs={class:"font-semibold text-gray-900 text-sm sm:text-base"},ms={class:"p-4 sm:p-6 space-y-4"},fs={key:0,class:"text-sm font-medium text-gray-700 mb-2"},ps={class:"grid md:grid-cols-2 gap-4"},gs={class:"text-sm text-gray-500"},ys={class:"font-medium"},vs={key:0,class:"text-gray-500 text-sm"},hs={class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},xs={class:"p-4 sm:p-6"},bs={class:"space-y-3"},_s={class:"mt-2 flex flex-wrap gap-2"},ws={key:0,class:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium"},Ss={key:1,class:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium"},ks={key:2,class:"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium"},qs={key:3,class:"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium"},Vs={key:4,class:"px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-sm font-medium"},Cs={key:5,class:"text-gray-500"},Ts={class:"mt-1 inline-flex items-center"},Ds={key:0},Rs={class:"font-medium break-words"},$s={key:0,class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},Ns={class:"p-4 sm:p-6"},Fs={class:"flex flex-wrap gap-2"},Ms={key:0,class:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium inline-flex items-center gap-1"},Ps={key:1,class:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium inline-flex items-center gap-1"},As={key:2,class:"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium inline-flex items-center gap-1"},Is={key:3,class:"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium inline-flex items-center gap-1"},Ls={key:1,class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},Es={class:"p-4 sm:p-6"},js={class:"space-y-3"},Bs={class:"font-medium"},zs={key:0},Os={class:"text-sm mt-1 line-clamp-3"},Hs={key:1},Us={class:"text-sm mt-1 line-clamp-3"},Ys={class:"flex items-center gap-2"},Gs={class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},Ws={class:"p-4 sm:p-6"},Js={class:"space-y-4"},Zs={key:0},Ks=["innerHTML"],Xs={key:1},Qs=["innerHTML"],eo={key:2},to={class:"text-sm mt-1 line-clamp-3"},so={key:3},oo={class:"text-sm mt-1 space-y-1 list-disc list-inside"},no={key:0},ro={key:1},io={key:2},lo={key:4},ao=["innerHTML"],uo={key:5,class:"text-gray-500 text-sm"},co={class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},mo={class:"p-4 sm:p-6"},fo={class:"space-y-2"},po={class:"flex items-start gap-2"},go={class:"flex items-start gap-2"},yo={class:"flex items-start gap-2"},vo={key:0,class:"mt-4 pt-4 border-t border-gray-200"},ho={class:"font-medium"},xo={key:0,class:"text-sm text-gray-500"},bo={key:4,class:"bg-red-50 border border-red-200 rounded-lg p-4"},_o={__name:"ReviewStep",props:{modelValue:{type:Object,required:!0},councilName:{type:String,default:"Council"},requestTypeName:{type:String,default:"Application"},applicationFee:{type:String,default:"TBD"},isResourceConsent:{type:Boolean,default:!1},stepConfigs:{type:Array,default:()=>[]},usesConfigurableSteps:{type:Boolean,default:!1},requestTypeDetails:{type:Object,default:null}},setup(e){const o=e,l=S(()=>!o.usesConfigurableSteps||!o.stepConfigs?[]:o.stepConfigs.filter(f=>f.show_on_review)),y=S(()=>o.isResourceConsent?!0:!!(o.modelValue.property||o.modelValue.property_address)),_=f=>{if(!f.sections)return!1;for(const n of f.sections)if(n.show_on_review){for(const $ of n.fields)if($.show_on_review&&o.modelValue[$.field_name])return!0}return!1},x=(f,n)=>{if(n==null||n==="")return"Not provided";if(f.field_type==="Check")return n?"Yes":"No";if(f.field_type==="Date"&&n)try{return new Date(n).toLocaleDateString("en-NZ",{year:"numeric",month:"long",day:"numeric"})}catch($){return n}return f.field_type==="Currency"&&n?`₱${Number(n).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`:f.field_type==="Select"?n:f.field_type==="Attach"||f.field_type==="Attach Image"?n?"✓ File attached":"Not provided":n},m=S(()=>!!(o.modelValue.consent_type_land_use||o.modelValue.consent_type_subdivision||o.modelValue.consent_type_discharge||o.modelValue.consent_type_water||o.modelValue.consent_type_coastal)),v=S(()=>{const f=o.modelValue.activity_status_type;return f==="Permitted"?"bg-green-100 text-green-800":f==="Controlled"?"bg-blue-100 text-blue-800":f==="Restricted Discretionary"?"bg-yellow-100 text-yellow-800":f==="Discretionary"?"bg-orange-100 text-orange-800":f==="Non-Complying"?"bg-red-100 text-red-800":f==="Prohibited"?"bg-gray-800 text-white":"bg-gray-100 text-gray-800"}),s=S(()=>!!(o.modelValue.hazard_flooding||o.modelValue.hazard_earthquake||o.modelValue.hazard_landslip||o.modelValue.hazard_coastal)),q=S(()=>!!(o.modelValue.consultation_undertaken||o.modelValue.consultation_summary||o.modelValue.affected_parties_details||o.modelValue.written_approvals_obtained)),r=S(()=>!!(o.modelValue.activity_description||o.modelValue.aee_full_assessment||o.modelValue.positive_effects_description||o.modelValue.effects_visual_amenity||o.modelValue.effects_traffic_parking||o.modelValue.effects_noise||o.modelValue.mitigation_measures||o.modelValue.aee_activity_description||o.modelValue.aee_existing_environment||o.modelValue.assessment_of_effects||o.modelValue.aee_document)),c=f=>{if(!f)return"";const n=document.createElement("div");return n.innerHTML=f,n.textContent||n.innerText||""},b=(f,n)=>{if(!f)return"";const $=c(f);return $.length<=n?$:$.substring(0,n)+"..."},N=f=>{if(!f)return"";try{return new Date(f).toLocaleDateString("en-NZ",{year:"numeric",month:"long",day:"numeric"})}catch(n){return f}},R=S(()=>{const f=!!(o.modelValue.council&&o.modelValue.request_type&&o.modelValue.requester_name&&o.modelValue.requester_email&&o.modelValue.property_address&&o.modelValue.delivery_preference);if(o.isResourceConsent){const n=!!(m.value&&o.modelValue.activity_status_type&&o.modelValue.activity_description&&o.modelValue.aee_full_assessment&&o.modelValue.declaration_accuracy&&o.modelValue.declaration_authority&&o.modelValue.declaration_acknowledgment);return f&&n}return f});return(f,n)=>{var $;return i(),a("div",It,[n[39]||(n[39]=t("h2",{class:"text-xl sm:text-2xl font-bold text-gray-900 mb-2"},"Review & Submit",-1)),n[40]||(n[40]=t("p",{class:"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8"},"Review your application details before submitting",-1)),t("div",Lt,[t("div",Et,[t("div",jt,[t("div",null,[t("h3",Bt,p(e.requestTypeName),1),t("p",zt,p(e.councilName),1)]),t("div",Ot,[n[0]||(n[0]=t("div",{class:"text-xs sm:text-sm text-blue-600 font-medium"},"Application Fee",-1)),t("div",Ht,p(e.applicationFee),1)])])]),t("div",Ut,[n[5]||(n[5]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Applicant Details")],-1)),t("div",Yt,[t("div",Gt,[t("div",null,[n[1]||(n[1]=t("span",{class:"text-sm text-gray-500"},"Name:",-1)),t("p",Wt,p(e.modelValue.requester_name||"Not provided"),1)]),t("div",null,[n[2]||(n[2]=t("span",{class:"text-sm text-gray-500"},"Email:",-1)),t("p",Jt,p(e.modelValue.requester_email||"Not provided"),1)]),t("div",null,[n[3]||(n[3]=t("span",{class:"text-sm text-gray-500"},"Phone:",-1)),t("p",Zt,p(e.modelValue.requester_phone||"Not provided"),1)]),e.modelValue.applicant_company?(i(),a("div",Kt,[n[4]||(n[4]=t("span",{class:"text-sm text-gray-500"},"Company:",-1)),t("p",Xt,p(e.modelValue.applicant_company),1)])):g("",!0)])])]),y.value?(i(),a("div",Qt,[n[8]||(n[8]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Property Details")],-1)),t("div",es,[e.modelValue.property_address?(i(),a("div",ts,[t("div",null,[n[6]||(n[6]=t("span",{class:"text-sm text-gray-500"},"Address:",-1)),t("p",ss,p(e.modelValue.property_address),1)]),e.modelValue.legal_description?(i(),a("div",os,[n[7]||(n[7]=t("span",{class:"text-sm text-gray-500"},"Legal Description:",-1)),t("p",ns,p(e.modelValue.legal_description),1)])):g("",!0)])):(i(),a("p",rs,"No property selected"))])])):g("",!0),($=e.requestTypeDetails)!=null&&$.collect_payment?(i(),a("div",is,[n[11]||(n[11]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Delivery & Payment")],-1)),t("div",ls,[t("div",null,[n[9]||(n[9]=t("span",{class:"text-sm text-gray-500"},"Delivery Preference:",-1)),t("p",as,p(e.modelValue.delivery_preference||"Not selected"),1)]),t("div",null,[n[10]||(n[10]=t("span",{class:"text-sm text-gray-500"},"Invoice To:",-1)),t("p",us,p(e.modelValue.invoice_to||"Not specified"),1)])])])):g("",!0),e.usesConfigurableSteps&&l.value.length>0?(i(!0),a(G,{key:2},J(l.value,I=>(i(),a("div",{key:I.step_code,class:"bg-white border border-gray-200 rounded-lg overflow-hidden"},[t("div",ds,[t("h3",cs,p(I.step_title),1)]),t("div",ms,[(i(!0),a(G,null,J(I.sections.filter(F=>F.show_on_review),F=>(i(),a("div",{key:F.section_code},[F.section_title?(i(),a("h4",fs,p(F.section_title),1)):g("",!0),t("div",ps,[(i(!0),a(G,null,J(F.fields.filter(L=>L.show_on_review),L=>(i(),a("div",{key:L.field_name},[t("span",gs,p(L.review_label||L.field_label)+":",1),t("p",ys,p(x(L,e.modelValue[L.field_name])),1)]))),128))])]))),128)),_(I)?g("",!0):(i(),a("p",vs," No information to display for review "))])]))),128)):g("",!0),e.isResourceConsent?(i(),a(G,{key:3},[t("div",hs,[n[15]||(n[15]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Consent Types & Activity Status")],-1)),t("div",xs,[t("div",bs,[t("div",null,[n[12]||(n[12]=t("span",{class:"text-sm text-gray-500"},"Consent Types:",-1)),t("div",_s,[e.modelValue.consent_type_land_use?(i(),a("span",ws," Land Use Consent ")):g("",!0),e.modelValue.consent_type_subdivision?(i(),a("span",Ss," Subdivision Consent ")):g("",!0),e.modelValue.consent_type_discharge?(i(),a("span",ks," Discharge Permit ")):g("",!0),e.modelValue.consent_type_water?(i(),a("span",qs," Water Permit ")):g("",!0),e.modelValue.consent_type_coastal?(i(),a("span",Vs," Coastal Permit ")):g("",!0),m.value?g("",!0):(i(),a("span",Cs," None selected "))])]),t("div",null,[n[13]||(n[13]=t("span",{class:"text-sm text-gray-500"},"Activity Status:",-1)),t("div",Ts,[t("span",{class:j(["px-3 py-1 rounded-full text-sm font-medium",v.value])},p(e.modelValue.activity_status_type||"Not specified"),3)])]),e.modelValue.activity_title?(i(),a("div",Ds,[n[14]||(n[14]=t("span",{class:"text-sm text-gray-500"},"Activity Title:",-1)),t("p",Rs,p(e.modelValue.activity_title),1)])):g("",!0)])])]),s.value?(i(),a("div",$s,[n[20]||(n[20]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Natural Hazards")],-1)),t("div",Ns,[t("div",Fs,[e.modelValue.hazard_flooding?(i(),a("span",Ms,[...n[16]||(n[16]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707"})],-1),C(" Flood Hazard ",-1)])])):g("",!0),e.modelValue.hazard_earthquake?(i(),a("span",Ps,[...n[17]||(n[17]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),C(" Earthquake/Fault Line ",-1)])])):g("",!0),e.modelValue.hazard_landslip?(i(),a("span",As,[...n[18]||(n[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1),C(" Landslip/Slope Instability ",-1)])])):g("",!0),e.modelValue.hazard_coastal?(i(),a("span",Is,[...n[19]||(n[19]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5"})],-1),C(" Coastal Hazard ",-1)])])):g("",!0)])])])):g("",!0),q.value?(i(),a("div",Ls,[n[25]||(n[25]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Consultation & Affected Parties")],-1)),t("div",Es,[t("div",js,[t("div",null,[n[21]||(n[21]=t("span",{class:"text-sm text-gray-500"},"Consultation Undertaken:",-1)),t("p",Bs,p(e.modelValue.consultation_undertaken||"Not specified"),1)]),e.modelValue.consultation_summary?(i(),a("div",zs,[n[22]||(n[22]=t("span",{class:"text-sm text-gray-500"},"Consultation Summary:",-1)),t("p",Os,p(e.modelValue.consultation_summary),1)])):g("",!0),e.modelValue.affected_parties_details?(i(),a("div",Hs,[n[23]||(n[23]=t("span",{class:"text-sm text-gray-500"},"Affected Parties:",-1)),t("p",Us,p(c(e.modelValue.affected_parties_details)),1)])):g("",!0),t("div",Ys,[(i(),a("svg",{class:j(["w-5 h-5",e.modelValue.written_approvals_obtained?"text-green-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...n[24]||(n[24]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),t("span",{class:j(e.modelValue.written_approvals_obtained?"text-gray-900":"text-gray-500")}," Written Approvals "+p(e.modelValue.written_approvals_obtained?"Obtained":"Not Obtained"),3)])])])])):g("",!0),t("div",Gs,[n[31]||(n[31]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Assessment of Environmental Effects")],-1)),t("div",Ws,[t("div",Js,[e.modelValue.activity_description?(i(),a("div",Zs,[n[26]||(n[26]=t("span",{class:"text-sm text-gray-500"},"Activity Description:",-1)),t("div",{class:"text-sm mt-1 line-clamp-3",innerHTML:e.modelValue.activity_description},null,8,Ks)])):g("",!0),e.modelValue.aee_full_assessment?(i(),a("div",Xs,[n[27]||(n[27]=t("span",{class:"text-sm text-gray-500"},"Full Assessment:",-1)),t("div",{class:"text-sm mt-1 line-clamp-3",innerHTML:e.modelValue.aee_full_assessment},null,8,Qs)])):g("",!0),e.modelValue.positive_effects_description?(i(),a("div",eo,[n[28]||(n[28]=t("span",{class:"text-sm text-gray-500"},"Positive Effects:",-1)),t("p",to,p(e.modelValue.positive_effects_description),1)])):g("",!0),e.modelValue.effects_visual_amenity||e.modelValue.effects_traffic_parking||e.modelValue.effects_noise?(i(),a("div",so,[n[29]||(n[29]=t("span",{class:"text-sm text-gray-500"},"Adverse Effects Summary:",-1)),t("ul",oo,[e.modelValue.effects_visual_amenity?(i(),a("li",no,"Visual/Amenity: "+p(b(e.modelValue.effects_visual_amenity,50)),1)):g("",!0),e.modelValue.effects_traffic_parking?(i(),a("li",ro,"Traffic/Parking: "+p(b(e.modelValue.effects_traffic_parking,50)),1)):g("",!0),e.modelValue.effects_noise?(i(),a("li",io,"Noise: "+p(b(e.modelValue.effects_noise,50)),1)):g("",!0)])])):g("",!0),e.modelValue.mitigation_measures?(i(),a("div",lo,[n[30]||(n[30]=t("span",{class:"text-sm text-gray-500"},"Mitigation Measures:",-1)),t("div",{class:"text-sm mt-1 line-clamp-3",innerHTML:e.modelValue.mitigation_measures},null,8,ao)])):g("",!0),r.value?g("",!0):(i(),a("p",uo," AEE not yet completed "))])])]),t("div",co,[n[36]||(n[36]=t("div",{class:"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200"},[t("h3",{class:"font-semibold text-gray-900 text-sm sm:text-base"},"Statutory Declarations")],-1)),t("div",mo,[t("div",fo,[t("div",po,[(i(),a("svg",{class:j(["w-5 h-5 flex-shrink-0 mt-0.5",e.modelValue.declaration_accuracy||e.modelValue.declaration_rma_compliance?"text-green-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...n[32]||(n[32]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),t("span",{class:j(["text-sm",e.modelValue.declaration_accuracy||e.modelValue.declaration_rma_compliance?"text-gray-900":"text-gray-500"])}," Declaration of Accuracy & RMA Compliance ",2)]),t("div",go,[(i(),a("svg",{class:j(["w-5 h-5 flex-shrink-0 mt-0.5",e.modelValue.declaration_authority||e.modelValue.declaration_authorized?"text-green-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...n[33]||(n[33]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),t("span",{class:j(["text-sm",e.modelValue.declaration_authority||e.modelValue.declaration_authorized?"text-gray-900":"text-gray-500"])}," Declaration of Authority to Apply ",2)]),t("div",yo,[(i(),a("svg",{class:j(["w-5 h-5 flex-shrink-0 mt-0.5",e.modelValue.declaration_acknowledgment||e.modelValue.declaration_public_information?"text-green-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...n[34]||(n[34]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),t("span",{class:j(["text-sm",e.modelValue.declaration_acknowledgment||e.modelValue.declaration_public_information?"text-gray-900":"text-gray-500"])}," Public Information & Privacy Acknowledgment ",2)]),e.modelValue.requester_signature?(i(),a("div",vo,[n[35]||(n[35]=t("span",{class:"text-sm text-gray-500"},"Signed by:",-1)),t("p",ho,p(e.modelValue.requester_signature),1),e.modelValue.signature_date?(i(),a("p",xo," Date: "+p(N(e.modelValue.signature_date)),1)):g("",!0)])):g("",!0)])])])],64)):g("",!0),n[38]||(n[38]=Z('<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 sm:p-6" data-v-889f31e6><div class="flex items-start gap-2 sm:gap-3" data-v-889f31e6><svg class="w-5 h-5 sm:w-6 sm:h-6 text-yellow-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-889f31e6><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-889f31e6></path></svg><div data-v-889f31e6><h4 class="font-semibold text-yellow-900 text-sm sm:text-base" data-v-889f31e6>Before You Submit</h4><ul class="mt-2 text-xs sm:text-sm text-yellow-800 space-y-1 list-disc list-inside" data-v-889f31e6><li data-v-889f31e6>Review all information carefully for accuracy and completeness</li><li data-v-889f31e6>Ensure all required fields are completed</li><li data-v-889f31e6>For Resource Consent applications, verify all statutory declarations are confirmed</li><li data-v-889f31e6>Once submitted, you cannot edit the application (you may need to withdraw and resubmit)</li></ul></div></div></div>',1)),R.value?g("",!0):(i(),a("div",bo,[...n[37]||(n[37]=[Z('<div class="flex items-start gap-2 sm:gap-3" data-v-889f31e6><svg class="w-5 h-5 text-red-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-889f31e6><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-v-889f31e6></path></svg><div data-v-889f31e6><h5 class="font-semibold text-red-900 text-xs sm:text-sm" data-v-889f31e6>Application Incomplete</h5><p class="text-red-800 text-xs sm:text-sm mt-1" data-v-889f31e6> Please complete all required sections before submitting. Use the Previous button to go back and fill in missing information. </p></div></div>',1)])]))])])}}},wo=Me(_o,[["__scopeId","data-v-889f31e6"]]),So={class:"min-h-screen bg-gray-50"},ko={class:"bg-white border-b border-gray-200"},qo={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Vo={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Co={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-8"},To={key:0},Do={key:1},Ro={key:2},$o={key:3},No={key:5},Fo={class:"text-xl font-bold text-red-600"},Mo={class:"list-disc list-inside mt-2 space-y-1 text-sm text-gray-700"},Po={key:0,class:"mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 shadow-sm"},Ao={__name:"NewRequest",setup(e){const o=U(()=>Y(()=>import("./SaveDraftModal-BFY2dWDw.js"),__vite__mapDeps([0,1,2]))),l=U(()=>Y(()=>import("./ValidationErrorModal-Hy_gEut9.js"),__vite__mapDeps([3,1,2]))),y=U(()=>Y(()=>import("./BookMeetingModal-DZcl7h9O.js"),__vite__mapDeps([4,1,2]))),_=U(()=>Y(()=>import("./SubmissionSuccessModal-BkRFecoL.js"),__vite__mapDeps([5,1,2,6]))),x=U(()=>Y(()=>import("./DynamicStepRenderer-CyuCRRXG.js"),__vite__mapDeps([7,1,2,8,9,10,11,12]))),m=Pe(),v=me(),s=Je(),q=Ae(),{errors:r,validateStep:c}=Ge(),b=A(!1),N=A(!1),R=A(!1),f=A(!1),n=A(null),$=A({loading:!1,data:[]}),I=A(null),F=S(()=>{var u;return(u=s.requestTypeConfig)!=null&&u.steps?s.requestTypeConfig.steps.length+4:4}),L=S(()=>{var d;const u=["Council","Type","Process Info"];return(d=s.requestTypeConfig)!=null&&d.steps&&u.push(...s.requestTypeConfig.steps.map(w=>w.step_title)),u.push("Review"),u}),O=S(()=>{var u;return((u=s.requestTypeConfig)==null?void 0:u.steps)&&s.requestTypeConfig.steps.length>0}),fe=S(()=>!0),K=S(()=>s.currentStep>=3),re=S(()=>{var d;if(!((d=s.requestTypeConfig)!=null&&d.steps))return null;const u=s.currentStep-3;return u>=0&&u<s.requestTypeConfig.steps.length?s.requestTypeConfig.steps[u]:null}),pe=S(()=>{var u;return s.currentStep>2&&s.currentStep<F.value-1&&((u=s.requestTypeConfig)==null?void 0:u.council_meeting_available)===1});function ge(){R.value=!0}function ye(u){console.log("Meeting booked:",u)}function H(){const u=s.currentStep;return u>=0&&u<L.value.length?L.value[u]:""}function X(){var w;const u=s.currentStep,d=3;if(u<d||u>=F.value-1)return null;if((w=s.requestTypeConfig)!=null&&w.steps){const T=u-d;if(T>=0&&T<s.requestTypeConfig.steps.length)return s.requestTypeConfig.steps[T]}return null}function ve(){const u=s.formData.council;if(!u)return"";const d=q.councils.find(w=>w.council_code===u);return(d==null?void 0:d.council_name)||u}function Q(u){return D(this,null,function*(){$.value.loading=!0,yield q.loadRequestTypesForCouncil(u),$.value={loading:!1,data:q.requestTypes||[]}})}function he(u){return D(this,null,function*(){if(s.updateField("request_type",u),yield s.initialize(u),I.value=s.requestTypeConfig,!s.requestTypeConfig){console.error("[NewRequest] Failed to load request type config");return}})}function ie(){return D(this,null,function*(){var u;if(s.currentStep===0&&!s.formData.council){alert("Please select a council before continuing.");return}if(s.currentStep===1&&!s.formData.request_type){alert("Please select a request type before continuing.");return}if(s.currentStep>=2&&O.value&&re.value&&!(yield c(re.value,s.formData))){console.error("[NewRequest] Validation failed:",r.value),N.value=!0;return}if(s.currentStep===2&&!s.currentRequestId){if(console.log("[NewRequest] Auto-saving draft after Process Info step..."),console.log("[NewRequest] requestTypeConfig:",s.requestTypeConfig),console.log("[NewRequest] usesConfigurableSteps:",O.value),console.log("[NewRequest] config steps:",(u=s.requestTypeConfig)==null?void 0:u.steps),yield s.saveDraft(),console.log("[NewRequest] Draft saved with ID:",s.currentRequestId),O.value)console.log("[NewRequest] Dynamic steps configured, continuing to next step...");else if(s.currentRequestId){console.log("[NewRequest] No dynamic steps configured, redirecting to detail page..."),v.push(`/request/${s.currentRequestId}`);return}}s.currentRequestId&&(yield s.saveProgress()),s.nextStep()})}function xe(){s.previousStep()}function le(){return D(this,null,function*(){try{yield s.saveDraft(),s.currentRequestId?v.push(`/request/${s.currentRequestId}`):b.value=!0}catch(u){console.error("Failed to save draft:",u)}})}function be(){return D(this,null,function*(){try{yield s.saveDraft(),s.reset(),v.push({name:"Dashboard"})}catch(u){console.error("Failed to save draft:",u)}})}function _e(){return D(this,null,function*(){try{const u=yield s.submitRequest();n.value=u,f.value=!0}catch(u){console.error("Failed to submit request:",u)}})}function we(){s.reset(),v.push("/dashboard")}function Se(u){f.value=!1,v.push(`/request/${u}`)}function ke(){f.value=!1;const u=s.formData.council;u?v.push(`/council/${u}/dashboard`):v.push("/dashboard")}return ce(()=>s.currentStep,()=>{},{immediate:!0}),ce(()=>s.formData.birth_date,u=>{var d;if(u&&((d=s.formData.request_type)!=null&&d.includes("SPISC"))){const w=new Date,T=new Date(u);let M=w.getFullYear()-T.getFullYear();const k=w.getMonth()-T.getMonth();(k<0||k===0&&w.getDate()<T.getDate())&&M--,s.updateField("age",M),M<60?r.value.birth_date="Applicant must be 60 years or older for SPISC":delete r.value.birth_date}}),Ie(()=>D(this,null,function*(){const u=m.query.type,d=m.query.draft,w=m.query.council,T=m.query.locked==="true";if(console.log("[NewRequest] Initialization - locked:",T,"council:",w,"type:",u),!d&&!m.query.draft&&s.reset(),!d){const{getApplicationAutoFill:M,applyAutoFill:k}=We();try{yield M(),k(s.formData,{overrideExisting:!1})}catch(qe){console.warn("[NewRequest] Failed to load user profile for auto-fill:",qe)}}if(d&&u){yield s.initialize(u,d),I.value=s.requestTypeConfig;return}if(T&&w&&u&&!d){console.log("[NewRequest] Locked flow detected - skipping to step 2"),s.updateField("council",w),yield Q(w),yield s.initialize(u),I.value=s.requestTypeConfig,s.updateField("request_type",u),s.currentStep=2,console.log("[NewRequest] Locked flow complete - currentStep:",s.currentStep);return}w&&!d&&!T?(s.updateField("council",w),yield Q(w),u?(yield s.initialize(u),I.value=s.requestTypeConfig,s.updateField("request_type",u),s.currentStep=2):s.currentStep=1):u&&!d&&!w&&(yield s.initialize(u),I.value=s.requestTypeConfig,s.updateField("request_type",u))})),Le((u,d,w)=>{if(s.isSubmitting||!s.currentRequestId){s.reset(),w();return}s.formData&&Object.keys(s.formData).some(M=>s.formData[M]!==void 0&&s.formData[M]!==null&&s.formData[M]!=="")&&!confirm("You have unsaved changes. Do you want to leave without saving?")?w(!1):(u.path.includes("/request/")||s.reset(),w())}),(u,d)=>{var w,T,M;return i(),a("div",So,[P(Ee,{title:"New Application",onBack:we},{actions:E(()=>[K.value?(i(),B(h(z),{key:0,onClick:le,variant:"outline",theme:"gray",loading:h(s).isSaving},{default:E(()=>[...d[9]||(d[9]=[C(" Save Draft ",-1)])]),_:1},8,["loading"])):g("",!0),K.value?(i(),B(h(z),{key:1,onClick:be,variant:"outline",theme:"gray",loading:h(s).isSaving},{default:E(()=>[...d[10]||(d[10]=[C(" Save and Close ",-1)])]),_:1},8,["loading"])):g("",!0)]),_:1}),t("div",ko,[t("div",qo,[P(st,{"current-step":h(s).currentStep,"total-steps":F.value,"step-titles":L.value},null,8,["current-step","total-steps","step-titles"])])]),t("main",Vo,[t("div",Co,[H()==="Council"?(i(),a("div",To,[P(lt,{modelValue:h(s).formData,"onUpdate:modelValue":d[0]||(d[0]=k=>h(s).formData=k),onCouncilChange:Q},null,8,["modelValue"])])):H()==="Type"?(i(),a("div",Do,[P(bt,{modelValue:h(s).formData,"onUpdate:modelValue":d[1]||(d[1]=k=>h(s).formData=k),"request-types":$.value,onTypeSelected:he},null,8,["modelValue","request-types"])])):H()==="Process Info"?(i(),a("div",Ro,[P(At,{"request-type-details":I.value,"council-name":ve(),modelValue:h(s).formData,"onUpdate:modelValue":d[2]||(d[2]=k=>h(s).formData=k),onContinue:ie},null,8,["request-type-details","council-name","modelValue"])])):H()==="Review"?(i(),a("div",$o,[P(wo,{modelValue:h(s).formData,"onUpdate:modelValue":d[3]||(d[3]=k=>h(s).formData=k),"request-type-config":h(s).requestTypeConfig},null,8,["modelValue","request-type-config"])])):O.value&&X()?(i(),B(h(x),{key:4,stepConfig:X(),modelValue:h(s).formData,"onUpdate:modelValue":d[4]||(d[4]=k=>h(s).formData=k)},null,8,["stepConfig","modelValue"])):(i(),a("div",No,[t("h2",Fo,"ERROR: Step "+p(h(s).currentStep)+" Fallback Hit!",1),d[16]||(d[16]=t("p",{class:"mt-2"},"The dynamic step condition failed to render. Check the following values:",-1)),t("ul",Mo,[t("li",null,[d[11]||(d[11]=t("strong",null,"Current Step Title:",-1)),C(" "+p(H()),1)]),t("li",null,[d[12]||(d[12]=t("strong",null,"Request Config Loaded:",-1)),C(" "+p(!!h(s).requestTypeConfig),1)]),t("li",null,[d[13]||(d[13]=t("strong",null,"Calculated Total Steps:",-1)),C(" "+p(F.value),1)]),t("li",null,[d[14]||(d[14]=t("strong",null,"Uses Configurable Steps:",-1)),C(" "+p(O.value),1)]),t("li",null,[d[15]||(d[15]=t("strong",null,"Current Step Config:",-1)),C(" "+p(JSON.stringify(X())),1)])]),d[17]||(d[17]=t("p",{class:"mt-4 text-sm text-gray-500"},"If 'Current Step Config' is not null, the issue is likely within DynamicStepRenderer or component registration.",-1))]))]),pe.value?(i(),a("div",Po,[t("div",{class:"flex items-start justify-between"},[t("div",{class:"flex-1"},[d[18]||(d[18]=Z('<div class="flex items-center gap-2 mb-2"><svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><h3 class="text-lg font-semibold text-gray-900">Council Meeting Available</h3></div><p class="text-sm text-gray-700 mb-3"> Schedule a meeting with council planners to discuss your application before submitting. This optional step can help clarify requirements and improve your application. </p>',2)),t("button",{onClick:ge,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"}," Request Council Meeting ")])])])):g("",!0),P(it,{"current-step":h(s).currentStep,"total-steps":F.value,"is-last-step":h(s).isLastStep,"can-go-next":fe.value,"can-save-draft":K.value,"is-saving":h(s).isSaving,"is-submitting":h(s).isSubmitting,onNext:ie,onPrevious:xe,onSaveDraft:le,onSubmit:_e},null,8,["current-step","total-steps","is-last-step","can-go-next","can-save-draft","is-saving","is-submitting"])]),P(h(o),{show:b.value,"onUpdate:show":d[5]||(d[5]=k=>b.value=k),"draft-id":h(s).currentRequestId},null,8,["show","draft-id"]),P(h(l),{show:N.value,"onUpdate:show":d[6]||(d[6]=k=>N.value=k),errors:h(r)},null,8,["show","errors"]),P(h(y),{show:R.value,"onUpdate:show":d[7]||(d[7]=k=>R.value=k),"request-id":h(s).currentRequestId,"request-type-code":h(s).formData.request_type,"council-code":h(s).formData.council,onBooked:ye},null,8,["show","request-id","request-type-code","council-code"]),P(h(_),{open:f.value,"request-number":(w=n.value)==null?void 0:w.request_number,"request-id":(T=n.value)==null?void 0:T.request_id,"sla-info":(M=n.value)==null?void 0:M.sla_info,onClose:d[8]||(d[8]=k=>f.value=!1),onViewRequest:Se,onGoToDashboard:ke},null,8,["open","request-number","request-id","sla-info"])])}}},Ho=Object.freeze(Object.defineProperty({__proto__:null,default:Ao},Symbol.toStringTag,{value:"Module"}));export{Ho as N,Ge as a,zo as b,Oo as i,We as u};
//# sourceMappingURL=NewRequest-D_bZwJmk.js.map
