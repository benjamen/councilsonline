var j=(T,O,o)=>new Promise((S,M)=>{var c=l=>{try{y(o.next(l))}catch(m){M(m)}},x=l=>{try{y(o.throw(l))}catch(m){M(m)}},y=l=>l.done?S(l.value):Promise.resolve(l.value).then(c,x);y((o=o.apply(T,O)).next())});import{c as F,B as u,w as Q,O as Z,o as n,P as ee,b as t,a as i,e as b,a6 as _,ak as U,ae as C,u as g,t as v,F as L,W as z,n as te}from"./vue-vendor-D9RCx05D.js";import{c as J,D as le}from"./frappe-ui-E4oUKPDc.js";import"./ui-components-88qJBhde.js";const se={class:"p-6 max-h-[80vh] overflow-y-auto"},oe={class:"space-y-6"},ae=["disabled"],ne=["disabled"],ie=["disabled"],re={class:"flex items-center justify-between mb-2"},de=["disabled"],ue={key:0,class:"mb-4 border border-blue-200 rounded-lg p-4 bg-blue-50"},ce={key:1,class:"mb-4 border border-red-200 rounded-lg p-4 bg-red-50"},me={class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},ge={class:"flex items-center justify-between mb-2"},pe={key:0,class:"text-xs text-gray-500"},be=["disabled"],ve=["value"],ye=["disabled"],fe={key:2,class:"text-xs text-gray-500 mt-1"},xe={key:0,class:"mt-3 text-center"},_e={key:1,class:"mt-3 text-center"},we={key:0,class:"mb-3 space-y-2"},ke={class:"flex-1"},he={class:"text-sm font-medium text-gray-900"},Ce={class:"text-xs text-gray-600"},Se=["onClick","disabled"],Me={class:"border border-gray-300 rounded-lg p-4 bg-white space-y-3"},Ae={class:"grid grid-cols-2 gap-3"},Te=["disabled"],De=["disabled"],Pe={key:0,class:"text-xs text-red-600 mt-1"},Ve=["disabled"],Oe=["disabled"],Re={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4"},qe={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Be={class:"text-sm text-red-800"},Ie={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Ee=["disabled"],Ne=["disabled"],je={key:0},Fe={key:1},Ue=60*60*1e3,$e={__name:"BookMeetingModal",props:{show:{type:Boolean,required:!0},requestId:{type:String,default:null},requestTypeCode:{type:String,default:null},councilCode:{type:String,default:null},meeting:{type:Object,default:null}},emits:["update:show","booked"],setup(T,{emit:O}){const o=T,S=O,M=F({get:()=>o.show,set:a=>S("update:show",a)}),c=u("Pre-Application Meeting"),x=u(""),y=u(""),l=u(!1),m=u(null),R=u(!1),A=u(""),k=u([]),h=u(""),w=u(""),D=u(""),q=u(!1),W=J({url:"lodgeick.api.get_meeting_config",auto:!1}),r=J({url:"lodgeick.api.get_available_meeting_slots",auto:!1});Q(()=>o.show,a=>{var e;if(a&&o.councilCode){if(o.meeting&&(c.value=o.meeting.meeting_type||"Pre-Application Meeting",x.value=o.meeting.meeting_purpose||"",y.value=o.meeting.discussion_points||"",o.meeting.preferred_meeting_times)){const P=Array.isArray(o.meeting.preferred_meeting_times)?o.meeting.preferred_meeting_times:[];d.value=((e=P[0])==null?void 0:e.preferred_start)||""}W.fetch({council_code:o.councilCode,meeting_type:c.value});const f=new Date,p=new Date;p.setDate(f.getDate()+30),r.fetch({council_code:o.councilCode,meeting_type:c.value,start_date:f.toISOString().split("T")[0],end_date:p.toISOString().split("T")[0]})}});const d=u(""),B=a=>{if(!a)return"";try{const e=new Date(a);if(isNaN(e.getTime()))throw new Error("Invalid date");return new Date(e.getTime()+Ue).toISOString().slice(0,16)}catch(e){return console.error("Error calculating end time:",e),""}},Y=a=>{if(!a)return"";try{const e=B(a);return e?new Date(e).toLocaleString():"Invalid date"}catch(e){return"Invalid date"}},$=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),I=F(()=>!c.value||!x.value.trim()?!1:d.value&&d.value.trim()!==""),G=()=>{if(A.value="",h.value.trim()&&w.value.trim()){if(!$(w.value.trim())){A.value="Please enter a valid email address";return}k.value.push({attendee_name:h.value.trim(),attendee_email:w.value.trim(),attendee_role:D.value.trim()||"Applicant Representative"}),h.value="",w.value="",D.value=""}},K=a=>{k.value.splice(a,1)},X=()=>{if(q.value=!q.value,q.value&&o.councilCode&&!r.data){const a=new Date,e=new Date;e.setDate(a.getDate()+30),r.fetch({council_code:o.councilCode,meeting_type:c.value,start_date:a.toISOString().split("T")[0],end_date:e.toISOString().split("T")[0]})}},E=()=>{l.value||(c.value="Pre-Application Meeting",x.value="",y.value="",k.value=[],d.value="",m.value=null,R.value=!1,S("update:show",!1))},H=()=>j(this,null,function*(){var a;if(I.value){l.value=!0,m.value=null;try{const e={preference_order:1,preferred_start:d.value,preferred_end:B(d.value)},p=yield(yield fetch("/api/method/lodgeick.api.book_council_meeting",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:o.requestId||"draft",request_type_code:o.requestTypeCode,meeting_type:c.value,meeting_purpose:x.value,discussion_points:y.value,attendees:k.value,preferred_time_slots:[e]})})).json();(a=p.message)!=null&&a.success?(R.value=!0,m.value=null,S("booked",p.message),setTimeout(()=>{E()},2e3)):m.value=p.exc||p._server_messages||"Failed to book meeting"}catch(e){console.error("Book meeting error:",e),m.value="Network error. Please try again."}finally{l.value=!1}}});return(a,e)=>(n(),Z(g(le),{modelValue:M.value,"onUpdate:modelValue":e[8]||(e[8]=f=>M.value=f),options:{size:"lg"}},{body:ee(()=>{var f,p,P,N;return[t("div",se,[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Request Pre-Application Council Meeting",-1)),t("div",oe,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meeting Type *",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:l.value},[...e[9]||(e[9]=[t("option",{value:"Pre-Application Meeting"},"Pre-Application Meeting",-1),t("option",{value:"Follow-up Meeting"},"Follow-up Meeting",-1),t("option",{value:"Clarification Meeting"},"Clarification Meeting",-1),t("option",{value:"Final Review Meeting"},"Final Review Meeting",-1)])],8,ae),[[U,c.value]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meeting Purpose *",-1)),_(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),rows:"3",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Brief summary of why you need this meeting...",disabled:l.value},null,8,ne),[[C,x.value]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Discussion Points (Optional)",-1)),_(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),rows:"4",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Key topics you'd like to discuss (bullet points)...",disabled:l.value},null,8,ie),[[C,y.value]])]),t("div",null,[t("div",re,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700"},"Preferred Meeting Time *",-1)),T.councilCode&&!g(r).loading?(n(),i("button",{key:0,type:"button",onClick:X,class:"text-sm text-blue-600 hover:text-blue-700 font-medium",disabled:l.value},v(g(r).data?"Refresh Available Slots":"Load Available Slots"),9,de)):b("",!0)]),e[20]||(e[20]=t("p",{class:"text-xs text-gray-500 mb-3"},"Select your preferred time slot (1 hour meeting). The council will confirm or propose an alternative.",-1)),g(r).loading?(n(),i("div",ue,[...e[14]||(e[14]=[t("div",{class:"text-center py-4"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),t("p",{class:"text-sm text-gray-600 mt-2"},"Loading available time slots...")],-1)])])):g(r).error?(n(),i("div",ce,[...e[15]||(e[15]=[t("p",{class:"text-sm text-red-600"},"Failed to load available slots. Please enter your preferred time manually below.",-1)])])):b("",!0),t("div",me,[t("div",ge,[e[16]||(e[16]=t("span",{class:"text-sm font-medium text-gray-700"},"Select Time",-1)),d.value?(n(),i("span",pe,"1 hour duration")):b("",!0)]),t("div",null,[((p=(f=g(r).data)==null?void 0:f.slots)==null?void 0:p.length)>0?_((n(),i("select",{key:0,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:l.value},[e[17]||(e[17]=t("option",{value:""},"-- Select an available time slot --",-1)),(n(!0),i(L,null,z(g(r).data.slots.slice(0,30),(s,V)=>(n(),i("option",{key:V,value:s.start.slice(0,16)},v(s.start_display)+" - "+v(s.end_display)+" ("+v(s.day)+") ",9,ve))),128))],8,be)),[[U,d.value]]):_((n(),i("input",{key:1,type:"datetime-local","onUpdate:modelValue":e[4]||(e[4]=s=>d.value=s),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:l.value},null,8,ye)),[[C,d.value]]),d.value?(n(),i("p",fe," Meeting will end at "+v(Y(d.value)),1)):b("",!0)]),!g(r).data&&!g(r).loading&&!g(r).error?(n(),i("div",xe,[...e[18]||(e[18]=[t("p",{class:"text-xs text-gray-500"},' Click "Load Available Slots" above to see available meeting times. ',-1)])])):b("",!0),((N=(P=g(r).data)==null?void 0:P.slots)==null?void 0:N.length)===0?(n(),i("div",_e,[...e[19]||(e[19]=[t("p",{class:"text-xs text-gray-600"}," No available slots found in the next 30 days. Please enter your preferred time manually. ",-1)])])):b("",!0)])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Additional Attendees (Optional)",-1)),e[26]||(e[26]=t("p",{class:"text-xs text-gray-500 mb-3"},"Add any representatives, consultants, or advisors who will attend with you.",-1)),k.value.length>0?(n(),i("div",we,[(n(!0),i(L,null,z(k.value,(s,V)=>(n(),i("div",{key:V,class:"flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3"},[t("div",ke,[t("div",he,v(s.attendee_name),1),t("div",Ce,v(s.attendee_email)+" â€¢ "+v(s.attendee_role),1)]),t("button",{onClick:Le=>K(V),class:"ml-3 text-red-600 hover:text-red-700",disabled:l.value},[...e[21]||(e[21]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Se)]))),128))])):b("",!0),t("div",Me,[t("div",Ae,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Name",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>h.value=s),placeholder:"John Smith",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:l.value},null,8,Te),[[C,h.value]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Email",-1)),_(t("input",{type:"email","onUpdate:modelValue":e[6]||(e[6]=s=>w.value=s),placeholder:"john@example.com",class:te(["w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",{"border-red-500":A.value}]),disabled:l.value},null,10,De),[[C,w.value]]),A.value?(n(),i("p",Pe,v(A.value),1)):b("",!0)])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Role/Title",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>D.value=s),placeholder:"e.g., Architect, Consultant, Representative",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:l.value},null,8,Ve),[[C,D.value]])]),t("button",{onClick:G,disabled:!h.value||!w.value||l.value,class:"w-full px-3 py-2 text-sm font-medium text-blue-600 border border-blue-300 hover:bg-blue-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"}," Add Attendee ",8,Oe)])]),e[28]||(e[28]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[t("h4",{class:"text-sm font-semibold text-blue-900 mb-2"},"What happens next?"),t("ul",{class:"text-sm text-blue-800 space-y-1 list-disc list-inside"},[t("li",null,"Your meeting request will be sent to the council"),t("li",null,"The council will review and confirm your selected time"),t("li",null,"You'll receive a calendar invitation once confirmed")])],-1)),R.value?(n(),i("div",Re,[...e[27]||(e[27]=[t("div",{class:"flex items-center"},[t("svg",{class:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),t("p",{class:"text-sm text-green-800 font-medium"},"Meeting request submitted! The council will confirm your selected time.")],-1)])])):b("",!0),m.value?(n(),i("div",qe,[t("p",Be,v(m.value),1)])):b("",!0),t("div",Ie,[t("button",{onClick:E,disabled:l.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}," Cancel ",8,Ee),t("button",{onClick:H,disabled:!I.value||l.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[l.value?(n(),i("span",je,"Requesting...")):(n(),i("span",Fe,"Request Meeting"))],8,Ne)])])])]}),_:1},8,["modelValue"]))}};export{$e as default};
//# sourceMappingURL=BookMeetingModal-xTVIUdDO.js.map
