var de=Object.defineProperty,ue=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var G=(u,i,s)=>i in u?de(u,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[i]=s,K=(u,i)=>{for(var s in i||(i={}))pe.call(i,s)&&G(u,s,i[s]);if($)for(var s of $(i))me.call(i,s)&&G(u,s,i[s]);return u},W=(u,i)=>ue(u,ce(i));var X=(u,i,s)=>new Promise((V,D)=>{var f=r=>{try{x(s.next(r))}catch(b){D(b)}},w=r=>{try{x(s.throw(r))}catch(b){D(b)}},x=r=>r.done?V(r.value):Promise.resolve(r.value).then(f,w);x((s=s.apply(u,i)).next())});import{j as Y,r as c,n as H,E as be,y as ge,o as a,w as ve,a as t,c as n,d as v,k as _,v as Q,M,u as p,t as m,F as B,l as N,A as fe,D as ye}from"./index-DAitPya7.js";const xe={class:"p-6 max-h-[80vh] overflow-y-auto"},_e={class:"space-y-6"},we=["disabled"],he=["disabled"],ke=["disabled"],Se={class:"flex items-center justify-between mb-2"},Te=["disabled"],Ce={key:0,class:"mb-4 border border-blue-200 rounded-lg p-4 bg-blue-50"},Ae={key:1,class:"mb-4 border border-red-200 rounded-lg p-4 bg-red-50"},Me={class:"space-y-3"},Ve={class:"flex items-center justify-between mb-2"},De={class:"flex items-center"},Oe={class:"text-sm font-medium text-gray-700"},Pe={key:0,class:"ml-2 text-xs text-red-600"},Ee={key:0,class:"text-xs text-gray-500"},Re={class:"block text-xs text-gray-600 mb-1"},qe=["onUpdate:modelValue","onChange","disabled"],Ue=["value","disabled"],Be=["onUpdate:modelValue","disabled"],Ne={key:2,class:"text-xs text-gray-500 mt-1"},je={key:0,class:"text-center py-2"},Ie={key:1,class:"text-center py-2"},Le={key:0,class:"mb-3 space-y-2"},Fe={class:"flex-1"},ze={class:"text-sm font-medium text-gray-900"},Je={class:"text-xs text-gray-600"},$e=["onClick","disabled"],Ge={class:"border border-gray-300 rounded-lg p-4 bg-white space-y-3"},Ke={class:"grid grid-cols-2 gap-3"},We=["disabled"],Xe=["disabled"],Ye={key:0,class:"text-xs text-red-600 mt-1"},He=["disabled"],Qe=["disabled"],Ze={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4"},et={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},tt={class:"text-sm text-red-800"},lt={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},st=["disabled"],rt=["disabled"],ot={key:0},at={key:1},nt=60*60*1e3,ut={__name:"BookMeetingModal",props:{show:{type:Boolean,required:!0},requestId:{type:String,default:null},requestTypeCode:{type:String,default:null},councilCode:{type:String,default:null}},emits:["update:show","booked"],setup(u,{emit:i}){const s=u,V=i,D=Y({get:()=>s.show,set:o=>V("update:show",o)}),f=c("Pre-Application Meeting"),w=c(""),x=c(""),r=c(!1),b=c(null),E=c(!1),O=c(""),C=c([]),A=c(""),h=c(""),P=c(""),R=c(!1),Z=H({url:"lodgeick.api.get_meeting_config",auto:!1}),d=H({url:"lodgeick.api.get_available_meeting_slots",auto:!1});be(()=>s.show,o=>{if(o&&s.councilCode){Z.fetch({council_code:s.councilCode,meeting_type:f.value});const e=new Date,y=new Date;y.setDate(e.getDate()+30),d.fetch({council_code:s.councilCode,meeting_type:f.value,start_date:e.toISOString().split("T")[0],end_date:y.toISOString().split("T")[0]})}});const k=c([{preference_order:1,preferred_start:""},{preference_order:2,preferred_start:""},{preference_order:3,preferred_start:""}]),j=o=>{if(!o)return"";try{const e=new Date(o);if(isNaN(e.getTime()))throw new Error("Invalid date");return new Date(e.getTime()+nt).toISOString().slice(0,16)}catch(e){return console.error("Error calculating end time:",e),""}},ee=o=>{if(!o)return"";try{const e=j(o);return e?new Date(e).toLocaleString():"Invalid date"}catch(e){return"Invalid date"}},te=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),I=Y(()=>!f.value||!w.value.trim()?!1:k.value.some(e=>e.preferred_start&&e.preferred_start.trim()!=="")),le=()=>{if(O.value="",A.value.trim()&&h.value.trim()){if(!te(h.value.trim())){O.value="Please enter a valid email address";return}C.value.push({attendee_name:A.value.trim(),attendee_email:h.value.trim(),attendee_role:P.value.trim()||"Applicant Representative"}),A.value="",h.value="",P.value=""}},se=o=>{C.value.splice(o,1)},re=(o,e)=>{o>=0&&o<k.value.length&&(k.value[o].preferred_start=e.start.slice(0,16))},oe=()=>{if(R.value=!R.value,R.value&&s.councilCode&&!d.data){const o=new Date,e=new Date;e.setDate(o.getDate()+30),d.fetch({council_code:s.councilCode,meeting_type:f.value,start_date:o.toISOString().split("T")[0],end_date:e.toISOString().split("T")[0]})}},L=()=>{r.value||(f.value="Pre-Application Meeting",w.value="",x.value="",C.value=[],k.value=[{preference_order:1,preferred_start:""},{preference_order:2,preferred_start:""},{preference_order:3,preferred_start:""}],b.value=null,E.value=!1,V("update:show",!1))},ae=()=>X(this,null,function*(){var o;if(I.value){r.value=!0,b.value=null;try{const e=k.value.filter(l=>l.preferred_start&&l.preferred_start.trim()!=="").map(l=>W(K({},l),{preferred_end:j(l.preferred_start)})),S=yield(yield fetch("/api/method/lodgeick.api.book_council_meeting",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:s.requestId||"draft",request_type_code:s.requestTypeCode,meeting_type:f.value,meeting_purpose:w.value,discussion_points:x.value,attendees:C.value,preferred_time_slots:e})})).json();(o=S.message)!=null&&o.success?(E.value=!0,b.value=null,V("booked",S.message),setTimeout(()=>{L()},2e3)):b.value=S.exc||S._server_messages||"Failed to book meeting"}catch(e){console.error("Book meeting error:",e),b.value="Network error. Please try again."}finally{r.value=!1}}});return(o,e)=>(a(),ge(p(ye),{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=y=>D.value=y),options:{size:"lg"}},{body:ve(()=>{var y,S;return[t("div",xe,[e[26]||(e[26]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Request Pre-Application Council Meeting",-1)),t("div",_e,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meeting Type *",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},[...e[7]||(e[7]=[t("option",{value:"Pre-Application Meeting"},"Pre-Application Meeting",-1),t("option",{value:"Site Visit"},"Site Visit",-1),t("option",{value:"Follow-up Meeting"},"Follow-up Meeting",-1),t("option",{value:"Technical Review"},"Technical Review",-1),t("option",{value:"Other"},"Other",-1)])],8,we),[[Q,f.value]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meeting Purpose *",-1)),_(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),rows:"3",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Brief summary of why you need this meeting...",disabled:r.value},null,8,he),[[M,w.value]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Discussion Points (Optional)",-1)),_(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),rows:"4",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Key topics you'd like to discuss (bullet points)...",disabled:r.value},null,8,ke),[[M,x.value]])]),t("div",null,[t("div",Se,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Preferred Meeting Times *",-1)),u.councilCode&&!p(d).loading?(a(),n("button",{key:0,type:"button",onClick:oe,class:"text-sm text-blue-600 hover:text-blue-700 font-medium",disabled:r.value},m(p(d).data?"Refresh Available Slots":"Load Available Slots"),9,Te)):v("",!0)]),e[17]||(e[17]=t("p",{class:"text-xs text-gray-500 mb-3"},"Select up to 3 preferred time slots (each meeting is 1 hour). The council will confirm or propose alternatives.",-1)),p(d).loading?(a(),n("div",Ce,[...e[12]||(e[12]=[t("div",{class:"text-center py-4"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),t("p",{class:"text-sm text-gray-600 mt-2"},"Loading available time slots...")],-1)])])):p(d).error?(a(),n("div",Ae,[...e[13]||(e[13]=[t("p",{class:"text-sm text-red-600"},"Failed to load available slots. Please enter your preferred times manually below.",-1)])])):v("",!0),t("div",Me,[(a(!0),n(B,null,N(k.value,(l,T)=>{var q,F,z,J;return a(),n("div",{key:T,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},[t("div",Ve,[t("div",De,[t("span",Oe,"Option "+m(l.preference_order),1),T===0?(a(),n("span",Pe,"*")):v("",!0)]),l.preferred_start?(a(),n("span",Ee,"1 hour duration")):v("",!0)]),t("div",null,[t("label",Re,m(((F=(q=p(d).data)==null?void 0:q.slots)==null?void 0:F.length)>0?"Select Time Slot":"Enter Time"),1),((J=(z=p(d).data)==null?void 0:z.slots)==null?void 0:J.length)>0?_((a(),n("select",{key:0,"onUpdate:modelValue":g=>l.preferred_start=g,onChange:g=>re(T,p(d).data.slots.find(U=>U.start.slice(0,16)===g.target.value)),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},[e[14]||(e[14]=t("option",{value:""},"-- Select a time slot --",-1)),(a(!0),n(B,null,N(p(d).data.slots.slice(0,30),(g,U)=>(a(),n("option",{key:U,value:g.start.slice(0,16),disabled:k.value.some((ne,ie)=>ie!==T&&ne.preferred_start===g.start.slice(0,16))},m(g.start_display)+" - "+m(g.end_display)+" ("+m(g.day)+") ",9,Ue))),128))],40,qe)),[[Q,l.preferred_start]]):_((a(),n("input",{key:1,type:"datetime-local","onUpdate:modelValue":g=>l.preferred_start=g,class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},null,8,Be)),[[M,l.preferred_start]]),l.preferred_start?(a(),n("p",Ne," Meeting will end at "+m(ee(l.preferred_start)),1)):v("",!0)])])}),128)),!p(d).data&&!p(d).loading&&!p(d).error?(a(),n("div",je,[...e[15]||(e[15]=[t("p",{class:"text-xs text-gray-500"},' Click "Load Available Slots" above to see available meeting times, or manually enter your preferred times. ',-1)])])):v("",!0),((S=(y=p(d).data)==null?void 0:y.slots)==null?void 0:S.length)===0?(a(),n("div",Ie,[...e[16]||(e[16]=[t("p",{class:"text-xs text-gray-600"}," No available slots found in the next 30 days. Please enter your preferred times manually above. ",-1)])])):v("",!0)])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Additional Attendees (Optional)",-1)),e[23]||(e[23]=t("p",{class:"text-xs text-gray-500 mb-3"},"Add any representatives, consultants, or advisors who will attend with you.",-1)),C.value.length>0?(a(),n("div",Le,[(a(!0),n(B,null,N(C.value,(l,T)=>(a(),n("div",{key:T,class:"flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3"},[t("div",Fe,[t("div",ze,m(l.attendee_name),1),t("div",Je,m(l.attendee_email)+" â€¢ "+m(l.attendee_role),1)]),t("button",{onClick:q=>se(T),class:"ml-3 text-red-600 hover:text-red-700",disabled:r.value},[...e[18]||(e[18]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,$e)]))),128))])):v("",!0),t("div",Ge,[t("div",Ke,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Name",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>A.value=l),placeholder:"John Smith",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},null,8,We),[[M,A.value]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Email",-1)),_(t("input",{type:"email","onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),placeholder:"john@example.com",class:fe(["w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",{"border-red-500":O.value}]),disabled:r.value},null,10,Xe),[[M,h.value]]),O.value?(a(),n("p",Ye,m(O.value),1)):v("",!0)])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Role/Title",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=l=>P.value=l),placeholder:"e.g., Architect, Consultant, Representative",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},null,8,He),[[M,P.value]])]),t("button",{onClick:le,disabled:!A.value||!h.value||r.value,class:"w-full px-3 py-2 text-sm font-medium text-blue-600 border border-blue-300 hover:bg-blue-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"}," Add Attendee ",8,Qe)])]),e[25]||(e[25]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[t("h4",{class:"text-sm font-semibold text-blue-900 mb-2"},"What happens next?"),t("ul",{class:"text-sm text-blue-800 space-y-1 list-disc list-inside"},[t("li",null,"Your meeting request will be sent to the council processing team"),t("li",null,"A council planner will contact you within 2 business days"),t("li",null,"They will confirm one of your preferred times or propose alternatives"),t("li",null,"A calendar invitation will be sent once confirmed")])],-1)),E.value?(a(),n("div",Ze,[...e[24]||(e[24]=[t("div",{class:"flex items-center"},[t("svg",{class:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),t("p",{class:"text-sm text-green-800 font-medium"},"Meeting request submitted successfully! The council will review and confirm your preferred time slots.")],-1)])])):v("",!0),b.value?(a(),n("div",et,[t("p",tt,m(b.value),1)])):v("",!0),t("div",lt,[t("button",{onClick:L,disabled:r.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}," Cancel ",8,st),t("button",{onClick:ae,disabled:!I.value||r.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(a(),n("span",ot,"Requesting...")):(a(),n("span",at,"Request Meeting"))],8,rt)])])])]}),_:1},8,["modelValue"]))}};export{ut as default};
//# sourceMappingURL=BookMeetingModal-C5zSccGb.js.map
