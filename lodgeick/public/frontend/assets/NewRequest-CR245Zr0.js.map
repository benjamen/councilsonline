{"version":3,"mappings":";giCAGO,MAAMA,GAAkBC,GAAY,UAAW,CAClD,MAAO,KAAO,CAEV,iBAAkB,KAClB,gBAAiB,KACjB,kBAAmB,KAGnB,SAAU,GACV,YAAa,EAGb,qBAAsB,GAGtB,SAAU,GACV,aAAc,GACd,UAAW,KAGX,MAAO,IACf,GAEI,QAAS,CACL,YAAcC,GAAUA,EAAM,cAAgB,EAG9C,WAAaA,GAAU,OACnB,OAAIC,EAAAD,EAAM,oBAAN,MAAAC,EAAyB,MAElBD,EAAM,kBAAkB,MAAM,OAAS,EAE3C,CACX,EAIA,WAAaA,GAEFA,EAAM,cAAgBA,EAAM,WAAa,EAIpD,kBAAoBA,GAAU,SAI1B,OAAOE,GAAAD,EAAAD,EAAM,oBAAN,YAAAC,EAAyB,QAAzB,YAAAC,EAAiCF,EAAM,YAClD,EAEA,gBAAkBA,GACPA,EAAM,qBAAqBA,EAAM,WAAW,IAAM,GAG7D,qBAAuBA,GACfA,EAAM,aAAe,EAAU,EAC5B,KAAK,OAAQA,EAAM,YAAc,GAAKA,EAAM,WAAc,GAAG,EAGxE,kBAAoBA,GAEXA,EAAM,UACC,IAAI,KACGA,EAAM,UACX,IAHe,OAAO,KAAKA,EAAM,QAAQ,EAAE,OAAS,CAK9E,EAEI,QAAS,CAML,UAAW,CACF,KAAK,YACN,KAAK,aAEb,EAKA,cAAe,CACN,KAAK,aACN,KAAK,aAEb,EAKA,SAASG,EAAW,CAEZA,GAAa,GAAKA,EAAY,KAAK,aACnC,KAAK,YAAcA,EAE3B,EAKM,WAAWC,EAAiBC,EAAU,KAAM,QAAAC,EAAA,sBAC9C,GAAI,CACA,KAAK,gBAAkBF,EACvB,KAAK,MAAQ,KAEb,QAAQ,IAAI,oCAAqC,CAAE,gBAAAA,EAAiB,QAAAC,CAAO,CAAE,EAG7E,MAAME,EAAiBC,EAAe,qBAAqBJ,CAAe,EAG1E,MAAM,IAAI,QAASK,GAAY,CAC3B,MAAMC,EAAc,YAAY,IAAM,CAC7BH,EAAe,UAChB,cAAcG,CAAW,EACzBD,EAAO,EAEf,EAAG,GAAG,CACV,CAAC,EAED,KAAK,kBAAoBF,EAAe,KAEpCF,IAEA,MAAM,KAAK,UAAUA,CAAO,EAEpC,OAASM,EAAO,CACZ,QAAQ,MAAM,gCAAiCA,CAAK,EACpD,KAAK,MAAQA,EAAM,SAAW,6BAClC,CACJ,IAEM,UAAUN,EAAS,QAAAC,EAAA,sBACrB,GAAI,CACA,MAAMM,EAAWJ,EAAe,WAAWH,CAAO,EAGlD,MAAM,IAAI,QAASI,GAAY,CAC3B,MAAMC,EAAc,YAAY,IAAM,CAC7BE,EAAS,UACV,cAAcF,CAAW,EACzBD,EAAO,EAEf,EAAG,GAAG,CACV,CAAC,EAED,MAAMI,EAAQD,EAAS,KAIvB,GAHA,KAAK,iBAAmBP,EAGpBQ,EAAM,gBACN,GAAI,CACA,KAAK,SAAW,KAAK,MAAMA,EAAM,eAAe,CACpD,OAASF,EAAO,CACZ,QAAQ,MAAM,mCAAoCA,CAAK,EACvD,KAAK,SAAWE,EAAM,WAAa,EACvC,MAEA,KAAK,SAAWA,EAAM,WAAa,GAIvC,KAAK,YAAcA,EAAM,oBAAsB,CACnD,OAASF,EAAO,CACZ,QAAQ,MAAM,wBAAyBA,CAAK,EAC5C,KAAK,MAAQA,EAAM,SAAW,sBAClC,CACJ,IAEM,cAAe,QAAAL,EAAA,sBAEjB,GAAI,KAAK,SAAU,CACf,QAAQ,IAAI,mDAAmD,EAC/D,MACJ,CAGI,KAAK,kBAAoB,CAAC,KAAK,SAAS,aACxC,QAAQ,KAAK,+CAA+C,EAC5D,KAAK,SAAS,WAAa,KAAK,kBAGpC,QAAQ,IAAI,qCAAsC,CAC9C,aAAc,CAAC,CAAC,KAAK,iBACrB,cAAe,CAAC,CAAC,KAAK,SAAS,WAC/B,YAAa,KAAK,YAClB,SAAU,KAAK,QAC/B,CAAa,EAED,KAAK,SAAW,GAChB,KAAK,MAAQ,KAEb,GAAI,CAEA,MAAMQ,EAAgB,GACtB,SAAW,CAACC,EAAKC,CAAK,IAAK,OAAO,QAAQ,KAAK,QAAQ,EAAG,CAEtD,GAAIA,aAAiB,KAAM,CACvB,QAAQ,KAAK,gDAAgDD,CAAG,EAAE,EAClE,QACJ,CAE2BC,GAAU,OACjCF,EAAcC,CAAG,EAAIC,EAE7B,CAGA,GAAI,OAAO,KAAKF,CAAa,EAAE,SAAW,GAAK,CAAC,KAAK,iBACjD,MAAM,IAAI,MAAM,0DAA0D,EAG9E,QAAQ,IAAI,6CAA8C,OAAO,KAAKA,CAAa,EAAE,OAAQ,QAAQ,EAErG,MAAMG,EAAS,MAAMT,EAAe,YAChCM,EACA,KAAK,WACzB,EAEgB,OAAK,KAAK,mBACN,KAAK,iBAAmBG,EAAO,WAE/B,KAAK,SAAS,WAAaA,EAAO,WAGlC,aAAa,QAAQ,mBAAoBA,EAAO,UAAU,GAG9D,KAAK,UAAY,IAAI,KAEdA,CACX,OAASN,EAAO,CACZ,cAAQ,MAAM,eAAgBA,CAAK,EACnC,KAAK,MAAQA,EAAM,SAAW,0BACxBA,CACV,QAAC,CACG,KAAK,SAAW,EACpB,CACJ,IAEM,WAAY,QAAAL,EAAA,sBACd,OAAO,KAAK,aAAY,CAC5B,IAEM,eAAgB,QAAAA,EAAA,sBAClB,KAAK,aAAe,GACpB,KAAK,MAAQ,KAEb,GAAI,CAEK,KAAK,mBACN,MAAM,KAAK,aAAY,GAI3B,MAAMW,EAAS,MAAMT,EAAe,cAAc,KAAK,gBAAgB,EAGvE,YAAK,MAAK,EAGHS,CACX,OAASN,EAAO,CACZ,cAAQ,MAAM,iBAAkBA,CAAK,EACrC,KAAK,MAAQA,EAAM,SAAW,2BACxBA,CACV,QAAC,CACG,KAAK,aAAe,EACxB,CACJ,IAEA,YAAYO,EAAWF,EAAO,CAC1B,KAAK,SAASE,CAAS,EAAIF,CAC/B,EAEA,aAAaG,EAAQ,CACjB,OAAO,OAAO,KAAK,SAAUA,CAAM,CACvC,EAEA,kBAAkBhB,EAAWiB,EAAS,CAClC,KAAK,qBAAqBjB,CAAS,EAAIiB,CAC3C,EAEA,YAAa,CACT,KAAK,MAAQ,IACjB,EAEA,OAAQ,CACJ,QAAQ,IAAI,oDAAoD,EAEhE,KAAK,iBAAmB,KACxB,KAAK,gBAAkB,KACvB,KAAK,kBAAoB,KAGzB,OAAO,KAAK,KAAK,QAAQ,EAAE,QAAQL,GAAO,CACtC,OAAO,KAAK,SAASA,CAAG,CAC5B,CAAC,EACD,KAAK,SAAW,GAEhB,KAAK,YAAc,EACnB,KAAK,qBAAuB,GAC5B,KAAK,SAAW,GAChB,KAAK,aAAe,GACpB,KAAK,UAAY,KACjB,KAAK,MAAQ,KAGb,aAAa,WAAW,kBAAkB,CAC9C,CACR,CACA,CAAC,ECzSD,SAASM,GAAcL,EAAO,CAC7B,OAAKA,EACc,6BACD,KAAKA,CAAK,EAFT,EAGpB,CAOA,SAASM,GAAcN,EAAO,CAC7B,OAAKA,EAEc,wEACD,KAAKA,EAAM,QAAQ,MAAO,EAAE,CAAC,EAH5B,EAIpB,CAOA,SAASO,GAAYP,EAAO,CAC3B,GAAI,CAACA,EAAO,MAAO,GACnB,GAAI,CACH,WAAI,IAAIA,CAAK,EACN,EACR,OAAQQ,EAAA,CACP,MAAO,EACR,CACD,CAOA,SAASC,GAAeT,EAAO,CAC9B,OAAIA,IAAU,IAAMA,IAAU,MAAQA,IAAU,OAAkB,GAC3D,CAAC,MAAM,WAAWA,CAAK,CAAC,GAAK,SAASA,CAAK,CACnD,CAUA,SAASU,GAAyBC,EAAYX,EAAOY,EAAU,CAE9D,IAAIC,EAAkBF,EAAW,KAAI,EACjCE,EAAgB,WAAW,OAAO,IACrCA,EAAkBA,EAAgB,UAAU,CAAC,EAAE,KAAI,GAGpD,GAAI,CAcH,OAXiB,IAAI,SAAS,WAAY,QAAS;AAAA;AAAA;AAAA,qBAGhCA,CAAe;AAAA;AAAA;AAAA;AAAA;AAAA,GAKjC,EAEuBD,EAAUZ,CAAK,CAExC,OAASL,EAAO,CACf,eAAQ,MAAM,oDAAqDgB,EAAYhB,CAAK,EAE7E,EACR,CACD,CAUO,SAASmB,GAAcd,EAAOe,EAAYH,EAAW,GAAI,CAC/D,GAAI,CAACG,EACJ,MAAO,CAAE,MAAO,GAAM,QAAS,EAAE,EAMlC,OAHuBA,EAAW,YAAW,EAGvB,CACrB,IAAK,QACJ,GAAI,CAACV,GAAcL,CAAK,EACvB,MAAO,CAAE,MAAO,GAAO,QAAS,oCAAoC,EAErE,MAED,IAAK,QACJ,GAAI,CAACM,GAAcN,CAAK,EACvB,MAAO,CAAE,MAAO,GAAO,QAAS,mCAAmC,EAEpE,MAED,IAAK,MACJ,GAAI,CAACO,GAAYP,CAAK,EACrB,MAAO,CAAE,MAAO,GAAO,QAAS,0BAA0B,EAE3D,MAED,IAAK,SACJ,GAAI,CAACS,GAAeT,CAAK,EACxB,MAAO,CAAE,MAAO,GAAO,QAAS,6BAA6B,EAE9D,MAED,QAEC,GAAIe,EAAW,WAAW,OAAO,GAC5B,CAACL,GAAyBK,EAAYf,EAAOY,CAAQ,EACxD,MAAO,CAAE,MAAO,GAAO,QAAS,mBAAmB,CAGxD,CAEC,MAAO,CAAE,MAAO,GAAM,QAAS,EAAE,CAClC,CCrHO,SAASI,IAA0C,CACzD,MAAMC,EAASC,EAA4B,EAAE,EACvCC,EAAeD,EAAI,EAAK,EAK9B,SAASE,EACRlB,EACAF,EACAqB,EACAT,EAAgB,GACN,CAEV,MAAMX,EAASqB,GAAkBtB,EAAOqB,EAAY,WAAYT,CAAQ,EAExE,OAAKX,EAAO,MAMRoB,EAAY,cAAgBrB,IAAU,IAAMA,IAAU,MAAQA,IAAU,SAC3EiB,EAAO,MAAMf,CAAS,EAAI,GAAGmB,EAAY,WAAW,eAC7C,KAIR,OAAOJ,EAAO,MAAMf,CAAS,EACtB,KAZNe,EAAO,MAAMf,CAAS,EAAID,EAAO,QAC1B,GAYT,CAKA,SAAesB,EACdC,EACAZ,EACmB,QAAAtB,EAAA,sBACnB6B,EAAa,MAAQ,GACrBF,EAAO,MAAQ,GAEf,IAAIb,EAAU,GAEd,UAAWqB,KAAWD,EAAW,UAAY,GAE5C,GAAI,EAAAC,EAAQ,YAEP,CADeC,EAAkBD,EAAQ,WAAYb,CAAQ,GAIlE,UAAWe,KAASF,EAAQ,QAAU,GAAI,CAEzC,GAAIE,EAAM,YAEL,CADeD,EAAkBC,EAAM,WAAYf,CAAQ,EAC9C,SAIlB,IAAIZ,EAAQY,EAASe,EAAM,UAAU,EAIrC,GAD+B,CAAC,WAAY,eAAgB,WAAY,OAAQ,SAAU,WAAY,aAAa,EACxF,SAASA,EAAM,UAAU,GAAK,CAAC3B,EAAO,CAEhE,MAAM4B,EAAkBhB,EAAS,cAAmBA,EAAS,QAAaA,EAAS,qBAA0BA,EAAS,iBAClHgB,GAAmB,OAAOA,GAAoB,WACjD5B,EAAQ4B,EAAgBD,EAAM,UAAU,EAE1C,CAEmBP,EAAoBO,EAAM,WAAY3B,EAAO2B,EAAOf,CAAQ,IAG9ER,EAAU,GAEZ,CAGD,OAAAe,EAAa,MAAQ,GACdf,CACR,GAKA,SAASsB,EAAkBf,EAAoBC,EAAwB,CACtE,GAAI,CACH,KAAM,CAAE,kBAAAiB,CAAA,EAAsB,QAAQ,2BAA2B,EACjE,OAAOA,EAAkBlB,EAAYC,CAAQ,CAC9C,OAASjB,EAAO,CACf,eAAQ,MAAM,+BAAgCA,CAAK,EAC5C,EACR,CACD,CAKA,SAASmC,GAAc,CACtBb,EAAO,MAAQ,EAChB,CAKA,SAASc,EAAgB7B,EAAmB,CAC3C,OAAOe,EAAO,MAAMf,CAAS,CAC9B,CAEA,MAAO,CACN,OAAAe,EACA,aAAAE,EACA,oBAAAC,EACA,aAAAG,EACA,YAAAO,EACA,gBAAAC,CAAA,CAEF,CChJA,MAAMC,EAAcd,EAAI,IAAI,EACtBe,GAAUf,EAAI,EAAK,EACnBvB,GAAQuB,EAAI,IAAI,EAEf,SAASgB,IAAiB,CAI/B,MAAMC,EAAkB,IAAY7C,EAAA,sBAClC2C,GAAQ,MAAQ,GAChBtC,GAAM,MAAQ,KAEd,GAAI,CACF,MAAMyC,EAAU,CACd,eAAgB,kBACxB,EAGU,OAAO,aACTA,EAAQ,qBAAqB,EAAI,OAAO,YAS1C,MAAMnC,EAAS,MANE,MAAM,MAAM,4CAA6C,CACxE,OAAQ,MACR,QAASmC,EACT,YAAa,SACrB,CAAO,GAE6B,KAAI,EAIlC,GAAInC,EAAO,QACT,OAAA+B,EAAY,MAAQ/B,EAAO,QACpB+B,EAAY,MAEnB,MAAM,IAAI,MAAM,wBAAwB,CAE5C,OAASK,EAAK,CACZ,OAAA1C,GAAM,MAAQ0C,EAAI,QAClB,QAAQ,MAAM,8BAA+BA,CAAG,EACzC,IACT,QAAC,CACCJ,GAAQ,MAAQ,EAClB,CACF,GAKMK,EAAkBC,EAAS,IAAM,OACrC,OAAKtD,EAAA+C,EAAY,QAAZ,MAAA/C,EAAmB,WACjB+C,EAAY,MAAM,WAAW,KAAKQ,GAAKA,EAAE,UAAU,GAAKR,EAAY,MAAM,WAAW,CAAC,EADlD,IAE7C,CAAC,EAKKS,EAAiBF,EAAS,IAAM,OACpC,OAAKtD,EAAA+C,EAAY,QAAZ,MAAA/C,EAAmB,SACjB+C,EAAY,MAAM,SAAS,KAAK,GAAK,EAAE,UAAU,GAAKA,EAAY,MAAM,SAAS,CAAC,EADhD,IAE3C,CAAC,EAMKU,EAAyB,IAAM,CACnC,GAAI,CAACV,EAAY,MAAO,MAAO,GAE/B,MAAMW,EAAUX,EAAY,MACtBY,EAAe,GA6CrB,GA1CIH,EAAe,QACjBG,EAAa,QAAUH,EAAe,MAAM,WAC5CG,EAAa,aAAeH,EAAe,MAAM,cAKnDG,EAAa,eAAiBD,EAAQ,UACtCC,EAAa,gBAAkBD,EAAQ,KACvCC,EAAa,gBAAkBD,EAAQ,MACvCC,EAAa,eAAiBD,EAAQ,UAGlCA,EAAQ,YAAc,cACpBA,EAAQ,gBACVC,EAAa,kBAAoB,GAAGD,EAAQ,aAAa,KAAKA,EAAQ,eAAiB,EAAE,KAAKA,EAAQ,aAAe,EAAE,IAAIA,EAAQ,iBAAmB,EAAE,GAAG,KAAI,GAK/JA,EAAQ,YAAc,UACxBC,EAAa,eAAiB,GAC9BA,EAAa,SAAWD,EAAQ,KAChCC,EAAa,cAAgBD,EAAQ,aACrCC,EAAa,YAAcD,EAAQ,gBAAkBA,EAAQ,KAC7DC,EAAa,YAAcD,EAAQ,gBAAkBA,EAAQ,MAEzDA,EAAQ,kBACVC,EAAa,cAAgB,GAAGD,EAAQ,eAAe,KAAKA,EAAQ,iBAAmB,EAAE,KAAKA,EAAQ,eAAiB,EAAE,IAAIA,EAAQ,mBAAqB,EAAE,GAAG,KAAI,GAIjKA,EAAQ,8BACVC,EAAa,yBAA2BD,EAAQ,8BAAgC,aAAe,QAAU,QAGvGA,EAAQ,4BACVC,EAAa,0BAA4BD,EAAQ,4BAKjDL,EAAgB,MAAO,CACzB,MAAMO,EAAOP,EAAgB,MAC7BM,EAAa,SAAW,GAAGC,EAAK,MAAM,KAAKA,EAAK,QAAU,EAAE,KAAKA,EAAK,MAAQ,EAAE,IAAIA,EAAK,UAAY,EAAE,GAAG,KAAI,EAC9GD,EAAa,iBAAmBA,EAAa,SAC7CA,EAAa,2BAA6BC,EAAK,kBAC/CD,EAAa,iBAAmBC,EAAK,gBACvC,CAGA,OAAIF,EAAQ,YAAcA,EAAQ,YAAcA,EAAQ,aACtDC,EAAa,0BAA4B,CACvC,MAAOD,EAAQ,YAAc,GAC7B,MAAOA,EAAQ,YAAc,GAC7B,KAAMA,EAAQ,WAAa,EACnC,GAIQA,EAAQ,qBACVC,EAAa,wBAA0BD,EAAQ,oBAG1CC,CACT,EAQME,EAAgB,CAAClC,EAAUmC,EAAU,KAAO,CAChD,KAAM,CACJ,iBAAAC,EAAmB,GACnB,aAAAC,EAAe,EACrB,EAAQF,EAEEH,EAAeF,EAAsB,EAE3C,cAAO,KAAKE,CAAY,EAAE,QAAQ7C,GAAO,CAEnCkD,EAAa,SAASlD,CAAG,GAGzB,CAACiD,GAAoBpC,EAASb,CAAG,IAGrCa,EAASb,CAAG,EAAI6C,EAAa7C,CAAG,EAClC,CAAC,EAEMa,CACT,EAKMsC,EAAmBX,EAAS,IAAM,OACtC,QAAOtD,EAAA+C,EAAY,QAAZ,YAAA/C,EAAmB,aAAc,EAC1C,CAAC,EAKKkE,EAAiBZ,EAAS,IAAM,OACpC,QAAOtD,EAAA+C,EAAY,QAAZ,YAAA/C,EAAmB,WAAY,EACxC,CAAC,EAKKmE,EAAgBb,EAAS,IAAM,OACnC,QAAOtD,EAAA+C,EAAY,QAAZ,YAAA/C,EAAmB,UAAW,EACvC,CAAC,EAKKoE,EAAoBd,EAAS,IAAM,WACvC,GAAI,CAACP,EAAY,MAAO,MAAO,GAE/B,MAAMW,EAAUX,EAAY,MAGtBsB,EAAeX,EAAQ,WAAaA,EAAQ,OAASA,EAAQ,UAGnE,OAAIA,EAAQ,YAAc,aACjBW,MACCrE,EAAA0D,EAAQ,aAAR,YAAA1D,EAAoB,QAAS,GAAK,QAClCC,EAAAyD,EAAQ,WAAR,YAAAzD,EAAkB,QAAS,GAAK,IAC/ByD,EAAQ,YAAc,QACxBW,GACAX,EAAQ,iBACPY,EAAAZ,EAAQ,WAAR,YAAAY,EAAkB,QAAS,GAAK,IAGnCD,CACT,CAAC,EAKKE,EAA8BjB,EAAS,IAAM,CACjD,GAAI,CAACP,EAAY,MAAO,MAAO,GAE/B,MAAMW,EAAUX,EAAY,MAC5B,IAAIyB,EAAY,EACZC,EAAQ,EAIZ,MADoB,CAAC,YAAa,QAAS,WAAW,EAC1C,QAAQ/B,GAAS,CAC3B+B,IACIf,EAAQhB,CAAK,GAAG8B,GACtB,CAAC,EAGDC,KACIf,EAAQ,YAAcA,EAAQ,YAAcA,EAAQ,YAAWc,IAGnEC,IACIf,EAAQ,YAAcA,EAAQ,WAAW,OAAS,GAAGc,IAGzDC,IACIf,EAAQ,UAAYA,EAAQ,SAAS,OAAS,GAAGc,IAGjDd,EAAQ,YAAc,SACxBe,IACIf,EAAQ,cAAcc,MAE1BC,IACIf,EAAQ,eAAec,KAGtB,KAAK,MAAOA,EAAYC,EAAS,GAAG,CAC7C,CAAC,EAED,MAAO,CACL,YAAA1B,EACA,QAAAC,GACA,MAAAtC,GACA,gBAAAwC,EACA,uBAAAO,EACA,cAAAI,EACA,gBAAAR,EACA,eAAAG,EACA,iBAAAS,EACA,eAAAC,EACA,cAAAC,EACA,kBAAAC,EACA,4BAAAG,CACJ,CACA,2ZCnRA,MAAMG,EAAQC,EAeRC,EAAqBtB,EAAS,IAC/BoB,EAAM,aAAe,EAAU,EAC5B,KAAK,OAAQA,EAAM,YAAc,GAAKA,EAAM,WAAc,GAAG,CACpE,gBAUAG,EAAA,EAAAC,EAqFM,MArFNC,GAqFM,CAnFLC,EAeM,MAfNC,GAeM,CAdLD,EAKM,MALNE,GAKM,CAJLF,EAGO,OAFL,gBAAgBJ,EAAA,MAAkB,MACnC,MAAM,uIAGRI,EAOM,MAPNG,GAOM,CANLH,EAEO,OAFPI,GAEOC,EADHV,aAAWA,EAAA,WAAW,WAAaA,EAAA,YAAW,QAElDK,EAEO,OAFPM,GAEOD,EADHT,EAAA,KAAkB,EAAG,cACzB,+fCZJ,MAAMW,EAAOC,EAEPC,EAAa,IAAM,CACxBF,EAAK,MAAM,CACZ,EAEMG,EAAiB,IAAM,CAC5BH,EAAK,UAAU,CAChB,EAEMI,EAAkB,IAAM,CAC7BJ,EAAK,YAAY,CAClB,EAEMK,EAAe,IAAM,CAC1BL,EAAK,QAAQ,CACd,gBAICV,EAAA,EAAAC,EA6EM,MA7ENC,GA6EM,CA5ELC,EAoEM,MApENC,GAoEM,CAlELD,EAcM,YAZEL,EAAA,YAAW,OADlBkB,EAYSC,EAAAC,CAAA,SAVP,QAAOL,EACR,QAAQ,UACP,SAAUf,EAAA,UAAYA,EAAA,eAEZ,SACV,IAEM,IAAAqB,EAAA,KAAAA,EAAA,IAFNhB,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC9DA,EAA4F,QAAtF,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,uCAE/D,IAEZ,eAFY,aAEZ,wCAIDA,EAgDM,MAhDNE,GAgDM,CA7CEP,EAAA,kBADPkB,EAaSC,EAAAC,CAAA,SAXP,QAAOJ,EACR,QAAQ,UACP,QAAShB,EAAA,SACT,SAAUA,EAAA,4BAMA,IACX,CADWsB,EAAA,MACRtB,EAAA,SAAQ,qCALMA,EAAA,sBAAW,cAC3B,IAEM,aAFNK,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC9DA,EAAwK,QAAlK,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,0JAQnEL,EAAA,gBAcRkB,EAcSC,EAAAC,CAAA,SAZP,QAAOH,EACR,QAAQ,QACR,MAAM,QACL,QAASjB,EAAA,aACT,SAAQ,CAAGA,EAAA,WAAaA,EAAA,wBAMd,IACX,CADWsB,EAAA,MACRtB,EAAA,aAAY,iDALEA,EAAA,0BAAe,cAC/B,IAEM,aAFNK,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC9DA,EAA0H,QAApH,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,wGAzB3Ea,EAaSC,EAAAC,CAAA,SAXP,QAAON,EACR,QAAQ,QACR,MAAM,OACL,SAAQ,CAAGd,EAAA,WAAaA,EAAA,UAAYA,EAAA,eAG1B,SACV,IAEM,IAAAqB,EAAA,KAAAA,EAAA,IAFNhB,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC9DA,EAAyF,QAAnF,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,oCAJ1E,IAEA,eAFA,SAEA,6CA0BHA,EAIM,OAJD,MAAM,oBAAkB,CAC5BA,EAEI,KAFD,MAAM,uBAAuB,EAAC,4FAEjC,4JC5GH,MAAMN,EAAQC,EAORY,EAAOC,EAEPU,EAAiBC,GAAY,CACjC,QAAQ,IAAI,qDAAsDA,CAAO,EACzE,QAAQ,IAAI,8CAA+CzB,EAAM,UAAU,EAE3Ea,EAAK,oBAAqBa,GAAAC,GAAA,GACrB3B,EAAM,YADe,CAExB,QAASyB,CACb,EAAG,EACDZ,EAAK,iBAAkBY,CAAO,EAE9B,QAAQ,IAAI,wCAAwC,CACtD,oBAxCErB,EAaM,YAZJkB,EAAA,KAAAA,EAAA,GAAAhB,EAAqE,MAAjE,MAAM,uCAAuC,EAAC,iBAAc,KAChEgB,EAAA,KAAAA,EAAA,GAAAhB,EAAuF,KAApF,MAAM,oBAAoB,EAAC,wDAAqD,KAEnFsB,EAQEC,GAAA,CAPC,cAAa5B,EAAA,WAAW,QACxB,sBAAoBuB,EACrB,eAAa,QACZ,SAAU,GACV,qBAAoB,GACrB,MAAM,GACL,aAAY,8lBC+BnB,MAAMxB,EAAQC,EAWRY,EAAOC,EAEPgB,EAAcC,GAAS,CAC3B,QAAQ,IAAI,6CAA8CA,EAAK,IAAI,EACnE,QAAQ,IAAI,uCAAwC/B,EAAM,UAAU,EACpE,QAAQ,IAAI,+CAAgDA,EAAM,WAAW,OAAO,EAEpF,MAAMgC,EAAeN,GAAAC,GAAA,GAChB3B,EAAM,YADU,CAEnB,aAAc+B,EAAK,IACvB,GAEE,QAAQ,IAAI,4CAA6CC,CAAY,EACrEnB,EAAK,oBAAqBmB,CAAY,EACtCnB,EAAK,gBAAiBkB,EAAK,IAAI,CACjC,oBApEE3B,EAoCM,YAnCJkB,EAAA,KAAAA,EAAA,GAAAhB,EAA8E,MAA1E,MAAM,uCAAuC,EAAC,0BAAuB,KACzEgB,EAAA,KAAAA,EAAA,GAAAhB,EAAkF,KAA/E,MAAM,oBAAoB,EAAC,mDAAgD,KAEnEL,EAAA,aAAa,SAAxBE,IAAAC,EAEM,MAFNC,GAEM,IAAAiB,EAAA,KAAAA,EAAA,IADJhB,EAA6F,OAAxF,MAAM,2EAA2E,iBAGxFH,IAAAC,EA2BM,MA3BNG,GA2BM,EA1BJJ,EAAA,IAAAC,EAyBM6B,EAAA,KAAAC,EAxBWjC,EAAA,aAAa,KAArB8B,QADT3B,EAyBM,OAvBH,IAAK2B,EAAK,KACV,QAAKI,GAAEL,EAAWC,CAAI,EACvB,MAAKK,EAAA,CAAC,wEACEnC,EAAA,WAAW,eAAiB8B,EAAK,KAAI,yEAE7CzB,EAiBM,MAjBNG,GAiBM,CAhBJH,EAQM,MARNI,GAQM,CAPJJ,EAA8E,KAA9EM,GAA8ED,EAAtBoB,EAAK,SAAS,KACtEzB,EAA6F,KAA1F,MAAM,wBAAwB,UAAQyB,EAAK,aAAW,uCACzDzB,EAIM,MAJN+B,GAIM,CAHQN,EAAK,UAAjB5B,EAAA,EAAAC,EAA2D,OAAAkC,GAAhC,SAAM3B,EAAGoB,EAAK,QAAQ,eACrCA,EAAK,qBAAjB5B,EAAA,EAAAC,EAAgF,OAAAmC,GAAA5B,EAAvCoB,EAAK,mBAAmB,EAAG,QAAK,aAC7DA,EAAK,UAAjB5B,EAAA,EAAAC,EAA2F,OAA3FoC,GAA2F7B,EAAvBoB,EAAK,QAAQ,mBAG1E9B,EAAA,WAAW,eAAiB8B,EAAK,MAA5C5B,IAAAC,EAMM,MANNqC,GAMM,IAAAnB,EAAA,KAAAA,EAAA,IALJhB,EAIM,OAJD,MAAM,mEAAmE,GAC5EA,EAEM,OAFD,MAAM,qBAAqB,KAAK,OAAO,OAAO,eAAe,QAAQ,cACxEA,EAA2F,QAArF,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,0+BC6DxF,MAAMoC,EAASC,GAAS,EAiBlB9B,EAAOC,EAEP8B,EAAiB,IAAM,CAE3B,GAAI,CAACC,GAAQ,WAAY,CAEvB,MAAMC,EAAc,OAAO,SAAS,SAAW,OAAO,SAAS,OAC/DJ,EAAO,KAAK,CACV,KAAM,QACN,MAAO,CAAE,SAAUI,CAAW,CACpC,CAAK,EACD,MACF,CAGAjC,EAAK,UAAU,CACjB,oBA3HET,EAkFM,YAjFJkB,EAAA,MAAAA,EAAA,IAAAhB,EAAkF,MAA9E,MAAM,uCAAuC,EAAC,8BAA2B,KAC7EA,EAAgG,IAAhGD,GAA8B,iBAAcM,EAAGV,EAAA,WAAW,EAAG,kCAA+B,GAEjFA,EAAA,oBAAXE,IAAAC,EAyEM,MAzENG,GAyEM,CApEJD,EAiCM,MAjCNE,GAiCM,CAhCJF,EAOM,MAPNG,GAOM,CANJH,EAKM,YAJJA,EAA+F,KAA/FI,GAA+FC,EAA5CV,EAAA,mBAAmB,iBAAiB,KAC9EA,EAAA,mBAAmB,UAA5BE,EAAA,EAAAC,EAEI,IAFJQ,GAEID,EADCV,EAAA,mBAAmB,QAAQ,mBAKpCK,EAsBM,MAtBNyC,GAsBM,CArBJzC,EAMM,YALJgB,EAAA,KAAAA,EAAA,GAAAhB,EAA8E,OAAzE,MAAM,6CAA6C,EAAC,kBAAe,KACxEA,EAEM,MAFN+B,GAAmD,KAChD1B,EAAGV,EAAA,mBAAmB,UAAQ,QAEjCqB,EAAA,KAAAA,EAAA,GAAAhB,EAAuE,OAAlE,MAAM,8BAA6B,4BAAyB,OAEnEA,EAMM,YALJgB,EAAA,KAAAA,EAAA,GAAAhB,EAA8E,OAAzE,MAAM,6CAA6C,EAAC,kBAAe,KACxEA,EAEM,MAFNgC,GAEM,KADDrC,EAAA,mBAAmB,UAAQ,OAAY,IAAC,GAAAqB,EAAA,KAAAA,EAAA,GAAAhB,EAAmC,QAA7B,MAAM,aAAY,OAAI,OAEzEgB,EAAA,KAAAA,EAAA,GAAAhB,EAAgE,OAA3D,MAAM,8BAA6B,qBAAkB,OAE5DA,EAMM,YALJgB,EAAA,KAAAA,EAAA,GAAAhB,EAA+E,OAA1E,MAAM,6CAA6C,EAAC,mBAAgB,KACzEA,EAEM,MAFNiC,GAEM5B,EADDV,EAAA,mBAAmB,iBAAgB,eAExCqB,EAAA,KAAAA,EAAA,GAAAhB,EAA+D,OAA1D,MAAM,8BAA6B,oBAAiB,WAKpDL,EAAA,mBAAmB,qBAA9BE,IAAAC,EAGM,MAHNoC,GAGM,CAFJlB,EAAA,KAAAA,EAAA,GAAAhB,EAAwE,MAApE,MAAM,0CAA0C,EAAC,iBAAc,KACnEA,EAA2G,OAAtG,MAAM,0CAA0C,UAAQL,EAAA,mBAAmB,mCAGlEA,EAAA,mBAAmB,aAAnCE,IAAAC,EAGM,MAHN4C,GAGM,CAFJ1B,EAAA,KAAAA,EAAA,GAAAhB,EAAgF,MAA5E,MAAM,0CAA0C,EAAC,yBAAsB,KAC3EA,EAAmG,OAA9F,MAAM,0CAA0C,UAAQL,EAAA,mBAAmB,swBAiBlFK,EAQM,OARD,MAAM,0BAA0B,GACnCA,EAMS,UALP,KAAK,SACJ,QAAOsC,EACR,MAAM,+FACP,0CAED,QAIJzC,IAAAC,EAEM,MAFN6C,GAEM,IAAA3B,EAAA,MAAAA,EAAA,KADJhB,EAAgG,KAA7F,MAAM,eAAe,EAAC,sEAAmE,irICsUlG,MAAMN,EAAQC,EAoCRiD,EAAiBtE,EAAS,IAC1B,CAACoB,EAAM,uBAAyB,CAACA,EAAM,YAClC,GAGFA,EAAM,YAAY,OAAOmD,GAAQA,EAAK,cAAc,CAC5D,EAGKC,EAAqBxE,EAAS,IAE9BoB,EAAM,kBACD,GAIF,CAAC,EAAEA,EAAM,WAAW,UAAYA,EAAM,WAAW,iBACzD,EAGKqD,EAAoBF,GAAS,CACjC,GAAI,CAACA,EAAK,SAAU,MAAO,GAE3B,UAAWrF,KAAWqF,EAAK,SACzB,GAAKrF,EAAQ,gBAEb,UAAWE,KAASF,EAAQ,OAC1B,GAAIE,EAAM,gBAAkBgC,EAAM,WAAWhC,EAAM,UAAU,EAC3D,MAAO,GAKb,MAAO,EACT,EAGMsF,EAAmB,CAACtF,EAAO3B,IAAU,CACzC,GAA2BA,GAAU,MAAQA,IAAU,GACrD,MAAO,eAIT,GAAI2B,EAAM,aAAe,QACvB,OAAO3B,EAAQ,MAAQ,KAGzB,GAAI2B,EAAM,aAAe,QAAU3B,EAEjC,GAAI,CACF,OAAO,IAAI,KAAKA,CAAK,EAAE,mBAAmB,QAAS,CACjD,KAAM,UACN,MAAO,OACP,IAAK,SACb,CAAO,CACH,OAASQ,EAAG,CACV,OAAOR,CACT,CAGF,OAAI2B,EAAM,aAAe,YAAc3B,EAC9B,IAAI,OAAOA,CAAK,EAAE,eAAe,QAAS,CAAE,sBAAuB,EAAG,sBAAuB,CAAC,CAAE,CAAC,GAGtG2B,EAAM,aAAe,SAChB3B,EAGL2B,EAAM,aAAe,UAAYA,EAAM,aAAe,eACjD3B,EAAQ,kBAAoB,eAG9BA,CACT,EAGMkH,EAAoB3E,EAAS,IAC1B,CAAC,EACNoB,EAAM,WAAW,uBACjBA,EAAM,WAAW,0BACjBA,EAAM,WAAW,wBACjBA,EAAM,WAAW,oBACjBA,EAAM,WAAW,qBAEpB,EAEKwD,EAAsB5E,EAAS,IAAM,CACzC,MAAM6E,EAASzD,EAAM,WAAW,qBAChC,OAAIyD,IAAW,YAAoB,8BAC/BA,IAAW,aAAqB,4BAChCA,IAAW,2BAAmC,gCAC9CA,IAAW,gBAAwB,gCACnCA,IAAW,gBAAwB,0BACnCA,IAAW,aAAqB,yBAC7B,2BACT,CAAC,EAEKC,EAAoB9E,EAAS,IAC1B,CAAC,EACNoB,EAAM,WAAW,iBACjBA,EAAM,WAAW,mBACjBA,EAAM,WAAW,iBACjBA,EAAM,WAAW,eAEpB,EAEK2D,EAAkB/E,EAAS,IACxB,CAAC,EACNoB,EAAM,WAAW,yBACjBA,EAAM,WAAW,sBACjBA,EAAM,WAAW,0BACjBA,EAAM,WAAW,2BAEpB,EAEK4D,EAAgBhF,EAAS,IACtB,CAAC,EACNoB,EAAM,WAAW,sBACjBA,EAAM,WAAW,qBACjBA,EAAM,WAAW,8BACjBA,EAAM,WAAW,wBACjBA,EAAM,WAAW,yBACjBA,EAAM,WAAW,eACjBA,EAAM,WAAW,qBAEjBA,EAAM,WAAW,0BACjBA,EAAM,WAAW,0BACjBA,EAAM,WAAW,uBACjBA,EAAM,WAAW,aAEpB,EAGK6D,EAAaC,GAAS,CAC1B,GAAI,CAACA,EAAM,MAAO,GAClB,MAAMC,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,UAAYD,EACTC,EAAI,aAAeA,EAAI,WAAa,EAC7C,EAEMC,EAAW,CAACC,EAAMC,IAAc,CACpC,GAAI,CAACD,EAAM,MAAO,GAClB,MAAME,EAAQN,EAAUI,CAAI,EAC5B,OAAIE,EAAM,QAAUD,EAAkBC,EAC/BA,EAAM,UAAU,EAAGD,CAAS,EAAI,KACzC,EAEME,EAAuBC,GAAY,CACvC,GAAI,CAACA,EAAS,MAAO,GACrB,GAAI,CACF,OAAO,IAAI,KAAKA,CAAO,EAAE,mBAAmB,QAAS,CACnD,KAAM,UACN,MAAO,OACP,IAAK,SACX,CAAK,CACH,OAASxH,EAAG,CACV,OAAOwH,CACT,CACF,EAEMC,EAAa1F,EAAS,IAAM,CAEhC,MAAMe,EAAe,CAAC,EACpBK,EAAM,WAAW,SACjBA,EAAM,WAAW,cACjBA,EAAM,WAAW,gBACjBA,EAAM,WAAW,iBACjBA,EAAM,WAAW,kBACjBA,EAAM,WAAW,qBAInB,GAAIA,EAAM,kBAAmB,CAC3B,MAAMuE,EAAoB,CAAC,EACzBhB,EAAkB,OAClBvD,EAAM,WAAW,sBACjBA,EAAM,WAAW,sBACjBA,EAAM,WAAW,qBACjBA,EAAM,WAAW,sBACjBA,EAAM,WAAW,uBACjBA,EAAM,WAAW,4BAEnB,OAAOL,GAAgB4E,CACzB,CAEA,OAAO5E,CACT,CAAC,sBApnBC,OAAAQ,EAAA,EAAAC,EAgZM,MAhZNC,GAgZM,CA/YJiB,EAAA,MAAAA,EAAA,IAAAhB,EAAiF,MAA7E,MAAM,kDAAkD,EAAC,kBAAe,KAC5EgB,EAAA,MAAAA,EAAA,IAAAhB,EAAgH,KAA7G,MAAM,iDAAiD,EAAC,oDAAiD,KAE5GA,EA2YM,MA3YNC,GA2YM,CAzYJD,EAWM,MAXNE,GAWM,CAVJF,EASM,MATNG,GASM,CARJH,EAGM,YAFJA,EAAuF,KAAvFI,GAAuFC,EAAvBV,EAAA,eAAe,KAC/EK,EAAsE,IAAtEM,GAAsED,EAAlBV,EAAA,WAAW,OAEjEK,EAGM,MAHNyC,GAGM,CAFJzB,EAAA,KAAAA,EAAA,GAAAhB,EAA+E,OAA1E,MAAM,8CAA8C,EAAC,kBAAe,KACzEA,EAAmF,MAAnF+B,GAAmF1B,EAAvBV,EAAA,cAAc,WAMhFK,EAwBM,MAxBNgC,GAwBM,aAvBJhC,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAmF,MAA/E,MAAM,kDAAkD,EAAC,mBAAiB,QAEhFA,EAmBM,MAnBNiC,GAmBM,CAlBJjC,EAiBM,MAjBNkC,GAiBM,CAhBJlC,EAGM,YAFJgB,EAAA,KAAAA,EAAA,GAAAhB,EAAgD,QAA1C,MAAM,uBAAuB,EAAC,QAAK,KACzCA,EAA4E,IAA5EmC,GAA4E9B,EAAlDV,EAAA,WAAW,gBAAc,qBAErDK,EAGM,YAFJgB,EAAA,KAAAA,EAAA,GAAAhB,EAAiD,QAA3C,MAAM,uBAAuB,EAAC,SAAM,KAC1CA,EAA6E,IAA7E0C,GAA6ErC,EAAnDV,EAAA,WAAW,iBAAe,qBAEtDK,EAGM,YAFJgB,EAAA,KAAAA,EAAA,GAAAhB,EAAiD,QAA3C,MAAM,uBAAuB,EAAC,SAAM,KAC1CA,EAA6E,IAA7EkE,GAA6E7D,EAAnDV,EAAA,WAAW,iBAAe,qBAE3CA,EAAA,WAAW,uBAAtBG,EAGM,MAAA6C,GAAA,CAFJ3B,EAAA,KAAAA,EAAA,GAAAhB,EAAmD,QAA7C,MAAM,uBAAuB,EAAC,WAAQ,KAC5CA,EAA6D,IAA7DmE,GAA6D9D,EAAnCV,EAAA,WAAW,iBAAiB,uBAOnDmD,EAAA,OAAXjD,IAAAC,EAiBM,MAjBNsE,GAiBM,aAhBJpE,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAkF,MAA9E,MAAM,kDAAkD,EAAC,kBAAgB,QAE/EA,EAYM,MAZNqE,GAYM,CAXO1E,EAAA,WAAW,kBAAtBE,IAAAC,EASM,MATNwE,GASM,CARJtE,EAGM,YAFJgB,EAAA,KAAAA,EAAA,GAAAhB,EAAmD,QAA7C,MAAM,uBAAuB,EAAC,WAAQ,KAC5CA,EAA4D,IAA5DuE,GAA4DlE,EAAlCV,EAAA,WAAW,gBAAgB,OAE5CA,EAAA,WAAW,uBAAtBG,EAGM,MAAA0E,GAAA,CAFJxD,EAAA,KAAAA,EAAA,GAAAhB,EAA6D,QAAvD,MAAM,uBAAuB,EAAC,qBAAkB,KACtDA,EAA6D,IAA7DyE,GAA6DpE,EAAnCV,EAAA,WAAW,iBAAiB,yBAG1DG,EAAwD,IAAxD4E,GAAgC,sBAAoB,kBAK7C1J,EAAA2E,EAAA,2BAAA3E,EAAoB,iBAA/B6E,IAAAC,EAcM,MAdN6E,GAcM,eAbJ3E,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAoF,MAAhF,MAAM,kDAAkD,EAAC,oBAAkB,QAEjFA,EASM,MATN4E,GASM,CARJ5E,EAGM,YAFJgB,EAAA,KAAAA,EAAA,GAAAhB,EAA+D,QAAzD,MAAM,uBAAuB,EAAC,uBAAoB,KACxDA,EAAiF,IAAjF6E,GAAiFxE,EAAvDV,EAAA,WAAW,qBAAmB,qBAE1DK,EAGM,YAFJgB,EAAA,MAAAA,EAAA,IAAAhB,EAAsD,QAAhD,MAAM,uBAAuB,EAAC,cAAW,KAC/CA,EAAyE,IAAzE8E,GAAyEzE,EAA/CV,EAAA,WAAW,YAAU,oCAMrCA,EAAA,uBAAyBiD,EAAA,MAAe,OAAM,SAC5D9C,EA8BM6B,EAAA,QAAAC,EA7BWgB,EAAA,MAARC,QADT/C,EA8BM,OA5BH,IAAK+C,EAAK,UACX,MAAM,+DAEN7C,EAEM,MAFN+E,GAEM,CADJ/E,EAAuF,KAAvFgF,GAAuF3E,EAAvBwC,EAAK,UAAU,OAEjF7C,EAqBM,MArBNiF,GAqBM,EApBJpF,EAAA,IAAAC,EAgBM6B,EAAA,KAAAC,EAfciB,EAAK,SAAS,OAAOqC,GAAKA,EAAE,cAAc,EAArD1H,QADTsC,EAgBM,OAdH,IAAKtC,EAAQ,eAEJA,EAAQ,eAAlBqC,EAAA,EAAAC,EAEK,KAFLqF,GAEK9E,EADA7C,EAAQ,aAAa,eAE1BwC,EAQM,MARNoF,GAQM,EAPJvF,EAAA,IAAAC,EAMM6B,EAAA,KAAAC,EALYpE,EAAQ,OAAO,OAAO6H,GAAKA,EAAE,cAAc,EAApD3H,QADToC,EAMM,OAJH,IAAKpC,EAAM,aAEZsC,EAAyF,OAAzFsF,GAAyFjF,EAAlD3C,EAAM,cAAgBA,EAAM,WAAW,EAAG,IAAC,GAClFsC,EAAsF,IAAtFuF,GAAsFlF,EAA5D2C,EAAiBtF,EAAOiC,EAAA,WAAWjC,EAAM,UAAU,6BAIzEqF,EAAiBF,CAAI,gBAA/B/C,EAEI,IAFJ0F,GAAgE,wCAEhE,wBAMU7F,EAAA,uBAAhBG,EAsPW6B,EAAA,SApPT3B,EA6DM,MA7DNyF,GA6DM,eA5DJzF,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAiG,MAA7F,MAAM,kDAAkD,EAAC,iCAA+B,QAE9FA,EAwDM,MAxDN0F,GAwDM,CAvDJ1F,EAsDM,MAtDN2F,GAsDM,CArDJ3F,EAqCM,YApCJgB,EAAA,MAAAA,EAAA,IAAAhB,EAAyD,QAAnD,MAAM,uBAAuB,EAAC,iBAAc,KAClDA,EAkCM,MAlCN4F,GAkCM,CAhCIjG,EAAA,WAAW,2BADnBG,EAKO,OALP+F,GAGC,oBAED,YAEQlG,EAAA,WAAW,8BADnBG,EAKO,OALPgG,GAGC,uBAED,YAEQnG,EAAA,WAAW,4BADnBG,EAKO,OALPiG,GAGC,oBAED,YAEQpG,EAAA,WAAW,wBADnBG,EAKO,OALPkG,GAGC,gBAED,YAEQrG,EAAA,WAAW,0BADnBG,EAKO,OALPmG,GAGC,kBAED,YACahD,EAAA,oBAAbnD,EAEO,OAFPoG,GAAsD,iBAEtD,OAGJlG,EAUM,YATJgB,EAAA,MAAAA,EAAA,IAAAhB,EAA2D,QAArD,MAAM,uBAAuB,EAAC,mBAAgB,KACpDA,EAOM,MAPNmG,GAOM,CANJnG,EAKO,QAJL,MAAK8B,EAAA,CAAC,6CACEoB,EAAA,KAAmB,EAExB,EAAA7C,EAAAV,EAAA,WAAW,sBAAoB,wBAI7BA,EAAA,WAAW,oBAAtBG,EAGM,MAAAsG,GAAA,CAFJpF,EAAA,MAAAA,EAAA,IAAAhB,EAA0D,QAApD,MAAM,uBAAuB,EAAC,kBAAe,KACnDA,EAAsE,IAAtEqG,GAAsEhG,EAAhCV,EAAA,WAAW,cAAc,uBAO5DyD,EAAA,OAAXvD,IAAAC,EA4CM,MA5CNwG,GA4CM,eA3CJtG,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAiF,MAA7E,MAAM,kDAAkD,EAAC,iBAAe,QAE9EA,EAuCM,MAvCNuG,GAuCM,CAtCJvG,EAqCM,MArCNwG,GAqCM,CAnCI7G,EAAA,WAAW,iBADnBE,IAAAC,EAQO,OARP2G,GAQO,IAAAzF,EAAA,MAAAA,EAAA,KAJLhB,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC7DA,EAAkM,QAA5L,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,iIACpE,iBAER,kBAEQL,EAAA,WAAW,mBADnBE,IAAAC,EAQO,OARP4G,GAQO,IAAA1F,EAAA,MAAAA,EAAA,KAJLhB,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC7DA,EAAuG,QAAjG,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,sCACpE,0BAER,kBAEQL,EAAA,WAAW,iBADnBE,IAAAC,EAQO,OARP6G,GAQO,IAAA3F,EAAA,MAAAA,EAAA,KAJLhB,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC7DA,EAA2F,QAArF,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,0BACpE,+BAER,kBAEQL,EAAA,WAAW,gBADnBE,IAAAC,EAQO,OARP8G,GAQO,IAAA5F,EAAA,MAAAA,EAAA,KAJLhB,EAEM,OAFD,MAAM,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,cAC7DA,EAA0K,QAApK,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,yGACpE,mBAER,kCAMKqD,EAAA,OAAXxD,IAAAC,EAkCM,MAlCN+G,GAkCM,eAjCJ7G,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAiG,MAA7F,MAAM,kDAAkD,EAAC,iCAA+B,QAE9FA,EA6BM,MA7BN8G,GA6BM,CA5BJ9G,EA2BM,MA3BN+G,GA2BM,CA1BJ/G,EAGM,YAFJgB,EAAA,MAAAA,EAAA,IAAAhB,EAAmE,QAA7D,MAAM,uBAAuB,EAAC,2BAAwB,KAC5DA,EAAsF,IAAtFgH,GAAsF3G,EAA5DV,EAAA,WAAW,yBAAuB,sBAEnDA,EAAA,WAAW,0BAAtBG,EAGM,MAAAmH,GAAA,CAFJjG,EAAA,MAAAA,EAAA,IAAAhB,EAAgE,QAA1D,MAAM,uBAAuB,EAAC,wBAAqB,KACzDA,EAA8E,IAA9EkH,GAA8E7G,EAAtCV,EAAA,WAAW,oBAAoB,iBAE9DA,EAAA,WAAW,8BAAtBG,EAGM,MAAAqH,GAAA,CAFJnG,EAAA,MAAAA,EAAA,IAAAhB,EAA4D,QAAtD,MAAM,uBAAuB,EAAC,oBAAiB,KACrDA,EAA6F,IAA7FoH,GAA6F/G,EAArDkD,EAAU5D,EAAA,WAAW,wBAAwB,kBAEvFK,EAaM,MAbNqH,GAaM,MAZJvH,EAQM,OAPJ,MAAKgC,EAAA,CAAC,UACEnC,EAAA,WAAW,2BAA0B,mCAC7C,KAAK,OACL,OAAO,eACP,QAAQ,gCAERK,EAA0H,QAApH,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,iEAE1EA,EAEO,QAFA,MAAK8B,EAAEnC,EAAA,WAAW,2BAA0B,kCAAsC,sBACrEU,EAAGV,EAAA,WAAW,2BAA0B,gDAQpEK,EAmCM,MAnCNsH,GAmCM,eAlCJtH,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAqG,MAAjG,MAAM,kDAAkD,EAAC,qCAAmC,QAElGA,EA8BM,MA9BNuH,GA8BM,CA7BJvH,EA4BM,MA5BNwH,GA4BM,CA3BO7H,EAAA,WAAW,0BAAtBG,EAGM,MAAA2H,GAAA,CAFJzG,EAAA,MAAAA,EAAA,IAAAhB,EAAgE,QAA1D,MAAM,uBAAuB,EAAC,wBAAqB,KACzDA,EAAsF,OAAjF,MAAM,4BAA4B,UAAQL,EAAA,WAAW,6CAEjDA,EAAA,WAAW,yBAAtBG,EAGM,MAAA4H,GAAA,CAFJ1G,EAAA,MAAAA,EAAA,IAAAhB,EAA2D,QAArD,MAAM,uBAAuB,EAAC,mBAAgB,KACpDA,EAAqF,OAAhF,MAAM,4BAA4B,UAAQL,EAAA,WAAW,4CAEjDA,EAAA,WAAW,kCAAtBG,EAGM,MAAA6H,GAAA,CAFJ3G,EAAA,MAAAA,EAAA,IAAAhB,EAA4D,QAAtD,MAAM,uBAAuB,EAAC,oBAAiB,KACrDA,EAAsF,IAAtF4H,GAAsFvH,EAA9CV,EAAA,WAAW,4BAA4B,iBAEtEA,EAAA,WAAW,wBAA0BA,EAAA,WAAW,yBAA2BA,EAAA,WAAW,mBAAjGG,EAOM,MAAA+H,GAAA,CANJ7G,EAAA,MAAAA,EAAA,IAAAhB,EAAmE,QAA7D,MAAM,uBAAuB,EAAC,2BAAwB,KAC5DA,EAIK,KAJL8H,GAIK,CAHOnI,EAAA,WAAW,wBAArBE,EAAA,EAAAC,EAAuH,QAA1E,mBAAgBO,EAAGqD,EAAS/D,EAAA,WAAW,uBAAsB,kBAChGA,EAAA,WAAW,yBAArBE,EAAA,EAAAC,EAA0H,QAA5E,oBAAiBO,EAAGqD,EAAS/D,EAAA,WAAW,wBAAuB,kBACnGA,EAAA,WAAW,eAArBE,EAAA,EAAAC,EAA4F,QAAxD,UAAOO,EAAGqD,EAAS/D,EAAA,WAAW,cAAa,gCAGxEA,EAAA,WAAW,yBAAtBG,EAGM,MAAAiI,GAAA,CAFJ/G,EAAA,MAAAA,EAAA,IAAAhB,EAA+D,QAAzD,MAAM,uBAAuB,EAAC,uBAAoB,KACxDA,EAAqF,OAAhF,MAAM,4BAA4B,UAAQL,EAAA,WAAW,4CAElD2D,EAAA,oBAAVxD,EAEI,IAFJkI,GAAuD,yBAEvD,SAMNhI,EAyDM,MAzDNiI,GAyDM,eAxDJjI,EAEM,OAFD,MAAM,yDAAuD,CAChEA,EAAwF,MAApF,MAAM,kDAAkD,EAAC,wBAAsB,QAErFA,EAoDM,MApDNkI,GAoDM,CAnDJlI,EAkDM,MAlDNmI,GAkDM,CAjDJnI,EAaM,MAbNoI,GAaM,MAZJtI,EAQM,OAPJ,MAAKgC,EAAA,CAAC,+BACGnC,EAAA,WAAW,sBAAwBA,EAAA,WAAW,2BAA0B,mCACjF,KAAK,OACL,OAAO,eACP,QAAQ,gCAERK,EAA0H,QAApH,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,iEAE1EA,EAEO,QAFD,MAAK8B,EAAA,CAAC,UAAmBnC,EAAA,WAAW,sBAAwBA,EAAA,WAAW,2BAA0B,mCAAuC,6CAE9I,KAEFK,EAaM,MAbNqI,GAaM,MAZJvI,EAQM,OAPJ,MAAKgC,EAAA,CAAC,+BACGnC,EAAA,WAAW,uBAAyBA,EAAA,WAAW,uBAAsB,mCAC9E,KAAK,OACL,OAAO,eACP,QAAQ,gCAERK,EAA0H,QAApH,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,iEAE1EA,EAEO,QAFD,MAAK8B,EAAA,CAAC,UAAmBnC,EAAA,WAAW,uBAAyBA,EAAA,WAAW,uBAAsB,mCAAuC,sCAE3I,KAEFK,EAaM,MAbNsI,GAaM,MAZJxI,EAQM,OAPJ,MAAKgC,EAAA,CAAC,+BACGnC,EAAA,WAAW,4BAA8BA,EAAA,WAAW,+BAA8B,mCAC3F,KAAK,OACL,OAAO,eACP,QAAQ,gCAERK,EAA0H,QAApH,iBAAe,QAAQ,kBAAgB,QAAQ,eAAa,IAAI,EAAE,iEAE1EA,EAEO,QAFD,MAAK8B,EAAA,CAAC,UAAmBnC,EAAA,WAAW,4BAA8BA,EAAA,WAAW,+BAA8B,mCAAuC,gDAExJ,KAESA,EAAA,WAAW,qBAAtBE,IAAAC,EAMM,MANNyI,GAMM,CALJvH,EAAA,MAAAA,EAAA,IAAAhB,EAAqD,QAA/C,MAAM,uBAAuB,EAAC,aAAU,KAC9CA,EAA+D,IAA/DwI,GAA+DnI,EAArCV,EAAA,WAAW,mBAAmB,KAC/CA,EAAA,WAAW,oBAApBG,EAEI,IAFJ2I,GAAkE,YACvD3E,EAAoBnE,EAAA,WAAW,cAAc,gsCA2BtDqE,EAAA,gBAAZnE,IAAAC,EAYM,MAZN4I,GAYM,IAAA1H,EAAA,MAAAA,EAAA,2yCC/NZ,MAAM2H,EAAiBC,EAAqB,IAAKC,EAAA,IAAC,OAAO,8BAAyC,2BAAC,EAC7FC,EAAuBF,EAAqB,IAAKC,EAAA,IAAC,OAAO,oCAA+C,2BAAC,EACzGE,EAAmBH,EAAqB,IAAKC,EAAA,IAAC,OAAO,gCAA2C,2BAAC,EACjGG,EAAyBJ,EAAqB,IAAKC,EAAA,IAAC,OAAO,sCAAiD,6BAAC,EAO7GI,EAAsBL,EAAqB,IAAKC,EAAA,IAAC,OAAO,mCAAuC,wCAAC,EAGhGK,EAAQC,GAAQ,EAChB/G,EAASC,GAAS,EAGlB+G,EAAQvO,GAAe,EACvBwO,EAAeC,GAAe,EAG9B,CAAE,OAAQC,EAAkB,aAAAjM,CAAY,EAAKP,GAAiB,EAG9DyM,EAAqBvM,EAAI,EAAK,EAC9BwM,EAAsBxM,EAAI,EAAK,EAC/ByM,EAAmBzM,EAAI,EAAK,EAC5B0M,EAA6B1M,EAAI,EAAK,EACtC2M,EAAmB3M,EAAI,IAAI,EAC3B4M,EAAe5M,EAAI,CAAE,QAAS,GAAO,KAAM,EAAE,CAAE,EAC/C6M,EAA6B7M,EAAI,IAAI,EAGrC8M,EAAazL,EAAS,IAAM,OAC9B,OAAItD,EAAAoO,EAAM,oBAAN,MAAApO,EAAyB,MAElBoO,EAAM,kBAAkB,MAAM,OAAS,EAE3C,CACX,CAAC,EAEKY,EAAa1L,EAAS,IAAM,OAC9B,MAAM2L,EAAS,CAAC,UAAW,OAAQ,cAAc,EACjD,OAAIjP,EAAAoO,EAAM,oBAAN,MAAApO,EAAyB,OACzBiP,EAAO,KAAK,GAAGb,EAAM,kBAAkB,MAAM,IAAIlE,GAAKA,EAAE,UAAU,CAAC,EAEvE+E,EAAO,KAAK,QAAQ,EACbA,CACX,CAAC,EAEKC,EAAwB5L,EAAS,IAAM,OACzC,QAAOtD,EAAAoO,EAAM,oBAAN,YAAApO,EAAyB,QAASoO,EAAM,kBAAkB,MAAM,OAAS,CACpF,CAAC,EAEKe,GAAkB7L,EAAS,IAEtB,EACV,EASK8L,EAAe9L,EAAS,IACnB8K,EAAM,aAAe,CAC/B,EAGKiB,GAAoB/L,EAAS,IAAM,OACrC,GAAI,GAACtD,EAAAoO,EAAM,oBAAN,MAAApO,EAAyB,OAAO,OAAO,KAI5C,MAAMsP,EAAmBlB,EAAM,YAAc,EAE7C,OAAIkB,GAAoB,GAAKA,EAAmBlB,EAAM,kBAAkB,MAAM,OACnEA,EAAM,kBAAkB,MAAMkB,CAAgB,EAGlD,IACX,CAAC,EAGKC,GAA0BjM,EAAS,IAAM,OAC3C,OAAO8K,EAAM,YAAc,GACpBA,EAAM,YAAcW,EAAW,MAAQ,KACvC/O,EAAAoO,EAAM,oBAAN,YAAApO,EAAyB,6BAA8B,CAClE,CAAC,EAGD,SAASwP,IAAoB,CACzBd,EAAiB,MAAQ,EAC7B,CAEA,SAASe,GAAoBC,EAAa,CACtC,QAAQ,IAAI,kBAAmBA,CAAW,CAE9C,CAEA,SAASC,GAAsB,CAC3B,MAAMC,EAAQxB,EAAM,YACpB,OAAIwB,GAAS,GAAKA,EAAQZ,EAAW,MAAM,OAChCA,EAAW,MAAMY,CAAK,EAE1B,EACX,CAEA,SAASC,GAAuB,OAC5B,MAAMD,EAAQxB,EAAM,YACd0B,EAAoB,EAI1B,GAAIF,EAAQE,GAAqBF,GAASb,EAAW,MAAQ,EACzD,OAAO,KAGX,IAAI/O,EAAAoO,EAAM,oBAAN,MAAApO,EAAyB,MAAO,CAChC,MAAME,EAAY0P,EAAQE,EAE1B,GAAI5P,GAAa,GAAKA,EAAYkO,EAAM,kBAAkB,MAAM,OAC5D,OAAOA,EAAM,kBAAkB,MAAMlO,CAAS,CAEtD,CAEA,OAAO,IACX,CAEA,SAAS6P,IAAiB,CACtB,MAAMC,EAAc5B,EAAM,SAAS,QACnC,GAAI,CAAC4B,EAAa,MAAO,GAEzB,MAAM7J,EAAUkI,EAAa,SAAS,KAAK4B,GAAKA,EAAE,eAAiBD,CAAW,EAC9E,OAAO7J,GAAA,YAAAA,EAAS,eAAgB6J,CACpC,CAEA,SAAeE,EAAgBF,EAAa,QAAA3P,EAAA,sBAExCwO,EAAa,MAAM,QAAU,GAC7B,MAAMR,EAAa,2BAA2B2B,CAAW,EACzDnB,EAAa,MAAQ,CACjB,QAAS,GACT,KAAMR,EAAa,cAAgB,EAC3C,CACA,GAEA,SAAe8B,GAAkBhQ,EAAiB,QAAAE,EAAA,sBAS9C,GAPA+N,EAAM,YAAY,eAAgBjO,CAAe,EAGjD,MAAMiO,EAAM,WAAWjO,CAAe,EACtC2O,EAA2B,MAAQV,EAAM,kBAGrC,CAACA,EAAM,kBAAmB,CAC1B,QAAQ,MAAM,iDAAiD,EAC/D,MACJ,CACJ,GAEA,SAAe3I,IAAa,QAAApF,EAAA,4BAExB,GAAI+N,EAAM,cAAgB,GAAK,CAACA,EAAM,SAAS,QAAS,CACpD,MAAM,4CAA4C,EAClD,MACJ,CAGA,GAAIA,EAAM,cAAgB,GAAK,CAACA,EAAM,SAAS,aAAc,CACzD,MAAM,iDAAiD,EACvD,MACJ,CAGA,GAAIA,EAAM,aAAe,GAAKc,EAAsB,OAASG,GAAkB,OAMvE,EALY,MAAM/M,EAClB+M,GAAkB,MAClBjB,EAAM,QAClB,GAEsB,CACV,QAAQ,MAAM,kCAAmCG,EAAiB,KAAK,EACvEE,EAAoB,MAAQ,GAC5B,MACJ,CAKJ,GAAIL,EAAM,cAAgB,GAAK,CAACA,EAAM,kBAWlC,GAVA,QAAQ,IAAI,2DAA2D,EACvE,QAAQ,IAAI,kCAAmCA,EAAM,iBAAiB,EACtE,QAAQ,IAAI,sCAAuCc,EAAsB,KAAK,EAC9E,QAAQ,IAAI,8BAA8BlP,EAAAoO,EAAM,oBAAN,YAAApO,EAAyB,KAAK,EAExE,MAAMoO,EAAM,UAAS,EACrB,QAAQ,IAAI,oCAAqCA,EAAM,gBAAgB,EAIlEc,EAAsB,MAQvB,QAAQ,IAAI,mEAAmE,UAN3Ed,EAAM,iBAAkB,CACxB,QAAQ,IAAI,yEAAyE,EACrFhH,EAAO,KAAK,YAAYgH,EAAM,gBAAgB,EAAE,EAChD,MACJ,EAOJA,EAAM,mBACN,MAAMA,EAAM,aAAY,GAG5BA,EAAM,SAAQ,CAClB,GAEA,SAAS1I,IAAiB,CACtB0I,EAAM,aAAY,CACtB,CAEA,SAAezI,IAAkB,QAAAtF,EAAA,sBAC7B,GAAI,CACA,MAAM+N,EAAM,UAAS,EAEjBA,EAAM,iBACNhH,EAAO,KAAK,YAAYgH,EAAM,gBAAgB,EAAE,EAEhDI,EAAmB,MAAQ,EAEnC,OAAS9N,EAAO,CACZ,QAAQ,MAAM,wBAAyBA,CAAK,CAChD,CACJ,GAEA,SAAe0P,IAAqB,QAAA/P,EAAA,sBAChC,GAAI,CACA,MAAM+N,EAAM,UAAS,EACrBA,EAAM,MAAK,EAEXhH,EAAO,KAAK,CAAE,KAAM,WAAW,CAAE,CACrC,OAAS1G,EAAO,CACZ,QAAQ,MAAM,wBAAyBA,CAAK,CAEhD,CACJ,GAEA,SAAekF,IAAe,QAAAvF,EAAA,sBAG1B,GAAI,CACA,MAAMW,EAAS,MAAMoN,EAAM,cAAa,EAGxCQ,EAAiB,MAAQ5N,EAGzB2N,EAA2B,MAAQ,EACvC,OAASjO,EAAO,CACZ,QAAQ,MAAM,4BAA6BA,CAAK,CACpD,CACJ,GAEA,SAAS2P,IAAS,CACdjC,EAAM,MAAK,EACXhH,EAAO,KAAK,YAAY,CAC5B,CAKA,SAASkJ,GAA2BC,EAAW,CAC3C5B,EAA2B,MAAQ,GACnCvH,EAAO,KAAK,YAAYmJ,CAAS,EAAE,CACvC,CAKA,SAASC,IAA+B,CACpC7B,EAA2B,MAAQ,GAEnC,MAAMqB,EAAc5B,EAAM,SAAS,QAC/B4B,EACA5I,EAAO,KAAK,YAAY4I,CAAW,YAAY,EAE/C5I,EAAO,KAAK,YAAY,CAEhC,CAGA,OAAAqJ,GAAM,IAAMrC,EAAM,YAAa,IAAM,CAErC,EAAG,CAAE,UAAW,EAAI,CAAE,EAGtBqC,GAAM,IAAMrC,EAAM,SAAS,WAAasC,GAAY,OAChD,GAAIA,KAAW1Q,EAAAoO,EAAM,SAAS,eAAf,MAAApO,EAA6B,SAAS,UAAU,CAE3D,MAAM2Q,EAAQ,IAAI,KACZC,EAAO,IAAI,KAAKF,CAAO,EAC7B,IAAIG,EAAMF,EAAM,YAAW,EAAKC,EAAK,YAAW,EAChD,MAAME,EAAIH,EAAM,SAAQ,EAAKC,EAAK,SAAQ,GACtCE,EAAI,GAAMA,IAAM,GAAKH,EAAM,UAAYC,EAAK,QAAO,IACnDC,IAIJzC,EAAM,YAAY,MAAOyC,CAAG,EAGxBA,EAAM,GACNtC,EAAiB,MAAM,WAAgB,gDAGvC,OAAOA,EAAiB,MAAM,UAEtC,CACJ,CAAC,EAGDwC,GAAU,IAAY1Q,EAAA,sBAClB,MAAMF,EAAkB+N,EAAM,MAAM,KAC9B9N,EAAU8N,EAAM,MAAM,MACtB8B,EAAc9B,EAAM,MAAM,QAC1B8C,EAAW9C,EAAM,MAAM,SAAW,OAUxC,GARA,QAAQ,IAAI,wCAAyC8C,EAAU,WAAYhB,EAAa,QAAS7P,CAAe,EAG5G,CAACC,GAAW,CAAC8N,EAAM,MAAM,OACzBE,EAAM,MAAK,EAIX,CAAChO,EAAS,CACV,KAAM,CAAE,uBAAAqD,EAAwB,cAAAI,CAAa,EAAKZ,GAAc,EAChE,GAAI,CACA,MAAMQ,EAAsB,EAC5BI,EAAcuK,EAAM,SAAU,CAC1B,iBAAkB,EAClC,CAAa,CACL,OAAS1N,GAAO,CACZ,QAAQ,KAAK,0DAA2DA,EAAK,CACjF,CACJ,CAGA,GAAIN,GAAWD,EAAiB,CAC5B,MAAMiO,EAAM,WAAWjO,EAAiBC,CAAO,EAC/C0O,EAA2B,MAAQV,EAAM,kBAEzC,MACJ,CAGA,GAAI4C,GAAYhB,GAAe7P,GAAmB,CAACC,EAAS,CACxD,QAAQ,IAAI,wDAAwD,EAGpEgO,EAAM,YAAY,UAAW4B,CAAW,EAGxC,MAAME,EAAgBF,CAAW,EAGjC,MAAM5B,EAAM,WAAWjO,CAAe,EACtC2O,EAA2B,MAAQV,EAAM,kBACzCA,EAAM,YAAY,eAAgBjO,CAAe,EAGjDiO,EAAM,YAAc,EACpB,QAAQ,IAAI,mDAAoDA,EAAM,WAAW,EACjF,MACJ,CAGI4B,GAAe,CAAC5P,GAAW,CAAC4Q,GAC5B5C,EAAM,YAAY,UAAW4B,CAAW,EAGxC,MAAME,EAAgBF,CAAW,EAG7B7P,GACA,MAAMiO,EAAM,WAAWjO,CAAe,EACtC2O,EAA2B,MAAQV,EAAM,kBACzCA,EAAM,YAAY,eAAgBjO,CAAe,EACjDiO,EAAM,YAAc,GAGpBA,EAAM,YAAc,GAEjBjO,GAAmB,CAACC,GAAW,CAAC4P,IAEvC,MAAM5B,EAAM,WAAWjO,CAAe,EACtC2O,EAA2B,MAAQV,EAAM,kBACzCA,EAAM,YAAY,eAAgBjO,CAAe,EAEzD,EAAC,EAGD8Q,GAAmB,CAACC,EAAIC,EAAMC,IAAS,CAEnC,GAAIhD,EAAM,cAAgB,CAACA,EAAM,iBAAkB,CAC/CA,EAAM,MAAK,EACXgD,EAAI,EACJ,MACJ,CAGmBhD,EAAM,UAAY,OAAO,KAAKA,EAAM,QAAQ,EAAE,KAAKtN,GAClEsN,EAAM,SAAStN,CAAG,IAAM,QAAasN,EAAM,SAAStN,CAAG,IAAM,MAAQsN,EAAM,SAAStN,CAAG,IAAM,EACrG,GAEsB,CAAC,QAAQ,gEAAgE,EACvFsQ,EAAK,EAAK,GAGLF,EAAG,KAAK,SAAS,WAAW,GAC7B9C,EAAM,MAAK,EAEfgD,EAAI,EAEZ,CAAC,oBA9lBG,OAAAvM,EAAA,EAAAC,EA4JM,MA5JNC,GA4JM,CA3JFuB,EAqBgB+K,GAAA,CArBD,MAAM,kBAAmB,OAAMhB,KAC/B,UACP,IAQS,CAPCjB,EAAA,WADVvJ,EAQSC,EAAAC,CAAA,SANJ,QAAOJ,GACR,QAAQ,UACR,MAAM,OACL,QAASG,EAAAsI,CAAA,EAAM,qBACnB,IAED,IAAApI,EAAA,KAAAA,EAAA,MAFC,eAED,sCAEUoJ,EAAA,WADVvJ,EAQSC,EAAAC,CAAA,SANJ,QAAOqK,GACR,QAAQ,UACR,MAAM,OACL,QAAStK,EAAAsI,CAAA,EAAM,qBACnB,IAED,IAAApI,EAAA,MAAAA,EAAA,OAFC,mBAED,8CAIRhB,EAQM,MARNC,GAQM,CAPFD,EAMM,MANNE,GAMM,CALFoB,EAIEgL,GAAA,CAHG,eAAcxL,EAAAsI,CAAA,EAAM,YACpB,cAAaW,EAAA,MACb,cAAaC,EAAA,gEAK1BhK,EA6FO,OA7FPG,GA6FO,CA5FHH,EAkDM,MAlDNI,GAkDM,CAjDSuK,EAAmB,mBAA9B7K,EAKM,MAAAQ,GAAA,CAJFgB,EAGEiL,GAAA,CAFW,WAAAzL,EAAAsI,CAAA,EAAM,SAAN,sBAAApI,EAAA,KAAAA,EAAA,GAAAa,GAAAf,EAAAsI,CAAA,EAAM,SAAQvH,GACtB,gBAAgBqJ,6BAITP,EAAmB,gBAAnC7K,EAMM,MAAA2C,GAAA,CALFnB,EAIEkL,GAAA,CAHW,WAAA1L,EAAAsI,CAAA,EAAM,SAAN,sBAAApI,EAAA,KAAAA,EAAA,GAAAa,GAAAf,EAAAsI,CAAA,EAAM,SAAQvH,GACtB,gBAAegI,EAAA,MACf,eAAesB,8CAIRR,EAAmB,wBAAnC7K,EAOM,MAAAiC,GAAA,CANFT,EAKEmL,GAAA,CAJG,uBAAsB3C,EAAA,MACtB,eAAciB,GAAc,EACpB,WAAAjK,EAAAsI,CAAA,EAAM,SAAN,sBAAApI,EAAA,KAAAA,EAAA,GAAAa,GAAAf,EAAAsI,CAAA,EAAM,SAAQvH,GACtB,WAAUpB,oEAIHkK,EAAmB,kBAAnC7K,EAKM,MAAAkC,GAAA,CAJFV,EAGEoL,GAAA,CAFW,WAAA5L,EAAAsI,CAAA,EAAM,SAAN,sBAAApI,EAAA,KAAAA,EAAA,GAAAa,GAAAf,EAAAsI,CAAA,EAAM,SAAQvH,GACtB,sBAAqBf,EAAAsI,CAAA,EAAM,mEAKrBc,EAAA,OAAyBW,EAAoB,OAD5DhK,EAIEC,EAAAmI,CAAA,SAFG,WAAY4B,EAAoB,EACxB,WAAA/J,EAAAsI,CAAA,EAAM,SAAN,sBAAApI,EAAA,KAAAA,EAAA,GAAAa,GAAAf,EAAAsI,CAAA,EAAM,SAAQvH,8CAG3B/B,EAWM,MAAAmC,GAAA,CAVFjC,EAAiG,KAAjGkC,GAA2C,iBAAepB,EAAAsI,CAAA,EAAM,WAAW,EAAG,iBAAc,GAC5FpI,EAAA,MAAAA,EAAA,IAAAhB,EAA4F,KAAzF,MAAM,MAAM,EAAC,2EAAwE,KACxFA,EAMK,KANLmC,GAMK,CALDnC,EAAyE,WAArEgB,EAAA,MAAAA,EAAA,IAAAhB,EAAoC,cAA5B,sBAAmB,KAASiB,EAAA,MAAI0J,EAAmB,QAC/D3K,EAAgF,WAA5EgB,EAAA,MAAAA,EAAA,IAAAhB,EAAuC,cAA/B,yBAAsB,OAAS,IAACK,EAAA,EAAKS,EAAAsI,CAAA,EAAM,iBAAiB,OACxEpJ,EAAkE,WAA9DgB,EAAA,MAAAA,EAAA,IAAAhB,EAAwC,cAAhC,0BAAuB,KAASiB,EAAA,MAAI8I,EAAA,KAAU,OAC1D/J,EAA8E,WAA1EgB,EAAA,MAAAA,EAAA,IAAAhB,EAAyC,cAAjC,2BAAwB,KAASiB,EAAA,MAAIiJ,EAAA,KAAqB,OACtElK,EAA2F,WAAvFgB,EAAA,MAAAA,EAAA,IAAAhB,EAAqC,cAA7B,uBAAoB,KAASiB,EAAA,IAACZ,EAAG,KAAK,UAAUwK,EAAoB,WAEpF7J,EAAA,MAAAA,EAAA,IAAAhB,EAAyJ,KAAtJ,MAAM,8BAA6B,kHAA+G,UAMnJuK,GAAA,OADV1K,IAAAC,EAwBM,MAxBN4C,GAwBM,CApBF1C,EAmBM,OAnBD,MAAM,kCAAkC,GACzCA,EAiBM,OAjBD,MAAM,QAAQ,ynBAWfA,EAKS,UAJJ,QAAOwK,GACR,MAAM,uGACT,2BAED,kBAKZlJ,EAYEqL,GAAA,CAXG,eAAc7L,EAAAsI,CAAA,EAAM,YACpB,cAAaW,EAAA,MACb,eAAcjJ,EAAAsI,CAAA,EAAM,WACpB,cAAae,GAAA,MACb,iBAAgBC,EAAA,MAChB,YAAWtJ,EAAAsI,CAAA,EAAM,SACjB,gBAAetI,EAAAsI,CAAA,EAAM,aACrB,OAAM3I,GACN,WAAUC,GACV,YAAYC,GACZ,SAAQC,uHAIjBU,EAGER,EAAA6H,CAAA,GAFU,KAAMa,EAAA,qCAAAA,EAAkB,MAAA3H,GAC/B,WAAUf,EAAAsI,CAAA,EAAM,8CAGrB9H,EAGER,EAAAgI,CAAA,GAFU,KAAMW,EAAA,qCAAAA,EAAmB,MAAA5H,GAChC,OAAQf,EAAAyI,CAAA,6BAGbjI,EAMER,EAAAiI,CAAA,GALU,KAAMW,EAAA,qCAAAA,EAAgB,MAAA7H,GAC7B,aAAYf,EAAAsI,CAAA,EAAM,iBAClB,oBAAmBtI,EAAAsI,CAAA,EAAM,SAAS,aAClC,eAActI,EAAAsI,CAAA,EAAM,SAAS,QAC7B,SAAQqB,qEAGbnJ,EAQER,EAAAkI,CAAA,GAPG,KAAMW,EAAA,MACN,kBAAgB3O,EAAA4O,EAAA,oBAAA5O,EAAkB,eAClC,cAAYC,EAAA2O,EAAA,oBAAA3O,EAAkB,WAC9B,YAAUqE,EAAAsK,EAAA,oBAAAtK,EAAkB,SAC5B,uBAAOqK,EAAA,MAA0B,IACjC,cAAc2B,GACd,gBAAiBE","names":["useRequestStore","defineStore","state","_a","_b","stepIndex","requestTypeCode","draftId","__async","configResource","requestService","resolve","checkLoaded","error","resource","draft","sanitizedData","key","value","result","fieldName","fields","isValid","validateEmail","validatePhone","validateUrl","e","validateNumber","evaluateCustomValidation","expression","formData","cleanExpression","validateField","validation","useStepValidation","errors","ref","isValidating","validateConfigField","fieldConfig","utilValidateField","validateStep","stepConfig","section","evaluateDependsOn","field","addressLineData","evaluateCondition","clearErrors","clearFieldError","userProfile","loading","useUserProfile","loadUserProfile","headers","err","defaultProperty","computed","p","defaultCouncil","getApplicationAutoFill","profile","autoFillData","prop","applyAutoFill","options","overrideExisting","fieldsToSkip","getAllProperties","getAllCouncils","getAllClients","isProfileComplete","hasBasicInfo","_c","profileCompletionPercentage","completed","total","props","__props","progressPercentage","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","emit","__emit","handleNext","handlePrevious","handleSaveDraft","handleSubmit","_createBlock","_unref","Button","_cache","_createTextVNode","updateCouncil","council","__spreadProps","__spreadValues","_createVNode","CouncilSelector","selectType","type","updatedValue","_Fragment","_renderList","$event","_normalizeClass","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","router","useRouter","handleContinue","session","currentPath","_hoisted_7","_hoisted_13","_hoisted_15","reviewSections","step","hasPropertyDetails","hasReviewContent","formatFieldValue","hasAnyConsentType","activityStatusClass","status","hasNaturalHazards","hasConsultation","hasAEEContent","stripHtml","html","tmp","truncate","text","maxLength","clean","formatSignatureDate","dateStr","isComplete","hasRCRequirements","_hoisted_14","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","s","_hoisted_31","_hoisted_32","f","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_70","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_79","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","SaveDraftModal","defineAsyncComponent","__vitePreload","ValidationErrorModal","BookMeetingModal","SubmissionSuccessModal","DynamicStepRenderer","route","useRoute","store","councilStore","useCouncilStore","validationErrors","showSaveDraftModal","showValidationModal","showMeetingModal","showSubmissionSuccessModal","submissionResult","requestTypes","selectedRequestTypeDetails","totalSteps","stepTitles","titles","usesConfigurableSteps","canNavigateNext","canSaveDraft","currentStepConfig","dynamicStepIndex","shouldShowMeetingBanner","handleBookMeeting","handleMeetingBooked","meetingData","getCurrentStepTitle","index","getCurrentStepConfig","dynamicStepsStart","getCouncilName","councilCode","c","onCouncilChange","selectRequestType","handleSaveAndClose","goBack","handleViewRequestFromModal","requestId","handleGoToDashboardFromModal","watch","newDate","today","born","age","m","onMounted","isLocked","onBeforeRouteLeave","to","from","next","RequestHeader","RequestProgress","Step1CouncilSelection","Step2RequestType","Step3ProcessInfo","ReviewStep","StepNavigation"],"ignoreList":[],"sources":["../../../../frontend/src/stores/requestStore.js","../../../../frontend/src/utils/fieldValidation.js","../../../../frontend/src/composables/useStepValidation.ts","../../../../frontend/src/composables/useUserProfile.js","../../../../frontend/src/components/request/RequestProgress.vue","../../../../frontend/src/components/request/StepNavigation.vue","../../../../frontend/src/components/request-steps/Step1CouncilSelection.vue","../../../../frontend/src/components/request-steps/Step2RequestType.vue","../../../../frontend/src/components/request-steps/Step3ProcessInfo.vue","../../../../frontend/src/components/request-steps/ReviewStep.vue","../../../../frontend/src/pages/NewRequest.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { requestService } from '../services'\n\nexport const useRequestStore = defineStore('request', {\n    state: () => ({\n        // Current request being edited\n        currentRequestId: null,\n        requestTypeCode: null,\n        requestTypeConfig: null,\n\n        // Form state\n        formData: {},\n        currentStep: 0,\n\n        // Validation\n        stepValidationStatus: {}, // { 0: true, 1: false, ... }\n\n        // UI state\n        isSaving: false,\n        isSubmitting: false,\n        lastSaved: null,\n\n        // Error state\n        error: null\n    }),\n\n    getters: {\n        isFirstStep: (state) => state.currentStep === 0,\n\n        // === NEW GETTER: Total Steps (matches logic in NewRequest.vue) ===\n        totalSteps: (state) => {\n            if (state.requestTypeConfig?.steps) {\n                // 3 Static Steps (Council, Type, Process Info) + Dynamic Steps + 1 Review Step\n                return state.requestTypeConfig.steps.length + 4\n            }\n            return 4 // Default: 3 Static + 1 Review\n        },\n        // =================================================================\n\n        // === FIXED GETTER: isLastStep ===\n        isLastStep: (state) => {\n            // Use the new, correct totalSteps getter\n            return state.currentStep === state.totalSteps - 1\n        },\n        // ================================\n\n        currentStepConfig: (state) => {\n            // NOTE: This getter still uses the wrong index if totalSteps were used, \n            // but the parent component uses its own calculation. Keeping it as-is \n            // since it is not currently used by the parent for dynamic steps.\n            return state.requestTypeConfig?.steps?.[state.currentStep]\n        },\n\n        canNavigateNext: (state) => {\n            return state.stepValidationStatus[state.currentStep] === true\n        },\n\n        completionPercentage: (state) => {\n            if (state.totalSteps === 0) return 0\n            return Math.round(((state.currentStep + 1) / state.totalSteps) * 100)\n        },\n\n        hasUnsavedChanges: (state) => {\n            // Check if form data exists and last saved is more than 30 seconds ago\n            if (!state.lastSaved) return Object.keys(state.formData).length > 0\n            const now = new Date()\n            const diff = now - state.lastSaved\n            return diff > 30000 // 30 seconds\n        }\n    },\n\n    actions: {\n        // ... (initialize, loadDraft, saveProgress, saveDraft, submitRequest actions remain unchanged)\n\n        /**\n         * Navigate to next step\n         */\n        nextStep() {\n            if (!this.isLastStep) {\n                this.currentStep++\n            }\n        },\n\n        /**\n         * Navigate to previous step\n         */\n        previousStep() {\n            if (!this.isFirstStep) {\n                this.currentStep--\n            }\n        },\n\n        /**\n         * Jump to specific step\n         */\n        goToStep(stepIndex) {\n            // Use the correct totalSteps getter\n            if (stepIndex >= 0 && stepIndex < this.totalSteps) {\n                this.currentStep = stepIndex\n            }\n        },\n        // ... (updateField, updateFields, setStepValidation, clearError, reset actions remain unchanged)\n\n        // All the boilerplate logic for initialize, loadDraft, saveProgress, etc. goes here\n        // ...\n        async initialize(requestTypeCode, draftId = null) {\n            try {\n                this.requestTypeCode = requestTypeCode\n                this.error = null\n\n                console.log('[RequestStore] initialize called:', { requestTypeCode, draftId })\n\n                // Load request type config\n                const configResource = requestService.getRequestTypeConfig(requestTypeCode)\n\n                // Wait for config to load\n                await new Promise((resolve) => {\n                    const checkLoaded = setInterval(() => {\n                        if (!configResource.loading) {\n                            clearInterval(checkLoaded)\n                            resolve()\n                        }\n                    }, 100)\n                })\n\n                this.requestTypeConfig = configResource.data\n\n                if (draftId) {\n                    // Load existing draft\n                    await this.loadDraft(draftId)\n                }\n            } catch (error) {\n                console.error('Failed to initialize request:', error)\n                this.error = error.message || 'Failed to load request type'\n            }\n        },\n\n        async loadDraft(draftId) {\n            try {\n                const resource = requestService.getRequest(draftId)\n\n                // Wait for load\n                await new Promise((resolve) => {\n                    const checkLoaded = setInterval(() => {\n                        if (!resource.loading) {\n                            clearInterval(checkLoaded)\n                            resolve()\n                        }\n                    }, 100)\n                })\n\n                const draft = resource.data\n                this.currentRequestId = draftId\n\n                // Parse the full form data from draft_full_data JSON field\n                if (draft.draft_full_data) {\n                    try {\n                        this.formData = JSON.parse(draft.draft_full_data)\n                    } catch (error) {\n                        console.error('Failed to parse draft_full_data:', error)\n                        this.formData = draft.form_data || {}\n                    }\n                } else {\n                    this.formData = draft.form_data || {}\n                }\n\n                // Use draft_current_step from the document\n                this.currentStep = draft.draft_current_step || 0\n            } catch (error) {\n                console.error('Failed to load draft:', error)\n                this.error = error.message || 'Failed to load draft'\n            }\n        },\n\n        async saveProgress() {\n            // Prevent concurrent saves\n            if (this.isSaving) {\n                console.log('[RequestStore] Save already in progress, skipping')\n                return\n            }\n\n            // Ensure formData has request_id if store has one\n            if (this.currentRequestId && !this.formData.request_id) {\n                console.warn('[RequestStore] Syncing request_id to formData')\n                this.formData.request_id = this.currentRequestId\n            }\n\n            console.log('[RequestStore] saveProgress called', {\n                hasRequestId: !!this.currentRequestId,\n                formDataHasId: !!this.formData.request_id,\n                currentStep: this.currentStep,\n                isSaving: this.isSaving\n            })\n\n            this.isSaving = true\n            this.error = null\n\n            try {\n                // Sanitize formData to remove File objects (files need separate upload)\n                const sanitizedData = {}\n                for (const [key, value] of Object.entries(this.formData)) {\n                    // Skip File objects - they should be uploaded separately\n                    if (value instanceof File) {\n                        console.warn(`[RequestStore] Skipping File object for key: ${key}`)\n                        continue\n                    }\n                    // Skip undefined/null but allow empty strings and false\n                    if (value !== undefined && value !== null) {\n                        sanitizedData[key] = value\n                    }\n                }\n\n                // Ensure we have some data to send\n                if (Object.keys(sanitizedData).length === 0 && !this.currentRequestId) {\n                    throw new Error('No form data to save. Please fill in at least one field.')\n                }\n\n                console.log('[RequestStore] Sending sanitized data with', Object.keys(sanitizedData).length, 'fields')\n\n                const result = await requestService.createDraft(\n                    sanitizedData,\n                    this.currentStep\n                )\n\n                if (!this.currentRequestId) {\n                    this.currentRequestId = result.request_id\n                    // Ensure subsequent saves include request_id to update existing draft\n                    this.formData.request_id = result.request_id\n\n                    // Backup to localStorage\n                    localStorage.setItem('current_draft_id', result.request_id)\n                }\n\n                this.lastSaved = new Date()\n\n                return result  // Return for caller\n            } catch (error) {\n                console.error('Save failed:', error)\n                this.error = error.message || 'Failed to save progress'\n                throw error\n            } finally {\n                this.isSaving = false\n            }\n        },\n\n        async saveDraft() {\n            return this.saveProgress()\n        },\n\n        async submitRequest() {\n            this.isSubmitting = true\n            this.error = null\n\n            try {\n                // Save current progress first\n                if (!this.currentRequestId) {\n                    await this.saveProgress()\n                }\n\n                // Submit the request and get result\n                const result = await requestService.submitRequest(this.currentRequestId)\n\n                // Clear state\n                this.reset()\n\n                // Return submission result with SLA info\n                return result\n            } catch (error) {\n                console.error('Submit failed:', error)\n                this.error = error.message || 'Failed to submit request'\n                throw error\n            } finally {\n                this.isSubmitting = false\n            }\n        },\n\n        updateField(fieldName, value) {\n            this.formData[fieldName] = value\n        },\n\n        updateFields(fields) {\n            Object.assign(this.formData, fields)\n        },\n\n        setStepValidation(stepIndex, isValid) {\n            this.stepValidationStatus[stepIndex] = isValid\n        },\n\n        clearError() {\n            this.error = null\n        },\n\n        reset() {\n            console.log('[RequestStore] reset() called - clearing all state')\n\n            this.currentRequestId = null\n            this.requestTypeCode = null\n            this.requestTypeConfig = null\n\n            // Clear formData completely - don't just reassign\n            Object.keys(this.formData).forEach(key => {\n                delete this.formData[key]\n            })\n            this.formData = {}  // Reset to empty object\n\n            this.currentStep = 0\n            this.stepValidationStatus = {}\n            this.isSaving = false\n            this.isSubmitting = false\n            this.lastSaved = null\n            this.error = null\n\n            // Clear localStorage backup\n            localStorage.removeItem('current_draft_id')\n        }\n    }\n})","/**\n * Field Validation Utility for Request Type Configuration\n *\n * Executes validation JavaScript from step_fields configuration\n *\n * Validation formats supported:\n * - \"email\" - Email format validation\n * - \"phone\" - Phone number validation\n * - \"url\" - URL format validation\n * - \"number\" - Numeric validation\n * - \"eval:formData.age >= 18\" - Custom JavaScript expression\n * - \"eval:formData.password === formData.confirm_password\" - Field comparison\n */\n\n/**\n * Validates an email address\n * @param {string} value - Email to validate\n * @returns {boolean} - True if valid email\n */\nfunction validateEmail(value) {\n\tif (!value) return true // Empty is valid (use is_required for mandatory)\n\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n\treturn emailRegex.test(value)\n}\n\n/**\n * Validates a phone number\n * @param {string} value - Phone to validate\n * @returns {boolean} - True if valid phone\n */\nfunction validatePhone(value) {\n\tif (!value) return true\n\t// Accepts: +64 21 123 4567, 021234567, (021) 123-4567, etc.\n\tconst phoneRegex = /^[\\+]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[0-9]{1,9}$/\n\treturn phoneRegex.test(value.replace(/\\s/g, ''))\n}\n\n/**\n * Validates a URL\n * @param {string} value - URL to validate\n * @returns {boolean} - True if valid URL\n */\nfunction validateUrl(value) {\n\tif (!value) return true\n\ttry {\n\t\tnew URL(value)\n\t\treturn true\n\t} catch {\n\t\treturn false\n\t}\n}\n\n/**\n * Validates a number\n * @param {*} value - Value to validate\n * @returns {boolean} - True if valid number\n */\nfunction validateNumber(value) {\n\tif (value === '' || value === null || value === undefined) return true\n\treturn !isNaN(parseFloat(value)) && isFinite(value)\n}\n\n/**\n * Safely evaluates a custom validation expression\n *\n * @param {string} expression - The validation expression (e.g., \"eval:formData.age >= 18\")\n * @param {*} value - The field value\n * @param {object} formData - The current form data\n * @returns {boolean} - True if validation passes\n */\nfunction evaluateCustomValidation(expression, value, formData) {\n\t// Remove 'eval:' prefix if present\n\tlet cleanExpression = expression.trim()\n\tif (cleanExpression.startsWith('eval:')) {\n\t\tcleanExpression = cleanExpression.substring(5).trim()\n\t}\n\n\ttry {\n\t\t// Create a safe evaluation context with formData and value\n\t\t// This prevents access to dangerous globals like window, document, etc.\n\t\tconst safeEval = new Function('formData', 'value', `\n\t\t\t'use strict';\n\t\t\ttry {\n\t\t\t\treturn Boolean(${cleanExpression});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('[Field Validation] Evaluation error:', e.message);\n\t\t\t\treturn true; // Fail open on evaluation error\n\t\t\t}\n\t\t`)\n\n\t\tconst result = safeEval(formData, value)\n\t\treturn result\n\t} catch (error) {\n\t\tconsole.error('[Field Validation] Failed to evaluate expression:', expression, error)\n\t\t// On error, default to passing validation (fail open)\n\t\treturn true\n\t}\n}\n\n/**\n * Validates a field value based on validation rule\n *\n * @param {*} value - The field value to validate\n * @param {string} validation - Validation rule (email, phone, url, number, or eval:expression)\n * @param {object} formData - Current form data (for custom validations)\n * @returns {object} - {valid: boolean, message: string}\n */\nexport function validateField(value, validation, formData = {}) {\n\tif (!validation) {\n\t\treturn { valid: true, message: '' }\n\t}\n\n\tconst validationType = validation.toLowerCase()\n\n\t// Built-in validation types\n\tswitch (validationType) {\n\t\tcase 'email':\n\t\t\tif (!validateEmail(value)) {\n\t\t\t\treturn { valid: false, message: 'Please enter a valid email address' }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase 'phone':\n\t\t\tif (!validatePhone(value)) {\n\t\t\t\treturn { valid: false, message: 'Please enter a valid phone number' }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase 'url':\n\t\t\tif (!validateUrl(value)) {\n\t\t\t\treturn { valid: false, message: 'Please enter a valid URL' }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase 'number':\n\t\t\tif (!validateNumber(value)) {\n\t\t\t\treturn { valid: false, message: 'Please enter a valid number' }\n\t\t\t}\n\t\t\tbreak\n\n\t\tdefault:\n\t\t\t// Custom validation expression (starts with eval:)\n\t\t\tif (validation.startsWith('eval:')) {\n\t\t\t\tif (!evaluateCustomValidation(validation, value, formData)) {\n\t\t\t\t\treturn { valid: false, message: 'Validation failed' }\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\treturn { valid: true, message: '' }\n}\n\n/**\n * Validates all fields in a section\n *\n * @param {array} fields - Array of field objects with validation rules\n * @param {object} formData - Current form data\n * @returns {object} - {valid: boolean, errors: {fieldName: message}}\n */\nexport function validateSection(fields, formData) {\n\tconst errors = {}\n\tlet valid = true\n\n\tfields.forEach(field => {\n\t\tconst value = formData[field.field_name]\n\n\t\t// Check required\n\t\tif (field.is_required && (value === '' || value === null || value === undefined)) {\n\t\t\terrors[field.field_name] = `${field.field_label} is required`\n\t\t\tvalid = false\n\t\t\treturn\n\t\t}\n\n\t\t// Check validation rule\n\t\tif (field.validation) {\n\t\t\tconst result = validateField(value, field.validation, formData)\n\t\t\tif (!result.valid) {\n\t\t\t\terrors[field.field_name] = result.message\n\t\t\t\tvalid = false\n\t\t\t}\n\t\t}\n\t})\n\n\treturn { valid, errors }\n}\n\n/**\n * Validates all fields in a step\n *\n * @param {object} stepConfig - Step configuration with sections and fields\n * @param {object} formData - Current form data\n * @returns {object} - {valid: boolean, errors: {fieldName: message}}\n */\nexport function validateStep(stepConfig, formData) {\n\tif (!stepConfig || !stepConfig.sections) {\n\t\treturn { valid: true, errors: {} }\n\t}\n\n\tlet allErrors = {}\n\tlet allValid = true\n\n\tstepConfig.sections.forEach(section => {\n\t\tif (section.fields && Array.isArray(section.fields)) {\n\t\t\tconst sectionResult = validateSection(section.fields, formData)\n\t\t\tif (!sectionResult.valid) {\n\t\t\t\tallValid = false\n\t\t\t\tallErrors = { ...allErrors, ...sectionResult.errors }\n\t\t\t}\n\t\t}\n\t})\n\n\treturn { valid: allValid, errors: allErrors }\n}\n\n/**\n * Example validation expressions:\n *\n * Email validation:\n *   validation: \"email\"\n *\n * Phone validation:\n *   validation: \"phone\"\n *\n * Age requirement:\n *   validation: \"eval:value >= 18\"\n *\n * Password confirmation:\n *   validation: \"eval:value === formData.password\"\n *\n * Conditional validation:\n *   validation: \"eval:formData.requester_type !== 'Individual' || value.length > 0\"\n *\n * Date range:\n *   validation: \"eval:new Date(value) >= new Date('2020-01-01')\"\n */\n","/**\n * Step-based validation for Request Type configuration\n * Integrates with existing fieldValidation.js utility\n */\n\nimport { ref, type Ref } from 'vue'\nimport { validateField as utilValidateField } from '../utils/fieldValidation'\n\nexport interface StepValidationReturn {\n\t/** Object containing field names and error messages */\n\terrors: Ref<Record<string, string>>\n\n\t/** Whether validation is in progress */\n\tisValidating: Ref<boolean>\n\n\t/** Validate single field with config */\n\tvalidateConfigField: (\n\t\tfieldName: string,\n\t\tvalue: any,\n\t\tfieldConfig: any,\n\t\tformData?: any\n\t) => boolean\n\n\t/** Validate entire step */\n\tvalidateStep: (stepConfig: any, formData: any) => Promise<boolean>\n\n\t/** Clear all errors */\n\tclearErrors: () => void\n\n\t/** Clear specific field error */\n\tclearFieldError: (fieldName: string) => void\n}\n\nexport function useStepValidation(): StepValidationReturn {\n\tconst errors = ref<Record<string, string>>({})\n\tconst isValidating = ref(false)\n\n\t/**\n\t * Validate single field with Request Type config\n\t */\n\tfunction validateConfigField(\n\t\tfieldName: string,\n\t\tvalue: any,\n\t\tfieldConfig: any,\n\t\tformData: any = {}\n\t): boolean {\n\t\t// Use utility validation\n\t\tconst result = utilValidateField(value, fieldConfig.validation, formData)\n\n\t\tif (!result.valid) {\n\t\t\terrors.value[fieldName] = result.message\n\t\t\treturn false\n\t\t}\n\n\t\t// Check required\n\t\tif (fieldConfig.is_required && (value === '' || value === null || value === undefined)) {\n\t\t\terrors.value[fieldName] = `${fieldConfig.field_label} is required`\n\t\t\treturn false\n\t\t}\n\n\t\t// Clear error if valid\n\t\tdelete errors.value[fieldName]\n\t\treturn true\n\t}\n\n\t/**\n\t * Validate entire step based on config\n\t */\n\tasync function validateStep(\n\t\tstepConfig: any,\n\t\tformData: any\n\t): Promise<boolean> {\n\t\tisValidating.value = true\n\t\terrors.value = {}\n\n\t\tlet isValid = true\n\n\t\tfor (const section of stepConfig.sections || []) {\n\t\t\t// Check section depends_on\n\t\t\tif (section.depends_on) {\n\t\t\t\tconst shouldShow = evaluateDependsOn(section.depends_on, formData)\n\t\t\t\tif (!shouldShow) continue\n\t\t\t}\n\n\t\t\tfor (const field of section.fields || []) {\n\t\t\t\t// Check field depends_on\n\t\t\t\tif (field.depends_on) {\n\t\t\t\t\tconst shouldShow = evaluateDependsOn(field.depends_on, formData)\n\t\t\t\t\tif (!shouldShow) continue\n\t\t\t\t}\n\n\t\t\t\t// Get field value - check for nested address fields\n\t\t\t\tlet value = formData[field.field_name]\n\n\t\t\t\t// Philippine address component fields are nested in address_line object\n\t\t\t\tconst addressComponentFields = ['barangay', 'municipality', 'province', 'city', 'region', 'zip_code', 'postal_code']\n\t\t\t\tif (addressComponentFields.includes(field.field_name) && !value) {\n\t\t\t\t\t// Check if there's an address_line object containing this field\n\t\t\t\t\tconst addressLineData = formData['address_line'] || formData['street'] || formData['residential_address'] || formData['property_address']\n\t\t\t\t\tif (addressLineData && typeof addressLineData === 'object') {\n\t\t\t\t\t\tvalue = addressLineData[field.field_name]\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst fieldValid = validateConfigField(field.field_name, value, field, formData)\n\n\t\t\t\tif (!fieldValid) {\n\t\t\t\t\tisValid = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tisValidating.value = false\n\t\treturn isValid\n\t}\n\n\t/**\n\t * Evaluate depends_on expression\n\t */\n\tfunction evaluateDependsOn(expression: string, formData: any): boolean {\n\t\ttry {\n\t\t\tconst { evaluateCondition } = require('../utils/conditionalLogic')\n\t\t\treturn evaluateCondition(expression, formData)\n\t\t} catch (error) {\n\t\t\tconsole.error('Error evaluating depends_on:', error)\n\t\t\treturn true // Show field on error\n\t\t}\n\t}\n\n\t/**\n\t * Clear all errors\n\t */\n\tfunction clearErrors() {\n\t\terrors.value = {}\n\t}\n\n\t/**\n\t * Clear specific field error\n\t */\n\tfunction clearFieldError(fieldName: string) {\n\t\tdelete errors.value[fieldName]\n\t}\n\n\treturn {\n\t\terrors,\n\t\tisValidating,\n\t\tvalidateConfigField,\n\t\tvalidateStep,\n\t\tclearErrors,\n\t\tclearFieldError\n\t}\n}\n\n/**\n * Example usage in NewRequest.vue:\n *\n * ```typescript\n * import { useStepValidation } from '@/composables/useStepValidation'\n *\n * const { errors, validateStep, clearErrors } = useStepValidation()\n *\n * async function handleNext() {\n *   const isValid = await validateStep(currentStepConfig.value, formData.value)\n *   if (!isValid) {\n *     showValidationModal.value = true\n *     return\n *   }\n *   // Continue...\n * }\n * ```\n */\n","/**\n * Composable for User Profile management and auto-fill functionality\n * Loads user profile data and provides auto-fill for application forms\n */\n\nimport { ref, computed } from 'vue'\n\nconst userProfile = ref(null)\nconst loading = ref(false)\nconst error = ref(null)\n\nexport function useUserProfile() {\n  /**\n   * Fetch user profile from backend\n   */\n  const loadUserProfile = async () => {\n    loading.value = true\n    error.value = null\n\n    try {\n      const headers = {\n        'Content-Type': 'application/json'\n      };\n\n      // Add CSRF token if available\n      if (window.csrf_token) {\n        headers['X-Frappe-CSRF-Token'] = window.csrf_token;\n      }\n\n      const response = await fetch('/api/method/lodgeick.api.get_user_profile', {\n        method: 'GET',\n        headers: headers,\n        credentials: 'include'\n      })\n\n      const result = await response.json()\n\n      // Backend returns profile data directly in result.message\n      // No need to check for success flag\n      if (result.message) {\n        userProfile.value = result.message\n        return userProfile.value\n      } else {\n        throw new Error('Failed to load profile')\n      }\n    } catch (err) {\n      error.value = err.message\n      console.error('Error loading user profile:', err)\n      return null\n    } finally {\n      loading.value = false\n    }\n  }\n\n  /**\n   * Get default property\n   */\n  const defaultProperty = computed(() => {\n    if (!userProfile.value?.properties) return null\n    return userProfile.value.properties.find(p => p.is_default) || userProfile.value.properties[0]\n  })\n\n  /**\n   * Get default council\n   */\n  const defaultCouncil = computed(() => {\n    if (!userProfile.value?.councils) return null\n    return userProfile.value.councils.find(c => c.is_default) || userProfile.value.councils[0]\n  })\n\n  /**\n   * Get auto-fill data for Resource Consent Application\n   * Returns object with all fields that can be auto-filled from profile\n   */\n  const getApplicationAutoFill = () => {\n    if (!userProfile.value) return {}\n\n    const profile = userProfile.value\n    const autoFillData = {}\n\n    // STEP 1: Council Selection\n    if (defaultCouncil.value) {\n      autoFillData.council = defaultCouncil.value.council_id\n      autoFillData.council_name = defaultCouncil.value.council_name\n    }\n\n    // STEP 4: Applicant & Proposal (FRD Step 1)\n    // Basic Applicant Details\n    autoFillData.requester_name = profile.full_name\n    autoFillData.requester_email = profile.user // Email from User account\n    autoFillData.requester_phone = profile.phone\n    autoFillData.requester_type = profile.user_role // 'Individual' or 'Agent'\n\n    // Individual: Postal Address\n    if (profile.user_role === 'Individual') {\n      if (profile.postal_street) {\n        autoFillData.applicant_address = `${profile.postal_street}, ${profile.postal_suburb || ''}, ${profile.postal_city || ''} ${profile.postal_postcode || ''}`.trim()\n      }\n    }\n\n    // Agent: Business Details\n    if (profile.user_role === 'Agent') {\n      autoFillData.agent_required = true\n      autoFillData.agent_id = profile.user\n      autoFillData.agent_company = profile.company_name\n      autoFillData.agent_email = profile.business_email || profile.user\n      autoFillData.agent_phone = profile.business_phone || profile.phone\n\n      if (profile.business_street) {\n        autoFillData.agent_address = `${profile.business_street}, ${profile.business_suburb || ''}, ${profile.business_city || ''} ${profile.business_postcode || ''}`.trim()\n      }\n\n      // Agent preferences\n      if (profile.default_communication_route) {\n        autoFillData.correspondence_recipient = profile.default_communication_route === 'Agent Only' ? 'Agent' : 'Both'\n      }\n\n      if (profile.default_invoice_recipient) {\n        autoFillData.invoice_responsible_party = profile.default_invoice_recipient\n      }\n    }\n\n    // Default Property\n    if (defaultProperty.value) {\n      const prop = defaultProperty.value\n      autoFillData.property = `${prop.street}, ${prop.suburb || ''}, ${prop.city || ''} ${prop.postcode || ''}`.trim()\n      autoFillData.property_address = autoFillData.property\n      autoFillData.property_legal_description = prop.legal_description\n      autoFillData.ownership_status = prop.ownership_status\n    }\n\n    // Communication Preferences\n    if (profile.comm_email || profile.comm_phone || profile.comm_post) {\n      autoFillData.communication_preferences = {\n        email: profile.comm_email || false,\n        phone: profile.comm_phone || false,\n        post: profile.comm_post || false\n      }\n    }\n\n    // Invoice Preference\n    if (profile.invoice_preference) {\n      autoFillData.invoice_delivery_method = profile.invoice_preference\n    }\n\n    return autoFillData\n  }\n\n  /**\n   * Apply auto-fill to form data\n   * @param {Object} formData - The form data object to update\n   * @param {Object} options - Options for auto-fill behavior\n   * @returns {Object} Updated form data\n   */\n  const applyAutoFill = (formData, options = {}) => {\n    const {\n      overrideExisting = false, // If true, override existing values\n      fieldsToSkip = [] // Array of field names to skip\n    } = options\n\n    const autoFillData = getApplicationAutoFill()\n\n    Object.keys(autoFillData).forEach(key => {\n      // Skip if field is in skip list\n      if (fieldsToSkip.includes(key)) return\n\n      // Skip if field already has value and we're not overriding\n      if (!overrideExisting && formData[key]) return\n\n      // Apply auto-fill value\n      formData[key] = autoFillData[key]\n    })\n\n    return formData\n  }\n\n  /**\n   * Get all properties for dropdown/selection\n   */\n  const getAllProperties = computed(() => {\n    return userProfile.value?.properties || []\n  })\n\n  /**\n   * Get all councils for dropdown/selection\n   */\n  const getAllCouncils = computed(() => {\n    return userProfile.value?.councils || []\n  })\n\n  /**\n   * Get all clients (Agent only)\n   */\n  const getAllClients = computed(() => {\n    return userProfile.value?.clients || []\n  })\n\n  /**\n   * Check if profile is complete\n   */\n  const isProfileComplete = computed(() => {\n    if (!userProfile.value) return false\n\n    const profile = userProfile.value\n\n    // Basic required fields\n    const hasBasicInfo = profile.full_name && profile.phone && profile.user_role\n\n    // Role-specific completeness\n    if (profile.user_role === 'Individual') {\n      return hasBasicInfo &&\n             (profile.properties?.length > 0 || false) &&\n             (profile.councils?.length > 0 || false)\n    } else if (profile.user_role === 'Agent') {\n      return hasBasicInfo &&\n             profile.company_name &&\n             (profile.councils?.length > 0 || false)\n    }\n\n    return hasBasicInfo\n  })\n\n  /**\n   * Get profile completion percentage\n   */\n  const profileCompletionPercentage = computed(() => {\n    if (!userProfile.value) return 0\n\n    const profile = userProfile.value\n    let completed = 0\n    let total = 0\n\n    // Basic fields (weight: 30%)\n    const basicFields = ['full_name', 'phone', 'user_role']\n    basicFields.forEach(field => {\n      total++\n      if (profile[field]) completed++\n    })\n\n    // Contact preferences (weight: 10%)\n    total++\n    if (profile.comm_email || profile.comm_phone || profile.comm_post) completed++\n\n    // Properties (weight: 30%)\n    total++\n    if (profile.properties && profile.properties.length > 0) completed++\n\n    // Councils (weight: 20%)\n    total++\n    if (profile.councils && profile.councils.length > 0) completed++\n\n    // Role-specific (weight: 10%)\n    if (profile.user_role === 'Agent') {\n      total++\n      if (profile.company_name) completed++\n    } else {\n      total++\n      if (profile.postal_street) completed++\n    }\n\n    return Math.round((completed / total) * 100)\n  })\n\n  return {\n    userProfile,\n    loading,\n    error,\n    loadUserProfile,\n    getApplicationAutoFill,\n    applyAutoFill,\n    defaultProperty,\n    defaultCouncil,\n    getAllProperties,\n    getAllCouncils,\n    getAllClients,\n    isProfileComplete,\n    profileCompletionPercentage\n  }\n}\n\n// Export singleton instance for global state\nlet instance = null\n\nexport function useGlobalUserProfile() {\n  if (!instance) {\n    instance = useUserProfile()\n  }\n  return instance\n}\n","<script setup>\nimport { computed } from 'vue'\n\nconst props = defineProps({\n\tcurrentStep: {\n\t\ttype: Number,\n\t\trequired: true\n\t},\n\ttotalSteps: {\n\t\ttype: Number,\n\t\trequired: true\n\t},\n\tstepTitles: {\n\t\ttype: Array,\n\t\tdefault: () => []\n\t}\n})\n\nconst progressPercentage = computed(() => {\n\tif (props.totalSteps === 0) return 0\n\treturn Math.round(((props.currentStep + 1) / props.totalSteps) * 100)\n})\n\nconst getStepStatus = (stepIndex) => {\n\tif (stepIndex < props.currentStep) return 'completed'\n\tif (stepIndex === props.currentStep) return 'current'\n\treturn 'upcoming'\n}\n</script>\n\n<template>\n\t<div class=\"mb-8\">\n\t\t<!-- Progress Bar -->\n\t\t<div class=\"relative mb-6\">\n\t\t\t<div class=\"overflow-hidden h-2 text-xs flex rounded bg-gray-200\">\n\t\t\t\t<div\n\t\t\t\t\t:style=\"{ width: progressPercentage + '%' }\"\n\t\t\t\t\tclass=\"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-600 transition-all duration-500\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"flex justify-between mt-2\">\n\t\t\t\t<span class=\"text-sm font-medium text-gray-700\">\n\t\t\t\t\t{{ stepTitles[currentStep] || `Step ${currentStep + 1}` }}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"text-sm font-medium text-gray-700\">\n\t\t\t\t\t{{ progressPercentage }}% Complete\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Step Indicators (temporarily hidden) -->\n\t\t<!-- <nav aria-label=\"Progress\" v-if=\"stepTitles.length > 0\">\n\t\t\t<ol class=\"flex items-center\">\n\t\t\t\t<li\n\t\t\t\t\tv-for=\"(title, index) in stepTitles\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t'relative',\n\t\t\t\t\t\tindex !== stepTitles.length - 1 ? 'pr-8 sm:pr-20 flex-1' : ''\n\t\t\t\t\t]\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"index !== stepTitles.length - 1\"\n\t\t\t\t\t\tclass=\"absolute inset-0 flex items-center\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'h-0.5 w-full',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'completed' ? 'bg-blue-600' : 'bg-gray-200'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"relative flex items-center group\">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'completed'\n\t\t\t\t\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t\t\t\t\t: getStepStatus(index) === 'current'\n\t\t\t\t\t\t\t\t\t? 'bg-white border-2 border-blue-600 text-blue-600'\n\t\t\t\t\t\t\t\t\t: 'bg-white border-2 border-gray-300 text-gray-500'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-if=\"getStepStatus(index) === 'completed'\">\n\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t{{ index + 1 }}\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if=\"title\"\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'ml-3 text-sm font-medium hidden sm:block',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'current'\n\t\t\t\t\t\t\t\t\t? 'text-blue-600'\n\t\t\t\t\t\t\t\t\t: getStepStatus(index) === 'completed'\n\t\t\t\t\t\t\t\t\t? 'text-gray-900'\n\t\t\t\t\t\t\t\t\t: 'text-gray-500'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t</ol>\n\t\t</nav> -->\n\t</div>\n</template>\n","<script setup>\nimport { Button } from 'frappe-ui'\n\nconst props = defineProps({\n\tcurrentStep: {\n\t\ttype: Number,\n\t\trequired: true\n\t},\n\ttotalSteps: {\n\t\ttype: Number,\n\t\trequired: true\n\t},\n\tisLastStep: {\n\t\ttype: Boolean,\n\t\tdefault: false\n\t},\n\tcanGoNext: {\n\t\ttype: Boolean,\n\t\tdefault: true\n\t},\n\tcanSaveDraft: {\n\t\ttype: Boolean,\n\t\tdefault: true\n\t},\n\tisSaving: {\n\t\ttype: Boolean,\n\t\tdefault: false\n\t},\n\tisSubmitting: {\n\t\ttype: Boolean,\n\t\tdefault: false\n\t}\n})\n\nconst emit = defineEmits(['next', 'previous', 'save-draft', 'submit'])\n\nconst handleNext = () => {\n\temit('next')\n}\n\nconst handlePrevious = () => {\n\temit('previous')\n}\n\nconst handleSaveDraft = () => {\n\temit('save-draft')\n}\n\nconst handleSubmit = () => {\n\temit('submit')\n}\n</script>\n\n<template>\n\t<div class=\"mt-8 pt-6 border-t border-gray-200\">\n\t\t<div class=\"flex items-center justify-between\">\n\t\t\t<!-- Previous Button -->\n\t\t\t<div>\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"currentStep > 0\"\n\t\t\t\t\t@click=\"handlePrevious\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t:disabled=\"isSaving || isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\tPrevious\n\t\t\t\t</Button>\n\t\t\t</div>\n\n\t\t\t<!-- Right side buttons -->\n\t\t\t<div class=\"flex items-center space-x-3\">\n\t\t\t\t<!-- Save Draft Button - Only show after council, type, and process info steps -->\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"canSaveDraft\"\n\t\t\t\t\t@click=\"handleSaveDraft\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t:loading=\"isSaving\"\n\t\t\t\t\t:disabled=\"isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"!isSaving\" #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ isSaving ? 'Saving...' : 'Save Draft' }}\n\t\t\t\t</Button>\n\n\t\t\t\t<!-- Next or Submit Button -->\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"!isLastStep\"\n\t\t\t\t\t@click=\"handleNext\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"blue\"\n\t\t\t\t\t:disabled=\"!canGoNext || isSaving || isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\tNext\n\t\t\t\t\t<template #suffix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t</Button>\n\n\t\t\t\t<Button\n\t\t\t\t\tv-else\n\t\t\t\t\t@click=\"handleSubmit\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"green\"\n\t\t\t\t\t:loading=\"isSubmitting\"\n\t\t\t\t\t:disabled=\"!canGoNext || isSaving\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"!isSubmitting\" #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ isSubmitting ? 'Submitting...' : 'Submit Application' }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Help Text -->\n\t\t<div class=\"mt-4 text-center\">\n\t\t\t<p class=\"text-sm text-gray-500\">\n\t\t\t\tYour progress is automatically saved. You can return to complete this application later.\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</template>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Select Council</h2>\n    <p class=\"text-gray-600 mb-8\">Choose the council that will process your application</p>\n\n    <CouncilSelector\n      :model-value=\"modelValue.council\"\n      @update:model-value=\"updateCouncil\"\n      display-mode=\"cards\"\n      :required=\"true\"\n      :show-selected-info=\"true\"\n      label=\"\"\n      :show-label=\"false\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { defineProps, defineEmits } from 'vue'\nimport CouncilSelector from '../CouncilSelector.vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: Object,\n    required: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'council-change'])\n\nconst updateCouncil = (council) => {\n  console.log('[Step1CouncilSelection] updateCouncil called with:', council)\n  console.log('[Step1CouncilSelection] Current modelValue:', props.modelValue)\n\n  emit('update:modelValue', {\n    ...props.modelValue,\n    council: council\n  })\n  emit('council-change', council)\n\n  console.log('[Step1CouncilSelection] Emitted events')\n}\n</script>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Select Application Type</h2>\n    <p class=\"text-gray-600 mb-8\">Choose the type of consent you wish to apply for</p>\n\n    <div v-if=\"requestTypes.loading\" class=\"text-center py-12\">\n      <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n    </div>\n\n    <div v-else class=\"grid md:grid-cols-2 gap-4\">\n      <div\n        v-for=\"type in requestTypes.data\"\n        :key=\"type.name\"\n        @click=\"selectType(type)\"\n        class=\"border-2 rounded-lg p-6 cursor-pointer transition-all hover:shadow-md\"\n        :class=\"modelValue.request_type === type.name ? 'border-blue-600 bg-blue-50' : 'border-gray-200 hover:border-blue-300'\"\n      >\n        <div class=\"flex items-start justify-between\">\n          <div class=\"flex-1\">\n            <h3 class=\"text-lg font-semibold text-gray-900 mb-2\">{{ type.type_name }}</h3>\n            <p class=\"text-sm text-gray-600\" v-html=\"type.description || 'No description available'\"></p>\n            <div class=\"mt-4 flex items-center space-x-4 text-xs text-gray-500\">\n              <span v-if=\"type.base_fee\">Fee: ${{ type.base_fee }}</span>\n              <span v-if=\"type.processing_sla_days\">{{ type.processing_sla_days }} days</span>\n              <span v-if=\"type.category\" class=\"px-2 py-1 bg-gray-100 rounded\">{{ type.category }}</span>\n            </div>\n          </div>\n          <div v-if=\"modelValue.request_type === type.name\" class=\"ml-4\">\n            <div class=\"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center\">\n              <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { defineProps, defineEmits } from 'vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: Object,\n    required: true\n  },\n  requestTypes: {\n    type: Object,\n    required: true\n  }\n})\n\nconst emit = defineEmits(['update:modelValue', 'type-selected'])\n\nconst selectType = (type) => {\n  console.log('[Step2RequestType] selectType called with:', type.name)\n  console.log('[Step2RequestType] props.modelValue:', props.modelValue)\n  console.log('[Step2RequestType] props.modelValue.council:', props.modelValue.council)\n\n  const updatedValue = {\n    ...props.modelValue,\n    request_type: type.name\n  }\n\n  console.log('[Step2RequestType] Emitting updatedValue:', updatedValue)\n  emit('update:modelValue', updatedValue)\n  emit('type-selected', type.name)\n}\n</script>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Council Process Information</h2>\n    <p class=\"text-gray-600 mb-6\">Understanding {{ councilName }}'s process for this application</p>\n\n    <div v-if=\"requestTypeDetails\" class=\"space-y-6\">\n\n      <!-- Note: Pre-Application Meeting booking has been moved to before the application starts -->\n      <!-- Users can book meetings from the request type selection page -->\n\n      <div class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <div class=\"flex items-start justify-between mb-4\">\n          <div>\n            <h3 class=\"text-xl font-semibold text-gray-900\">{{ requestTypeDetails.request_type_name }}</h3>\n            <p v-if=\"requestTypeDetails.category\" class=\"text-sm text-gray-500 mt-1\">\n              {{ requestTypeDetails.category }}\n            </p>\n          </div>\n        </div>\n\n        <div class=\"grid md:grid-cols-3 gap-4 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Application Fee</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              ${{ requestTypeDetails.base_fee || '0' }}\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Plus any additional costs</div>\n          </div>\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Processing Time</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              {{ requestTypeDetails.sla_days || 'N/A' }} <span class=\"text-base\">days</span>\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Standard timeframe</div>\n          </div>\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Payment Required</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              {{ requestTypeDetails.requires_payment ? 'Yes' : 'No' }}\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Before processing</div>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"requestTypeDetails.process_description\" class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <h4 class=\"text-lg font-semibold text-gray-900 mb-4\">How This Works</h4>\n        <div class=\"prose prose-sm max-w-none text-gray-700\" v-html=\"requestTypeDetails.process_description\"></div>\n      </div>\n\n      <div v-else-if=\"requestTypeDetails.description\" class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <h4 class=\"text-lg font-semibold text-gray-900 mb-4\">About This Application</h4>\n        <div class=\"prose prose-sm max-w-none text-gray-700\" v-html=\"requestTypeDetails.description\"></div>\n      </div>\n\n      <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n        <div class=\"flex items-start\">\n          <svg class=\"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-yellow-900 text-sm\">Before You Continue</h5>\n            <p class=\"text-yellow-800 text-sm mt-1\">\n              Please review this information carefully. Make sure you understand the process, fees, and timeframes before proceeding with your application.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"flex justify-center pt-4\">\n        <button\n          type=\"button\"\n          @click=\"handleContinue\"\n          class=\"px-8 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          I Understand - Continue to Application\n        </button>\n      </div>\n    </div>\n\n    <div v-else class=\"text-center py-12\">\n      <p class=\"text-gray-500\">No request type selected. Please go back and select a request type.</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { defineProps, defineEmits } from 'vue'\nimport { session } from '@/data/session'\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter()\n\nconst props = defineProps({\n  requestTypeDetails: {\n    type: Object,\n    default: null\n  },\n  councilName: {\n    type: String,\n    default: ''\n  },\n  modelValue: {\n    type: Object,\n    default: () => ({})\n  }\n})\n\nconst emit = defineEmits(['continue', 'update:modelValue'])\n\nconst handleContinue = () => {\n  // Check if user is logged in before allowing them to continue\n  if (!session.isLoggedIn) {\n    // Save current URL to redirect back after login\n    const currentPath = window.location.pathname + window.location.search\n    router.push({\n      name: 'Login',\n      query: { redirect: currentPath }\n    })\n    return\n  }\n\n  // User is logged in, proceed normally\n  emit('continue')\n}\n</script>\n","<template>\n  <div class=\"px-4 sm:px-0\">\n    <h2 class=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">Review & Submit</h2>\n    <p class=\"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8\">Review your application details before submitting</p>\n\n    <div class=\"space-y-4 sm:space-y-6\">\n      <!-- Application Summary -->\n      <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4 sm:p-6\">\n        <div class=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-0\">\n          <div>\n            <h3 class=\"text-base sm:text-lg font-semibold text-blue-900\">{{ requestTypeName }}</h3>\n            <p class=\"text-xs sm:text-sm text-blue-700 mt-1\">{{ councilName }}</p>\n          </div>\n          <div class=\"sm:text-right\">\n            <div class=\"text-xs sm:text-sm text-blue-600 font-medium\">Application Fee</div>\n            <div class=\"text-xl sm:text-2xl font-bold text-blue-900\">{{ applicationFee }}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Applicant Details -->\n      <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Applicant Details</h3>\n        </div>\n        <div class=\"p-4 sm:p-6 space-y-3\">\n          <div class=\"grid md:grid-cols-2 gap-4\">\n            <div>\n              <span class=\"text-sm text-gray-500\">Name:</span>\n              <p class=\"font-medium\">{{ modelValue.requester_name || 'Not provided' }}</p>\n            </div>\n            <div>\n              <span class=\"text-sm text-gray-500\">Email:</span>\n              <p class=\"font-medium\">{{ modelValue.requester_email || 'Not provided' }}</p>\n            </div>\n            <div>\n              <span class=\"text-sm text-gray-500\">Phone:</span>\n              <p class=\"font-medium\">{{ modelValue.requester_phone || 'Not provided' }}</p>\n            </div>\n            <div v-if=\"modelValue.applicant_company\">\n              <span class=\"text-sm text-gray-500\">Company:</span>\n              <p class=\"font-medium\">{{ modelValue.applicant_company }}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Property Details (only show if request type has property information) -->\n      <div v-if=\"hasPropertyDetails\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Property Details</h3>\n        </div>\n        <div class=\"p-4 sm:p-6\">\n          <div v-if=\"modelValue.property_address\" class=\"space-y-2\">\n            <div>\n              <span class=\"text-sm text-gray-500\">Address:</span>\n              <p class=\"font-medium\">{{ modelValue.property_address }}</p>\n            </div>\n            <div v-if=\"modelValue.legal_description\">\n              <span class=\"text-sm text-gray-500\">Legal Description:</span>\n              <p class=\"font-medium\">{{ modelValue.legal_description }}</p>\n            </div>\n          </div>\n          <p v-else class=\"text-gray-500\">No property selected</p>\n        </div>\n      </div>\n\n      <!-- Delivery Preference (only show if request type collects payment) -->\n      <div v-if=\"requestTypeDetails?.collect_payment\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Delivery & Payment</h3>\n        </div>\n        <div class=\"p-4 sm:p-6 space-y-3\">\n          <div>\n            <span class=\"text-sm text-gray-500\">Delivery Preference:</span>\n            <p class=\"font-medium\">{{ modelValue.delivery_preference || 'Not selected' }}</p>\n          </div>\n          <div>\n            <span class=\"text-sm text-gray-500\">Invoice To:</span>\n            <p class=\"font-medium\">{{ modelValue.invoice_to || 'Not specified' }}</p>\n          </div>\n        </div>\n      </div>\n\n      <!-- Dynamic Review Sections (for configured request types) -->\n      <template v-if=\"usesConfigurableSteps && reviewSections.length > 0\">\n        <div\n          v-for=\"step in reviewSections\"\n          :key=\"step.step_code\"\n          class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\"\n        >\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">{{ step.step_title }}</h3>\n          </div>\n          <div class=\"p-4 sm:p-6 space-y-4\">\n            <div\n              v-for=\"section in step.sections.filter(s => s.show_on_review)\"\n              :key=\"section.section_code\"\n            >\n              <h4 v-if=\"section.section_title\" class=\"text-sm font-medium text-gray-700 mb-2\">\n                {{ section.section_title }}\n              </h4>\n              <div class=\"grid md:grid-cols-2 gap-4\">\n                <div\n                  v-for=\"field in section.fields.filter(f => f.show_on_review)\"\n                  :key=\"field.field_name\"\n                >\n                  <span class=\"text-sm text-gray-500\">{{ field.review_label || field.field_label }}:</span>\n                  <p class=\"font-medium\">{{ formatFieldValue(field, modelValue[field.field_name]) }}</p>\n                </div>\n              </div>\n            </div>\n            <p v-if=\"!hasReviewContent(step)\" class=\"text-gray-500 text-sm\">\n              No information to display for review\n            </p>\n          </div>\n        </div>\n      </template>\n\n      <!-- Resource Consent Specific Details -->\n      <template v-if=\"isResourceConsent\">\n        <!-- Consent Types -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Consent Types & Activity Status</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-3\">\n              <div>\n                <span class=\"text-sm text-gray-500\">Consent Types:</span>\n                <div class=\"mt-2 flex flex-wrap gap-2\">\n                  <span\n                    v-if=\"modelValue.consent_type_land_use\"\n                    class=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium\"\n                  >\n                    Land Use Consent\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_subdivision\"\n                    class=\"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium\"\n                  >\n                    Subdivision Consent\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_discharge\"\n                    class=\"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium\"\n                  >\n                    Discharge Permit\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_water\"\n                    class=\"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium\"\n                  >\n                    Water Permit\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_coastal\"\n                    class=\"px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-sm font-medium\"\n                  >\n                    Coastal Permit\n                  </span>\n                  <span v-if=\"!hasAnyConsentType\" class=\"text-gray-500\">\n                    None selected\n                  </span>\n                </div>\n              </div>\n              <div>\n                <span class=\"text-sm text-gray-500\">Activity Status:</span>\n                <div class=\"mt-1 inline-flex items-center\">\n                  <span\n                    class=\"px-3 py-1 rounded-full text-sm font-medium\"\n                    :class=\"activityStatusClass\"\n                  >\n                    {{ modelValue.activity_status_type || 'Not specified' }}\n                  </span>\n                </div>\n              </div>\n              <div v-if=\"modelValue.activity_title\">\n                <span class=\"text-sm text-gray-500\">Activity Title:</span>\n                <p class=\"font-medium break-words\">{{ modelValue.activity_title }}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Natural Hazards -->\n        <div v-if=\"hasNaturalHazards\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Natural Hazards</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"flex flex-wrap gap-2\">\n              <span\n                v-if=\"modelValue.hazard_flooding\"\n                class=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707\" />\n                </svg>\n                Flood Hazard\n              </span>\n              <span\n                v-if=\"modelValue.hazard_earthquake\"\n                class=\"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                </svg>\n                Earthquake/Fault Line\n              </span>\n              <span\n                v-if=\"modelValue.hazard_landslip\"\n                class=\"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\n                </svg>\n                Landslip/Slope Instability\n              </span>\n              <span\n                v-if=\"modelValue.hazard_coastal\"\n                class=\"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5\" />\n                </svg>\n                Coastal Hazard\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <!-- Consultation & Affected Parties -->\n        <div v-if=\"hasConsultation\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Consultation & Affected Parties</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-3\">\n              <div>\n                <span class=\"text-sm text-gray-500\">Consultation Undertaken:</span>\n                <p class=\"font-medium\">{{ modelValue.consultation_undertaken || 'Not specified' }}</p>\n              </div>\n              <div v-if=\"modelValue.consultation_summary\">\n                <span class=\"text-sm text-gray-500\">Consultation Summary:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ modelValue.consultation_summary }}</p>\n              </div>\n              <div v-if=\"modelValue.affected_parties_details\">\n                <span class=\"text-sm text-gray-500\">Affected Parties:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ stripHtml(modelValue.affected_parties_details) }}</p>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                <svg\n                  class=\"w-5 h-5\"\n                  :class=\"modelValue.written_approvals_obtained ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span :class=\"modelValue.written_approvals_obtained ? 'text-gray-900' : 'text-gray-500'\">\n                  Written Approvals {{ modelValue.written_approvals_obtained ? 'Obtained' : 'Not Obtained' }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- AEE Summary -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Assessment of Environmental Effects</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-4\">\n              <div v-if=\"modelValue.activity_description\">\n                <span class=\"text-sm text-gray-500\">Activity Description:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.activity_description\"></div>\n              </div>\n              <div v-if=\"modelValue.aee_full_assessment\">\n                <span class=\"text-sm text-gray-500\">Full Assessment:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.aee_full_assessment\"></div>\n              </div>\n              <div v-if=\"modelValue.positive_effects_description\">\n                <span class=\"text-sm text-gray-500\">Positive Effects:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ modelValue.positive_effects_description }}</p>\n              </div>\n              <div v-if=\"modelValue.effects_visual_amenity || modelValue.effects_traffic_parking || modelValue.effects_noise\">\n                <span class=\"text-sm text-gray-500\">Adverse Effects Summary:</span>\n                <ul class=\"text-sm mt-1 space-y-1 list-disc list-inside\">\n                  <li v-if=\"modelValue.effects_visual_amenity\">Visual/Amenity: {{ truncate(modelValue.effects_visual_amenity, 50) }}</li>\n                  <li v-if=\"modelValue.effects_traffic_parking\">Traffic/Parking: {{ truncate(modelValue.effects_traffic_parking, 50) }}</li>\n                  <li v-if=\"modelValue.effects_noise\">Noise: {{ truncate(modelValue.effects_noise, 50) }}</li>\n                </ul>\n              </div>\n              <div v-if=\"modelValue.mitigation_measures\">\n                <span class=\"text-sm text-gray-500\">Mitigation Measures:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.mitigation_measures\"></div>\n              </div>\n              <p v-if=\"!hasAEEContent\" class=\"text-gray-500 text-sm\">\n                AEE not yet completed\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Statutory Declarations -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Statutory Declarations</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-2\">\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_accuracy || modelValue.declaration_rma_compliance) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_accuracy || modelValue.declaration_rma_compliance) ? 'text-gray-900' : 'text-gray-500'\">\n                  Declaration of Accuracy & RMA Compliance\n                </span>\n              </div>\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_authority || modelValue.declaration_authorized) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_authority || modelValue.declaration_authorized) ? 'text-gray-900' : 'text-gray-500'\">\n                  Declaration of Authority to Apply\n                </span>\n              </div>\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_acknowledgment || modelValue.declaration_public_information) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_acknowledgment || modelValue.declaration_public_information) ? 'text-gray-900' : 'text-gray-500'\">\n                  Public Information & Privacy Acknowledgment\n                </span>\n              </div>\n              <div v-if=\"modelValue.requester_signature\" class=\"mt-4 pt-4 border-t border-gray-200\">\n                <span class=\"text-sm text-gray-500\">Signed by:</span>\n                <p class=\"font-medium\">{{ modelValue.requester_signature }}</p>\n                <p v-if=\"modelValue.signature_date\" class=\"text-sm text-gray-500\">\n                  Date: {{ formatSignatureDate(modelValue.signature_date) }}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </template>\n\n      <!-- Important Notice -->\n      <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 sm:p-6\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 sm:w-6 sm:h-6 text-yellow-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h4 class=\"font-semibold text-yellow-900 text-sm sm:text-base\">Before You Submit</h4>\n            <ul class=\"mt-2 text-xs sm:text-sm text-yellow-800 space-y-1 list-disc list-inside\">\n              <li>Review all information carefully for accuracy and completeness</li>\n              <li>Ensure all required fields are completed</li>\n              <li>For Resource Consent applications, verify all statutory declarations are confirmed</li>\n              <li>Once submitted, you cannot edit the application (you may need to withdraw and resubmit)</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <!-- Completeness Check -->\n      <div v-if=\"!isComplete\" class=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-red-900 text-xs sm:text-sm\">Application Incomplete</h5>\n            <p class=\"text-red-800 text-xs sm:text-sm mt-1\">\n              Please complete all required sections before submitting. Use the Previous button to go back and fill in missing information.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { defineProps, computed } from 'vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: Object,\n    required: true\n  },\n  councilName: {\n    type: String,\n    default: 'Council'\n  },\n  requestTypeName: {\n    type: String,\n    default: 'Application'\n  },\n  applicationFee: {\n    type: String,\n    default: 'TBD'\n  },\n  isResourceConsent: {\n    type: Boolean,\n    default: false\n  },\n  stepConfigs: {\n    type: Array,\n    default: () => []\n  },\n  usesConfigurableSteps: {\n    type: Boolean,\n    default: false\n  },\n  requestTypeDetails: {\n    type: Object,\n    default: null\n  }\n})\n\n// Filter steps that should show on review\nconst reviewSections = computed(() => {\n  if (!props.usesConfigurableSteps || !props.stepConfigs) {\n    return []\n  }\n\n  return props.stepConfigs.filter(step => step.show_on_review)\n})\n\n// Check if property details should be displayed\nconst hasPropertyDetails = computed(() => {\n  // Always show for resource consent\n  if (props.isResourceConsent) {\n    return true\n  }\n\n  // Check if property data actually exists in the request\n  return !!(props.modelValue.property || props.modelValue.property_address)\n})\n\n// Check if a step has any content to show on review\nconst hasReviewContent = (step) => {\n  if (!step.sections) return false\n\n  for (const section of step.sections) {\n    if (!section.show_on_review) continue\n\n    for (const field of section.fields) {\n      if (field.show_on_review && props.modelValue[field.field_name]) {\n        return true\n      }\n    }\n  }\n\n  return false\n}\n\n// Format field value for display\nconst formatFieldValue = (field, value) => {\n  if (value === undefined || value === null || value === '') {\n    return 'Not provided'\n  }\n\n  // Check field type\n  if (field.field_type === 'Check') {\n    return value ? 'Yes' : 'No'\n  }\n\n  if (field.field_type === 'Date' && value) {\n    // Format date nicely\n    try {\n      return new Date(value).toLocaleDateString('en-NZ', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      })\n    } catch (e) {\n      return value\n    }\n  }\n\n  if (field.field_type === 'Currency' && value) {\n    return `${Number(value).toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`\n  }\n\n  if (field.field_type === 'Select') {\n    return value\n  }\n\n  if (field.field_type === 'Attach' || field.field_type === 'Attach Image') {\n    return value ? ' File attached' : 'Not provided'\n  }\n\n  return value\n}\n\n// RC-specific computed properties\nconst hasAnyConsentType = computed(() => {\n  return !!(\n    props.modelValue.consent_type_land_use ||\n    props.modelValue.consent_type_subdivision ||\n    props.modelValue.consent_type_discharge ||\n    props.modelValue.consent_type_water ||\n    props.modelValue.consent_type_coastal\n  )\n})\n\nconst activityStatusClass = computed(() => {\n  const status = props.modelValue.activity_status_type\n  if (status === 'Permitted') return 'bg-green-100 text-green-800'\n  if (status === 'Controlled') return 'bg-blue-100 text-blue-800'\n  if (status === 'Restricted Discretionary') return 'bg-yellow-100 text-yellow-800'\n  if (status === 'Discretionary') return 'bg-orange-100 text-orange-800'\n  if (status === 'Non-Complying') return 'bg-red-100 text-red-800'\n  if (status === 'Prohibited') return 'bg-gray-800 text-white'\n  return 'bg-gray-100 text-gray-800'\n})\n\nconst hasNaturalHazards = computed(() => {\n  return !!(\n    props.modelValue.hazard_flooding ||\n    props.modelValue.hazard_earthquake ||\n    props.modelValue.hazard_landslip ||\n    props.modelValue.hazard_coastal\n  )\n})\n\nconst hasConsultation = computed(() => {\n  return !!(\n    props.modelValue.consultation_undertaken ||\n    props.modelValue.consultation_summary ||\n    props.modelValue.affected_parties_details ||\n    props.modelValue.written_approvals_obtained\n  )\n})\n\nconst hasAEEContent = computed(() => {\n  return !!(\n    props.modelValue.activity_description ||\n    props.modelValue.aee_full_assessment ||\n    props.modelValue.positive_effects_description ||\n    props.modelValue.effects_visual_amenity ||\n    props.modelValue.effects_traffic_parking ||\n    props.modelValue.effects_noise ||\n    props.modelValue.mitigation_measures ||\n    // Legacy fields\n    props.modelValue.aee_activity_description ||\n    props.modelValue.aee_existing_environment ||\n    props.modelValue.assessment_of_effects ||\n    props.modelValue.aee_document\n  )\n})\n\n// Helper functions\nconst stripHtml = (html) => {\n  if (!html) return ''\n  const tmp = document.createElement('div')\n  tmp.innerHTML = html\n  return tmp.textContent || tmp.innerText || ''\n}\n\nconst truncate = (text, maxLength) => {\n  if (!text) return ''\n  const clean = stripHtml(text)\n  if (clean.length <= maxLength) return clean\n  return clean.substring(0, maxLength) + '...'\n}\n\nconst formatSignatureDate = (dateStr) => {\n  if (!dateStr) return ''\n  try {\n    return new Date(dateStr).toLocaleDateString('en-NZ', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    })\n  } catch (e) {\n    return dateStr\n  }\n}\n\nconst isComplete = computed(() => {\n  // Basic required fields\n  const hasBasicInfo = !!(\n    props.modelValue.council &&\n    props.modelValue.request_type &&\n    props.modelValue.requester_name &&\n    props.modelValue.requester_email &&\n    props.modelValue.property_address &&\n    props.modelValue.delivery_preference\n  )\n\n  // If RC, check additional requirements\n  if (props.isResourceConsent) {\n    const hasRCRequirements = !!(\n      hasAnyConsentType.value &&\n      props.modelValue.activity_status_type &&\n      props.modelValue.activity_description &&\n      props.modelValue.aee_full_assessment &&\n      props.modelValue.declaration_accuracy &&\n      props.modelValue.declaration_authority &&\n      props.modelValue.declaration_acknowledgment\n    )\n    return hasBasicInfo && hasRCRequirements\n  }\n\n  return hasBasicInfo\n})\n</script>\n\n<style scoped>\n.line-clamp-3 {\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n</style>\n","<template>\n    <div class=\"min-h-screen bg-gray-50\">\n        <RequestHeader title=\"New Application\" @back=\"goBack\">\n            <template #actions>\n                <Button\n                    v-if=\"canSaveDraft\"\n                    @click=\"handleSaveDraft\"\n                    variant=\"outline\"\n                    theme=\"gray\"\n                    :loading=\"store.isSaving\"\n                >\n                    Save Draft\n                </Button>\n                <Button\n                    v-if=\"canSaveDraft\"\n                    @click=\"handleSaveAndClose\"\n                    variant=\"outline\"\n                    theme=\"gray\"\n                    :loading=\"store.isSaving\"\n                >\n                    Save and Close\n                </Button>\n            </template>\n        </RequestHeader>\n\n        <div class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n                <RequestProgress\n                    :current-step=\"store.currentStep\"\n                    :total-steps=\"totalSteps\"\n                    :step-titles=\"stepTitles\"\n                />\n            </div>\n        </div>\n\n        <main class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-8\">\n                <div v-if=\"getCurrentStepTitle() === 'Council'\">\n                    <Step1CouncilSelection\n                        v-model=\"store.formData\"\n                        @council-change=\"onCouncilChange\"\n                    />\n                </div>\n\n                <div v-else-if=\"getCurrentStepTitle() === 'Type'\">\n                    <Step2RequestType\n                        v-model=\"store.formData\"\n                        :request-types=\"requestTypes\"\n                        @type-selected=\"selectRequestType\"\n                    />\n                </div>\n\n                <div v-else-if=\"getCurrentStepTitle() === 'Process Info'\">\n                    <Step3ProcessInfo\n                        :request-type-details=\"selectedRequestTypeDetails\"\n                        :council-name=\"getCouncilName()\"\n                        v-model=\"store.formData\"\n                        @continue=\"handleNext\"\n                    />\n                </div>\n\n                <div v-else-if=\"getCurrentStepTitle() === 'Review'\">\n                    <ReviewStep\n                        v-model=\"store.formData\"\n                        :request-type-config=\"store.requestTypeConfig\"\n                    />\n                </div>\n\n                <DynamicStepRenderer\n                    v-else-if=\"usesConfigurableSteps && getCurrentStepConfig()\"\n                    :stepConfig=\"getCurrentStepConfig()\"\n                    v-model=\"store.formData\"\n                />\n                \n                <div v-else>\n                    <h2 class=\"text-xl font-bold text-red-600\">ERROR: Step {{ store.currentStep }} Fallback Hit!</h2>\n                    <p class=\"mt-2\">The dynamic step condition failed to render. Check the following values:</p>\n                    <ul class=\"list-disc list-inside mt-2 space-y-1 text-sm text-gray-700\">\n                        <li><strong>Current Step Title:</strong> {{ getCurrentStepTitle() }}</li>\n                        <li><strong>Request Config Loaded:</strong> {{ !!store.requestTypeConfig }}</li>\n                        <li><strong>Calculated Total Steps:</strong> {{ totalSteps }}</li>\n                        <li><strong>Uses Configurable Steps:</strong> {{ usesConfigurableSteps }}</li>\n                        <li><strong>Current Step Config:</strong> {{ JSON.stringify(getCurrentStepConfig()) }}</li>\n                    </ul>\n                    <p class=\"mt-4 text-sm text-gray-500\">If 'Current Step Config' is not null, the issue is likely within DynamicStepRenderer or component registration.</p>\n                </div>\n            </div>\n\n            <!-- Council Meeting Banner (shown after Process Info step) -->\n            <div\n                v-if=\"shouldShowMeetingBanner\"\n                class=\"mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 shadow-sm\"\n            >\n                <div class=\"flex items-start justify-between\">\n                    <div class=\"flex-1\">\n                        <div class=\"flex items-center gap-2 mb-2\">\n                            <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                            </svg>\n                            <h3 class=\"text-lg font-semibold text-gray-900\">Pre-Application Meeting Available</h3>\n                        </div>\n                        <p class=\"text-sm text-gray-700 mb-3\">\n                            Schedule a meeting with council planners to discuss your application before submitting.\n                            This optional step can help clarify requirements and improve your application.\n                        </p>\n                        <button\n                            @click=\"handleBookMeeting\"\n                            class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\n                        >\n                            Request Council Meeting\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <StepNavigation\n                :current-step=\"store.currentStep\"\n                :total-steps=\"totalSteps\"\n                :is-last-step=\"store.isLastStep\"\n                :can-go-next=\"canNavigateNext\"\n                :can-save-draft=\"canSaveDraft\"\n                :is-saving=\"store.isSaving\"\n                :is-submitting=\"store.isSubmitting\"\n                @next=\"handleNext\"\n                @previous=\"handlePrevious\"\n                @save-draft=\"handleSaveDraft\"\n                @submit=\"handleSubmit\"\n            />\n        </main>\n\n        <SaveDraftModal\n            v-model:show=\"showSaveDraftModal\"\n            :draft-id=\"store.currentRequestId\"\n        />\n\n        <ValidationErrorModal\n            v-model:show=\"showValidationModal\"\n            :errors=\"validationErrors\"\n        />\n\n        <BookMeetingModal\n            v-model:show=\"showMeetingModal\"\n            :request-id=\"store.currentRequestId\"\n            :request-type-code=\"store.formData.request_type\"\n            :council-code=\"store.formData.council\"\n            @booked=\"handleMeetingBooked\"\n        />\n\n        <SubmissionSuccessModal\n            :open=\"showSubmissionSuccessModal\"\n            :request-number=\"submissionResult?.request_number\"\n            :request-id=\"submissionResult?.request_id\"\n            :sla-info=\"submissionResult?.sla_info\"\n            @close=\"showSubmissionSuccessModal = false\"\n            @view-request=\"handleViewRequestFromModal\"\n            @go-to-dashboard=\"handleGoToDashboardFromModal\"\n        />\n    </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watch, defineAsyncComponent } from 'vue'\nimport { useRoute, useRouter, onBeforeRouteLeave } from 'vue-router'\nimport { Button } from 'frappe-ui'\n\n// Store and composables\nimport { useRequestStore } from '../stores/requestStore'\nimport { useCouncilStore } from '../stores/councilStore'\nimport { useStepValidation } from '../composables/useStepValidation'\nimport { useUserProfile } from '../composables/useUserProfile'\n\n// Components\nimport RequestHeader from '../components/request/RequestHeader.vue'\nimport RequestProgress from '../components/request/RequestProgress.vue'\nimport StepNavigation from '../components/request/StepNavigation.vue'\n// Lazy-loaded modals (load on demand to reduce bundle size)\nconst SaveDraftModal = defineAsyncComponent(() => import('../components/modals/SaveDraftModal.vue'))\nconst ValidationErrorModal = defineAsyncComponent(() => import('../components/modals/ValidationErrorModal.vue'))\nconst BookMeetingModal = defineAsyncComponent(() => import('../components/modals/BookMeetingModal.vue'))\nconst SubmissionSuccessModal = defineAsyncComponent(() => import('../components/modals/SubmissionSuccessModal.vue'))\n\n// Step components\nimport Step1CouncilSelection from '../components/request-steps/Step1CouncilSelection.vue'\nimport Step2RequestType from '../components/request-steps/Step2RequestType.vue'\nimport Step3ProcessInfo from '../components/request-steps/Step3ProcessInfo.vue'\n// Lazy-load DynamicStepRenderer (large component with complex logic)\nconst DynamicStepRenderer = defineAsyncComponent(() => import('../components/DynamicStepRenderer.vue'))\nimport ReviewStep from '../components/request-steps/ReviewStep.vue'\n\nconst route = useRoute()\nconst router = useRouter()\n\n// Stores\nconst store = useRequestStore()\nconst councilStore = useCouncilStore()\n\n// Validation\nconst { errors: validationErrors, validateStep } = useStepValidation()\n\n// UI state\nconst showSaveDraftModal = ref(false)\nconst showValidationModal = ref(false)\nconst showMeetingModal = ref(false)\nconst showSubmissionSuccessModal = ref(false)\nconst submissionResult = ref(null)\nconst requestTypes = ref({ loading: false, data: [] })\nconst selectedRequestTypeDetails = ref(null)\n\n// Computed\nconst totalSteps = computed(() => {\n    if (store.requestTypeConfig?.steps) {\n        // Council (0) + Type (1) + Process Info (2) + Dynamic Steps + Review (Last)\n        return store.requestTypeConfig.steps.length + 4\n    }\n    return 4 // Default: Council, Type, Process Info, Review\n})\n\nconst stepTitles = computed(() => {\n    const titles = ['Council', 'Type', 'Process Info']\n    if (store.requestTypeConfig?.steps) {\n        titles.push(...store.requestTypeConfig.steps.map(s => s.step_title))\n    }\n    titles.push('Review') // Always add Review as the last step\n    return titles\n})\n\nconst usesConfigurableSteps = computed(() => {\n    return store.requestTypeConfig?.steps && store.requestTypeConfig.steps.length > 0\n})\n\nconst canNavigateNext = computed(() => {\n    // Always allow navigation for now (validation happens on attempt)\n    return true\n})\n\n/**\n * Can only save draft after:\n * - Step 1: Council selected\n * - Step 2: Request type selected\n * - Step 3: Process info read and confirmed\n * So allow saving from step 4 onwards (step index >= 3)\n */\nconst canSaveDraft = computed(() => {\n    return store.currentStep >= 3\n})\n\n// Get configuration for current step (for dynamic validation)\nconst currentStepConfig = computed(() => {\n    if (!store.requestTypeConfig?.steps) return null\n\n    // Steps 0-2 are fixed (Council, Type, Process Info)\n    // Dynamic steps start at index 3\n    const dynamicStepIndex = store.currentStep - 3\n\n    if (dynamicStepIndex >= 0 && dynamicStepIndex < store.requestTypeConfig.steps.length) {\n        return store.requestTypeConfig.steps[dynamicStepIndex]\n    }\n\n    return null\n})\n\n// Show meeting banner after Process Info (step 3) if council meetings are available\nconst shouldShowMeetingBanner = computed(() => {\n    return store.currentStep > 2 && // After Process Info step\n           store.currentStep < totalSteps.value - 1 && // Before Review step\n           store.requestTypeConfig?.council_meeting_available === 1\n})\n\n// Methods\nfunction handleBookMeeting() {\n    showMeetingModal.value = true\n}\n\nfunction handleMeetingBooked(meetingData) {\n    console.log('Meeting booked:', meetingData)\n    // Optionally show a success message or refresh data\n}\n\nfunction getCurrentStepTitle() {\n    const index = store.currentStep\n    if (index >= 0 && index < stepTitles.value.length) {\n        return stepTitles.value[index]\n    }\n    return ''\n}\n\nfunction getCurrentStepConfig() {\n    const index = store.currentStep\n    const dynamicStepsStart = 3;\n\n    // Check if the current step is within the dynamic steps range (3 up to totalSteps - 2)\n    // totalSteps - 1 is the Review step index.\n    if (index < dynamicStepsStart || index >= totalSteps.value - 1) {\n        return null\n    }\n\n    if (store.requestTypeConfig?.steps) {\n        const stepIndex = index - dynamicStepsStart\n\n        if (stepIndex >= 0 && stepIndex < store.requestTypeConfig.steps.length) {\n            return store.requestTypeConfig.steps[stepIndex]\n        }\n    }\n\n    return null\n}\n\nfunction getCouncilName() {\n    const councilCode = store.formData.council\n    if (!councilCode) return ''\n\n    const council = councilStore.councils.find(c => c.council_code === councilCode)\n    return council?.council_name || councilCode\n}\n\nasync function onCouncilChange(councilCode) {\n    // Load request types for selected council\n    requestTypes.value.loading = true\n    await councilStore.loadRequestTypesForCouncil(councilCode)\n    requestTypes.value = {\n        loading: false,\n        data: councilStore.requestTypes || []\n    }\n}\n\nasync function selectRequestType(requestTypeCode) {\n    // Store request type in formData (required for draft creation)\n    store.updateField('request_type', requestTypeCode)\n\n    // Load request type configuration\n    await store.initialize(requestTypeCode)\n    selectedRequestTypeDetails.value = store.requestTypeConfig\n\n    // Validate config loaded\n    if (!store.requestTypeConfig) {\n        console.error('[NewRequest] Failed to load request type config')\n        return\n    }\n}\n\nasync function handleNext() {\n    // Validation for Step 0 (Council Selection)\n    if (store.currentStep === 0 && !store.formData.council) {\n        alert('Please select a council before continuing.')\n        return\n    }\n\n    // Validation for Step 1 (Request Type Selection)\n    if (store.currentStep === 1 && !store.formData.request_type) {\n        alert('Please select a request type before continuing.')\n        return\n    }\n\n    // Validate current step before allowing navigation (for dynamic steps)\n    if (store.currentStep >= 2 && usesConfigurableSteps.value && currentStepConfig.value) {\n        const isValid = await validateStep(\n            currentStepConfig.value,\n            store.formData\n        )\n\n        if (!isValid) {\n            console.error('[NewRequest] Validation failed:', validationErrors.value)\n            showValidationModal.value = true\n            return // Block navigation\n        }\n    }\n\n    // Auto-save after Process Info step (step 2) to create draft\n    // This ensures the request has an ID for features like \"Book Meeting\" and \"Send Message\"\n    if (store.currentStep === 2 && !store.currentRequestId) {\n        console.log('[NewRequest] Auto-saving draft after Process Info step...')\n        console.log('[NewRequest] requestTypeConfig:', store.requestTypeConfig)\n        console.log('[NewRequest] usesConfigurableSteps:', usesConfigurableSteps.value)\n        console.log('[NewRequest] config steps:', store.requestTypeConfig?.steps)\n\n        await store.saveDraft()\n        console.log('[NewRequest] Draft saved with ID:', store.currentRequestId)\n\n        // Only redirect if there are NO dynamic steps configured\n        // If there are dynamic steps, user needs to fill them out first\n        if (!usesConfigurableSteps.value) {\n            // No dynamic steps - redirect to detail page\n            if (store.currentRequestId) {\n                console.log('[NewRequest] No dynamic steps configured, redirecting to detail page...')\n                router.push(`/request/${store.currentRequestId}`)\n                return // Don't call nextStep, the redirect will handle navigation\n            }\n        } else {\n            console.log('[NewRequest] Dynamic steps configured, continuing to next step...')\n        }\n    }\n\n    // Auto-save existing drafts before navigation\n    if (store.currentRequestId) {\n        await store.saveProgress()\n    }\n\n    store.nextStep()\n}\n\nfunction handlePrevious() {\n    store.previousStep()\n}\n\nasync function handleSaveDraft() {\n    try {\n        await store.saveDraft()\n        // Redirect to request detail page to show Send Message and Book Meeting buttons\n        if (store.currentRequestId) {\n            router.push(`/request/${store.currentRequestId}`)\n        } else {\n            showSaveDraftModal.value = true\n        }\n    } catch (error) {\n        console.error('Failed to save draft:', error)\n    }\n}\n\nasync function handleSaveAndClose() {\n    try {\n        await store.saveDraft()\n        store.reset()  // Clear state after successful save\n        // Redirect to dashboard\n        router.push({ name: 'Dashboard' })\n    } catch (error) {\n        console.error('Failed to save draft:', error)\n        // Don't reset on error - preserve state for retry\n    }\n}\n\nasync function handleSubmit() {\n    // Validation logic (omitted for brevity)\n\n    try {\n        const result = await store.submitRequest()\n\n        // Store submission result for modal\n        submissionResult.value = result\n\n        // Show success modal with SLA info\n        showSubmissionSuccessModal.value = true\n    } catch (error) {\n        console.error('Failed to submit request:', error)\n    }\n}\n\nfunction goBack() {\n    store.reset()  // Clear all state before navigation\n    router.push('/dashboard')\n}\n\n/**\n * Handle view request from success modal\n */\nfunction handleViewRequestFromModal(requestId) {\n    showSubmissionSuccessModal.value = false\n    router.push(`/request/${requestId}`)\n}\n\n/**\n * Handle go to dashboard from success modal\n */\nfunction handleGoToDashboardFromModal() {\n    showSubmissionSuccessModal.value = false\n    // Redirect to council-specific dashboard if available\n    const councilCode = store.formData.council\n    if (councilCode) {\n        router.push(`/council/${councilCode}/dashboard`)\n    } else {\n        router.push('/dashboard')\n    }\n}\n\n// Watch block for step changes\nwatch(() => store.currentStep, () => {\n    // Step changed - trigger reactivity\n}, { immediate: true })\n\n// Watch birth_date for age calculation (SPISC applications)\nwatch(() => store.formData.birth_date, (newDate) => {\n    if (newDate && store.formData.request_type?.includes('SPISC')) {\n        // Calculate age\n        const today = new Date()\n        const born = new Date(newDate)\n        let age = today.getFullYear() - born.getFullYear()\n        const m = today.getMonth() - born.getMonth()\n        if (m < 0 || (m === 0 && today.getDate() < born.getDate())) {\n            age--\n        }\n\n        // Update age in form data\n        store.updateField('age', age)\n\n        // Validate minimum age for SPISC (60 years)\n        if (age < 60) {\n            validationErrors.value['birth_date'] = 'Applicant must be 60 years or older for SPISC'\n        } else {\n            // Clear birth_date validation errors if age is valid\n            delete validationErrors.value['birth_date']\n        }\n    }\n})\n\n// Initialize\nonMounted(async () => {\n    const requestTypeCode = route.query.type\n    const draftId = route.query.draft\n    const councilCode = route.query.council\n    const isLocked = route.query.locked === 'true'\n\n    console.log('[NewRequest] Initialization - locked:', isLocked, 'council:', councilCode, 'type:', requestTypeCode)\n\n    // If starting fresh request (no draft ID), ensure clean state\n    if (!draftId && !route.query.draft) {\n        store.reset()  // Clear any lingering state\n    }\n\n    // Auto-fill user profile data for new requests (not drafts)\n    if (!draftId) {\n        const { getApplicationAutoFill, applyAutoFill } = useUserProfile()\n        try {\n            await getApplicationAutoFill()\n            applyAutoFill(store.formData, {\n                overrideExisting: false // Don't overwrite user input\n            })\n        } catch (error) {\n            console.warn('[NewRequest] Failed to load user profile for auto-fill:', error)\n        }\n    }\n\n    // Handle draft loading (this takes precedence)\n    if (draftId && requestTypeCode) {\n        await store.initialize(requestTypeCode, draftId)\n        selectedRequestTypeDetails.value = store.requestTypeConfig\n        // Draft loading sets the step automatically, so return early\n        return\n    }\n\n    // Handle locked request flow from council website (council + type both locked)\n    if (isLocked && councilCode && requestTypeCode && !draftId) {\n        console.log('[NewRequest] Locked flow detected - skipping to step 2')\n\n        // Set council (locked)\n        store.updateField('council', councilCode)\n\n        // Pre-load request types for this council\n        await onCouncilChange(councilCode)\n\n        // Initialize request type config\n        await store.initialize(requestTypeCode)\n        selectedRequestTypeDetails.value = store.requestTypeConfig\n        store.updateField('request_type', requestTypeCode)\n\n        // Skip directly to step 2 (Process Info)\n        store.currentStep = 2\n        console.log('[NewRequest] Locked flow complete - currentStep:', store.currentStep)\n        return\n    }\n\n    // Handle council pre-selection from URL (not locked, just pre-selected)\n    if (councilCode && !draftId && !isLocked) {\n        store.updateField('council', councilCode)\n\n        // Pre-load request types for this council\n        await onCouncilChange(councilCode)\n\n        // If request type is also provided, advance to step 2\n        if (requestTypeCode) {\n            await store.initialize(requestTypeCode)\n            selectedRequestTypeDetails.value = store.requestTypeConfig\n            store.updateField('request_type', requestTypeCode)\n            store.currentStep = 2\n        } else {\n            // Just council provided, advance to step 1 (Type selection)\n            store.currentStep = 1\n        }\n    } else if (requestTypeCode && !draftId && !councilCode) {\n        // Just request type provided (unusual case, but handle it)\n        await store.initialize(requestTypeCode)\n        selectedRequestTypeDetails.value = store.requestTypeConfig\n        store.updateField('request_type', requestTypeCode)\n    }\n})\n\n// Navigation guard - warn about unsaved changes\nonBeforeRouteLeave((to, from, next) => {\n    // Allow navigation if submitting or no draft exists\n    if (store.isSubmitting || !store.currentRequestId) {\n        store.reset()  // Clear state when leaving without draft\n        next()\n        return\n    }\n\n    // Check if there are unsaved changes\n    const hasChanges = store.formData && Object.keys(store.formData).some(key =>\n        store.formData[key] !== undefined && store.formData[key] !== null && store.formData[key] !== ''\n    )\n\n    if (hasChanges && !confirm('You have unsaved changes. Do you want to leave without saving?')) {\n        next(false) // Cancel navigation\n    } else {\n        // User confirmed or no unsaved changes\n        if (!to.path.includes('/request/')) {\n            store.reset()  // Clear state when navigating away from requests\n        }\n        next() // Allow navigation\n    }\n})\n</script>"],"file":"assets/NewRequest-CR245Zr0.js"}