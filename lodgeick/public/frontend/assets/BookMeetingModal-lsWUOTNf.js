var de=Object.defineProperty,ue=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var $=(u,i,l)=>i in u?de(u,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[i]=l,G=(u,i)=>{for(var l in i||(i={}))pe.call(i,l)&&$(u,l,i[l]);if(W)for(var l of W(i))me.call(i,l)&&$(u,l,i[l]);return u},K=(u,i)=>ue(u,ce(i));var X=(u,i,l)=>new Promise((V,P)=>{var g=r=>{try{x(l.next(r))}catch(b){P(b)}},h=r=>{try{x(l.throw(r))}catch(b){P(b)}},x=r=>r.done?V(r.value):Promise.resolve(r.value).then(g,h);x((l=l.apply(u,i)).next())});import{c as Y,B as c,w as ge,O as be,o as a,P as ve,b as t,a as n,e as f,a6 as C,ak as H,ae as D,u as p,t as m,F as U,W as N,n as fe}from"./vue-vendor-D9RCx05D.js";import{c as Q,D as ye}from"./frappe-ui-E4oUKPDc.js";import"./ui-components-88qJBhde.js";const _e={class:"p-6 max-h-[80vh] overflow-y-auto"},xe={class:"space-y-6"},we=["disabled"],he=["disabled"],ke=["disabled"],Ce={class:"flex items-center justify-between mb-2"},Ae=["disabled"],Se={key:0,class:"mb-4 border border-blue-200 rounded-lg p-4 bg-blue-50"},Te={key:1,class:"mb-4 border border-red-200 rounded-lg p-4 bg-red-50"},Me={class:"space-y-3"},De={class:"flex items-center justify-between mb-2"},Ve={class:"flex items-center"},Pe={class:"text-sm font-medium text-gray-700"},Oe={key:0,class:"ml-2 text-xs text-red-600"},Re={key:0,class:"text-xs text-gray-500"},qe={class:"block text-xs text-gray-600 mb-1"},Be=["onUpdate:modelValue","onChange","disabled"],Ee=["value","disabled"],Ue=["onUpdate:modelValue","disabled"],Ne={key:2,class:"text-xs text-gray-500 mt-1"},je={key:0,class:"text-center py-2"},Fe={key:1,class:"text-center py-2"},Ie={key:0,class:"mb-3 space-y-2"},Le={class:"flex-1"},ze={class:"text-sm font-medium text-gray-900"},Je={class:"text-xs text-gray-600"},We=["onClick","disabled"],$e={class:"border border-gray-300 rounded-lg p-4 bg-white space-y-3"},Ge={class:"grid grid-cols-2 gap-3"},Ke=["disabled"],Xe=["disabled"],Ye={key:0,class:"text-xs text-red-600 mt-1"},He=["disabled"],Qe=["disabled"],Ze={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4"},et={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},tt={class:"text-sm text-red-800"},st={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},lt=["disabled"],rt=["disabled"],ot={key:0},at={key:1},nt=60*60*1e3,pt={__name:"BookMeetingModal",props:{show:{type:Boolean,required:!0},requestId:{type:String,default:null},requestTypeCode:{type:String,default:null},councilCode:{type:String,default:null},meeting:{type:Object,default:null}},emits:["update:show","booked"],setup(u,{emit:i}){const l=u,V=i,P=Y({get:()=>l.show,set:o=>V("update:show",o)}),g=c("Pre-Application Meeting"),h=c(""),x=c(""),r=c(!1),b=c(null),q=c(!1),O=c(""),T=c([]),M=c(""),A=c(""),R=c(""),B=c(!1),Z=Q({url:"lodgeick.api.get_meeting_config",auto:!1}),d=Q({url:"lodgeick.api.get_available_meeting_slots",auto:!1});ge(()=>l.show,o=>{var e,w,y;if(o&&l.councilCode){if(l.meeting&&(g.value=l.meeting.meeting_type||"Pre-Application Meeting",h.value=l.meeting.meeting_purpose||"",x.value=l.meeting.discussion_points||"",l.meeting.preferred_meeting_times)){const S=Array.isArray(l.meeting.preferred_meeting_times)?l.meeting.preferred_meeting_times:[];k.value=[{preference_order:1,preferred_start:((e=S[0])==null?void 0:e.preferred_start)||""},{preference_order:2,preferred_start:((w=S[1])==null?void 0:w.preferred_start)||""},{preference_order:3,preferred_start:((y=S[2])==null?void 0:y.preferred_start)||""}]}Z.fetch({council_code:l.councilCode,meeting_type:g.value});const s=new Date,_=new Date;_.setDate(s.getDate()+30),d.fetch({council_code:l.councilCode,meeting_type:g.value,start_date:s.toISOString().split("T")[0],end_date:_.toISOString().split("T")[0]})}});const k=c([{preference_order:1,preferred_start:""},{preference_order:2,preferred_start:""},{preference_order:3,preferred_start:""}]),j=o=>{if(!o)return"";try{const e=new Date(o);if(isNaN(e.getTime()))throw new Error("Invalid date");return new Date(e.getTime()+nt).toISOString().slice(0,16)}catch(e){return console.error("Error calculating end time:",e),""}},ee=o=>{if(!o)return"";try{const e=j(o);return e?new Date(e).toLocaleString():"Invalid date"}catch(e){return"Invalid date"}},te=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o),F=Y(()=>!g.value||!h.value.trim()?!1:k.value.some(e=>e.preferred_start&&e.preferred_start.trim()!=="")),se=()=>{if(O.value="",M.value.trim()&&A.value.trim()){if(!te(A.value.trim())){O.value="Please enter a valid email address";return}T.value.push({attendee_name:M.value.trim(),attendee_email:A.value.trim(),attendee_role:R.value.trim()||"Applicant Representative"}),M.value="",A.value="",R.value=""}},le=o=>{T.value.splice(o,1)},re=(o,e)=>{o>=0&&o<k.value.length&&(k.value[o].preferred_start=e.start.slice(0,16))},oe=()=>{if(B.value=!B.value,B.value&&l.councilCode&&!d.data){const o=new Date,e=new Date;e.setDate(o.getDate()+30),d.fetch({council_code:l.councilCode,meeting_type:g.value,start_date:o.toISOString().split("T")[0],end_date:e.toISOString().split("T")[0]})}},I=()=>{r.value||(g.value="Pre-Application Meeting",h.value="",x.value="",T.value=[],k.value=[{preference_order:1,preferred_start:""},{preference_order:2,preferred_start:""},{preference_order:3,preferred_start:""}],b.value=null,q.value=!1,V("update:show",!1))},ae=()=>X(this,null,function*(){var o;if(F.value){r.value=!0,b.value=null;try{const e=k.value.filter(s=>s.preferred_start&&s.preferred_start.trim()!=="").map(s=>K(G({},s),{preferred_end:j(s.preferred_start)})),y=yield(yield fetch("/api/method/lodgeick.api.book_council_meeting",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:l.requestId||"draft",request_type_code:l.requestTypeCode,meeting_type:g.value,meeting_purpose:h.value,discussion_points:x.value,attendees:T.value,preferred_time_slots:e})})).json();(o=y.message)!=null&&o.success?(q.value=!0,b.value=null,V("booked",y.message),setTimeout(()=>{I()},2e3)):b.value=y.exc||y._server_messages||"Failed to book meeting"}catch(e){console.error("Book meeting error:",e),b.value="Network error. Please try again."}finally{r.value=!1}}});return(o,e)=>(a(),be(p(ye),{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=w=>P.value=w),options:{size:"lg"}},{body:ve(()=>{var w,y;return[t("div",_e,[e[26]||(e[26]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Request Pre-Application Council Meeting",-1)),t("div",xe,[t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meeting Type *",-1)),C(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},[...e[7]||(e[7]=[t("option",{value:"Pre-Application Meeting"},"Pre-Application Meeting",-1),t("option",{value:"Follow-up Meeting"},"Follow-up Meeting",-1),t("option",{value:"Clarification Meeting"},"Clarification Meeting",-1),t("option",{value:"Final Review Meeting"},"Final Review Meeting",-1)])],8,we),[[H,g.value]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meeting Purpose *",-1)),C(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),rows:"3",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Brief summary of why you need this meeting...",disabled:r.value},null,8,he),[[D,h.value]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Discussion Points (Optional)",-1)),C(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),rows:"4",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Key topics you'd like to discuss (bullet points)...",disabled:r.value},null,8,ke),[[D,x.value]])]),t("div",null,[t("div",Ce,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Preferred Meeting Times *",-1)),u.councilCode&&!p(d).loading?(a(),n("button",{key:0,type:"button",onClick:oe,class:"text-sm text-blue-600 hover:text-blue-700 font-medium",disabled:r.value},m(p(d).data?"Refresh Available Slots":"Load Available Slots"),9,Ae)):f("",!0)]),e[17]||(e[17]=t("p",{class:"text-xs text-gray-500 mb-3"},"Select up to 3 preferred time slots (each meeting is 1 hour). The council will confirm or propose alternatives.",-1)),p(d).loading?(a(),n("div",Se,[...e[12]||(e[12]=[t("div",{class:"text-center py-4"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),t("p",{class:"text-sm text-gray-600 mt-2"},"Loading available time slots...")],-1)])])):p(d).error?(a(),n("div",Te,[...e[13]||(e[13]=[t("p",{class:"text-sm text-red-600"},"Failed to load available slots. Please enter your preferred times manually below.",-1)])])):f("",!0),t("div",Me,[(a(!0),n(U,null,N(k.value,(s,_)=>{var S,L,z,J;return a(),n("div",{key:_,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},[t("div",De,[t("div",Ve,[t("span",Pe,"Option "+m(s.preference_order),1),_===0?(a(),n("span",Oe,"*")):f("",!0)]),s.preferred_start?(a(),n("span",Re,"1 hour duration")):f("",!0)]),t("div",null,[t("label",qe,m(((L=(S=p(d).data)==null?void 0:S.slots)==null?void 0:L.length)>0?"Select Time Slot":"Enter Time"),1),((J=(z=p(d).data)==null?void 0:z.slots)==null?void 0:J.length)>0?C((a(),n("select",{key:0,"onUpdate:modelValue":v=>s.preferred_start=v,onChange:v=>re(_,p(d).data.slots.find(E=>E.start.slice(0,16)===v.target.value)),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},[e[14]||(e[14]=t("option",{value:""},"-- Select a time slot --",-1)),(a(!0),n(U,null,N(p(d).data.slots.slice(0,30),(v,E)=>(a(),n("option",{key:E,value:v.start.slice(0,16),disabled:k.value.some((ne,ie)=>ie!==_&&ne.preferred_start===v.start.slice(0,16))},m(v.start_display)+" - "+m(v.end_display)+" ("+m(v.day)+") ",9,Ee))),128))],40,Be)),[[H,s.preferred_start]]):C((a(),n("input",{key:1,type:"datetime-local","onUpdate:modelValue":v=>s.preferred_start=v,class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},null,8,Ue)),[[D,s.preferred_start]]),s.preferred_start?(a(),n("p",Ne," Meeting will end at "+m(ee(s.preferred_start)),1)):f("",!0)])])}),128)),!p(d).data&&!p(d).loading&&!p(d).error?(a(),n("div",je,[...e[15]||(e[15]=[t("p",{class:"text-xs text-gray-500"},' Click "Load Available Slots" above to see available meeting times, or manually enter your preferred times. ',-1)])])):f("",!0),((y=(w=p(d).data)==null?void 0:w.slots)==null?void 0:y.length)===0?(a(),n("div",Fe,[...e[16]||(e[16]=[t("p",{class:"text-xs text-gray-600"}," No available slots found in the next 30 days. Please enter your preferred times manually above. ",-1)])])):f("",!0)])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Additional Attendees (Optional)",-1)),e[23]||(e[23]=t("p",{class:"text-xs text-gray-500 mb-3"},"Add any representatives, consultants, or advisors who will attend with you.",-1)),T.value.length>0?(a(),n("div",Ie,[(a(!0),n(U,null,N(T.value,(s,_)=>(a(),n("div",{key:_,class:"flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3"},[t("div",Le,[t("div",ze,m(s.attendee_name),1),t("div",Je,m(s.attendee_email)+" â€¢ "+m(s.attendee_role),1)]),t("button",{onClick:S=>le(_),class:"ml-3 text-red-600 hover:text-red-700",disabled:r.value},[...e[18]||(e[18]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,We)]))),128))])):f("",!0),t("div",$e,[t("div",Ge,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Name",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>M.value=s),placeholder:"John Smith",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},null,8,Ke),[[D,M.value]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Email",-1)),C(t("input",{type:"email","onUpdate:modelValue":e[4]||(e[4]=s=>A.value=s),placeholder:"john@example.com",class:fe(["w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",{"border-red-500":O.value}]),disabled:r.value},null,10,Xe),[[D,A.value]]),O.value?(a(),n("p",Ye,m(O.value),1)):f("",!0)])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Role/Title",-1)),C(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>R.value=s),placeholder:"e.g., Architect, Consultant, Representative",class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:r.value},null,8,He),[[D,R.value]])]),t("button",{onClick:se,disabled:!M.value||!A.value||r.value,class:"w-full px-3 py-2 text-sm font-medium text-blue-600 border border-blue-300 hover:bg-blue-50 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"}," Add Attendee ",8,Qe)])]),e[25]||(e[25]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[t("h4",{class:"text-sm font-semibold text-blue-900 mb-2"},"What happens next?"),t("ul",{class:"text-sm text-blue-800 space-y-1 list-disc list-inside"},[t("li",null,"Your meeting request will be sent to the council processing team"),t("li",null,"A council planner will contact you within 2 business days"),t("li",null,"They will confirm one of your preferred times or propose alternatives"),t("li",null,"A calendar invitation will be sent once confirmed")])],-1)),q.value?(a(),n("div",Ze,[...e[24]||(e[24]=[t("div",{class:"flex items-center"},[t("svg",{class:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),t("p",{class:"text-sm text-green-800 font-medium"},"Meeting request submitted successfully! The council will review and confirm your preferred time slots.")],-1)])])):f("",!0),b.value?(a(),n("div",et,[t("p",tt,m(b.value),1)])):f("",!0),t("div",st,[t("button",{onClick:I,disabled:r.value,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"}," Cancel ",8,lt),t("button",{onClick:ae,disabled:!F.value||r.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(a(),n("span",ot,"Requesting...")):(a(),n("span",at,"Request Meeting"))],8,rt)])])])]}),_:1},8,["modelValue"]))}};export{pt as default};
//# sourceMappingURL=BookMeetingModal-lsWUOTNf.js.map
