{"version":3,"file":"SendMessageModal-CUZDMWPZ.js","sources":["../../../../frontend/src/components/modals/SendMessageModal.vue"],"sourcesContent":["<script setup>\nimport { ref, computed } from 'vue'\nimport { Dialog, Input, Button } from 'frappe-ui'\n\nconst props = defineProps({\n\tshow: {\n\t\ttype: Boolean,\n\t\trequired: true\n\t},\n\trequestId: {\n\t\ttype: String,\n\t\trequired: true\n\t}\n})\n\nconst emit = defineEmits(['update:show', 'sent'])\n\nconst isOpen = computed({\n\tget: () => props.show,\n\tset: (value) => emit('update:show', value)\n})\n\nconst subject = ref('')\nconst message = ref('')\nconst communicationType = ref('Email')\nconst sending = ref(false)\nconst error = ref(null)\nconst success = ref(false)\n\nconst isValid = computed(() => {\n\treturn subject.value.trim() && message.value.trim()\n})\n\nconst handleClose = () => {\n\tif (!sending.value) {\n\t\tsubject.value = ''\n\t\tmessage.value = ''\n\t\tcommunicationType.value = 'Email'\n\t\terror.value = null\n\t\tsuccess.value = false\n\t\temit('update:show', false)\n\t}\n}\n\nconst handleSend = async () => {\n\tif (!isValid.value) return\n\n\tsending.value = true\n\terror.value = null\n\n\ttry {\n\t\tconst response = await fetch('/api/method/lodgeick.api.send_request_message', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'X-Frappe-CSRF-Token': window.csrf_token\n\t\t\t},\n\t\t\tbody: JSON.stringify({\n\t\t\t\trequest_id: props.requestId,\n\t\t\t\tsubject: subject.value,\n\t\t\t\tmessage: message.value,\n\t\t\t\tcommunication_type: communicationType.value\n\t\t\t})\n\t\t})\n\n\t\tconst data = await response.json()\n\n\t\tif (data.message?.success) {\n\t\t\t// Show success message\n\t\t\tsuccess.value = true\n\t\t\terror.value = null\n\n\t\t\t// Emit sent event immediately\n\t\t\temit('sent')\n\n\t\t\t// Close modal after 2 seconds so user sees success message\n\t\t\tsetTimeout(() => {\n\t\t\t\thandleClose()\n\t\t\t}, 2000)\n\t\t} else {\n\t\t\terror.value = data.exc || data._server_messages || 'Failed to send message'\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('Send message error:', err)\n\t\terror.value = 'Network error. Please try again.'\n\t} finally {\n\t\tsending.value = false\n\t}\n}\n</script>\n\n<template>\n\t<Dialog v-model=\"isOpen\" :options=\"{ size: 'lg' }\">\n\t\t<template #body>\n\t\t\t<div class=\"p-6\">\n\t\t\t\t<h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Send Message to Council</h3>\n\n\t\t\t\t<div class=\"space-y-4\">\n\t\t\t\t\t<!-- Subject Input -->\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 mb-2\">Subject *</label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tv-model=\"subject\"\n\t\t\t\t\t\t\tplaceholder=\"Brief description of your message\"\n\t\t\t\t\t\t\t:disabled=\"sending\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Message Content -->\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 mb-2\">Message *</label>\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-model=\"message\"\n\t\t\t\t\t\t\trows=\"8\"\n\t\t\t\t\t\t\tclass=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n\t\t\t\t\t\t\tplaceholder=\"Type your message to the council...\"\n\t\t\t\t\t\t\t:disabled=\"sending\"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Communication Type -->\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label class=\"block text-sm font-medium text-gray-700 mb-2\">Communication Type</label>\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tv-model=\"communicationType\"\n\t\t\t\t\t\t\tclass=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n\t\t\t\t\t\t\t:disabled=\"sending\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"Email\">Email</option>\n\t\t\t\t\t\t\t<option value=\"Phone\">Phone Call Follow-up</option>\n\t\t\t\t\t\t\t<option value=\"Letter\">Letter</option>\n\t\t\t\t\t\t\t<option value=\"Other\">Other</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Info Note -->\n\t\t\t\t\t<div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n\t\t\t\t\t\t<p class=\"text-sm text-blue-800\">\n\t\t\t\t\t\t\tYour message will be sent to the council processing team.\n\t\t\t\t\t\t\tThey typically respond within 2-3 business days.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Success Display -->\n\t\t\t\t\t<div v-if=\"success\" class=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<svg class=\"w-5 h-5 text-green-600 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<p class=\"text-sm text-green-800 font-medium\">Message sent successfully! The council will respond within 2-3 business days.</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Error Display -->\n\t\t\t\t\t<div v-if=\"error\" class=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n\t\t\t\t\t\t<p class=\"text-sm text-red-800\">{{ error }}</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Buttons inside body to avoid overlay issues -->\n\t\t\t\t\t<div class=\"flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t\t\t\t:disabled=\"sending\"\n\t\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t@click=\"handleSend\"\n\t\t\t\t\t\t\t:disabled=\"!isValid || sending\"\n\t\t\t\t\t\t\tclass=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span v-if=\"sending\">Sending...</span>\n\t\t\t\t\t\t\t<span v-else>Send Message</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n"],"names":["props","__props","emit","__emit","isOpen","computed","value","subject","ref","message","communicationType","sending","error","success","isValid","handleClose","handleSend","__async","data","_a","err","_createBlock","_unref","Dialog","$event","_createElementVNode","_hoisted_1","_cache","_hoisted_2","_createVNode","Input","_openBlock","_createElementBlock","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9"],"mappings":"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"}