var ue=Object.defineProperty,ce=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var Y=(_,v,n)=>v in _?ue(_,v,{enumerable:!0,configurable:!0,writable:!0,value:n}):_[v]=n,ee=(_,v)=>{for(var n in v||(v={}))me.call(v,n)&&Y(_,n,v[n]);if(K)for(var n of K(v))ge.call(v,n)&&Y(_,n,v[n]);return _},te=(_,v)=>ce(_,pe(v));var B=(_,v,n)=>new Promise((S,k)=>{var C=m=>{try{y(n.next(m))}catch(l){k(l)}},R=m=>{try{y(n.throw(m))}catch(l){k(l)}},y=m=>m.done?S(m.value):Promise.resolve(m.value).then(C,R);y((n=n.apply(_,v)).next())});import{j as A,r as $,C as se,z as ve,o as i,w as q,a as e,n as W,c as d,d as V,b as g,h as D,u as b,I as U,l as j,x as oe,v as N,t as u,i as F,D as le,f as ae,k as X,F as H,m as L,q as E,s as z,g as J}from"./index-DPvnlc80.js";import{D as xe}from"./Dropdown-B1rIxaM8.js";import{_ as ye}from"./StatusBadge-BYz0LkON.js";import{_ as T}from"./StatCard-RRC-W62S.js";function P(S,k){return B(this,arguments,function*(_,v,n={}){v||(v={});let C=Object.assign({Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-Frappe-Site-Name":window.location.hostname},n.headers||{});window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&(C["X-Frappe-CSRF-Token"]=window.csrf_token);let R=_.startsWith("/")?_:`/api/method/${_}`;const y=yield fetch(R,{method:"POST",headers:C,body:JSON.stringify(v)});if(y.ok){const m=yield y.json();if(m.docs||_==="login")return m;if(m.exc)try{console.groupCollapsed(_),console.log(`method: ${_}`),console.log("params:",v);let l=JSON.parse(m.exc);for(let f of l)console.log(f);console.groupEnd()}catch(l){console.warn("Error printing debug messages",l)}return m.message}else{let m=yield y.text(),l,f;try{l=JSON.parse(m)}catch(M){}let w=[[_,l.exc_type,l._error_message].filter(Boolean).join(" ")];if(l.exc){f=l.exc;try{f=JSON.parse(f)[0],console.log(f)}catch(M){}}let h=new Error(w.join(`
`));throw h.exc_type=l.exc_type,h.exc=f,h.status=y.status,h.messages=l._server_messages?JSON.parse(l._server_messages):[],h.messages=h.messages.concat(l.message),h.messages=h.messages.map(M=>{try{return JSON.parse(M).message}catch(x){return M}}),h.messages=h.messages.filter(Boolean),h.messages.length||(h.messages=l._error_message?[l._error_message]:["Internal Server Error"]),n.onError&&n.onError({response:y,status:y.status,error:h}),h}})}const fe={class:"grid grid-cols-2 gap-4"},be={class:"grid grid-cols-2 gap-4"},_e={class:"border-t border-gray-200 pt-6"},he={class:"mb-4"},ke={class:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700"},we={class:"grid grid-cols-3 gap-4"},Ce={class:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium"},$e={class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},Ve={class:"flex items-center justify-between"},Me={class:"text-xl font-bold text-blue-900"},Re={class:"text-xs text-gray-600 mt-1"},De={key:0,class:"mt-4"},Se={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},qe={class:"flex items-start"},Te={class:"text-sm text-red-700"},Ue={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},je={__name:"TaskDialog",props:{modelValue:{type:Boolean,default:!1},task:{type:Object,default:null}},emits:["update:modelValue","task-saved"],setup(_,{emit:v}){const n=_,S=v,k=A({get:()=>n.modelValue,set:s=>S("update:modelValue",s)}),C=A(()=>!!n.task),R=$(!1),y=$(""),m=()=>({title:"",description:"",priority:"Medium",status:"Open",due_date:"",assign_to:"",assign_from:"",request:"",activity_type:"",assigned_role:"",estimated_hours:null,actual_hours:null}),l=$(m()),f=$(""),w=$(0),h=A(()=>(l.value.actual_hours||0)*w.value);se(()=>l.value.assign_to,s=>B(this,null,function*(){if(s)try{const o=yield P("frappe.client.get",{doctype:"User",name:s});if(o&&o.roles&&o.roles.length>0){const p=o.roles.find(O=>!["Guest","All"].includes(O.role));if(p){f.value=p.role,l.value.assigned_role=p.role;const O=yield P("lodgeick.lodgeick.doctype.role_rate.role_rate.get_hourly_rate",{role:p.role});O&&O.hourly_rate&&(w.value=O.hourly_rate)}}}catch(o){console.error("Error fetching user role and rate:",o),f.value="",w.value=0}else f.value="",w.value=0}));const M=()=>{};se(()=>n.task,s=>{s?(l.value={title:s.title||"",description:s.description||"",priority:s.priority||"Medium",status:s.status||"Open",due_date:s.due_date||"",assign_to:s.assign_to||"",assign_from:s.assign_from||"",request:s.request||"",activity_type:s.activity_type||"",assigned_role:s.assigned_role||"",estimated_hours:s.estimated_hours||null,actual_hours:s.actual_hours||null},s.assigned_role&&(f.value=s.assigned_role),s.hourly_rate&&(w.value=s.hourly_rate)):(l.value=m(),f.value="",w.value=0)},{immediate:!0});const x=()=>B(this,null,function*(){y.value="",R.value=!0;try{if(C.value)yield P("frappe.client.set_value",{doctype:"WB Task",name:n.task.name,fieldname:l.value});else{const s=te(ee({doctype:"WB Task"},l.value),{assign_from:l.value.assign_from||"Administrator"});yield P("frappe.client.insert",{doc:s})}S("task-saved"),r()}catch(s){console.error("Error saving task:",s),y.value=s.message||"Failed to save task. Please try again."}finally{R.value=!1}}),r=()=>{k.value=!1,l.value=m(),y.value=""};return(s,o)=>(i(),ve(b(le),{modelValue:k.value,"onUpdate:modelValue":o[10]||(o[10]=p=>k.value=p),options:{title:C.value?"Edit Task":"Create New Task",size:"3xl"}},{"body-content":q(()=>[e("form",{onSubmit:W(x,["prevent"]),class:"space-y-6"},[e("div",null,[o[11]||(o[11]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Title "),e("span",{class:"text-red-500"},"*")],-1)),g(b(U),{id:"title",modelValue:l.value.title,"onUpdate:modelValue":o[0]||(o[0]=p=>l.value.title=p),type:"text",required:"",placeholder:"Enter task title",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[12]||(o[12]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Description ",-1)),j(e("textarea",{id:"description","onUpdate:modelValue":o[1]||(o[1]=p=>l.value.description=p),rows:"3",placeholder:"Describe the task...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[oe,l.value.description]])]),e("div",fe,[e("div",null,[o[14]||(o[14]=e("label",{for:"priority",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Priority "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{id:"priority","onUpdate:modelValue":o[2]||(o[2]=p=>l.value.priority=p),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...o[13]||(o[13]=[e("option",{value:"Low"},"Low",-1),e("option",{value:"Medium"},"Medium",-1),e("option",{value:"High"},"High",-1),e("option",{value:"Urgent"},"Urgent",-1)])],512),[[N,l.value.priority]])]),e("div",null,[o[16]||(o[16]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Status "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{id:"status","onUpdate:modelValue":o[3]||(o[3]=p=>l.value.status=p),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...o[15]||(o[15]=[e("option",{value:"Open"},"Open",-1),e("option",{value:"Working"},"Working",-1),e("option",{value:"Pending Review"},"Pending Review",-1),e("option",{value:"Completed"},"Completed",-1),e("option",{value:"Cancelled"},"Cancelled",-1)])],512),[[N,l.value.status]])])]),e("div",be,[e("div",null,[o[17]||(o[17]=e("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Due Date "),e("span",{class:"text-red-500"},"*")],-1)),g(b(U),{id:"due_date",modelValue:l.value.due_date,"onUpdate:modelValue":o[4]||(o[4]=p=>l.value.due_date=p),type:"date",required:"",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[18]||(o[18]=e("label",{for:"assign_to",class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Assign To "),e("span",{class:"text-red-500"},"*")],-1)),g(b(U),{id:"assign_to",modelValue:l.value.assign_to,"onUpdate:modelValue":o[5]||(o[5]=p=>l.value.assign_to=p),type:"text",required:"",placeholder:"User email",class:"w-full"},null,8,["modelValue"])])]),e("div",null,[o[19]||(o[19]=e("label",{for:"request",class:"block text-sm font-medium text-gray-700 mb-2"}," Linked Request (Optional) ",-1)),g(b(U),{id:"request",modelValue:l.value.request,"onUpdate:modelValue":o[6]||(o[6]=p=>l.value.request=p),type:"text",placeholder:"Request ID (e.g., RC-2025-001)",class:"w-full"},null,8,["modelValue"])]),e("div",_e,[o[26]||(o[26]=e("h3",{class:"text-sm font-medium text-gray-900 mb-4"},"Time Tracking & Costing",-1)),e("div",he,[o[20]||(o[20]=e("label",{for:"assigned_role",class:"block text-sm font-medium text-gray-700 mb-2"}," User Role (Auto-detected) ",-1)),e("div",ke,u(f.value||"Role will be detected from assigned user"),1)]),e("div",we,[e("div",null,[o[21]||(o[21]=e("label",{for:"estimated_hours",class:"block text-sm font-medium text-gray-700 mb-2"}," Estimated Hours ",-1)),g(b(U),{id:"estimated_hours",modelValue:l.value.estimated_hours,"onUpdate:modelValue":o[7]||(o[7]=p=>l.value.estimated_hours=p),modelModifiers:{number:!0},type:"number",step:"0.25",min:"0",placeholder:"0.00",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[22]||(o[22]=e("label",{for:"actual_hours",class:"block text-sm font-medium text-gray-700 mb-2"}," Actual Hours ",-1)),g(b(U),{id:"actual_hours",modelValue:l.value.actual_hours,"onUpdate:modelValue":o[8]||(o[8]=p=>l.value.actual_hours=p),modelModifiers:{number:!0},type:"number",step:"0.25",min:"0",placeholder:"0.00",onInput:M,class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[23]||(o[23]=e("label",{for:"hourly_rate",class:"block text-sm font-medium text-gray-700 mb-2"}," Hourly Rate ",-1)),e("div",Ce," $"+u(w.value.toFixed(2)),1)])]),e("div",$e,[e("div",Ve,[o[24]||(o[24]=e("span",{class:"text-sm font-medium text-gray-700"},"Total Cost",-1)),e("span",Me,"$"+u(h.value.toFixed(2)),1)]),e("p",Re," Calculated as: "+u(l.value.actual_hours||0)+" hours × $"+u(w.value.toFixed(2))+"/hr ",1)]),l.value.request?(i(),d("div",De,[o[25]||(o[25]=e("label",{for:"activity_type",class:"block text-sm font-medium text-gray-700 mb-2"}," Activity Type (Optional) ",-1)),g(b(U),{id:"activity_type",modelValue:l.value.activity_type,"onUpdate:modelValue":o[9]||(o[9]=p=>l.value.activity_type=p),type:"text",placeholder:"e.g., Site Inspection",class:"w-full"},null,8,["modelValue"])])):V("",!0)]),y.value?(i(),d("div",Se,[e("div",qe,[o[27]||(o[27]=e("svg",{class:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Te,u(y.value),1)])])):V("",!0),e("div",Ue,[g(b(F),{type:"button",onClick:r,variant:"outline"},{default:q(()=>[...o[28]||(o[28]=[D(" Cancel ",-1)])]),_:1}),g(b(F),{type:"submit",loading:R.value,variant:"solid",theme:"green"},{default:q(()=>[D(u(C.value?"Update Task":"Create Task"),1)]),_:1},8,["loading"])])],32)]),_:1},8,["modelValue","options"]))}},Ae={class:"space-y-6"},Oe={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},Ie={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Be={class:"p-6 border-b border-gray-200"},Ne={class:"flex justify-between items-center"},Pe={class:"divide-y divide-gray-200"},Ee={key:0,class:"p-12 text-center"},Fe={key:1,class:"p-12 text-center text-gray-500"},He={class:"flex items-start justify-between gap-6"},Le={class:"flex items-start space-x-4 flex-1"},ze=["checked","onChange"],Je={class:"flex-1"},We={class:"flex items-center space-x-3 mb-2"},Xe={class:"text-sm text-gray-600 mb-4"},Ge={class:"flex flex-wrap items-center gap-3"},Qe={key:0,class:"flex items-center text-sm text-gray-600"},Ze={class:"font-medium"},Ke={key:1,class:"inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold"},Ye={key:0,class:"ml-1"},et={class:"flex flex-col items-end space-y-3 min-w-[180px]"},tt={key:0,class:"px-4 py-2 bg-green-50 border-2 border-green-200 rounded-lg"},st={class:"text-2xl font-bold text-green-900"},ot={key:1,class:"px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg w-full"},lt={class:"flex items-center justify-between"},at={class:"text-xs text-blue-700 font-medium"},rt={class:"text-lg font-bold text-blue-900"},nt={key:0},it={key:1},dt={key:0,class:"text-xs text-blue-600 mt-1"},ut={class:"flex items-center space-x-2"},ct=["onClick"],pt=["onClick"],mt={__name:"TaskManagement",setup(_){const v=ae(),n=$(!1),S=$(null),k=X({url:"lodgeick.lodgeick.doctype.task.task.get_my_tasks",auto:!0}),C=A(()=>{const x=k.data||[],r=new Date().toDateString();return{myTasks:x.length,inProgress:x.filter(s=>s.status==="Open").length,completedToday:x.filter(s=>s.status==="Completed"&&s.date_of_completion&&new Date(s.date_of_completion).toDateString()===r).length,overdue:x.filter(s=>s.status==="Overdue").length}}),R=x=>{const r={Low:"bg-gray-100 text-gray-800",Medium:"bg-blue-100 text-blue-800",High:"bg-orange-100 text-orange-800",Urgent:"bg-red-100 text-red-800"};return r[x]||r.Medium},y=x=>x?new Date(x)<new Date:!1,m=x=>x?new Date(x).toLocaleDateString("en-NZ",{day:"numeric",month:"short",year:"numeric"}):"",l=x=>B(this,null,function*(){const r=x.status==="Completed"?"Open":"Completed";try{yield P("frappe.client.set_value",{doctype:"WB Task",name:x.name,fieldname:"status",value:r}),k.reload()}catch(s){console.error("Error toggling task status:",s)}}),f=x=>{v.push({name:"InternalRequestDetail",params:{id:x}})},w=()=>{S.value=null,n.value=!0},h=x=>{S.value=x,n.value=!0},M=()=>{k.reload()};return(x,r)=>(i(),d("div",Ae,[e("div",Oe,[g(T,{title:"My Tasks",value:C.value.myTasks,icon:"clipboard",color:"blue"},null,8,["value"]),g(T,{title:"In Progress",value:C.value.inProgress,icon:"clock",color:"yellow"},null,8,["value"]),g(T,{title:"Completed Today",value:C.value.completedToday,icon:"check",color:"green"},null,8,["value"]),g(T,{title:"Overdue",value:C.value.overdue,icon:"alert-triangle",color:"red"},null,8,["value"])]),e("div",Ie,[e("div",Be,[e("div",Ne,[r[3]||(r[3]=e("h2",{class:"text-lg font-semibold text-gray-900"},"My Tasks",-1)),g(b(F),{onClick:w,variant:"solid",theme:"green"},{prefix:q(()=>[...r[1]||(r[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:q(()=>[r[2]||(r[2]=D(" New Task ",-1))]),_:1})])]),e("div",Pe,[b(k).loading?(i(),d("div",Ee,[...r[4]||(r[4]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1)])])):!b(k).data||b(k).data.length===0?(i(),d("div",Fe,[...r[5]||(r[5]=[e("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",null,"No tasks assigned",-1)])])):(i(!0),d(H,{key:2},L(b(k).data,s=>(i(),d("div",{key:s.name,class:"p-6 hover:bg-gray-50 transition-colors"},[e("div",He,[e("div",Le,[e("input",{type:"checkbox",checked:s.status==="Completed",onChange:o=>l(s),class:"mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer"},null,40,ze),e("div",Je,[e("div",We,[e("h3",{class:E(["text-base font-semibold",s.status==="Completed"?"text-gray-400 line-through":"text-gray-900"])},u(s.title),3),s.priority?(i(),d("span",{key:0,class:E(["inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold",R(s.priority)])},u(s.priority),3)):V("",!0)]),e("p",Xe,u(s.description),1),e("div",Ge,[s.request?(i(),d("div",Qe,[r[6]||(r[6]=e("svg",{class:"w-4 h-4 mr-1.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",Ze,u(s.request),1)])):V("",!0),s.assigned_role?(i(),d("div",Ke,[r[7]||(r[7]=e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),D(" "+u(s.assigned_role),1)])):V("",!0),s.due_date?(i(),d("div",{key:2,class:E(["inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold",y(s.due_date)?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},[r[8]||(r[8]=e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),D(" "+u(m(s.due_date))+" ",1),y(s.due_date)?(i(),d("span",Ye,"⚠️")):V("",!0)],2)):V("",!0)])])]),e("div",et,[s.total_cost?(i(),d("div",tt,[r[9]||(r[9]=e("div",{class:"text-xs text-green-700 font-medium mb-0.5"},"Total Cost",-1)),e("div",st,"$"+u(s.total_cost.toFixed(2)),1)])):V("",!0),s.estimated_hours||s.actual_hours?(i(),d("div",ot,[e("div",lt,[e("div",at,u(s.actual_hours?"Actual":"Est.")+" Hours ",1),e("div",rt,[s.actual_hours?(i(),d("span",nt,u(s.actual_hours)+"h",1)):s.estimated_hours?(i(),d("span",it,"~"+u(s.estimated_hours)+"h",1)):V("",!0)])]),s.hourly_rate?(i(),d("div",dt," @ $"+u(s.hourly_rate.toFixed(2))+"/hr ",1)):V("",!0)])):V("",!0),e("div",ut,[s.request?(i(),d("button",{key:0,onClick:o=>f(s.request),class:"p-2 text-gray-400 hover:text-blue-600 transition rounded-lg hover:bg-blue-50",title:"View Request"},[...r[10]||(r[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,ct)):V("",!0),e("button",{onClick:o=>h(s),class:"p-2 text-gray-400 hover:text-green-600 transition rounded-lg hover:bg-green-50",title:"Edit Task"},[...r[11]||(r[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,pt)])])])]))),128))])]),g(je,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=s=>n.value=s),task:S.value,onTaskSaved:M},null,8,["modelValue","task"])]))}},gt={class:"min-h-screen bg-gray-50"},vt={class:"bg-white shadow-sm border-b border-gray-200"},xt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},yt={class:"flex justify-between items-center py-4"},ft={class:"flex items-center space-x-4"},bt={class:"flex items-center space-x-2 text-gray-700 hover:text-gray-900"},_t={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},ht={class:"text-sm font-medium text-green-600"},kt={class:"text-sm font-medium"},wt={class:"flex space-x-6 border-t border-gray-200 -mb-px"},Ct=["onClick"],$t={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Vt={key:0},Mt={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8"},Rt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6"},Dt={class:"grid md:grid-cols-4 gap-4"},St={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},qt={class:"overflow-x-auto"},Tt={class:"min-w-full divide-y divide-gray-200"},Ut={class:"bg-white divide-y divide-gray-200"},jt={key:0},At={key:1},Ot=["onClick"],It={class:"text-sm font-medium text-gray-900"},Bt={class:"text-sm text-gray-500"},Nt={class:"px-6 py-4 whitespace-nowrap"},Pt={class:"text-sm text-gray-900"},Et={class:"text-sm text-gray-500"},Ft={class:"px-6 py-4"},Ht={class:"text-sm text-gray-900"},Lt={class:"px-6 py-4 whitespace-nowrap"},zt={class:"px-6 py-4 whitespace-nowrap"},Jt={key:0,class:"flex items-center"},Wt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-2"},Xt={class:"text-xs font-medium text-green-600"},Gt={class:"text-sm text-gray-900"},Qt={key:1,class:"text-sm text-gray-400"},Zt={class:"px-6 py-4 whitespace-nowrap"},Kt={class:"text-sm text-gray-900"},Yt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},es=["onClick"],ts=["onClick"],ss={key:1},os={key:2},ls={key:0,class:"space-y-4"},as={class:"bg-gray-50 p-4 rounded-lg"},rs={class:"text-sm font-medium text-gray-900"},ns={class:"text-sm text-gray-500"},is=["value"],vs={__name:"InternalRequestManagement",setup(_){const v=ae(),n=$("requests"),S=[{id:"requests",label:"All Requests"},{id:"tasks",label:"My Tasks"},{id:"analytics",label:"Analytics"}],k=$(""),C=$(""),R=$(""),y=$(""),m=$(!1),l=$(null),f=$(""),w=$(""),h=$(!1),M=X({url:"lodgeick.lodgeick.doctype.request.request.get_all_requests_for_staff",auto:!0}),x=X({url:"lodgeick.api.get_staff_users",auto:!0}),r=A(()=>{const c=M.data||[];return{total:c.length,unassigned:c.filter(t=>!t.assigned_to).length,inProgress:c.filter(t=>t.status==="Under Review").length,rfi:c.filter(t=>t.status==="RFI Issued").length,completed:c.filter(t=>["Approved","Declined","Withdrawn"].includes(t.status)).length}}),s=A(()=>{let c=M.data||[];if(k.value){const t=k.value.toLowerCase();c=c.filter(a=>{var I,Q,Z;return((I=a.request_number)==null?void 0:I.toLowerCase().includes(t))||((Q=a.property_address)==null?void 0:Q.toLowerCase().includes(t))||((Z=a.applicant_name)==null?void 0:Z.toLowerCase().includes(t))})}return C.value&&(c=c.filter(t=>t.status===C.value)),R.value==="unassigned"?c=c.filter(t=>!t.assigned_to):R.value==="me"&&(c=c.filter(t=>t.assigned_to===z.user)),y.value&&(c=c.filter(t=>t.request_type===y.value)),c}),o=A(()=>z.user||"User"),p=A(()=>o.value.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)),O=c=>c?c.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"?",G=c=>{v.push({name:"InternalRequestDetail",params:{id:c}})},re=c=>{l.value=c,f.value=c.assigned_to||"",w.value="",m.value=!0},ne=()=>B(this,null,function*(){if(!f.value){alert("Please select a user to assign");return}h.value=!0;try{const t=yield(yield fetch("/api/method/lodgeick.api.assign_request",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:l.value.name,assigned_to:f.value,notes:w.value})})).json();if(t.message&&t.message.success)m.value=!1,l.value=null,f.value="",w.value="",M.reload(),alert("Request assigned successfully!");else throw new Error("Failed to assign request")}catch(c){console.error("Error assigning request:",c),alert("Failed to assign request. Please try again.")}finally{h.value=!1}}),ie=()=>{m.value=!1,l.value=null,f.value="",w.value=""},de=[{label:"Public Dashboard",onClick:()=>{v.push({name:"Dashboard"})}},{label:"My Profile",onClick:()=>console.log("Profile")},{label:"Settings",onClick:()=>console.log("Settings")},{label:"Logout",onClick:()=>z.logout.submit()}];return(c,t)=>(i(),d("div",gt,[e("header",vt,[e("div",xt,[e("div",yt,[t[8]||(t[8]=J('<div class="flex items-center space-x-3"><div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg></div><div><h1 class="text-xl font-bold text-gray-900">Easy Council</h1><p class="text-xs text-gray-500">Internal Request Management</p></div></div>',1)),e("div",ft,[g(b(xe),{options:de},{default:q(({open:a})=>[e("button",bt,[e("div",_t,[e("span",ht,u(p.value),1)]),e("span",kt,u(o.value),1),t[7]||(t[7]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))])]),_:1})])]),e("div",wt,[(i(),d(H,null,L(S,a=>e("button",{key:a.id,onClick:I=>n.value=a.id,class:E(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",n.value===a.id?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},u(a.label),11,Ct)),64))])])]),e("main",$t,[n.value==="requests"?(i(),d("div",Vt,[e("div",Mt,[g(T,{title:"Total Requests",value:r.value.total,icon:"inbox",color:"blue"},null,8,["value"]),g(T,{title:"New/Unassigned",value:r.value.unassigned,icon:"alert-circle",color:"red"},null,8,["value"]),g(T,{title:"In Progress",value:r.value.inProgress,icon:"clock",color:"yellow"},null,8,["value"]),g(T,{title:"RFI Issued",value:r.value.rfi,icon:"help-circle",color:"orange"},null,8,["value"]),g(T,{title:"Completed",value:r.value.completed,icon:"check-circle",color:"green"},null,8,["value"])]),e("div",Rt,[e("div",Dt,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Search",-1)),g(b(U),{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),placeholder:"Request number, property..."},null,8,["modelValue"])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),j(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>C.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[10]||(t[10]=[J('<option value="">All Statuses</option><option value="Submitted">Submitted</option><option value="Under Review">Under Review</option><option value="RFI Issued">RFI Issued</option><option value="Approved">Approved</option><option value="Declined">Declined</option>',6)])],512),[[N,C.value]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Assigned To",-1)),j(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>R.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[12]||(t[12]=[e("option",{value:""},"All Staff",-1),e("option",{value:"unassigned"},"Unassigned",-1),e("option",{value:"me"},"Assigned to Me",-1)])],512),[[N,R.value]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Request Type",-1)),j(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[14]||(t[14]=[e("option",{value:""},"All Types",-1),e("option",{value:"Building Consent"},"Building Consent",-1),e("option",{value:"Resource Consent"},"Resource Consent",-1),e("option",{value:"LIM"},"LIM Report",-1)])],512),[[N,y.value]])])])]),e("div",St,[e("div",qt,[e("table",Tt,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Request "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Applicant "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Property "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Assigned To "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Days Elapsed "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Ut,[b(M).loading?(i(),d("tr",jt,[...t[16]||(t[16]=[e("td",{colspan:"7",class:"px-6 py-12 text-center text-gray-500"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})],-1)])])):!b(M).data||b(M).data.length===0?(i(),d("tr",At,[...t[17]||(t[17]=[e("td",{colspan:"7",class:"px-6 py-12 text-center text-gray-500"}," No requests found ",-1)])])):(i(!0),d(H,{key:2},L(s.value,a=>(i(),d("tr",{key:a.name,class:"hover:bg-gray-50 cursor-pointer"},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:I=>G(a.name)},[e("div",It,u(a.request_number),1),e("div",Bt,u(a.request_type),1)],8,Ot),e("td",Nt,[e("div",Pt,u(a.applicant_name||a.applicant),1),e("div",Et,u(a.applicant_email),1)]),e("td",Ft,[e("div",Ht,u(a.property_address),1)]),e("td",Lt,[g(ye,{status:a.status},null,8,["status"])]),e("td",zt,[a.assigned_to?(i(),d("div",Jt,[e("div",Wt,[e("span",Xt,u(O(a.assigned_to)),1)]),e("span",Gt,u(a.assigned_to_name||a.assigned_to),1)])):(i(),d("span",Qt,"Unassigned"))]),e("td",Zt,[e("div",Kt,u(a.working_days_elapsed||0)+" days",1),a.working_days_remaining?(i(),d("div",{key:0,class:E(["text-xs",a.is_overdue?"text-red-600":"text-gray-500"])},u(a.working_days_remaining)+" remaining ",3)):V("",!0)]),e("td",Yt,[e("button",{onClick:W(I=>re(a),["stop"]),class:"text-green-600 hover:text-green-900 mr-3"}," Assign ",8,es),e("button",{onClick:W(I=>G(a.name),["stop"]),class:"text-blue-600 hover:text-blue-900"}," View ",8,ts)])]))),128))])])])])])):V("",!0),n.value==="tasks"?(i(),d("div",ss,[g(mt)])):V("",!0),n.value==="analytics"?(i(),d("div",os,[...t[19]||(t[19]=[J('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center"><svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><h3 class="text-lg font-medium text-gray-900 mb-2">Analytics Dashboard</h3><p class="text-gray-500">Performance metrics and reporting coming soon</p></div>',1)])])):V("",!0)]),g(b(le),{modelValue:m.value,"onUpdate:modelValue":t[6]||(t[6]=a=>m.value=a),options:{title:"Assign Request",size:"md"}},{"body-content":q(()=>[l.value?(i(),d("div",ls,[e("div",as,[e("div",rs,u(l.value.request_number),1),e("div",ns,u(l.value.brief_description),1)]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[D("Assign To "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>f.value=a),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[t[20]||(t[20]=e("option",{value:""},"Select a staff member",-1)),(i(!0),d(H,null,L(b(x).data,a=>(i(),d("option",{key:a.name,value:a.name},u(a.display_name),9,is))),128))],512),[[N,f.value]]),t[22]||(t[22]=e("p",{class:"mt-1 text-sm text-gray-500"},"Select the staff member to assign this request to (showing name and primary role)",-1))]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes (Optional)",-1)),j(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=a=>w.value=a),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Add any notes about this assignment..."},null,512),[[oe,w.value]])])])):V("",!0)]),actions:q(()=>[g(b(F),{onClick:ie,variant:"outline"},{default:q(()=>[...t[24]||(t[24]=[D("Cancel",-1)])]),_:1}),g(b(F),{onClick:ne,loading:h.value,variant:"solid",theme:"blue"},{default:q(()=>[...t[25]||(t[25]=[D(" Assign Request ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}};export{vs as default};
//# sourceMappingURL=InternalRequestManagement-DTeN9U5G.js.map
