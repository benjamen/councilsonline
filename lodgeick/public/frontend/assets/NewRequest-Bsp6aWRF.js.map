{"version":3,"mappings":"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","names":["validateEmail","value","validatePhone","validateUrl","e","validateNumber","evaluateCustomValidation","expression","formData","cleanExpression","error","validateField","validation","evaluateCondition","isSectionVisible","section","isFieldVisible","field","useStepValidation","errors","ref","isValidating","validateConfigField","fieldName","fieldConfig","result","utilValidateField","validateStep","stepConfig","__async","isValid","evaluateDependsOn","addressLineData","clearErrors","clearFieldError","userProfile","loading","useUserProfile","loadUserProfile","headers","err","defaultProperty","computed","_a","p","defaultCouncil","c","getApplicationAutoFill","profile","autoFillData","prop","applyAutoFill","options","overrideExisting","fieldsToSkip","key","getAllProperties","getAllCouncils","getAllClients","isProfileComplete","hasBasicInfo","_b","_c","profileCompletionPercentage","completed","total","useSiteCouncilStore","defineStore","state","_d","d","forceRefresh","now","call","useRequestStore","newStep","maxStep","configIndex","stepIndex","requestTypeCode","draftId","configResource","requestService","resolve","checkLoaded","resource","draft","draftStep","sanitizedData","item","fileUrl","fields","props","__props","progressPercentage","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","emit","__emit","handleNext","handlePrevious","handleSaveDraft","handleSubmit","_createBlock","_unref","Button","_cache","_createTextVNode","selectType","type","updatedValue","__spreadProps","__spreadValues","_Fragment","_renderList","$event","_normalizeClass","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","router","useRouter","handleContinue","session","currentPath","_hoisted_7","_hoisted_13","_hoisted_15","reviewSections","step","hasPropertyDetails","hasReviewContent","formatFieldValue","hasAnyConsentType","activityStatusClass","status","hasNaturalHazards","hasConsultation","hasAEEContent","stripHtml","html","tmp","truncate","text","maxLength","clean","formatSignatureDate","dateStr","isComplete","hasRCRequirements","_hoisted_14","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","s","_hoisted_31","_hoisted_32","f","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_70","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_79","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","SaveDraftModal","defineAsyncComponent","__vitePreload","ValidationErrorModal","BookMeetingModal","SubmissionSuccessModal","DynamicStepRenderer","route","useRoute","store","councilStore","validationErrors","showSaveDraftModal","showValidationModal","showMeetingModal","showSubmissionSuccessModal","submissionResult","requestTypes","selectedRequestTypeDetails","totalSteps","stepTitles","titles","usesConfigurableSteps","canNavigateNext","canSaveDraft","currentStepConfig","dynamicStepIndex","shouldShowMeetingBanner","handleBookMeeting","handleMeetingBooked","meetingData","getCurrentStepTitle","index","getCurrentStepConfig","dynamicStepsStart","getCouncilName","loadRequestTypes","selectRequestType","handleSaveAndClose","goBack","handleViewRequestFromModal","requestId","handleGoToDashboardFromModal","councilCode","watch","newDate","today","born","age","m","onMounted","onBeforeRouteLeave","to","from","next","_createVNode","RequestHeader","RequestProgress","Step2RequestType","Step3ProcessInfo","ReviewStep","location","StepNavigation"],"ignoreList":[],"sources":["../../../../frontend/src/utils/fieldValidation.js","../../../../frontend/src/utils/conditionalLogic.js","../../../../frontend/src/composables/useStepValidation.ts","../../../../frontend/src/composables/useUserProfile.js","../../../../frontend/src/stores/siteCouncil.js","../../../../frontend/src/stores/requestStore.js","../../../../frontend/src/components/request/RequestProgress.vue","../../../../frontend/src/components/request/StepNavigation.vue","../../../../frontend/src/components/request-steps/Step2RequestType.vue","../../../../frontend/src/components/request-steps/Step3ProcessInfo.vue","../../../../frontend/src/components/request-steps/ReviewStep.vue","../../../../frontend/src/pages/NewRequest.vue"],"sourcesContent":["/**\n * Field Validation Utility for Request Type Configuration\n *\n * Executes validation JavaScript from step_fields configuration\n *\n * Validation formats supported:\n * - \"email\" - Email format validation\n * - \"phone\" - Phone number validation\n * - \"url\" - URL format validation\n * - \"number\" - Numeric validation\n * - \"eval:formData.age >= 18\" - Custom JavaScript expression\n * - \"eval:formData.password === formData.confirm_password\" - Field comparison\n */\n\n/**\n * Validates an email address\n * @param {string} value - Email to validate\n * @returns {boolean} - True if valid email\n */\nfunction validateEmail(value) {\n\tif (!value) return true // Empty is valid (use is_required for mandatory)\n\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n\treturn emailRegex.test(value)\n}\n\n/**\n * Validates a phone number\n * @param {string} value - Phone to validate\n * @returns {boolean} - True if valid phone\n */\nfunction validatePhone(value) {\n\tif (!value) return true\n\t// Accepts: +64 21 123 4567, 021234567, (021) 123-4567, etc.\n\tconst phoneRegex =\n\t\t/^[\\+]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[0-9]{1,9}$/\n\treturn phoneRegex.test(value.replace(/\\s/g, \"\"))\n}\n\n/**\n * Validates a URL\n * @param {string} value - URL to validate\n * @returns {boolean} - True if valid URL\n */\nfunction validateUrl(value) {\n\tif (!value) return true\n\ttry {\n\t\tnew URL(value)\n\t\treturn true\n\t} catch {\n\t\treturn false\n\t}\n}\n\n/**\n * Validates a number\n * @param {*} value - Value to validate\n * @returns {boolean} - True if valid number\n */\nfunction validateNumber(value) {\n\tif (value === \"\" || value === null || value === undefined) return true\n\treturn !isNaN(Number.parseFloat(value)) && isFinite(value)\n}\n\n/**\n * Safely evaluates a custom validation expression\n *\n * @param {string} expression - The validation expression (e.g., \"eval:formData.age >= 18\")\n * @param {*} value - The field value\n * @param {object} formData - The current form data\n * @returns {boolean} - True if validation passes\n */\nfunction evaluateCustomValidation(expression, value, formData) {\n\t// Remove 'eval:' prefix if present\n\tlet cleanExpression = expression.trim()\n\tif (cleanExpression.startsWith(\"eval:\")) {\n\t\tcleanExpression = cleanExpression.substring(5).trim()\n\t}\n\n\ttry {\n\t\t// Create a safe evaluation context with formData and value\n\t\t// This prevents access to dangerous globals like window, document, etc.\n\t\tconst safeEval = new Function(\n\t\t\t\"formData\",\n\t\t\t\"value\",\n\t\t\t`\n\t\t\t'use strict';\n\t\t\ttry {\n\t\t\t\treturn Boolean(${cleanExpression});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('[Field Validation] Evaluation error:', e.message);\n\t\t\t\treturn true; // Fail open on evaluation error\n\t\t\t}\n\t\t`,\n\t\t)\n\n\t\tconst result = safeEval(formData, value)\n\t\treturn result\n\t} catch (error) {\n\t\tconsole.error(\n\t\t\t\"[Field Validation] Failed to evaluate expression:\",\n\t\t\texpression,\n\t\t\terror,\n\t\t)\n\t\t// On error, default to passing validation (fail open)\n\t\treturn true\n\t}\n}\n\n/**\n * Validates a field value based on validation rule\n *\n * @param {*} value - The field value to validate\n * @param {string} validation - Validation rule (email, phone, url, number, or eval:expression)\n * @param {object} formData - Current form data (for custom validations)\n * @returns {object} - {valid: boolean, message: string}\n */\nexport function validateField(value, validation, formData = {}) {\n\tif (!validation) {\n\t\treturn { valid: true, message: \"\" }\n\t}\n\n\tconst validationType = validation.toLowerCase()\n\n\t// Built-in validation types\n\tswitch (validationType) {\n\t\tcase \"email\":\n\t\t\tif (!validateEmail(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid email address\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase \"phone\":\n\t\t\tif (!validatePhone(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid phone number\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase \"url\":\n\t\t\tif (!validateUrl(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid URL\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase \"number\":\n\t\t\tif (!validateNumber(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid number\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tdefault:\n\t\t\t// Custom validation expression (starts with eval:)\n\t\t\tif (validation.startsWith(\"eval:\")) {\n\t\t\t\tif (!evaluateCustomValidation(validation, value, formData)) {\n\t\t\t\t\treturn { valid: false, message: \"Validation failed\" }\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\treturn { valid: true, message: \"\" }\n}\n\n/**\n * Validates all fields in a section\n *\n * @param {array} fields - Array of field objects with validation rules\n * @param {object} formData - Current form data\n * @returns {object} - {valid: boolean, errors: {fieldName: message}}\n */\nexport function validateSection(fields, formData) {\n\tconst errors = {}\n\tlet valid = true\n\n\tfields.forEach((field) => {\n\t\tconst value = formData[field.field_name]\n\n\t\t// Check required\n\t\tif (\n\t\t\tfield.is_required &&\n\t\t\t(value === \"\" || value === null || value === undefined)\n\t\t) {\n\t\t\terrors[field.field_name] = `${field.field_label} is required`\n\t\t\tvalid = false\n\t\t\treturn\n\t\t}\n\n\t\t// Check validation rule\n\t\tif (field.validation) {\n\t\t\tconst result = validateField(value, field.validation, formData)\n\t\t\tif (!result.valid) {\n\t\t\t\terrors[field.field_name] = result.message\n\t\t\t\tvalid = false\n\t\t\t}\n\t\t}\n\t})\n\n\treturn { valid, errors }\n}\n\n/**\n * Validates all fields in a step\n *\n * @param {object} stepConfig - Step configuration with sections and fields\n * @param {object} formData - Current form data\n * @returns {object} - {valid: boolean, errors: {fieldName: message}}\n */\nexport function validateStep(stepConfig, formData) {\n\tif (!stepConfig || !stepConfig.sections) {\n\t\treturn { valid: true, errors: {} }\n\t}\n\n\tlet allErrors = {}\n\tlet allValid = true\n\n\tstepConfig.sections.forEach((section) => {\n\t\tif (section.fields && Array.isArray(section.fields)) {\n\t\t\tconst sectionResult = validateSection(section.fields, formData)\n\t\t\tif (!sectionResult.valid) {\n\t\t\t\tallValid = false\n\t\t\t\tallErrors = { ...allErrors, ...sectionResult.errors }\n\t\t\t}\n\t\t}\n\t})\n\n\treturn { valid: allValid, errors: allErrors }\n}\n\n/**\n * Example validation expressions:\n *\n * Email validation:\n *   validation: \"email\"\n *\n * Phone validation:\n *   validation: \"phone\"\n *\n * Age requirement:\n *   validation: \"eval:value >= 18\"\n *\n * Password confirmation:\n *   validation: \"eval:value === formData.password\"\n *\n * Conditional validation:\n *   validation: \"eval:formData.requester_type !== 'Individual' || value.length > 0\"\n *\n * Date range:\n *   validation: \"eval:new Date(value) >= new Date('2020-01-01')\"\n */\n","/**\n * Conditional Logic Utility for Request Type Configuration\n *\n * Evaluates `depends_on` expressions from step_configs, step_sections, and step_fields\n *\n * Expression formats supported:\n * - eval:formData.field_name=='value'  (frontend style)\n * - eval:doc.field_name=='value'       (Frappe backend style - alias for formData)\n * - eval:formData.field_name!='value'\n * - eval:formData.field_name\n * - eval:!formData.field_name\n * - eval:formData.field_name>5\n * - eval:formData.field_name=='value1' || formData.field_name=='value2'\n * - eval:formData.field_name=='value1' && formData.other_field=='value2'\n * - eval:doc.payment_method=='Bank Deposit'  (Frappe style - commonly used)\n */\n\n/**\n * Safely evaluates a depends_on expression\n *\n * @param {string} expression - The depends_on expression (e.g., \"eval:formData.requester_type=='Company'\")\n * @param {object} formData - The current form data\n * @returns {boolean} - True if condition is met, false otherwise\n */\nexport function evaluateCondition(expression, formData) {\n\t// If no expression, always show\n\tif (!expression || expression.trim() === \"\") {\n\t\treturn true\n\t}\n\n\t// Remove 'eval:' prefix if present\n\tlet cleanExpression = expression.trim()\n\tif (cleanExpression.startsWith(\"eval:\")) {\n\t\tcleanExpression = cleanExpression.substring(5).trim()\n\t}\n\n\ttry {\n\t\t// Create a safe evaluation context with both formData and doc (alias)\n\t\t// This prevents access to dangerous globals like window, document, etc.\n\t\t// 'doc' is an alias for formData to support Frappe-style expressions\n\t\tconst safeEval = new Function(\n\t\t\t\"formData\",\n\t\t\t\"doc\",\n\t\t\t`\n      'use strict';\n      try {\n        return Boolean(${cleanExpression});\n      } catch (e) {\n        console.warn('[Conditional Logic] Evaluation error:', e.message);\n        return false;\n      }\n    `,\n\t\t)\n\n\t\t// Pass formData as both parameters so both 'formData' and 'doc' work\n\t\tconst result = safeEval(formData, formData)\n\t\treturn result\n\t} catch (error) {\n\t\tconsole.error(\n\t\t\t\"[Conditional Logic] Failed to evaluate expression:\",\n\t\t\texpression,\n\t\t\terror,\n\t\t)\n\t\t// On error, default to showing the field/section (fail open)\n\t\treturn true\n\t}\n}\n\n/**\n * Evaluates step visibility based on depends_on\n *\n * @param {object} step - Step config object with optional depends_on\n * @param {object} formData - Current form data\n * @returns {boolean} - Whether step should be visible\n */\nexport function isStepVisible(step, formData) {\n\tif (!step) return false\n\tif (!step.is_enabled) return false\n\tif (!step.depends_on) return true\n\n\treturn evaluateCondition(step.depends_on, formData)\n}\n\n/**\n * Evaluates section visibility based on depends_on\n *\n * @param {object} section - Section config object with optional depends_on\n * @param {object} formData - Current form data\n * @returns {boolean} - Whether section should be visible\n */\nexport function isSectionVisible(section, formData) {\n\tif (!section) return false\n\tif (!section.is_enabled) return false\n\tif (!section.depends_on) return true\n\n\treturn evaluateCondition(section.depends_on, formData)\n}\n\n/**\n * Evaluates field visibility based on depends_on\n *\n * @param {object} field - Field config object with optional depends_on\n * @param {object} formData - Current form data\n * @returns {boolean} - Whether field should be visible\n */\nexport function isFieldVisible(field, formData) {\n\tif (!field) return false\n\tif (!field.depends_on) return true\n\n\treturn evaluateCondition(field.depends_on, formData)\n}\n\n/**\n * Filters an array of items based on their depends_on conditions\n *\n * @param {array} items - Array of steps/sections/fields with optional depends_on\n * @param {object} formData - Current form data\n * @param {function} visibilityFn - Function to check visibility (isStepVisible, isSectionVisible, isFieldVisible)\n * @returns {array} - Filtered array of visible items\n */\nexport function filterVisibleItems(items, formData, visibilityFn) {\n\tif (!items || !Array.isArray(items)) return []\n\n\treturn items.filter((item) => visibilityFn(item, formData))\n}\n\n/**\n * Example expressions and their evaluations:\n *\n * Expression: \"eval:formData.requester_type=='Company'\"\n * formData: { applicant_type: 'Company' }\n * Result: true\n *\n * Expression: \"eval:formData.has_agent\"\n * formData: { has_agent: 1 }\n * Result: true\n *\n * Expression: \"eval:!formData.has_agent\"\n * formData: { has_agent: 0 }\n * Result: true\n *\n * Expression: \"eval:formData.age>65\"\n * formData: { age: 70 }\n * Result: true\n *\n * Expression: \"eval:formData.consent_type=='Land Use' || formData.consent_type=='Subdivision'\"\n * formData: { consent_type: 'Land Use' }\n * Result: true\n */\n","/**\n * Step-based validation for Request Type configuration\n * Integrates with existing fieldValidation.js utility\n */\n\nimport { type Ref, ref } from \"vue\"\nimport { validateField as utilValidateField } from \"../utils/fieldValidation\"\nimport { evaluateCondition } from \"../utils/conditionalLogic\"\n\nexport interface StepValidationReturn {\n\t/** Object containing field names and error messages */\n\terrors: Ref<Record<string, string>>\n\n\t/** Whether validation is in progress */\n\tisValidating: Ref<boolean>\n\n\t/** Validate single field with config */\n\tvalidateConfigField: (\n\t\tfieldName: string,\n\t\tvalue: any,\n\t\tfieldConfig: any,\n\t\tformData?: any,\n\t) => boolean\n\n\t/** Validate entire step */\n\tvalidateStep: (stepConfig: any, formData: any) => Promise<boolean>\n\n\t/** Clear all errors */\n\tclearErrors: () => void\n\n\t/** Clear specific field error */\n\tclearFieldError: (fieldName: string) => void\n}\n\nexport function useStepValidation(): StepValidationReturn {\n\tconst errors = ref<Record<string, string>>({})\n\tconst isValidating = ref(false)\n\n\t/**\n\t * Validate single field with Request Type config\n\t */\n\tfunction validateConfigField(\n\t\tfieldName: string,\n\t\tvalue: any,\n\t\tfieldConfig: any,\n\t\tformData: any = {},\n\t): boolean {\n\t\t// Use utility validation\n\t\tconst result = utilValidateField(value, fieldConfig.validation, formData)\n\n\t\tif (!result.valid) {\n\t\t\terrors.value[fieldName] = result.message\n\t\t\treturn false\n\t\t}\n\n\t\t// Check required\n\t\tif (\n\t\t\tfieldConfig.is_required &&\n\t\t\t(value === \"\" || value === null || value === undefined)\n\t\t) {\n\t\t\terrors.value[fieldName] = `${fieldConfig.field_label} is required`\n\t\t\treturn false\n\t\t}\n\n\t\t// Clear error if valid\n\t\tdelete errors.value[fieldName]\n\t\treturn true\n\t}\n\n\t/**\n\t * Validate entire step based on config\n\t */\n\tasync function validateStep(\n\t\tstepConfig: any,\n\t\tformData: any,\n\t): Promise<boolean> {\n\t\tisValidating.value = true\n\t\terrors.value = {}\n\n\t\tlet isValid = true\n\n\t\tfor (const section of stepConfig.sections || []) {\n\t\t\t// Check section depends_on\n\t\t\tif (section.depends_on) {\n\t\t\t\tconst shouldShow = evaluateDependsOn(section.depends_on, formData)\n\t\t\t\tif (!shouldShow) continue\n\t\t\t}\n\n\t\t\tfor (const field of section.fields || []) {\n\t\t\t\t// Check field depends_on\n\t\t\t\tif (field.depends_on) {\n\t\t\t\t\tconst shouldShow = evaluateDependsOn(field.depends_on, formData)\n\t\t\t\t\tif (!shouldShow) continue\n\t\t\t\t}\n\n\t\t\t\t// Get field value - check for nested address fields\n\t\t\t\tlet value = formData[field.field_name]\n\n\t\t\t\t// Philippine address component fields are nested in address_line object\n\t\t\t\tconst addressComponentFields = [\n\t\t\t\t\t\"barangay\",\n\t\t\t\t\t\"municipality\",\n\t\t\t\t\t\"province\",\n\t\t\t\t\t\"city\",\n\t\t\t\t\t\"region\",\n\t\t\t\t\t\"zip_code\",\n\t\t\t\t\t\"postal_code\",\n\t\t\t\t]\n\t\t\t\tif (addressComponentFields.includes(field.field_name) && !value) {\n\t\t\t\t\t// Check if there's an address_line object containing this field\n\t\t\t\t\tconst addressLineData =\n\t\t\t\t\t\tformData[\"address_line\"] ||\n\t\t\t\t\t\tformData[\"street\"] ||\n\t\t\t\t\t\tformData[\"residential_address\"] ||\n\t\t\t\t\t\tformData[\"property_address\"]\n\t\t\t\t\tif (addressLineData && typeof addressLineData === \"object\") {\n\t\t\t\t\t\tvalue = addressLineData[field.field_name]\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst fieldValid = validateConfigField(\n\t\t\t\t\tfield.field_name,\n\t\t\t\t\tvalue,\n\t\t\t\t\tfield,\n\t\t\t\t\tformData,\n\t\t\t\t)\n\n\t\t\t\tif (!fieldValid) {\n\t\t\t\t\tisValid = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tisValidating.value = false\n\t\treturn isValid\n\t}\n\n\t/**\n\t * Evaluate depends_on expression\n\t */\n\tfunction evaluateDependsOn(expression: string, formData: any): boolean {\n\t\ttry {\n\t\t\treturn evaluateCondition(expression, formData)\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error evaluating depends_on:\", error)\n\t\t\treturn true // Show field on error\n\t\t}\n\t}\n\n\t/**\n\t * Clear all errors\n\t */\n\tfunction clearErrors() {\n\t\terrors.value = {}\n\t}\n\n\t/**\n\t * Clear specific field error\n\t */\n\tfunction clearFieldError(fieldName: string) {\n\t\tdelete errors.value[fieldName]\n\t}\n\n\treturn {\n\t\terrors,\n\t\tisValidating,\n\t\tvalidateConfigField,\n\t\tvalidateStep,\n\t\tclearErrors,\n\t\tclearFieldError,\n\t}\n}\n\n/**\n * Example usage in NewRequest.vue:\n *\n * ```typescript\n * import { useStepValidation } from '@/composables/useStepValidation'\n *\n * const { errors, validateStep, clearErrors } = useStepValidation()\n *\n * async function handleNext() {\n *   const isValid = await validateStep(currentStepConfig.value, formData.value)\n *   if (!isValid) {\n *     showValidationModal.value = true\n *     return\n *   }\n *   // Continue...\n * }\n * ```\n */\n","/**\n * Composable for User Profile management and auto-fill functionality\n * Loads user profile data and provides auto-fill for application forms\n */\n\nimport { computed, ref } from \"vue\"\n\nconst userProfile = ref(null)\nconst loading = ref(false)\nconst error = ref(null)\n\nexport function useUserProfile() {\n\t/**\n\t * Fetch user profile from backend\n\t */\n\tconst loadUserProfile = async () => {\n\t\tloading.value = true\n\t\terror.value = null\n\n\t\ttry {\n\t\t\tconst headers = {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t}\n\n\t\t\t// Add CSRF token if available\n\t\t\tif (window.csrf_token) {\n\t\t\t\theaders[\"X-Frappe-CSRF-Token\"] = window.csrf_token\n\t\t\t}\n\n\t\t\tconst response = await fetch(\n\t\t\t\t\"/api/method/lodgeick.api.get_user_profile\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\theaders: headers,\n\t\t\t\t\tcredentials: \"include\",\n\t\t\t\t},\n\t\t\t)\n\n\t\t\tconst result = await response.json()\n\n\t\t\t// Backend returns profile data directly in result.message\n\t\t\t// No need to check for success flag\n\t\t\tif (result.message) {\n\t\t\t\tuserProfile.value = result.message\n\t\t\t\treturn userProfile.value\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Failed to load profile\")\n\t\t\t}\n\t\t} catch (err) {\n\t\t\terror.value = err.message\n\t\t\tconsole.error(\"Error loading user profile:\", err)\n\t\t\treturn null\n\t\t} finally {\n\t\t\tloading.value = false\n\t\t}\n\t}\n\n\t/**\n\t * Get default property\n\t */\n\tconst defaultProperty = computed(() => {\n\t\tif (!userProfile.value?.properties) return null\n\t\treturn (\n\t\t\tuserProfile.value.properties.find((p) => p.is_default) ||\n\t\t\tuserProfile.value.properties[0]\n\t\t)\n\t})\n\n\t/**\n\t * Get default council\n\t */\n\tconst defaultCouncil = computed(() => {\n\t\tif (!userProfile.value?.councils) return null\n\t\treturn (\n\t\t\tuserProfile.value.councils.find((c) => c.is_default) ||\n\t\t\tuserProfile.value.councils[0]\n\t\t)\n\t})\n\n\t/**\n\t * Get auto-fill data for Resource Consent Application\n\t * Returns object with all fields that can be auto-filled from profile\n\t */\n\tconst getApplicationAutoFill = () => {\n\t\tif (!userProfile.value) return {}\n\n\t\tconst profile = userProfile.value\n\t\tconst autoFillData = {}\n\n\t\t// STEP 1: Council Selection\n\t\tif (defaultCouncil.value) {\n\t\t\tautoFillData.council = defaultCouncil.value.council_id\n\t\t\tautoFillData.council_name = defaultCouncil.value.council_name\n\t\t}\n\n\t\t// STEP 4: Applicant & Proposal (FRD Step 1)\n\t\t// Basic Applicant Details\n\t\tautoFillData.requester_name = profile.full_name\n\t\tautoFillData.requester_email = profile.user // Email from User account\n\t\tautoFillData.requester_phone = profile.phone\n\t\tautoFillData.requester_type = profile.user_role // 'Individual' or 'Agent'\n\n\t\t// Individual: Postal Address\n\t\tif (profile.user_role === \"Individual\") {\n\t\t\tif (profile.postal_street) {\n\t\t\t\tautoFillData.applicant_address =\n\t\t\t\t\t`${profile.postal_street}, ${profile.postal_suburb || \"\"}, ${profile.postal_city || \"\"} ${profile.postal_postcode || \"\"}`.trim()\n\t\t\t}\n\t\t}\n\n\t\t// Agent: Business Details\n\t\tif (profile.user_role === \"Agent\") {\n\t\t\tautoFillData.agent_required = true\n\t\t\tautoFillData.agent_id = profile.user\n\t\t\tautoFillData.agent_company = profile.company_name\n\t\t\tautoFillData.agent_email = profile.business_email || profile.user\n\t\t\tautoFillData.agent_phone = profile.business_phone || profile.phone\n\n\t\t\tif (profile.business_street) {\n\t\t\t\tautoFillData.agent_address =\n\t\t\t\t\t`${profile.business_street}, ${profile.business_suburb || \"\"}, ${profile.business_city || \"\"} ${profile.business_postcode || \"\"}`.trim()\n\t\t\t}\n\n\t\t\t// Agent preferences\n\t\t\tif (profile.default_communication_route) {\n\t\t\t\tautoFillData.correspondence_recipient =\n\t\t\t\t\tprofile.default_communication_route === \"Agent Only\"\n\t\t\t\t\t\t? \"Agent\"\n\t\t\t\t\t\t: \"Both\"\n\t\t\t}\n\n\t\t\tif (profile.default_invoice_recipient) {\n\t\t\t\tautoFillData.invoice_responsible_party =\n\t\t\t\t\tprofile.default_invoice_recipient\n\t\t\t}\n\t\t}\n\n\t\t// Default Property\n\t\tif (defaultProperty.value) {\n\t\t\tconst prop = defaultProperty.value\n\t\t\tautoFillData.property =\n\t\t\t\t`${prop.street}, ${prop.suburb || \"\"}, ${prop.city || \"\"} ${prop.postcode || \"\"}`.trim()\n\t\t\tautoFillData.property_address = autoFillData.property\n\t\t\tautoFillData.property_legal_description = prop.legal_description\n\t\t\tautoFillData.ownership_status = prop.ownership_status\n\t\t}\n\n\t\t// Communication Preferences\n\t\tif (profile.comm_email || profile.comm_phone || profile.comm_post) {\n\t\t\tautoFillData.communication_preferences = {\n\t\t\t\temail: profile.comm_email || false,\n\t\t\t\tphone: profile.comm_phone || false,\n\t\t\t\tpost: profile.comm_post || false,\n\t\t\t}\n\t\t}\n\n\t\t// Invoice Preference\n\t\tif (profile.invoice_preference) {\n\t\t\tautoFillData.invoice_delivery_method = profile.invoice_preference\n\t\t}\n\n\t\treturn autoFillData\n\t}\n\n\t/**\n\t * Apply auto-fill to form data\n\t * @param {Object} formData - The form data object to update\n\t * @param {Object} options - Options for auto-fill behavior\n\t * @returns {Object} Updated form data\n\t */\n\tconst applyAutoFill = (formData, options = {}) => {\n\t\tconst {\n\t\t\toverrideExisting = false, // If true, override existing values\n\t\t\tfieldsToSkip = [], // Array of field names to skip\n\t\t} = options\n\n\t\tconst autoFillData = getApplicationAutoFill()\n\n\t\tObject.keys(autoFillData).forEach((key) => {\n\t\t\t// Skip if field is in skip list\n\t\t\tif (fieldsToSkip.includes(key)) return\n\n\t\t\t// Skip if field already has value and we're not overriding\n\t\t\tif (!overrideExisting && formData[key]) return\n\n\t\t\t// Apply auto-fill value\n\t\t\tformData[key] = autoFillData[key]\n\t\t})\n\n\t\treturn formData\n\t}\n\n\t/**\n\t * Get all properties for dropdown/selection\n\t */\n\tconst getAllProperties = computed(() => {\n\t\treturn userProfile.value?.properties || []\n\t})\n\n\t/**\n\t * Get all councils for dropdown/selection\n\t */\n\tconst getAllCouncils = computed(() => {\n\t\treturn userProfile.value?.councils || []\n\t})\n\n\t/**\n\t * Get all clients (Agent only)\n\t */\n\tconst getAllClients = computed(() => {\n\t\treturn userProfile.value?.clients || []\n\t})\n\n\t/**\n\t * Check if profile is complete\n\t */\n\tconst isProfileComplete = computed(() => {\n\t\tif (!userProfile.value) return false\n\n\t\tconst profile = userProfile.value\n\n\t\t// Basic required fields\n\t\tconst hasBasicInfo = profile.full_name && profile.phone && profile.user_role\n\n\t\t// Role-specific completeness\n\t\tif (profile.user_role === \"Individual\") {\n\t\t\treturn (\n\t\t\t\thasBasicInfo &&\n\t\t\t\t(profile.properties?.length > 0 || false) &&\n\t\t\t\t(profile.councils?.length > 0 || false)\n\t\t\t)\n\t\t} else if (profile.user_role === \"Agent\") {\n\t\t\treturn (\n\t\t\t\thasBasicInfo &&\n\t\t\t\tprofile.company_name &&\n\t\t\t\t(profile.councils?.length > 0 || false)\n\t\t\t)\n\t\t}\n\n\t\treturn hasBasicInfo\n\t})\n\n\t/**\n\t * Get profile completion percentage\n\t */\n\tconst profileCompletionPercentage = computed(() => {\n\t\tif (!userProfile.value) return 0\n\n\t\tconst profile = userProfile.value\n\t\tlet completed = 0\n\t\tlet total = 0\n\n\t\t// Basic fields (weight: 30%)\n\t\tconst basicFields = [\"full_name\", \"phone\", \"user_role\"]\n\t\tbasicFields.forEach((field) => {\n\t\t\ttotal++\n\t\t\tif (profile[field]) completed++\n\t\t})\n\n\t\t// Contact preferences (weight: 10%)\n\t\ttotal++\n\t\tif (profile.comm_email || profile.comm_phone || profile.comm_post)\n\t\t\tcompleted++\n\n\t\t// Properties (weight: 30%)\n\t\ttotal++\n\t\tif (profile.properties && profile.properties.length > 0) completed++\n\n\t\t// Councils (weight: 20%)\n\t\ttotal++\n\t\tif (profile.councils && profile.councils.length > 0) completed++\n\n\t\t// Role-specific (weight: 10%)\n\t\tif (profile.user_role === \"Agent\") {\n\t\t\ttotal++\n\t\t\tif (profile.company_name) completed++\n\t\t} else {\n\t\t\ttotal++\n\t\t\tif (profile.postal_street) completed++\n\t\t}\n\n\t\treturn Math.round((completed / total) * 100)\n\t})\n\n\treturn {\n\t\tuserProfile,\n\t\tloading,\n\t\terror,\n\t\tloadUserProfile,\n\t\tgetApplicationAutoFill,\n\t\tapplyAutoFill,\n\t\tdefaultProperty,\n\t\tdefaultCouncil,\n\t\tgetAllProperties,\n\t\tgetAllCouncils,\n\t\tgetAllClients,\n\t\tisProfileComplete,\n\t\tprofileCompletionPercentage,\n\t}\n}\n\n// Export singleton instance for global state\nlet instance = null\n\nexport function useGlobalUserProfile() {\n\tif (!instance) {\n\t\tinstance = useUserProfile()\n\t}\n\treturn instance\n}\n","/**\n * Site Council Store (Single-Tenant)\n *\n * Simplified store for single-tenant architecture where Council is a Single DocType.\n * Replaces the complex multi-tenant councilStore.js.\n */\n\nimport { call } from \"frappe-ui\"\nimport { defineStore } from \"pinia\"\n\nexport const useSiteCouncilStore = defineStore(\"siteCouncil\", {\n\tstate: () => ({\n\t\tcouncil: null,\n\t\trequestTypes: [],\n\t\tloading: false,\n\t\terror: null,\n\t\tlastFetched: null, // Cache timestamp\n\t}),\n\n\tgetters: {\n\t\t/**\n\t\t * Get council data (always available since it's a Single DocType)\n\t\t */\n\t\tcouncilData: (state) => state.council,\n\n\t\t/**\n\t\t * Check if council data is loaded\n\t\t */\n\t\tisLoaded: (state) => !!state.council,\n\n\t\t/**\n\t\t * Get available request types for this site's council\n\t\t */\n\t\tavailableRequestTypes: (state) => state.requestTypes,\n\n\t\t/**\n\t\t * Get council branding/theme colors\n\t\t */\n\t\tbranding: (state) => ({\n\t\t\tprimaryColor: state.council?.primary_color || \"#0066CC\",\n\t\t\tsecondaryColor: state.council?.secondary_color || \"#1E40AF\",\n\t\t\tlogo: state.council?.logo,\n\t\t\tcouncilName: state.council?.council_name || \"Council\",\n\t\t}),\n\n\t\t/**\n\t\t * Get meeting configuration\n\t\t */\n\t\tmeetingConfig: (state) => ({\n\t\t\tdefaultDuration: state.council?.default_meeting_duration || 60,\n\t\t\tavailableDurations: state.council?.available_meeting_durations?.split(',').map(d => parseInt(d.trim())) || [30, 60, 90],\n\t\t\tbufferTime: state.council?.meeting_buffer_time || 15,\n\t\t}),\n\t},\n\n\tactions: {\n\t\t/**\n\t\t * Load council data from server\n\t\t * @param {boolean} forceRefresh - Skip cache and fetch fresh data\n\t\t */\n\t\tasync loadCouncil(forceRefresh = false) {\n\t\t\t// Cache for 5 minutes\n\t\t\tconst CACHE_DURATION = 5 * 60 * 1000\n\t\t\tconst now = Date.now()\n\n\t\t\t// Return cached data if available and not expired\n\t\t\tif (!forceRefresh && this.council && this.lastFetched) {\n\t\t\t\tconst cacheAge = now - this.lastFetched\n\t\t\t\tif (cacheAge < CACHE_DURATION) {\n\t\t\t\t\tconsole.log(\"[siteCouncil] Using cached council data\")\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.loading = true\n\t\t\tthis.error = null\n\n\t\t\ttry {\n\t\t\t\tconsole.log(\"[siteCouncil] Fetching council data...\")\n\n\t\t\t\t// Get council data (Single DocType)\n\t\t\t\tthis.council = await call(\"lodgeick.api.get_council\")\n\n\t\t\t\t// Get enabled request types\n\t\t\t\tthis.requestTypes = await call(\"lodgeick.api.get_request_types\")\n\n\t\t\t\tthis.lastFetched = now\n\n\t\t\t\tconsole.log(`[siteCouncil] Loaded: ${this.council.council_name}`)\n\t\t\t\tconsole.log(`[siteCouncil] Request Types: ${this.requestTypes.length}`)\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error(\"[siteCouncil] Failed to load council data:\", err)\n\t\t\t\tthis.error = err.message || \"Failed to load council data\"\n\t\t\t\tthrow err\n\t\t\t} finally {\n\t\t\t\tthis.loading = false\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reload council data (force refresh)\n\t\t */\n\t\tasync reload() {\n\t\t\treturn this.loadCouncil(true)\n\t\t},\n\n\t\t/**\n\t\t * Clear cached data\n\t\t */\n\t\tclearCache() {\n\t\t\tthis.council = null\n\t\t\tthis.requestTypes = []\n\t\t\tthis.lastFetched = null\n\t\t\tconsole.log(\"[siteCouncil] Cache cleared\")\n\t\t},\n\t},\n})\n","import { defineStore } from \"pinia\"\nimport { requestService } from \"../services\"\n\nexport const useRequestStore = defineStore(\"request\", {\n\tpersist: {\n\t\tkey: 'requestStore',\n\t\tstorage: localStorage,\n\t\tpaths: ['currentRequestId', 'formData', 'currentStep', 'requestTypeCode']\n\t},\n\tstate: () => ({\n\t\t// Current request being edited\n\t\tcurrentRequestId: null,\n\t\trequestTypeCode: null,\n\t\trequestTypeConfig: null,\n\n\t\t// Form state\n\t\tformData: {},\n\t\tcurrentStep: 0,\n\n\t\t// Validation\n\t\tstepValidationStatus: {}, // { 0: true, 1: false, ... }\n\n\t\t// UI state\n\t\tisSaving: false,\n\t\tisSubmitting: false,\n\t\tlastSaved: null,\n\n\t\t// Error state\n\t\terror: null,\n\t}),\n\n\tgetters: {\n\t\tisFirstStep: (state) => state.currentStep === 0,\n\n\t\t// === SINGLE-TENANT: Total Steps (matches logic in NewRequest.vue) ===\n\t\ttotalSteps: (state) => {\n\t\t\tif (state.requestTypeConfig?.steps) {\n\t\t\t\t// Single-tenant: Type (0) + Process Info (1) + Dynamic Steps + Review (Last)\n\t\t\t\treturn state.requestTypeConfig.steps.length + 3\n\t\t\t}\n\t\t\treturn 3 // Default: Type, Process Info, Review (no Council step)\n\t\t},\n\t\t// =================================================================\n\n\t\t// === FIXED GETTER: isLastStep ===\n\t\tisLastStep: (state) => {\n\t\t\t// Use the new, correct totalSteps getter\n\t\t\treturn state.currentStep === state.totalSteps - 1\n\t\t},\n\t\t// ================================\n\n\t\tcurrentStepConfig: (state) => {\n\t\t\t// NOTE: This getter still uses the wrong index if totalSteps were used,\n\t\t\t// but the parent component uses its own calculation. Keeping it as-is\n\t\t\t// since it is not currently used by the parent for dynamic steps.\n\t\t\treturn state.requestTypeConfig?.steps?.[state.currentStep]\n\t\t},\n\n\t\tcanNavigateNext: (state) => {\n\t\t\treturn state.stepValidationStatus[state.currentStep] === true\n\t\t},\n\n\t\tcompletionPercentage: (state) => {\n\t\t\tif (state.totalSteps === 0) return 0\n\t\t\treturn Math.round(((state.currentStep + 1) / state.totalSteps) * 100)\n\t\t},\n\n\t\thasUnsavedChanges: (state) => {\n\t\t\t// Check if form data exists and last saved is more than 30 seconds ago\n\t\t\tif (!state.lastSaved) return Object.keys(state.formData).length > 0\n\t\t\tconst now = new Date()\n\t\t\tconst diff = now - state.lastSaved\n\t\t\treturn diff > 30000 // 30 seconds\n\t\t},\n\t},\n\n\tactions: {\n\t\t// ... (initialize, loadDraft, saveProgress, saveDraft, submitRequest actions remain unchanged)\n\n\t\t/**\n\t\t * Navigate to next step with validation\n\t\t */\n\t\tnextStep() {\n\t\t\tconst newStep = this.currentStep + 1\n\t\t\tconst maxStep = this.totalSteps - 1\n\n\t\t\t// Bounds check\n\t\t\tif (newStep > maxStep) {\n\t\t\t\tconsole.error('[Store] Navigation beyond bounds prevented', {\n\t\t\t\t\tcurrentStep: this.currentStep,\n\t\t\t\t\tnewStep,\n\t\t\t\t\tmaxStep\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Config validation for dynamic steps (steps 2 to totalSteps-2)\n\t\t\t// Dynamic steps need configuration from backend\n\t\t\tconst isDynamicStep = newStep >= 2 && newStep < maxStep\n\t\t\tif (isDynamicStep && this.requestTypeConfig?.steps) {\n\t\t\t\t// Calculate actual step index in requestTypeConfig.steps array\n\t\t\t\t// Dynamic steps: step 2 = steps[0], step 3 = steps[1], etc.\n\t\t\t\tconst configIndex = newStep - 2\n\t\t\t\tconst config = this.requestTypeConfig.steps[configIndex]\n\n\t\t\t\tif (!config) {\n\t\t\t\t\tconsole.error('[Store] Missing step config, redirecting to review', {\n\t\t\t\t\t\tcurrentStep: this.currentStep,\n\t\t\t\t\t\tnewStep,\n\t\t\t\t\t\tconfigIndex,\n\t\t\t\t\t\ttotalConfigSteps: this.requestTypeConfig.steps.length\n\t\t\t\t\t})\n\t\t\t\t\t// Jump to final review step instead of showing error\n\t\t\t\t\tthis.currentStep = maxStep\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.currentStep = newStep\n\t\t},\n\n\t\t/**\n\t\t * Navigate to previous step\n\t\t */\n\t\tpreviousStep() {\n\t\t\tif (!this.isFirstStep) {\n\t\t\t\tthis.currentStep--\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Jump to specific step\n\t\t */\n\t\tgoToStep(stepIndex) {\n\t\t\t// Use the correct totalSteps getter\n\t\t\tif (stepIndex >= 0 && stepIndex < this.totalSteps) {\n\t\t\t\tthis.currentStep = stepIndex\n\t\t\t}\n\t\t},\n\t\t// ... (updateField, updateFields, setStepValidation, clearError, reset actions remain unchanged)\n\n\t\t// All the boilerplate logic for initialize, loadDraft, saveProgress, etc. goes here\n\t\t// ...\n\t\tasync initialize(requestTypeCode, draftId = null) {\n\t\t\ttry {\n\t\t\t\tthis.requestTypeCode = requestTypeCode\n\t\t\t\tthis.error = null\n\n\t\t\t\tconsole.log(\"[RequestStore] initialize called:\", {\n\t\t\t\t\trequestTypeCode,\n\t\t\t\t\tdraftId,\n\t\t\t\t})\n\n\t\t\t\t// Load request type config\n\t\t\t\tconst configResource =\n\t\t\t\t\trequestService.getRequestTypeConfig(requestTypeCode)\n\n\t\t\t\t// Wait for config to load\n\t\t\t\tawait new Promise((resolve) => {\n\t\t\t\t\tconst checkLoaded = setInterval(() => {\n\t\t\t\t\t\tif (!configResource.loading) {\n\t\t\t\t\t\t\tclearInterval(checkLoaded)\n\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100)\n\t\t\t\t})\n\n\t\t\t\tthis.requestTypeConfig = configResource.data\n\n\t\t\t\tif (draftId) {\n\t\t\t\t\t// Load existing draft\n\t\t\t\t\tawait this.loadDraft(draftId)\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to initialize request:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to load request type\"\n\t\t\t}\n\t\t},\n\n\t\tasync loadDraft(draftId) {\n\t\t\ttry {\n\t\t\t\tconst resource = requestService.getRequest(draftId)\n\n\t\t\t\t// Wait for load\n\t\t\t\tawait new Promise((resolve) => {\n\t\t\t\t\tconst checkLoaded = setInterval(() => {\n\t\t\t\t\t\tif (!resource.loading) {\n\t\t\t\t\t\t\tclearInterval(checkLoaded)\n\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100)\n\t\t\t\t})\n\n\t\t\t\tconst draft = resource.data\n\t\t\t\tthis.currentRequestId = draftId\n\n\t\t\t\t// Parse the full form data from draft_full_data JSON field\n\t\t\t\tif (draft.draft_full_data) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.formData = JSON.parse(draft.draft_full_data)\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(\"Failed to parse draft_full_data:\", error)\n\t\t\t\t\t\tthis.formData = draft.form_data || {}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.formData = draft.form_data || {}\n\t\t\t\t}\n\n\t\t\t\t// Use draft_current_step from the document (clamp to valid range)\n\t\t\t\tconst draftStep = draft.draft_current_step || 0\n\t\t\t\tconst maxStep = this.totalSteps - 1\n\t\t\t\tthis.currentStep = Math.min(Math.max(0, draftStep), maxStep)\n\n\t\t\t\tif (draftStep !== this.currentStep) {\n\t\t\t\t\tconsole.warn(`[RequestStore] Draft had invalid step ${draftStep}, clamped to ${this.currentStep} (max: ${maxStep})`)\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to load draft:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to load draft\"\n\t\t\t}\n\t\t},\n\n\t\tasync saveProgress() {\n\t\t\t// Prevent concurrent saves\n\t\t\tif (this.isSaving) {\n\t\t\t\tconsole.log(\"[RequestStore] Save already in progress, skipping\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Ensure formData has request_id if store has one\n\t\t\tif (this.currentRequestId && !this.formData.request_id) {\n\t\t\t\tconsole.warn(\"[RequestStore] Syncing request_id to formData\")\n\t\t\t\tthis.formData.request_id = this.currentRequestId\n\t\t\t}\n\n\t\t\tconsole.log(\"[RequestStore] saveProgress called\", {\n\t\t\t\thasRequestId: !!this.currentRequestId,\n\t\t\t\tformDataHasId: !!this.formData.request_id,\n\t\t\t\tcurrentStep: this.currentStep,\n\t\t\t\tisSaving: this.isSaving,\n\t\t\t})\n\n\t\t\tthis.isSaving = true\n\t\t\tthis.error = null\n\n\t\t\ttry {\n\t\t\t\t// Sanitize formData to remove File objects (files need separate upload)\n\t\t\t\tconst sanitizedData = {}\n\t\t\t\tfor (const [key, value] of Object.entries(this.formData)) {\n\t\t\t\t\t// Skip File objects - they should be uploaded separately\n\t\t\t\t\tif (value instanceof File) {\n\t\t\t\t\t\tconsole.warn(`[RequestStore] Skipping File object for key: ${key}`)\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert file arrays to URL strings (Bug #6 fix)\n\t\t\t\t\tif (Array.isArray(value) && value.length > 0) {\n\t\t\t\t\t\t// Check if this is a file upload array (has file_url property)\n\t\t\t\t\t\tconst isFileArray = value.some(item => item && typeof item === 'object' && item.file_url)\n\t\t\t\t\t\tif (isFileArray) {\n\t\t\t\t\t\t\t// Extract the file_url from the first item\n\t\t\t\t\t\t\tconst fileUrl = value[0].file_url\n\t\t\t\t\t\t\tif (fileUrl && typeof fileUrl === 'string') {\n\t\t\t\t\t\t\t\tconsole.log(`[RequestStore] Converting file array to URL string for ${key}:`, fileUrl)\n\t\t\t\t\t\t\t\tsanitizedData[key] = fileUrl\n\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.warn(`[RequestStore] File array for ${key} does not have valid file_url, skipping`)\n\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Skip undefined/null but allow empty strings and false\n\t\t\t\t\tif (value !== undefined && value !== null) {\n\t\t\t\t\t\tsanitizedData[key] = value\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ensure we have some data to send\n\t\t\t\tif (Object.keys(sanitizedData).length === 0 && !this.currentRequestId) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"No form data to save. Please fill in at least one field.\",\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"[RequestStore] Sending sanitized data with\",\n\t\t\t\t\tObject.keys(sanitizedData).length,\n\t\t\t\t\t\"fields\",\n\t\t\t\t)\n\t\t\t\tconsole.log(\"[RequestStore] Sanitized data keys:\", Object.keys(sanitizedData))\n\t\t\t\tconsole.log(\"[RequestStore] Sanitized data:\", JSON.stringify(sanitizedData, null, 2))\n\n\t\t\t\tconst result = await requestService.createDraft(\n\t\t\t\t\tsanitizedData,\n\t\t\t\t\tthis.currentStep,\n\t\t\t\t)\n\n\t\t\t\tif (!this.currentRequestId) {\n\t\t\t\t\tthis.currentRequestId = result.request_id\n\t\t\t\t\t// Ensure subsequent saves include request_id to update existing draft\n\t\t\t\t\tthis.formData.request_id = result.request_id\n\n\t\t\t\t\t// Backup to localStorage\n\t\t\t\t\tlocalStorage.setItem(\"current_draft_id\", result.request_id)\n\t\t\t\t}\n\n\t\t\t\tthis.lastSaved = new Date()\n\n\t\t\t\treturn result // Return for caller\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Save failed:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to save progress\"\n\t\t\t\tthrow error\n\t\t\t} finally {\n\t\t\t\tthis.isSaving = false\n\t\t\t}\n\t\t},\n\n\t\tasync saveDraft() {\n\t\t\treturn this.saveProgress()\n\t\t},\n\n\t\tasync submitRequest() {\n\t\t\tthis.isSubmitting = true\n\t\t\tthis.error = null\n\n\t\t\ttry {\n\t\t\t\t// Save current progress first\n\t\t\t\tif (!this.currentRequestId) {\n\t\t\t\t\tawait this.saveProgress()\n\t\t\t\t}\n\n\t\t\t\t// Submit the request and get result\n\t\t\t\tconst result = await requestService.submitRequest(this.currentRequestId)\n\n\t\t\t\t// Clear state\n\t\t\t\tthis.reset()\n\n\t\t\t\t// Return submission result with SLA info\n\t\t\t\treturn result\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Submit failed:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to submit request\"\n\t\t\t\tthrow error\n\t\t\t} finally {\n\t\t\t\tthis.isSubmitting = false\n\t\t\t}\n\t\t},\n\n\t\tupdateField(fieldName, value) {\n\t\t\tthis.formData[fieldName] = value\n\t\t},\n\n\t\tupdateFields(fields) {\n\t\t\tObject.assign(this.formData, fields)\n\t\t},\n\n\t\tsetStepValidation(stepIndex, isValid) {\n\t\t\tthis.stepValidationStatus[stepIndex] = isValid\n\t\t},\n\n\t\tclearError() {\n\t\t\tthis.error = null\n\t\t},\n\n\t\treset() {\n\t\t\tconsole.log(\"[RequestStore] reset() called - clearing all state\")\n\n\t\t\tthis.currentRequestId = null\n\t\t\tthis.requestTypeCode = null\n\t\t\tthis.requestTypeConfig = null\n\n\t\t\t// Clear formData completely - don't just reassign\n\t\t\tObject.keys(this.formData).forEach((key) => {\n\t\t\t\tdelete this.formData[key]\n\t\t\t})\n\t\t\tthis.formData = {} // Reset to empty object\n\n\t\t\tthis.currentStep = 0\n\t\t\tthis.stepValidationStatus = {}\n\t\t\tthis.isSaving = false\n\t\t\tthis.isSubmitting = false\n\t\t\tthis.lastSaved = null\n\t\t\tthis.error = null\n\n\t\t\t// Clear localStorage backup\n\t\t\tlocalStorage.removeItem(\"current_draft_id\")\n\t\t},\n\t},\n})\n","<script setup>\nimport { computed } from \"vue\"\n\nconst props = defineProps({\n\tcurrentStep: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\ttotalSteps: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\tstepTitles: {\n\t\ttype: Array,\n\t\tdefault: () => [],\n\t},\n})\n\nconst progressPercentage = computed(() => {\n\tif (props.totalSteps === 0) return 0\n\treturn Math.round(((props.currentStep + 1) / props.totalSteps) * 100)\n})\n\nconst getStepStatus = (stepIndex) => {\n\tif (stepIndex < props.currentStep) return \"completed\"\n\tif (stepIndex === props.currentStep) return \"current\"\n\treturn \"upcoming\"\n}\n</script>\n\n<template>\n\t<div class=\"mb-8\">\n\t\t<!-- Progress Bar -->\n\t\t<div class=\"relative mb-6\">\n\t\t\t<div class=\"overflow-hidden h-2 text-xs flex rounded bg-gray-200\">\n\t\t\t\t<div\n\t\t\t\t\t:style=\"{ width: progressPercentage + '%' }\"\n\t\t\t\t\tclass=\"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-600 transition-all duration-500\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"flex justify-between mt-2\">\n\t\t\t\t<span class=\"text-sm font-medium text-gray-700\">\n\t\t\t\t\t{{ stepTitles[currentStep] || `Step ${currentStep + 1}` }}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"text-sm font-medium text-gray-700\">\n\t\t\t\t\t{{ progressPercentage }}% Complete\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Step Indicators (temporarily hidden) -->\n\t\t<!-- <nav aria-label=\"Progress\" v-if=\"stepTitles.length > 0\">\n\t\t\t<ol class=\"flex items-center\">\n\t\t\t\t<li\n\t\t\t\t\tv-for=\"(title, index) in stepTitles\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t'relative',\n\t\t\t\t\t\tindex !== stepTitles.length - 1 ? 'pr-8 sm:pr-20 flex-1' : ''\n\t\t\t\t\t]\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"index !== stepTitles.length - 1\"\n\t\t\t\t\t\tclass=\"absolute inset-0 flex items-center\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'h-0.5 w-full',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'completed' ? 'bg-blue-600' : 'bg-gray-200'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"relative flex items-center group\">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'completed'\n\t\t\t\t\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t\t\t\t\t: getStepStatus(index) === 'current'\n\t\t\t\t\t\t\t\t\t? 'bg-white border-2 border-blue-600 text-blue-600'\n\t\t\t\t\t\t\t\t\t: 'bg-white border-2 border-gray-300 text-gray-500'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-if=\"getStepStatus(index) === 'completed'\">\n\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t{{ index + 1 }}\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if=\"title\"\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'ml-3 text-sm font-medium hidden sm:block',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'current'\n\t\t\t\t\t\t\t\t\t? 'text-blue-600'\n\t\t\t\t\t\t\t\t\t: getStepStatus(index) === 'completed'\n\t\t\t\t\t\t\t\t\t? 'text-gray-900'\n\t\t\t\t\t\t\t\t\t: 'text-gray-500'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t</ol>\n\t\t</nav> -->\n\t</div>\n</template>\n","<script setup>\nimport { Button } from \"frappe-ui\"\n\nconst props = defineProps({\n\tcurrentStep: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\ttotalSteps: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\tisLastStep: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\tcanGoNext: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\tcanSaveDraft: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\tisSaving: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\tisSubmitting: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n})\n\nconst emit = defineEmits([\"next\", \"previous\", \"save-draft\", \"submit\"])\n\nconst handleNext = () => {\n\temit(\"next\")\n}\n\nconst handlePrevious = () => {\n\temit(\"previous\")\n}\n\nconst handleSaveDraft = () => {\n\temit(\"save-draft\")\n}\n\nconst handleSubmit = () => {\n\temit(\"submit\")\n}\n</script>\n\n<template>\n\t<div class=\"mt-8 pt-6 border-t border-gray-200\">\n\t\t<div class=\"flex items-center justify-between\">\n\t\t\t<!-- Previous Button -->\n\t\t\t<div>\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"currentStep > 0\"\n\t\t\t\t\t@click=\"handlePrevious\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t:disabled=\"isSaving || isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\tPrevious\n\t\t\t\t</Button>\n\t\t\t</div>\n\n\t\t\t<!-- Right side buttons -->\n\t\t\t<div class=\"flex items-center space-x-3\">\n\t\t\t\t<!-- Save Draft Button - Only show after council, type, and process info steps -->\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"canSaveDraft\"\n\t\t\t\t\t@click=\"handleSaveDraft\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t:loading=\"isSaving\"\n\t\t\t\t\t:disabled=\"isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"!isSaving\" #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ isSaving ? 'Saving...' : 'Save Draft' }}\n\t\t\t\t</Button>\n\n\t\t\t\t<!-- Next or Submit Button -->\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"!isLastStep\"\n\t\t\t\t\t@click=\"handleNext\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"blue\"\n\t\t\t\t\t:disabled=\"!canGoNext || isSaving || isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\tNext\n\t\t\t\t\t<template #suffix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t</Button>\n\n\t\t\t\t<Button\n\t\t\t\t\tv-else\n\t\t\t\t\t@click=\"handleSubmit\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"green\"\n\t\t\t\t\t:loading=\"isSubmitting\"\n\t\t\t\t\t:disabled=\"!canGoNext || isSaving\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"!isSubmitting\" #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ isSubmitting ? 'Submitting...' : 'Submit Application' }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Help Text -->\n\t\t<div class=\"mt-4 text-center\">\n\t\t\t<p class=\"text-sm text-gray-500\">\n\t\t\t\tYour progress is automatically saved. You can return to complete this application later.\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</template>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Select Application Type</h2>\n    <p class=\"text-gray-600 mb-8\">Choose the type of consent you wish to apply for</p>\n\n    <div v-if=\"requestTypes.loading\" class=\"text-center py-12\">\n      <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n    </div>\n\n    <div v-else class=\"grid md:grid-cols-2 gap-4\">\n      <div\n        v-for=\"type in requestTypes.data\"\n        :key=\"type.name\"\n        @click=\"selectType(type)\"\n        class=\"border-2 rounded-lg p-6 cursor-pointer transition-all hover:shadow-md\"\n        :class=\"modelValue.request_type === type.name ? 'border-blue-600 bg-blue-50' : 'border-gray-200 hover:border-blue-300'\"\n      >\n        <div class=\"flex items-start justify-between\">\n          <div class=\"flex-1\">\n            <h3 class=\"text-lg font-semibold text-gray-900 mb-2\">{{ type.type_name }}</h3>\n            <p class=\"text-sm text-gray-600\" v-html=\"type.description || 'No description available'\"></p>\n            <div class=\"mt-4 flex items-center space-x-4 text-xs text-gray-500\">\n              <span v-if=\"type.base_fee\">Fee: ${{ type.base_fee }}</span>\n              <span v-if=\"type.processing_sla_days\">{{ type.processing_sla_days }} days</span>\n              <span v-if=\"type.category\" class=\"px-2 py-1 bg-gray-100 rounded\">{{ type.category }}</span>\n            </div>\n          </div>\n          <div v-if=\"modelValue.request_type === type.name\" class=\"ml-4\">\n            <div class=\"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center\">\n              <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { defineEmits, defineProps } from \"vue\"\n\nconst props = defineProps({\n\tmodelValue: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\trequestTypes: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n})\n\nconst emit = defineEmits([\"update:modelValue\", \"type-selected\"])\n\nconst selectType = (type) => {\n\tconsole.log(\"[Step2RequestType] selectType called with:\", type.name)\n\tconsole.log(\"[Step2RequestType] props.modelValue:\", props.modelValue)\n\tconsole.log(\n\t\t\"[Step2RequestType] props.modelValue.council:\",\n\t\tprops.modelValue.council,\n\t)\n\n\tconst updatedValue = {\n\t\t...props.modelValue,\n\t\trequest_type: type.name,\n\t}\n\n\tconsole.log(\"[Step2RequestType] Emitting updatedValue:\", updatedValue)\n\temit(\"update:modelValue\", updatedValue)\n\temit(\"type-selected\", type.name)\n}\n</script>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Council Process Information</h2>\n    <p class=\"text-gray-600 mb-6\">Understanding {{ councilName }}'s process for this application</p>\n\n    <div v-if=\"requestTypeDetails\" class=\"space-y-6\">\n\n      <!-- Note: Council Meeting booking has been moved to before the application starts -->\n      <!-- Users can book meetings from the request type selection page -->\n\n      <div class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <div class=\"flex items-start justify-between mb-4\">\n          <div>\n            <h3 class=\"text-xl font-semibold text-gray-900\">{{ requestTypeDetails.request_type_name }}</h3>\n            <p v-if=\"requestTypeDetails.category\" class=\"text-sm text-gray-500 mt-1\">\n              {{ requestTypeDetails.category }}\n            </p>\n          </div>\n        </div>\n\n        <div class=\"grid md:grid-cols-3 gap-4 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Application Fee</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              ${{ requestTypeDetails.base_fee || '0' }}\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Plus any additional costs</div>\n          </div>\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Processing Time</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              {{ requestTypeDetails.sla_days || 'N/A' }} <span class=\"text-base\">days</span>\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Standard timeframe</div>\n          </div>\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Payment Required</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              {{ requestTypeDetails.requires_payment ? 'Yes' : 'No' }}\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Before processing</div>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"requestTypeDetails.process_description\" class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <h4 class=\"text-lg font-semibold text-gray-900 mb-4\">How This Works</h4>\n        <div class=\"prose prose-sm max-w-none text-gray-700\" v-html=\"requestTypeDetails.process_description\"></div>\n      </div>\n\n      <div v-else-if=\"requestTypeDetails.description\" class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <h4 class=\"text-lg font-semibold text-gray-900 mb-4\">About This Application</h4>\n        <div class=\"prose prose-sm max-w-none text-gray-700\" v-html=\"requestTypeDetails.description\"></div>\n      </div>\n\n      <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n        <div class=\"flex items-start\">\n          <svg class=\"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-yellow-900 text-sm\">Before You Continue</h5>\n            <p class=\"text-yellow-800 text-sm mt-1\">\n              Please review this information carefully. Make sure you understand the process, fees, and timeframes before proceeding with your application.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"flex justify-center pt-4\">\n        <button\n          type=\"button\"\n          @click=\"handleContinue\"\n          class=\"px-8 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          I Understand - Continue to Application\n        </button>\n      </div>\n    </div>\n\n    <div v-else class=\"text-center py-12\">\n      <p class=\"text-gray-500\">No request type selected. Please go back and select a request type.</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { session } from \"@/data/session\"\nimport { defineEmits, defineProps } from \"vue\"\nimport { useRouter } from \"vue-router\"\n\nconst router = useRouter()\n\nconst props = defineProps({\n\trequestTypeDetails: {\n\t\ttype: Object,\n\t\tdefault: null,\n\t},\n\tcouncilName: {\n\t\ttype: String,\n\t\tdefault: \"\",\n\t},\n\tmodelValue: {\n\t\ttype: Object,\n\t\tdefault: () => ({}),\n\t},\n})\n\nconst emit = defineEmits([\"continue\", \"update:modelValue\"])\n\nconst handleContinue = () => {\n\t// Check if user is logged in before allowing them to continue\n\tif (!session.isLoggedIn) {\n\t\t// Save current URL to redirect back after login\n\t\tconst currentPath = window.location.pathname + window.location.search\n\t\trouter.push({\n\t\t\tname: \"Login\",\n\t\t\tquery: { redirect: currentPath },\n\t\t})\n\t\treturn\n\t}\n\n\t// User is logged in, proceed normally\n\temit(\"continue\")\n}\n</script>\n","<template>\n  <div class=\"px-4 sm:px-0\">\n    <h2 class=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">Review & Submit</h2>\n    <p class=\"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8\">Review your application details before submitting</p>\n\n    <div class=\"space-y-4 sm:space-y-6\">\n      <!-- Application Summary -->\n      <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4 sm:p-6\">\n        <div class=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-0\">\n          <div>\n            <h3 class=\"text-base sm:text-lg font-semibold text-blue-900\">{{ requestTypeName }}</h3>\n            <p class=\"text-xs sm:text-sm text-blue-700 mt-1\">{{ councilName }}</p>\n          </div>\n          <div class=\"sm:text-right\">\n            <div class=\"text-xs sm:text-sm text-blue-600 font-medium\">Application Fee</div>\n            <div class=\"text-xl sm:text-2xl font-bold text-blue-900\">{{ applicationFee }}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Applicant Details -->\n      <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Applicant Details</h3>\n        </div>\n        <div class=\"p-4 sm:p-6 space-y-3\">\n          <div class=\"grid md:grid-cols-2 gap-4\">\n            <div>\n              <span class=\"text-sm text-gray-500\">Name:</span>\n              <p class=\"font-medium\">{{ modelValue.requester_name || 'Not provided' }}</p>\n            </div>\n            <div>\n              <span class=\"text-sm text-gray-500\">Email:</span>\n              <p class=\"font-medium\">{{ modelValue.requester_email || 'Not provided' }}</p>\n            </div>\n            <div>\n              <span class=\"text-sm text-gray-500\">Phone:</span>\n              <p class=\"font-medium\">{{ modelValue.requester_phone || 'Not provided' }}</p>\n            </div>\n            <div v-if=\"modelValue.applicant_company\">\n              <span class=\"text-sm text-gray-500\">Company:</span>\n              <p class=\"font-medium\">{{ modelValue.applicant_company }}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Property Details (only show if request type has property information) -->\n      <div v-if=\"hasPropertyDetails\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Property Details</h3>\n        </div>\n        <div class=\"p-4 sm:p-6\">\n          <div v-if=\"modelValue.property_address\" class=\"space-y-2\">\n            <div>\n              <span class=\"text-sm text-gray-500\">Address:</span>\n              <p class=\"font-medium\">{{ modelValue.property_address }}</p>\n            </div>\n            <div v-if=\"modelValue.legal_description\">\n              <span class=\"text-sm text-gray-500\">Legal Description:</span>\n              <p class=\"font-medium\">{{ modelValue.legal_description }}</p>\n            </div>\n          </div>\n          <p v-else class=\"text-gray-500\">No property selected</p>\n        </div>\n      </div>\n\n      <!-- Delivery Preference (only show if request type collects payment) -->\n      <div v-if=\"requestTypeDetails?.collect_payment\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Delivery & Payment</h3>\n        </div>\n        <div class=\"p-4 sm:p-6 space-y-3\">\n          <div>\n            <span class=\"text-sm text-gray-500\">Delivery Preference:</span>\n            <p class=\"font-medium\">{{ modelValue.delivery_preference || 'Not selected' }}</p>\n          </div>\n          <div>\n            <span class=\"text-sm text-gray-500\">Invoice To:</span>\n            <p class=\"font-medium\">{{ modelValue.invoice_to || 'Not specified' }}</p>\n          </div>\n        </div>\n      </div>\n\n      <!-- Dynamic Review Sections (for configured request types) -->\n      <template v-if=\"usesConfigurableSteps && reviewSections.length > 0\">\n        <div\n          v-for=\"step in reviewSections\"\n          :key=\"step.step_code\"\n          class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\"\n        >\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">{{ step.step_title }}</h3>\n          </div>\n          <div class=\"p-4 sm:p-6 space-y-4\">\n            <div\n              v-for=\"section in step.sections.filter(s => s.show_on_review)\"\n              :key=\"section.section_code\"\n            >\n              <h4 v-if=\"section.section_title\" class=\"text-sm font-medium text-gray-700 mb-2\">\n                {{ section.section_title }}\n              </h4>\n              <div class=\"grid md:grid-cols-2 gap-4\">\n                <div\n                  v-for=\"field in section.fields.filter(f => f.show_on_review)\"\n                  :key=\"field.field_name\"\n                >\n                  <span class=\"text-sm text-gray-500\">{{ field.review_label || field.field_label }}:</span>\n                  <p class=\"font-medium\">{{ formatFieldValue(field, modelValue[field.field_name]) }}</p>\n                </div>\n              </div>\n            </div>\n            <p v-if=\"!hasReviewContent(step)\" class=\"text-gray-500 text-sm\">\n              No information to display for review\n            </p>\n          </div>\n        </div>\n      </template>\n\n      <!-- Resource Consent Specific Details -->\n      <template v-if=\"isResourceConsent\">\n        <!-- Consent Types -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Consent Types & Activity Status</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-3\">\n              <div>\n                <span class=\"text-sm text-gray-500\">Consent Types:</span>\n                <div class=\"mt-2 flex flex-wrap gap-2\">\n                  <span\n                    v-if=\"modelValue.consent_type_land_use\"\n                    class=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium\"\n                  >\n                    Land Use Consent\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_subdivision\"\n                    class=\"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium\"\n                  >\n                    Subdivision Consent\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_discharge\"\n                    class=\"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium\"\n                  >\n                    Discharge Permit\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_water\"\n                    class=\"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium\"\n                  >\n                    Water Permit\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_coastal\"\n                    class=\"px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-sm font-medium\"\n                  >\n                    Coastal Permit\n                  </span>\n                  <span v-if=\"!hasAnyConsentType\" class=\"text-gray-500\">\n                    None selected\n                  </span>\n                </div>\n              </div>\n              <div>\n                <span class=\"text-sm text-gray-500\">Activity Status:</span>\n                <div class=\"mt-1 inline-flex items-center\">\n                  <span\n                    class=\"px-3 py-1 rounded-full text-sm font-medium\"\n                    :class=\"activityStatusClass\"\n                  >\n                    {{ modelValue.activity_status_type || 'Not specified' }}\n                  </span>\n                </div>\n              </div>\n              <div v-if=\"modelValue.activity_title\">\n                <span class=\"text-sm text-gray-500\">Activity Title:</span>\n                <p class=\"font-medium break-words\">{{ modelValue.activity_title }}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Natural Hazards -->\n        <div v-if=\"hasNaturalHazards\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Natural Hazards</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"flex flex-wrap gap-2\">\n              <span\n                v-if=\"modelValue.hazard_flooding\"\n                class=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707\" />\n                </svg>\n                Flood Hazard\n              </span>\n              <span\n                v-if=\"modelValue.hazard_earthquake\"\n                class=\"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                </svg>\n                Earthquake/Fault Line\n              </span>\n              <span\n                v-if=\"modelValue.hazard_landslip\"\n                class=\"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\n                </svg>\n                Landslip/Slope Instability\n              </span>\n              <span\n                v-if=\"modelValue.hazard_coastal\"\n                class=\"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5\" />\n                </svg>\n                Coastal Hazard\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <!-- Consultation & Affected Parties -->\n        <div v-if=\"hasConsultation\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Consultation & Affected Parties</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-3\">\n              <div>\n                <span class=\"text-sm text-gray-500\">Consultation Undertaken:</span>\n                <p class=\"font-medium\">{{ modelValue.consultation_undertaken || 'Not specified' }}</p>\n              </div>\n              <div v-if=\"modelValue.consultation_summary\">\n                <span class=\"text-sm text-gray-500\">Consultation Summary:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ modelValue.consultation_summary }}</p>\n              </div>\n              <div v-if=\"modelValue.affected_parties_details\">\n                <span class=\"text-sm text-gray-500\">Affected Parties:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ stripHtml(modelValue.affected_parties_details) }}</p>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                <svg\n                  class=\"w-5 h-5\"\n                  :class=\"modelValue.written_approvals_obtained ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span :class=\"modelValue.written_approvals_obtained ? 'text-gray-900' : 'text-gray-500'\">\n                  Written Approvals {{ modelValue.written_approvals_obtained ? 'Obtained' : 'Not Obtained' }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- AEE Summary -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Assessment of Environmental Effects</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-4\">\n              <div v-if=\"modelValue.activity_description\">\n                <span class=\"text-sm text-gray-500\">Activity Description:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.activity_description\"></div>\n              </div>\n              <div v-if=\"modelValue.aee_full_assessment\">\n                <span class=\"text-sm text-gray-500\">Full Assessment:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.aee_full_assessment\"></div>\n              </div>\n              <div v-if=\"modelValue.positive_effects_description\">\n                <span class=\"text-sm text-gray-500\">Positive Effects:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ modelValue.positive_effects_description }}</p>\n              </div>\n              <div v-if=\"modelValue.effects_visual_amenity || modelValue.effects_traffic_parking || modelValue.effects_noise\">\n                <span class=\"text-sm text-gray-500\">Adverse Effects Summary:</span>\n                <ul class=\"text-sm mt-1 space-y-1 list-disc list-inside\">\n                  <li v-if=\"modelValue.effects_visual_amenity\">Visual/Amenity: {{ truncate(modelValue.effects_visual_amenity, 50) }}</li>\n                  <li v-if=\"modelValue.effects_traffic_parking\">Traffic/Parking: {{ truncate(modelValue.effects_traffic_parking, 50) }}</li>\n                  <li v-if=\"modelValue.effects_noise\">Noise: {{ truncate(modelValue.effects_noise, 50) }}</li>\n                </ul>\n              </div>\n              <div v-if=\"modelValue.mitigation_measures\">\n                <span class=\"text-sm text-gray-500\">Mitigation Measures:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.mitigation_measures\"></div>\n              </div>\n              <p v-if=\"!hasAEEContent\" class=\"text-gray-500 text-sm\">\n                AEE not yet completed\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Statutory Declarations -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Statutory Declarations</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-2\">\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_accuracy || modelValue.declaration_rma_compliance) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_accuracy || modelValue.declaration_rma_compliance) ? 'text-gray-900' : 'text-gray-500'\">\n                  Declaration of Accuracy & RMA Compliance\n                </span>\n              </div>\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_authority || modelValue.declaration_authorized) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_authority || modelValue.declaration_authorized) ? 'text-gray-900' : 'text-gray-500'\">\n                  Declaration of Authority to Apply\n                </span>\n              </div>\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_acknowledgment || modelValue.declaration_public_information) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_acknowledgment || modelValue.declaration_public_information) ? 'text-gray-900' : 'text-gray-500'\">\n                  Public Information & Privacy Acknowledgment\n                </span>\n              </div>\n              <div v-if=\"modelValue.requester_signature\" class=\"mt-4 pt-4 border-t border-gray-200\">\n                <span class=\"text-sm text-gray-500\">Signed by:</span>\n                <p class=\"font-medium\">{{ modelValue.requester_signature }}</p>\n                <p v-if=\"modelValue.signature_date\" class=\"text-sm text-gray-500\">\n                  Date: {{ formatSignatureDate(modelValue.signature_date) }}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </template>\n\n      <!-- Important Notice -->\n      <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 sm:p-6\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 sm:w-6 sm:h-6 text-yellow-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h4 class=\"font-semibold text-yellow-900 text-sm sm:text-base\">Before You Submit</h4>\n            <ul class=\"mt-2 text-xs sm:text-sm text-yellow-800 space-y-1 list-disc list-inside\">\n              <li>Review all information carefully for accuracy and completeness</li>\n              <li>Ensure all required fields are completed</li>\n              <li>For Resource Consent applications, verify all statutory declarations are confirmed</li>\n              <li>Once submitted, you cannot edit the application (you may need to withdraw and resubmit)</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <!-- Completeness Check -->\n      <div v-if=\"!isComplete\" class=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-red-900 text-xs sm:text-sm\">Application Incomplete</h5>\n            <p class=\"text-red-800 text-xs sm:text-sm mt-1\">\n              Please complete all required sections before submitting. Use the Previous button to go back and fill in missing information.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { computed, defineProps } from \"vue\"\n\nconst props = defineProps({\n\tmodelValue: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\tcouncilName: {\n\t\ttype: String,\n\t\tdefault: \"Council\",\n\t},\n\trequestTypeName: {\n\t\ttype: String,\n\t\tdefault: \"Application\",\n\t},\n\tapplicationFee: {\n\t\ttype: String,\n\t\tdefault: \"TBD\",\n\t},\n\tisResourceConsent: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\tstepConfigs: {\n\t\ttype: Array,\n\t\tdefault: () => [],\n\t},\n\tusesConfigurableSteps: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\trequestTypeDetails: {\n\t\ttype: Object,\n\t\tdefault: null,\n\t},\n})\n\n// Filter steps that should show on review\nconst reviewSections = computed(() => {\n\tif (!props.usesConfigurableSteps || !props.stepConfigs) {\n\t\treturn []\n\t}\n\n\treturn props.stepConfigs.filter((step) => step.show_on_review)\n})\n\n// Check if property details should be displayed\nconst hasPropertyDetails = computed(() => {\n\t// Always show for resource consent\n\tif (props.isResourceConsent) {\n\t\treturn true\n\t}\n\n\t// Check if property data actually exists in the request\n\treturn !!(props.modelValue.property || props.modelValue.property_address)\n})\n\n// Check if a step has any content to show on review\nconst hasReviewContent = (step) => {\n\tif (!step.sections) return false\n\n\tfor (const section of step.sections) {\n\t\tif (!section.show_on_review) continue\n\n\t\tfor (const field of section.fields) {\n\t\t\tif (field.show_on_review && props.modelValue[field.field_name]) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false\n}\n\n// Format field value for display\nconst formatFieldValue = (field, value) => {\n\tif (value === undefined || value === null || value === \"\") {\n\t\treturn \"Not provided\"\n\t}\n\n\t// Check field type\n\tif (field.field_type === \"Check\") {\n\t\treturn value ? \"Yes\" : \"No\"\n\t}\n\n\tif (field.field_type === \"Date\" && value) {\n\t\t// Format date nicely\n\t\ttry {\n\t\t\treturn new Date(value).toLocaleDateString(\"en-NZ\", {\n\t\t\t\tyear: \"numeric\",\n\t\t\t\tmonth: \"long\",\n\t\t\t\tday: \"numeric\",\n\t\t\t})\n\t\t} catch (e) {\n\t\t\treturn value\n\t\t}\n\t}\n\n\tif (field.field_type === \"Currency\" && value) {\n\t\treturn `${Number(value).toLocaleString(\"en-PH\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`\n\t}\n\n\tif (field.field_type === \"Select\") {\n\t\treturn value\n\t}\n\n\tif (field.field_type === \"Attach\" || field.field_type === \"Attach Image\") {\n\t\treturn value ? \" File attached\" : \"Not provided\"\n\t}\n\n\treturn value\n}\n\n// RC-specific computed properties\nconst hasAnyConsentType = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.consent_type_land_use ||\n\t\tprops.modelValue.consent_type_subdivision ||\n\t\tprops.modelValue.consent_type_discharge ||\n\t\tprops.modelValue.consent_type_water ||\n\t\tprops.modelValue.consent_type_coastal\n\t)\n})\n\nconst activityStatusClass = computed(() => {\n\tconst status = props.modelValue.activity_status_type\n\tif (status === \"Permitted\") return \"bg-green-100 text-green-800\"\n\tif (status === \"Controlled\") return \"bg-blue-100 text-blue-800\"\n\tif (status === \"Restricted Discretionary\")\n\t\treturn \"bg-yellow-100 text-yellow-800\"\n\tif (status === \"Discretionary\") return \"bg-orange-100 text-orange-800\"\n\tif (status === \"Non-Complying\") return \"bg-red-100 text-red-800\"\n\tif (status === \"Prohibited\") return \"bg-gray-800 text-white\"\n\treturn \"bg-gray-100 text-gray-800\"\n})\n\nconst hasNaturalHazards = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.hazard_flooding ||\n\t\tprops.modelValue.hazard_earthquake ||\n\t\tprops.modelValue.hazard_landslip ||\n\t\tprops.modelValue.hazard_coastal\n\t)\n})\n\nconst hasConsultation = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.consultation_undertaken ||\n\t\tprops.modelValue.consultation_summary ||\n\t\tprops.modelValue.affected_parties_details ||\n\t\tprops.modelValue.written_approvals_obtained\n\t)\n})\n\nconst hasAEEContent = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.activity_description ||\n\t\tprops.modelValue.aee_full_assessment ||\n\t\tprops.modelValue.positive_effects_description ||\n\t\tprops.modelValue.effects_visual_amenity ||\n\t\tprops.modelValue.effects_traffic_parking ||\n\t\tprops.modelValue.effects_noise ||\n\t\tprops.modelValue.mitigation_measures ||\n\t\t// Legacy fields\n\t\tprops.modelValue.aee_activity_description ||\n\t\tprops.modelValue.aee_existing_environment ||\n\t\tprops.modelValue.assessment_of_effects ||\n\t\tprops.modelValue.aee_document\n\t)\n})\n\n// Helper functions\nconst stripHtml = (html) => {\n\tif (!html) return \"\"\n\tconst tmp = document.createElement(\"div\")\n\ttmp.innerHTML = html\n\treturn tmp.textContent || tmp.innerText || \"\"\n}\n\nconst truncate = (text, maxLength) => {\n\tif (!text) return \"\"\n\tconst clean = stripHtml(text)\n\tif (clean.length <= maxLength) return clean\n\treturn clean.substring(0, maxLength) + \"...\"\n}\n\nconst formatSignatureDate = (dateStr) => {\n\tif (!dateStr) return \"\"\n\ttry {\n\t\treturn new Date(dateStr).toLocaleDateString(\"en-NZ\", {\n\t\t\tyear: \"numeric\",\n\t\t\tmonth: \"long\",\n\t\t\tday: \"numeric\",\n\t\t})\n\t} catch (e) {\n\t\treturn dateStr\n\t}\n}\n\nconst isComplete = computed(() => {\n\t// Basic required fields\n\tconst hasBasicInfo = !!(\n\t\tprops.modelValue.council &&\n\t\tprops.modelValue.request_type &&\n\t\tprops.modelValue.requester_name &&\n\t\tprops.modelValue.requester_email &&\n\t\tprops.modelValue.property_address &&\n\t\tprops.modelValue.delivery_preference\n\t)\n\n\t// If RC, check additional requirements\n\tif (props.isResourceConsent) {\n\t\tconst hasRCRequirements = !!(\n\t\t\thasAnyConsentType.value &&\n\t\t\tprops.modelValue.activity_status_type &&\n\t\t\tprops.modelValue.activity_description &&\n\t\t\tprops.modelValue.aee_full_assessment &&\n\t\t\tprops.modelValue.declaration_accuracy &&\n\t\t\tprops.modelValue.declaration_authority &&\n\t\t\tprops.modelValue.declaration_acknowledgment\n\t\t)\n\t\treturn hasBasicInfo && hasRCRequirements\n\t}\n\n\treturn hasBasicInfo\n})\n</script>\n\n<style scoped>\n.line-clamp-3 {\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n</style>\n","<template>\n    <div class=\"min-h-screen bg-gray-50\">\n        <RequestHeader title=\"New Application\" @back=\"goBack\">\n            <template #actions>\n                <Button\n                    v-if=\"canSaveDraft\"\n                    @click=\"handleSaveDraft\"\n                    variant=\"outline\"\n                    theme=\"gray\"\n                    :loading=\"store.isSaving\"\n                >\n                    Save Draft\n                </Button>\n                <Button\n                    v-if=\"canSaveDraft\"\n                    @click=\"handleSaveAndClose\"\n                    variant=\"outline\"\n                    theme=\"gray\"\n                    :loading=\"store.isSaving\"\n                >\n                    Save and Close\n                </Button>\n            </template>\n        </RequestHeader>\n\n        <div class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n                <RequestProgress\n                    :current-step=\"store.currentStep\"\n                    :total-steps=\"totalSteps\"\n                    :step-titles=\"stepTitles\"\n                />\n            </div>\n        </div>\n\n        <main class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-8\">\n                <!-- Skip Council step in single-tenant mode -->\n                <div v-if=\"getCurrentStepTitle() === 'Type'\">\n                    <Step2RequestType\n                        v-model=\"store.formData\"\n                        :request-types=\"requestTypes\"\n                        @type-selected=\"selectRequestType\"\n                    />\n                </div>\n\n                <div v-else-if=\"getCurrentStepTitle() === 'Process Info'\">\n                    <Step3ProcessInfo\n                        :request-type-details=\"selectedRequestTypeDetails\"\n                        :council-name=\"getCouncilName()\"\n                        v-model=\"store.formData\"\n                        @continue=\"handleNext\"\n                    />\n                </div>\n\n                <!-- Review step: Show when at or beyond last step (defensive check for out-of-bounds) -->\n                <div v-else-if=\"store.currentStep >= totalSteps - 1\">\n                    <ReviewStep\n                        v-model=\"store.formData\"\n                        :request-type-config=\"store.requestTypeConfig\"\n                    />\n                </div>\n\n                <DynamicStepRenderer\n                    v-else-if=\"usesConfigurableSteps && getCurrentStepConfig()\"\n                    :stepConfig=\"getCurrentStepConfig()\"\n                    v-model=\"store.formData\"\n                />\n\n                <div v-else class=\"text-center py-12\">\n                    <div class=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-100 mb-4\">\n                        <svg class=\"h-8 w-8 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                        </svg>\n                    </div>\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-2\">Unable to Load This Step</h3>\n                    <p class=\"text-sm text-gray-600 mb-6\">\n                        We're having trouble loading this step. Please try refreshing or go back to continue your application.\n                    </p>\n                    <div class=\"flex gap-3 justify-center\">\n                        <button\n                            @click=\"location.reload()\"\n                            class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n                        >\n                            Refresh Page\n                        </button>\n                        <button\n                            @click=\"handlePrevious\"\n                            class=\"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition\"\n                        >\n                            Go Back\n                        </button>\n                        <button\n                            @click=\"router.push('/dashboard')\"\n                            class=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition\"\n                        >\n                            Return to Dashboard\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Council Meeting Banner (shown after Process Info step) -->\n            <div\n                v-if=\"shouldShowMeetingBanner\"\n                class=\"mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 shadow-sm\"\n            >\n                <div class=\"flex items-start justify-between\">\n                    <div class=\"flex-1\">\n                        <div class=\"flex items-center gap-2 mb-2\">\n                            <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                            </svg>\n                            <h3 class=\"text-lg font-semibold text-gray-900\">Council Meeting Available</h3>\n                        </div>\n                        <p class=\"text-sm text-gray-700 mb-3\">\n                            Schedule a meeting with council planners to discuss your application before submitting.\n                            This optional step can help clarify requirements and improve your application.\n                        </p>\n                        <button\n                            @click=\"handleBookMeeting\"\n                            class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\n                        >\n                            Request Council Meeting\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <StepNavigation\n                :current-step=\"store.currentStep\"\n                :total-steps=\"totalSteps\"\n                :is-last-step=\"store.isLastStep\"\n                :can-go-next=\"canNavigateNext\"\n                :can-save-draft=\"canSaveDraft\"\n                :is-saving=\"store.isSaving\"\n                :is-submitting=\"store.isSubmitting\"\n                @next=\"handleNext\"\n                @previous=\"handlePrevious\"\n                @save-draft=\"handleSaveDraft\"\n                @submit=\"handleSubmit\"\n            />\n        </main>\n\n        <SaveDraftModal\n            v-model:show=\"showSaveDraftModal\"\n            :draft-id=\"store.currentRequestId\"\n        />\n\n        <ValidationErrorModal\n            v-model:show=\"showValidationModal\"\n            :errors=\"validationErrors\"\n        />\n\n        <BookMeetingModal\n            v-model:show=\"showMeetingModal\"\n            :request-id=\"store.currentRequestId\"\n            :request-type-code=\"store.formData.request_type\"\n            :council-code=\"store.formData.council\"\n            @booked=\"handleMeetingBooked\"\n        />\n\n        <SubmissionSuccessModal\n            :open=\"showSubmissionSuccessModal\"\n            :request-number=\"submissionResult?.request_number\"\n            :request-id=\"submissionResult?.request_id\"\n            :sla-info=\"submissionResult?.sla_info\"\n            @close=\"showSubmissionSuccessModal = false\"\n            @view-request=\"handleViewRequestFromModal\"\n            @go-to-dashboard=\"handleGoToDashboardFromModal\"\n        />\n    </div>\n</template>\n\n<script setup>\nimport { Button } from \"frappe-ui\"\nimport { computed, defineAsyncComponent, onMounted, ref, watch } from \"vue\"\nimport { onBeforeRouteLeave, useRoute, useRouter } from \"vue-router\"\n\nimport { useStepValidation } from \"../composables/useStepValidation\"\nimport { useUserProfile } from \"../composables/useUserProfile\"\nimport { useSiteCouncilStore } from \"../stores/siteCouncil\"\n// Store and composables\nimport { useRequestStore } from \"../stores/requestStore\"\n\n// Components\nimport RequestHeader from \"../components/request/RequestHeader.vue\"\nimport RequestProgress from \"../components/request/RequestProgress.vue\"\nimport StepNavigation from \"../components/request/StepNavigation.vue\"\n// Lazy-loaded modals (load on demand to reduce bundle size)\nconst SaveDraftModal = defineAsyncComponent(\n\t() => import(\"../components/modals/SaveDraftModal.vue\"),\n)\nconst ValidationErrorModal = defineAsyncComponent(\n\t() => import(\"../components/modals/ValidationErrorModal.vue\"),\n)\nconst BookMeetingModal = defineAsyncComponent(\n\t() => import(\"../components/modals/BookMeetingModal.vue\"),\n)\nconst SubmissionSuccessModal = defineAsyncComponent(\n\t() => import(\"../components/modals/SubmissionSuccessModal.vue\"),\n)\n\n// Step components\nimport Step2RequestType from \"../components/request-steps/Step2RequestType.vue\"\nimport Step3ProcessInfo from \"../components/request-steps/Step3ProcessInfo.vue\"\n// Lazy-load DynamicStepRenderer (large component with complex logic)\nconst DynamicStepRenderer = defineAsyncComponent(\n\t() => import(\"../components/DynamicStepRenderer.vue\"),\n)\nimport ReviewStep from \"../components/request-steps/ReviewStep.vue\"\n\nconst route = useRoute()\nconst router = useRouter()\n\n// Stores\nconst store = useRequestStore()\nconst councilStore = useSiteCouncilStore()\n\n// Validation\nconst { errors: validationErrors, validateStep } = useStepValidation()\n\n// UI state\nconst showSaveDraftModal = ref(false)\nconst showValidationModal = ref(false)\nconst showMeetingModal = ref(false)\nconst showSubmissionSuccessModal = ref(false)\nconst submissionResult = ref(null)\nconst requestTypes = ref({ loading: false, data: [] })\nconst selectedRequestTypeDetails = ref(null)\n\n// Computed\nconst totalSteps = computed(() => {\n\tif (store.requestTypeConfig?.steps) {\n\t\t// Single-tenant: Type (0) + Process Info (1) + Dynamic Steps + Review (Last)\n\t\treturn store.requestTypeConfig.steps.length + 3\n\t}\n\treturn 3 // Default: Type, Process Info, Review (no Council step)\n})\n\nconst stepTitles = computed(() => {\n\t// Single-tenant: Skip \"Council\" step\n\tconst titles = [\"Type\", \"Process Info\"]\n\tif (store.requestTypeConfig?.steps) {\n\t\ttitles.push(...store.requestTypeConfig.steps.map((s) => s.step_title))\n\t}\n\ttitles.push(\"Review\") // Always add Review as the last step\n\treturn titles\n})\n\nconst usesConfigurableSteps = computed(() => {\n\treturn (\n\t\tstore.requestTypeConfig?.steps && store.requestTypeConfig.steps.length > 0\n\t)\n})\n\nconst canNavigateNext = computed(() => {\n\t// Always allow navigation for now (validation happens on attempt)\n\treturn true\n})\n\n/**\n * Can only save draft after:\n * - Step 0: Request type selected\n * - Step 1: Process info read and confirmed\n * So allow saving from step 2 onwards (step index >= 2) - single-tenant\n */\nconst canSaveDraft = computed(() => {\n\treturn store.currentStep >= 2\n})\n\n// Get configuration for current step (for dynamic validation)\nconst currentStepConfig = computed(() => {\n\tif (!store.requestTypeConfig?.steps) return null\n\n\t// Single-tenant: Steps 0-1 are fixed (Type, Process Info)\n\t// Dynamic steps start at index 2\n\tconst dynamicStepIndex = store.currentStep - 2\n\n\tif (\n\t\tdynamicStepIndex >= 0 &&\n\t\tdynamicStepIndex < store.requestTypeConfig.steps.length\n\t) {\n\t\treturn store.requestTypeConfig.steps[dynamicStepIndex]\n\t}\n\n\treturn null\n})\n\n// Show meeting banner after Process Info (step 3) if council meetings are available\nconst shouldShowMeetingBanner = computed(() => {\n\treturn (\n\t\tstore.currentStep > 1 && // After Process Info step (single-tenant: step 1)\n\t\tstore.currentStep < totalSteps.value - 1 && // Before Review step\n\t\tstore.requestTypeConfig?.council_meeting_available === 1\n\t)\n})\n\n// Methods\nfunction handleBookMeeting() {\n\tshowMeetingModal.value = true\n}\n\nfunction handleMeetingBooked(meetingData) {\n\tconsole.log(\"Meeting booked:\", meetingData)\n\t// Optionally show a success message or refresh data\n}\n\nfunction getCurrentStepTitle() {\n\tconst index = store.currentStep\n\tif (index >= 0 && index < stepTitles.value.length) {\n\t\treturn stepTitles.value[index]\n\t}\n\treturn \"\"\n}\n\nfunction getCurrentStepConfig() {\n\tconst index = store.currentStep\n\tconst dynamicStepsStart = 2 // Single-tenant: 0=Type, 1=Process Info, 2+=Dynamic\n\n\t// Check if the current step is within the dynamic steps range (2 up to totalSteps - 2)\n\t// totalSteps - 1 is the Review step index.\n\tif (index < dynamicStepsStart || index >= totalSteps.value - 1) {\n\t\treturn null\n\t}\n\n\tif (store.requestTypeConfig?.steps) {\n\t\tconst stepIndex = index - dynamicStepsStart\n\n\t\tif (stepIndex >= 0 && stepIndex < store.requestTypeConfig.steps.length) {\n\t\t\treturn store.requestTypeConfig.steps[stepIndex]\n\t\t}\n\t}\n\n\treturn null\n}\n\nfunction getCouncilName() {\n\t// Single-tenant: always return the one council's name\n\treturn councilStore.councilData?.council_name || \"Council\"\n}\n\nasync function loadRequestTypes() {\n\t// Single-tenant: load request types for the site's council\n\trequestTypes.value.loading = true\n\tawait councilStore.loadCouncil()\n\trequestTypes.value = {\n\t\tloading: false,\n\t\tdata: councilStore.availableRequestTypes || [],\n\t}\n}\n\nasync function selectRequestType(requestTypeCode) {\n\t// Store request type in formData (required for draft creation)\n\tstore.updateField(\"request_type\", requestTypeCode)\n\n\t// Load request type configuration\n\tawait store.initialize(requestTypeCode)\n\tselectedRequestTypeDetails.value = store.requestTypeConfig\n\n\t// Validate config loaded\n\tif (!store.requestTypeConfig) {\n\t\tconsole.error(\"[NewRequest] Failed to load request type config\")\n\t\treturn\n\t}\n}\n\nasync function handleNext() {\n\t// Single-tenant: Step 0 is Request Type Selection (no council step)\n\tif (store.currentStep === 0 && !store.formData.request_type) {\n\t\talert(\"Please select a request type before continuing.\")\n\t\treturn\n\t}\n\n\t// Validate current step before allowing navigation (for dynamic steps)\n\tif (\n\t\tstore.currentStep >= 1 &&\n\t\tusesConfigurableSteps.value &&\n\t\tcurrentStepConfig.value\n\t) {\n\t\tconst isValid = await validateStep(currentStepConfig.value, store.formData)\n\n\t\tif (!isValid) {\n\t\t\tconsole.error(\"[NewRequest] Validation failed:\", validationErrors.value)\n\t\t\tshowValidationModal.value = true\n\t\t\treturn // Block navigation\n\t\t}\n\t}\n\n\t// Auto-save after Process Info step (step 1 in single-tenant) to create draft\n\t// This ensures the request has an ID for features like \"Book Meeting\" and \"Send Message\"\n\tif (store.currentStep === 1 && !store.currentRequestId) {\n\t\tconsole.log(\"[NewRequest] Auto-saving draft after Process Info step...\")\n\t\tconsole.log(\"[NewRequest] requestTypeConfig:\", store.requestTypeConfig)\n\t\tconsole.log(\n\t\t\t\"[NewRequest] usesConfigurableSteps:\",\n\t\t\tusesConfigurableSteps.value,\n\t\t)\n\t\tconsole.log(\"[NewRequest] config steps:\", store.requestTypeConfig?.steps)\n\n\t\tawait store.saveDraft()\n\t\tconsole.log(\"[NewRequest] Draft saved with ID:\", store.currentRequestId)\n\n\t\t// Only redirect if there are NO dynamic steps configured\n\t\t// If there are dynamic steps, user needs to fill them out first\n\t\tif (!usesConfigurableSteps.value) {\n\t\t\t// No dynamic steps - redirect to detail page\n\t\t\tif (store.currentRequestId) {\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"[NewRequest] No dynamic steps configured, redirecting to detail page...\",\n\t\t\t\t)\n\t\t\t\trouter.push(`/request/${store.currentRequestId}`)\n\t\t\t\treturn // Don't call nextStep, the redirect will handle navigation\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(\n\t\t\t\t\"[NewRequest] Dynamic steps configured, continuing to next step...\",\n\t\t\t)\n\t\t}\n\t}\n\n\t// Auto-save existing drafts before navigation\n\tif (store.currentRequestId) {\n\t\tawait store.saveProgress()\n\t}\n\n\t// Don't advance beyond the last step (Review step should use Submit button)\n\tif (store.currentStep < totalSteps.value - 1) {\n\t\tstore.nextStep()\n\t}\n}\n\nfunction handlePrevious() {\n\tstore.previousStep()\n}\n\nasync function handleSaveDraft() {\n\ttry {\n\t\tawait store.saveDraft()\n\t\t// Redirect to request detail page to show Send Message and Book Meeting buttons\n\t\tif (store.currentRequestId) {\n\t\t\trouter.push(`/request/${store.currentRequestId}`)\n\t\t} else {\n\t\t\tshowSaveDraftModal.value = true\n\t\t}\n\t} catch (error) {\n\t\tconsole.error(\"Failed to save draft:\", error)\n\t}\n}\n\nasync function handleSaveAndClose() {\n\ttry {\n\t\tawait store.saveDraft()\n\t\tstore.reset() // Clear state after successful save\n\t\t// Redirect to dashboard\n\t\trouter.push({ name: \"Dashboard\" })\n\t} catch (error) {\n\t\tconsole.error(\"Failed to save draft:\", error)\n\t\t// Don't reset on error - preserve state for retry\n\t}\n}\n\nasync function handleSubmit() {\n\t// Validation logic (omitted for brevity)\n\n\ttry {\n\t\tconst result = await store.submitRequest()\n\n\t\t// Store submission result for modal\n\t\tsubmissionResult.value = result\n\n\t\t// Show success modal with SLA info\n\t\tshowSubmissionSuccessModal.value = true\n\t} catch (error) {\n\t\tconsole.error(\"Failed to submit request:\", error)\n\t}\n}\n\nfunction goBack() {\n\tstore.reset() // Clear all state before navigation\n\trouter.push(\"/dashboard\")\n}\n\n/**\n * Handle view request from success modal\n */\nfunction handleViewRequestFromModal(requestId) {\n\tshowSubmissionSuccessModal.value = false\n\trouter.push(`/request/${requestId}`)\n}\n\n/**\n * Handle go to dashboard from success modal\n */\nfunction handleGoToDashboardFromModal() {\n\tshowSubmissionSuccessModal.value = false\n\t// Redirect to council-specific dashboard if available\n\tconst councilCode = store.formData.council\n\tif (councilCode) {\n\t\trouter.push(`/council/${councilCode}/dashboard`)\n\t} else {\n\t\trouter.push(\"/dashboard\")\n\t}\n}\n\n// Watch block for step changes\nwatch(\n\t() => store.currentStep,\n\t() => {\n\t\t// Step changed - trigger reactivity\n\t},\n\t{ immediate: true },\n)\n\n// Watch birth_date for age calculation (SPISC applications)\nwatch(\n\t() => store.formData.birth_date,\n\t(newDate) => {\n\t\tif (newDate && store.formData.request_type?.includes(\"SPISC\")) {\n\t\t\t// Calculate age\n\t\t\tconst today = new Date()\n\t\t\tconst born = new Date(newDate)\n\t\t\tlet age = today.getFullYear() - born.getFullYear()\n\t\t\tconst m = today.getMonth() - born.getMonth()\n\t\t\tif (m < 0 || (m === 0 && today.getDate() < born.getDate())) {\n\t\t\t\tage--\n\t\t\t}\n\n\t\t\t// Update age in form data\n\t\t\tstore.updateField(\"age\", age)\n\n\t\t\t// Validate minimum age for SPISC (60 years)\n\t\t\tif (age < 60) {\n\t\t\t\tvalidationErrors.value[\"birth_date\"] =\n\t\t\t\t\t\"Applicant must be 60 years or older for SPISC\"\n\t\t\t} else {\n\t\t\t\t// Clear birth_date validation errors if age is valid\n\t\t\t\tdelete validationErrors.value[\"birth_date\"]\n\t\t\t}\n\t\t}\n\t},\n)\n\n// Initialize\nonMounted(async () => {\n\tconst requestTypeCode = route.query.type\n\tconst draftId = route.query.draft\n\n\tconsole.log(\n\t\t\"[NewRequest] Initialization - type:\",\n\t\trequestTypeCode,\n\t\t\"draft:\",\n\t\tdraftId,\n\t)\n\n\t// If starting fresh request (no draft ID), ensure clean state\n\tif (!draftId && !route.query.draft) {\n\t\tstore.reset() // Clear any lingering state\n\t}\n\n\t// Auto-fill user profile data for new requests (not drafts)\n\tif (!draftId) {\n\t\tconst { getApplicationAutoFill, applyAutoFill } = useUserProfile()\n\t\ttry {\n\t\t\tawait getApplicationAutoFill()\n\t\t\tapplyAutoFill(store.formData, {\n\t\t\t\toverrideExisting: false, // Don't overwrite user input\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.warn(\n\t\t\t\t\"[NewRequest] Failed to load user profile for auto-fill:\",\n\t\t\t\terror,\n\t\t\t)\n\t\t}\n\t}\n\n\t// Handle draft loading (this takes precedence)\n\tif (draftId && requestTypeCode) {\n\t\tawait store.initialize(requestTypeCode, draftId)\n\t\tselectedRequestTypeDetails.value = store.requestTypeConfig\n\t\t// Draft loading sets the step automatically, so return early\n\t\treturn\n\t}\n\n\t// Single-tenant: Load council and request types once\n\tawait loadRequestTypes()\n\n\t// Handle request type pre-selection from URL\n\tif (requestTypeCode && !draftId) {\n\t\tconsole.log(\"[NewRequest] Request type provided in URL:\", requestTypeCode)\n\n\t\t// Initialize request type config\n\t\tawait store.initialize(requestTypeCode)\n\t\tselectedRequestTypeDetails.value = store.requestTypeConfig\n\t\tstore.updateField(\"request_type\", requestTypeCode)\n\n\t\t// Skip directly to step 1 (Process Info) since we don't have Council step\n\t\tstore.currentStep = 1\n\t\tconsole.log(\"[NewRequest] Advanced to step 1 (Process Info)\")\n\t}\n})\n\n// Navigation guard - warn about unsaved changes\nonBeforeRouteLeave((to, from, next) => {\n\t// Allow navigation if submitting or no draft exists\n\tif (store.isSubmitting || !store.currentRequestId) {\n\t\tstore.reset() // Clear state when leaving without draft\n\t\tnext()\n\t\treturn\n\t}\n\n\t// Check if there are unsaved changes\n\tconst hasChanges =\n\t\tstore.formData &&\n\t\tObject.keys(store.formData).some(\n\t\t\t(key) =>\n\t\t\t\tstore.formData[key] !== undefined &&\n\t\t\t\tstore.formData[key] !== null &&\n\t\t\t\tstore.formData[key] !== \"\",\n\t\t)\n\n\tif (\n\t\thasChanges &&\n\t\t!confirm(\"You have unsaved changes. Do you want to leave without saving?\")\n\t) {\n\t\tnext(false) // Cancel navigation\n\t} else {\n\t\t// User confirmed or no unsaved changes\n\t\tif (!to.path.includes(\"/request/\")) {\n\t\t\tstore.reset() // Clear state when navigating away from requests\n\t\t}\n\t\tnext() // Allow navigation\n\t}\n})\n</script>"],"file":"assets/NewRequest-Bsp6aWRF.js"}