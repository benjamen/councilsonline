{"version":3,"file":"PaymentModal-Cg2vZyqZ.js","sources":["../../../../frontend/src/components/modals/PaymentModal.vue"],"sourcesContent":["<template>\n\t<Dialog v-model=\"isOpen\" :options=\"{ title: 'Payment Options', size: 'md' }\">\n\t\t<template #body-content>\n\t\t\t<div class=\"space-y-6\">\n\t\t\t\t<!-- Payment Summary -->\n\t\t\t\t<div class=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n\t\t\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t\t\t<span class=\"text-gray-700 font-medium\">Total Amount (incl. GST)</span>\n\t\t\t\t\t\t<span class=\"text-2xl font-bold text-gray-900\">\n\t\t\t\t\t\t\t${{ formatCurrency(totalAmount) }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"text-sm text-gray-600 flex justify-between\">\n\t\t\t\t\t\t<span>Fees: ${{ formatCurrency(feesExclGst) }} + GST ${{ formatCurrency(gst) }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Payment Method: Invoice -->\n\t\t\t\t<div\n\t\t\t\t\tclass=\"border-2 rounded-lg p-4 cursor-pointer transition-all\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'border-blue-500 bg-blue-50': selectedMethod === 'invoice',\n\t\t\t\t\t\t'border-gray-200 hover:border-blue-300': selectedMethod !== 'invoice'\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"selectedMethod = 'invoice'\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-start gap-3\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\tv-model=\"selectedMethod\"\n\t\t\t\t\t\t\tvalue=\"invoice\"\n\t\t\t\t\t\t\tclass=\"mt-1\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t<h3 class=\"font-medium text-gray-900 mb-1\">Request Invoice</h3>\n\t\t\t\t\t\t\t<p class=\"text-sm text-gray-600\">\n\t\t\t\t\t\t\t\tAn invoice will be sent to your email. Pay via bank transfer or at council office.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Payment Method: Online (Future - Stripe) -->\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"stripeEnabled\"\n\t\t\t\t\tclass=\"border-2 rounded-lg p-4 cursor-pointer transition-all\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'border-blue-500 bg-blue-50': selectedMethod === 'card',\n\t\t\t\t\t\t'border-gray-200 hover:border-blue-300': selectedMethod !== 'card'\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"selectedMethod = 'card'\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-start gap-3\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\tv-model=\"selectedMethod\"\n\t\t\t\t\t\t\tvalue=\"card\"\n\t\t\t\t\t\t\tclass=\"mt-1\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t<h3 class=\"font-medium text-gray-900 mb-1\">Pay Now (Credit/Debit Card)</h3>\n\t\t\t\t\t\t\t<p class=\"text-sm text-gray-600 mb-2\">\n\t\t\t\t\t\t\t\tPay securely online with Stripe. Instant confirmation.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">Visa, Mastercard, Amex accepted</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Error Message -->\n\t\t\t\t<div v-if=\"error\" class=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n\t\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t\t<svg class=\"h-5 w-5 text-red-600 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<p class=\"text-sm text-red-800\">{{ error }}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\n\t\t<template #actions>\n\t\t\t<Button variant=\"subtle\" @click=\"isOpen = false\" :disabled=\"processing\">\n\t\t\t\tCancel\n\t\t\t</Button>\n\t\t\t<Button\n\t\t\t\tvariant=\"solid\"\n\t\t\t\t@click=\"handleProceed\"\n\t\t\t\t:loading=\"processing\"\n\t\t\t\t:disabled=\"!selectedMethod\"\n\t\t\t>\n\t\t\t\t{{ selectedMethod === 'card' ? 'Proceed to Payment' : 'Request Invoice' }}\n\t\t\t</Button>\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script setup>\nimport { Button, Dialog, createResource } from \"frappe-ui\"\nimport { computed, ref } from \"vue\"\n\nconst props = defineProps({\n\tshow: Boolean,\n\trequestId: String,\n\ttotalAmount: Number,\n\tfeesExclGst: Number,\n\tgst: Number,\n\tstripeEnabled: { type: Boolean, default: false },\n})\n\nconst emit = defineEmits([\n\t\"update:show\",\n\t\"invoice-requested\",\n\t\"payment-initiated\",\n])\n\nconst selectedMethod = ref(\"invoice\")\nconst processing = ref(false)\nconst error = ref(null)\n\n// Computed property for v-model on Dialog\nconst isOpen = computed({\n\tget() {\n\t\treturn props.show\n\t},\n\tset(value) {\n\t\temit(\"update:show\", value)\n\t},\n})\n\n// Create resource for invoice request\nconst invoiceResource = createResource({\n\turl: \"lodgeick.api.request_invoice\",\n\tmakeParams(values) {\n\t\treturn {\n\t\t\trequest_id: values.requestId,\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\tif (data.success) {\n\t\t\temit(\"invoice-requested\", data)\n\t\t\temit(\"update:show\", false)\n\t\t} else {\n\t\t\terror.value = data.error || \"Failed to request invoice\"\n\t\t}\n\t\tprocessing.value = false\n\t},\n\tonError(err) {\n\t\terror.value = err.message || \"An error occurred while requesting invoice\"\n\t\tprocessing.value = false\n\t},\n})\n\nconst handleProceed = async () => {\n\terror.value = null\n\tprocessing.value = true\n\n\ttry {\n\t\tif (selectedMethod.value === \"invoice\") {\n\t\t\tawait requestInvoice()\n\t\t} else if (selectedMethod.value === \"card\") {\n\t\t\tawait initiateStripePayment()\n\t\t}\n\t} catch (err) {\n\t\terror.value = err.message || \"An unexpected error occurred\"\n\t\tprocessing.value = false\n\t}\n}\n\nconst requestInvoice = async () => {\n\tinvoiceResource.submit({ requestId: props.requestId })\n}\n\nconst initiateStripePayment = async () => {\n\t// Phase 2: Stripe integration\n\temit(\"payment-initiated\")\n\tprocessing.value = false\n\talert(\"Stripe integration coming soon!\")\n}\n\nconst formatCurrency = (amount) => {\n\tif (!amount) return \"0.00\"\n\treturn new Intl.NumberFormat(\"en-NZ\", {\n\t\tminimumFractionDigits: 2,\n\t\tmaximumFractionDigits: 2,\n\t}).format(amount)\n}\n</script>\n"],"names":["props","__props","emit","__emit","selectedMethod","ref","processing","error","isOpen","computed","value","invoiceResource","createResource","values","data","err","handleProceed","__async","requestInvoice","initiateStripePayment","formatCurrency","amount","_createBlock","_unref","Dialog","$event","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_cache","_hoisted_4","_toDisplayString","_hoisted_5","_hoisted_6","_createElementBlock","_hoisted_7","_openBlock","_hoisted_8","_hoisted_9","_hoisted_10","_createVNode","Button"],"mappings":"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"}