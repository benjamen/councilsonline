{"version":3,"file":"useStatutoryClock--LlLn5es.js","sources":["../../../../frontend/src/composables/useStatutoryClock.js"],"sourcesContent":["import { createResource } from \"frappe-ui\"\nimport { computed, ref, watch } from \"vue\"\n\n/**\n * Composable for managing statutory clock data\n *\n * For Resource Consent requests, fetches clock data from Resource Consent Application.\n * For other request types (Building Consent, etc.), will fetch from their respective applications.\n * Falls back to Request fields for backward compatibility during migration.\n *\n * @param {Object} request - The request resource from frappe-ui\n * @returns {Object} Statutory clock data and methods\n */\nexport function useStatutoryClock(request) {\n\t// Fetch Resource Consent Application if this is a Resource Consent\n\tconst consentApplication = createResource({\n\t\turl: \"frappe.client.get_list\",\n\t\tparams: {\n\t\t\tdoctype: \"Resource Consent Application\",\n\t\t\tfilters: { request: request.data?.name },\n\t\t\tfields: [\n\t\t\t\t\"name\",\n\t\t\t\t\"statutory_clock_started\",\n\t\t\t\t\"statutory_clock_stopped\",\n\t\t\t\t\"working_days_elapsed\",\n\t\t\t\t\"working_days_remaining\",\n\t\t\t],\n\t\t\tlimit: 1,\n\t\t},\n\t\tauto: false,\n\t})\n\n\t// Auto-fetch when request data is available\n\twatch(\n\t\t() => request.data,\n\t\t(newData) => {\n\t\t\tif (\n\t\t\t\tnewData &&\n\t\t\t\tnewData.request_category === \"Resource Consent\" &&\n\t\t\t\tnewData.name\n\t\t\t) {\n\t\t\t\tconsentApplication.reload()\n\t\t\t}\n\t\t},\n\t\t{ immediate: true },\n\t)\n\n\t/**\n\t * Get statutory clock data from the appropriate source\n\t */\n\tconst clockData = computed(() => {\n\t\t// For Resource Consent, prefer RC Application data\n\t\tif (request.data?.request_category === \"Resource Consent\") {\n\t\t\tconst rcApp = consentApplication.data?.[0]\n\t\t\tif (rcApp) {\n\t\t\t\treturn {\n\t\t\t\t\tstatutory_clock_started: rcApp.statutory_clock_started,\n\t\t\t\t\tstatutory_clock_stopped: rcApp.statutory_clock_stopped,\n\t\t\t\t\tworking_days_elapsed: rcApp.working_days_elapsed || 0,\n\t\t\t\t\tworking_days_remaining: rcApp.working_days_remaining || 0,\n\t\t\t\t\tsource: \"Resource Consent Application\",\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fallback to Request fields (deprecated, for backward compatibility)\n\t\treturn {\n\t\t\tstatutory_clock_started: request.data?.statutory_clock_started,\n\t\t\tstatutory_clock_stopped: request.data?.statutory_clock_stopped,\n\t\t\tworking_days_elapsed: request.data?.working_days_elapsed || 0,\n\t\t\tworking_days_remaining: request.data?.working_days_remaining || 0,\n\t\t\tsource: \"Request (deprecated)\",\n\t\t}\n\t})\n\n\t/**\n\t * Calculate progress percentage for visual indicators\n\t */\n\tconst progressPercent = computed(() => {\n\t\tconst elapsed = clockData.value.working_days_elapsed\n\t\tconst total = request.data?.statutory_timeframe || 20\n\t\treturn Math.min((elapsed / total) * 100, 100)\n\t})\n\n\t/**\n\t * Check if clock is currently running\n\t */\n\tconst isClockRunning = computed(() => {\n\t\treturn (\n\t\t\tclockData.value.statutory_clock_started &&\n\t\t\t!clockData.value.statutory_clock_stopped\n\t\t)\n\t})\n\n\t/**\n\t * Check if request is overdue\n\t */\n\tconst isOverdue = computed(() => {\n\t\treturn (\n\t\t\tclockData.value.working_days_remaining < 0 || request.data?.is_overdue\n\t\t)\n\t})\n\n\treturn {\n\t\tclockData,\n\t\tprogressPercent,\n\t\tisClockRunning,\n\t\tisOverdue,\n\t\tloading: computed(() => consentApplication.loading),\n\t}\n}\n"],"names":["useStatutoryClock","request","consentApplication","createResource","_a","watch","newData","clockData","computed","rcApp","_b","_c","_d","_e","_f","progressPercent","elapsed","total","isClockRunning","isOverdue"],"mappings":"gGAaO,SAASA,EAAkBC,EAAS,OAE1C,MAAMC,EAAqBC,EAAe,CACzC,IAAK,yBACL,OAAQ,CACP,QAAS,+BACT,QAAS,CAAE,SAASC,EAAAH,EAAQ,OAAR,YAAAG,EAAc,IAAI,EACtC,OAAQ,CACP,OACA,0BACA,0BACA,uBACA,wBACJ,EACG,MAAO,CACV,EACE,KAAM,EACR,CAAE,EAGDC,EACC,IAAMJ,EAAQ,KACbK,GAAY,CAEXA,GACAA,EAAQ,mBAAqB,oBAC7BA,EAAQ,MAERJ,EAAmB,OAAM,CAE3B,EACA,CAAE,UAAW,EAAI,CACnB,EAKC,MAAMK,EAAYC,EAAS,IAAM,iBAEhC,KAAIJ,EAAAH,EAAQ,OAAR,YAAAG,EAAc,oBAAqB,mBAAoB,CAC1D,MAAMK,GAAQC,EAAAR,EAAmB,OAAnB,YAAAQ,EAA0B,GACxC,GAAID,EACH,MAAO,CACN,wBAAyBA,EAAM,wBAC/B,wBAAyBA,EAAM,wBAC/B,qBAAsBA,EAAM,sBAAwB,EACpD,uBAAwBA,EAAM,wBAA0B,EACxD,OAAQ,8BACb,CAEE,CAGA,MAAO,CACN,yBAAyBE,EAAAV,EAAQ,OAAR,YAAAU,EAAc,wBACvC,yBAAyBC,EAAAX,EAAQ,OAAR,YAAAW,EAAc,wBACvC,uBAAsBC,EAAAZ,EAAQ,OAAR,YAAAY,EAAc,uBAAwB,EAC5D,yBAAwBC,EAAAb,EAAQ,OAAR,YAAAa,EAAc,yBAA0B,EAChE,OAAQ,sBACX,CACC,CAAC,EAKKC,EAAkBP,EAAS,IAAM,OACtC,MAAMQ,EAAUT,EAAU,MAAM,qBAC1BU,IAAQb,EAAAH,EAAQ,OAAR,YAAAG,EAAc,sBAAuB,GACnD,OAAO,KAAK,IAAKY,EAAUC,EAAS,IAAK,GAAG,CAC7C,CAAC,EAKKC,EAAiBV,EAAS,IAE9BD,EAAU,MAAM,yBAChB,CAACA,EAAU,MAAM,uBAElB,EAKKY,EAAYX,EAAS,IAAM,OAChC,OACCD,EAAU,MAAM,uBAAyB,KAAKH,EAAAH,EAAQ,OAAR,YAAAG,EAAc,WAE9D,CAAC,EAED,MAAO,CACN,UAAAG,EACA,gBAAAQ,EACA,eAAAG,EACA,UAAAC,EACA,QAASX,EAAS,IAAMN,EAAmB,OAAO,CACpD,CACA"}