var pe=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var Y=(C,x,c)=>x in C?pe(C,x,{enumerable:!0,configurable:!0,writable:!0,value:c}):C[x]=c,ee=(C,x)=>{for(var c in x||(x={}))ve.call(x,c)&&Y(C,c,x[c]);if(K)for(var c of K(x))xe.call(x,c)&&Y(C,c,x[c]);return C},te=(C,x)=>me(C,ge(x));var H=(C,x,c)=>new Promise((D,y)=>{var V=b=>{try{w(c.next(b))}catch(a){y(a)}},M=b=>{try{w(c.throw(b))}catch(a){y(a)}},w=b=>b.done?D(b.value):Promise.resolve(b.value).then(V,M);w((c=c.apply(C,x)).next())});import{j as U,r as _,x as se,B as L,H as ye,o as r,w as q,a as e,n as G,c as n,d as f,b as g,h as $,u as v,I as j,l as A,z as oe,v as B,t as d,i as E,D as le,f as ae,k as J,F as z,m as F,q as N,s as W,g as O}from"./index-_wRyxq0y.js";import{D as fe}from"./Dropdown-BNfD3hxb.js";import{_ as be}from"./StatusBadge-DOaN44VF.js";import{_ as S}from"./StatCard-BBP5Cvcd.js";const he={class:"grid grid-cols-2 gap-4"},_e={class:"grid grid-cols-2 gap-4"},we={class:"border-t border-gray-200 pt-6"},ke={class:"mb-4"},Ce={class:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700"},Ve={class:"grid grid-cols-3 gap-4"},$e={class:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-medium"},Me={class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},De={class:"flex items-center justify-between"},Re={class:"text-xl font-bold text-blue-900"},qe={class:"text-xs text-gray-600 mt-1"},Ae={key:0,class:"mt-4"},Ue={key:0,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},Se={class:"flex items-start"},Te={class:"text-sm text-red-700"},je={class:"flex justify-end space-x-3 pt-4 border-t border-gray-200"},Pe={__name:"TaskDialog",props:{modelValue:{type:Boolean,default:!1},task:{type:Object,default:null}},emits:["update:modelValue","task-saved"],setup(C,{emit:x}){const c=C,D=x,y=U({get:()=>c.modelValue,set:s=>D("update:modelValue",s)}),V=U(()=>!!c.task),M=_(!1),w=_(""),b=()=>({title:"",description:"",priority:"Medium",status:"Open",due_date:"",assign_to:"",assign_from:"",request:"",activity_type:"",assigned_role:"",estimated_hours:null,actual_hours:null}),a=_(b()),k=_(""),h=_(0),R=U(()=>(a.value.actual_hours||0)*h.value);se(()=>a.value.assign_to,s=>H(this,null,function*(){if(s)try{const o=yield L("frappe.client.get",{doctype:"User",name:s});if(o&&o.roles&&o.roles.length>0){const m=o.roles.find(T=>!["Guest","All"].includes(T.role));if(m){k.value=m.role,a.value.assigned_role=m.role;const T=yield L("lodgeick.lodgeick.doctype.role_rate.role_rate.get_hourly_rate",{role:m.role});T&&T.hourly_rate&&(h.value=T.hourly_rate)}}}catch(o){console.error("Error fetching user role and rate:",o),k.value="",h.value=0}else k.value="",h.value=0}));const P=()=>{};se(()=>c.task,s=>{s?(a.value={title:s.title||"",description:s.description||"",priority:s.priority||"Medium",status:s.status||"Open",due_date:s.due_date||"",assign_to:s.assign_to||"",assign_from:s.assign_from||"",request:s.request||"",activity_type:s.activity_type||"",assigned_role:s.assigned_role||"",estimated_hours:s.estimated_hours||null,actual_hours:s.actual_hours||null},s.assigned_role&&(k.value=s.assigned_role),s.hourly_rate&&(h.value=s.hourly_rate)):(a.value=b(),k.value="",h.value=0)},{immediate:!0});const p=()=>H(this,null,function*(){w.value="",M.value=!0;try{if(V.value)yield L("frappe.client.set_value",{doctype:"WB Task",name:c.task.name,fieldname:a.value});else{const s=te(ee({doctype:"WB Task"},a.value),{assign_from:a.value.assign_from||"Administrator"});yield L("frappe.client.insert",{doc:s})}D("task-saved"),i()}catch(s){console.error("Error saving task:",s),w.value=s.message||"Failed to save task. Please try again."}finally{M.value=!1}}),i=()=>{y.value=!1,a.value=b(),w.value=""};return(s,o)=>(r(),ye(v(le),{modelValue:y.value,"onUpdate:modelValue":o[10]||(o[10]=m=>y.value=m),options:{title:V.value?"Edit Task":"Create New Task",size:"3xl"}},{"body-content":q(()=>[e("form",{onSubmit:G(p,["prevent"]),class:"space-y-6"},[e("div",null,[o[11]||(o[11]=e("label",{for:"title",class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Title "),e("span",{class:"text-red-500"},"*")],-1)),g(v(j),{id:"title",modelValue:a.value.title,"onUpdate:modelValue":o[0]||(o[0]=m=>a.value.title=m),type:"text",required:"",placeholder:"Enter task title",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[12]||(o[12]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-2"}," Description ",-1)),A(e("textarea",{id:"description","onUpdate:modelValue":o[1]||(o[1]=m=>a.value.description=m),rows:"3",placeholder:"Describe the task...",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[oe,a.value.description]])]),e("div",he,[e("div",null,[o[14]||(o[14]=e("label",{for:"priority",class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Priority "),e("span",{class:"text-red-500"},"*")],-1)),A(e("select",{id:"priority","onUpdate:modelValue":o[2]||(o[2]=m=>a.value.priority=m),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...o[13]||(o[13]=[e("option",{value:"Low"},"Low",-1),e("option",{value:"Medium"},"Medium",-1),e("option",{value:"High"},"High",-1),e("option",{value:"Urgent"},"Urgent",-1)])],512),[[B,a.value.priority]])]),e("div",null,[o[16]||(o[16]=e("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Status "),e("span",{class:"text-red-500"},"*")],-1)),A(e("select",{id:"status","onUpdate:modelValue":o[3]||(o[3]=m=>a.value.status=m),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...o[15]||(o[15]=[e("option",{value:"Open"},"Open",-1),e("option",{value:"Working"},"Working",-1),e("option",{value:"Pending Review"},"Pending Review",-1),e("option",{value:"Completed"},"Completed",-1),e("option",{value:"Cancelled"},"Cancelled",-1)])],512),[[B,a.value.status]])])]),e("div",_e,[e("div",null,[o[17]||(o[17]=e("label",{for:"due_date",class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Due Date "),e("span",{class:"text-red-500"},"*")],-1)),g(v(j),{id:"due_date",modelValue:a.value.due_date,"onUpdate:modelValue":o[4]||(o[4]=m=>a.value.due_date=m),type:"date",required:"",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[18]||(o[18]=e("label",{for:"assign_to",class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Assign To "),e("span",{class:"text-red-500"},"*")],-1)),g(v(j),{id:"assign_to",modelValue:a.value.assign_to,"onUpdate:modelValue":o[5]||(o[5]=m=>a.value.assign_to=m),type:"text",required:"",placeholder:"User email",class:"w-full"},null,8,["modelValue"])])]),e("div",null,[o[19]||(o[19]=e("label",{for:"request",class:"block text-sm font-medium text-gray-700 mb-2"}," Linked Request (Optional) ",-1)),g(v(j),{id:"request",modelValue:a.value.request,"onUpdate:modelValue":o[6]||(o[6]=m=>a.value.request=m),type:"text",placeholder:"Request ID (e.g., RC-2025-001)",class:"w-full"},null,8,["modelValue"])]),e("div",we,[o[26]||(o[26]=e("h3",{class:"text-sm font-medium text-gray-900 mb-4"},"Time Tracking & Costing",-1)),e("div",ke,[o[20]||(o[20]=e("label",{for:"assigned_role",class:"block text-sm font-medium text-gray-700 mb-2"}," User Role (Auto-detected) ",-1)),e("div",Ce,d(k.value||"Role will be detected from assigned user"),1)]),e("div",Ve,[e("div",null,[o[21]||(o[21]=e("label",{for:"estimated_hours",class:"block text-sm font-medium text-gray-700 mb-2"}," Estimated Hours ",-1)),g(v(j),{id:"estimated_hours",modelValue:a.value.estimated_hours,"onUpdate:modelValue":o[7]||(o[7]=m=>a.value.estimated_hours=m),modelModifiers:{number:!0},type:"number",step:"0.25",min:"0",placeholder:"0.00",class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[22]||(o[22]=e("label",{for:"actual_hours",class:"block text-sm font-medium text-gray-700 mb-2"}," Actual Hours ",-1)),g(v(j),{id:"actual_hours",modelValue:a.value.actual_hours,"onUpdate:modelValue":o[8]||(o[8]=m=>a.value.actual_hours=m),modelModifiers:{number:!0},type:"number",step:"0.25",min:"0",placeholder:"0.00",onInput:P,class:"w-full"},null,8,["modelValue"])]),e("div",null,[o[23]||(o[23]=e("label",{for:"hourly_rate",class:"block text-sm font-medium text-gray-700 mb-2"}," Hourly Rate ",-1)),e("div",$e," $"+d(h.value.toFixed(2)),1)])]),e("div",Me,[e("div",De,[o[24]||(o[24]=e("span",{class:"text-sm font-medium text-gray-700"},"Total Cost",-1)),e("span",Re,"$"+d(R.value.toFixed(2)),1)]),e("p",qe," Calculated as: "+d(a.value.actual_hours||0)+" hours × $"+d(h.value.toFixed(2))+"/hr ",1)]),a.value.request?(r(),n("div",Ae,[o[25]||(o[25]=e("label",{for:"activity_type",class:"block text-sm font-medium text-gray-700 mb-2"}," Activity Type (Optional) ",-1)),g(v(j),{id:"activity_type",modelValue:a.value.activity_type,"onUpdate:modelValue":o[9]||(o[9]=m=>a.value.activity_type=m),type:"text",placeholder:"e.g., Site Inspection",class:"w-full"},null,8,["modelValue"])])):f("",!0)]),w.value?(r(),n("div",Ue,[e("div",Se,[o[27]||(o[27]=e("svg",{class:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",Te,d(w.value),1)])])):f("",!0),e("div",je,[g(v(E),{type:"button",onClick:i,variant:"outline"},{default:q(()=>[...o[28]||(o[28]=[$(" Cancel ",-1)])]),_:1}),g(v(E),{type:"submit",loading:M.value,variant:"solid",theme:"green"},{default:q(()=>[$(d(V.value?"Update Task":"Create Task"),1)]),_:1},8,["loading"])])],32)]),_:1},8,["modelValue","options"]))}},Be={class:"space-y-6"},Ie={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},He={class:"bg-white rounded-lg shadow-sm border border-gray-200"},Oe={class:"p-6 border-b border-gray-200"},Le={class:"flex justify-between items-center"},ze={class:"divide-y divide-gray-200"},Fe={key:0,class:"p-12 text-center"},Ne={key:1,class:"p-12 text-center text-gray-500"},Ee={class:"flex items-start justify-between gap-6"},We={class:"flex items-start space-x-4 flex-1"},Ge=["checked","onChange"],Je={class:"flex-1"},Qe={class:"flex items-center space-x-3 mb-2"},Xe={class:"text-sm text-gray-600 mb-4"},Ze={class:"flex flex-wrap items-center gap-3"},Ke={key:0,class:"flex items-center text-sm text-gray-600"},Ye={class:"font-medium"},et={key:1,class:"inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold"},tt={key:0,class:"ml-1"},st={class:"flex flex-col items-end space-y-3 min-w-[180px]"},ot={key:0,class:"px-4 py-2 bg-green-50 border-2 border-green-200 rounded-lg"},lt={class:"text-2xl font-bold text-green-900"},at={key:1,class:"px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg w-full"},rt={class:"flex items-center justify-between"},nt={class:"text-xs text-blue-700 font-medium"},it={class:"text-lg font-bold text-blue-900"},dt={key:0},ut={key:1},ct={key:0,class:"text-xs text-blue-600 mt-1"},pt={class:"flex items-center space-x-2"},mt=["onClick"],gt=["onClick"],vt={__name:"TaskManagement",setup(C){const x=ae(),c=_(!1),D=_(null),y=J({url:"lodgeick.lodgeick.doctype.task.task.get_my_tasks",auto:!0}),V=U(()=>{const p=y.data||[],i=new Date().toDateString();return{myTasks:p.length,inProgress:p.filter(s=>s.status==="Open").length,completedToday:p.filter(s=>s.status==="Completed"&&s.date_of_completion&&new Date(s.date_of_completion).toDateString()===i).length,overdue:p.filter(s=>s.status==="Overdue").length}}),M=p=>{const i={Low:"bg-gray-100 text-gray-800",Medium:"bg-blue-100 text-blue-800",High:"bg-orange-100 text-orange-800",Urgent:"bg-red-100 text-red-800"};return i[p]||i.Medium},w=p=>p?new Date(p)<new Date:!1,b=p=>p?new Date(p).toLocaleDateString("en-NZ",{day:"numeric",month:"short",year:"numeric"}):"",a=p=>H(this,null,function*(){const i=p.status==="Completed"?"Open":"Completed";try{yield L("frappe.client.set_value",{doctype:"WB Task",name:p.name,fieldname:"status",value:i}),y.reload()}catch(s){console.error("Error toggling task status:",s)}}),k=p=>{x.push({name:"InternalRequestDetail",params:{id:p}})},h=()=>{D.value=null,c.value=!0},R=p=>{D.value=p,c.value=!0},P=()=>{y.reload()};return(p,i)=>(r(),n("div",Be,[e("div",Ie,[g(S,{title:"My Tasks",value:V.value.myTasks,icon:"clipboard",color:"blue"},null,8,["value"]),g(S,{title:"In Progress",value:V.value.inProgress,icon:"clock",color:"yellow"},null,8,["value"]),g(S,{title:"Completed Today",value:V.value.completedToday,icon:"check",color:"green"},null,8,["value"]),g(S,{title:"Overdue",value:V.value.overdue,icon:"alert-triangle",color:"red"},null,8,["value"])]),e("div",He,[e("div",Oe,[e("div",Le,[i[3]||(i[3]=e("h2",{class:"text-lg font-semibold text-gray-900"},"My Tasks",-1)),g(v(E),{onClick:h,variant:"solid",theme:"green"},{prefix:q(()=>[...i[1]||(i[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:q(()=>[i[2]||(i[2]=$(" New Task ",-1))]),_:1})])]),e("div",ze,[v(y).loading?(r(),n("div",Fe,[...i[4]||(i[4]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"},null,-1)])])):!v(y).data||v(y).data.length===0?(r(),n("div",Ne,[...i[5]||(i[5]=[e("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1),e("p",null,"No tasks assigned",-1)])])):(r(!0),n(z,{key:2},F(v(y).data,s=>(r(),n("div",{key:s.name,class:"p-6 hover:bg-gray-50 transition-colors"},[e("div",Ee,[e("div",We,[e("input",{type:"checkbox",checked:s.status==="Completed",onChange:o=>a(s),class:"mt-1 h-5 w-5 text-green-600 focus:ring-green-500 border-gray-300 rounded cursor-pointer"},null,40,Ge),e("div",Je,[e("div",Qe,[e("h3",{class:N(["text-base font-semibold",s.status==="Completed"?"text-gray-400 line-through":"text-gray-900"])},d(s.title),3),s.priority?(r(),n("span",{key:0,class:N(["inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold",M(s.priority)])},d(s.priority),3)):f("",!0)]),e("p",Xe,d(s.description),1),e("div",Ze,[s.request?(r(),n("div",Ke,[i[6]||(i[6]=e("svg",{class:"w-4 h-4 mr-1.5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",Ye,d(s.request),1)])):f("",!0),s.assigned_role?(r(),n("div",et,[i[7]||(i[7]=e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),$(" "+d(s.assigned_role),1)])):f("",!0),s.due_date?(r(),n("div",{key:2,class:N(["inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold",w(s.due_date)?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},[i[8]||(i[8]=e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),$(" "+d(b(s.due_date))+" ",1),w(s.due_date)?(r(),n("span",tt,"⚠️")):f("",!0)],2)):f("",!0)])])]),e("div",st,[s.total_cost?(r(),n("div",ot,[i[9]||(i[9]=e("div",{class:"text-xs text-green-700 font-medium mb-0.5"},"Total Cost",-1)),e("div",lt,"$"+d(s.total_cost.toFixed(2)),1)])):f("",!0),s.estimated_hours||s.actual_hours?(r(),n("div",at,[e("div",rt,[e("div",nt,d(s.actual_hours?"Actual":"Est.")+" Hours ",1),e("div",it,[s.actual_hours?(r(),n("span",dt,d(s.actual_hours)+"h",1)):s.estimated_hours?(r(),n("span",ut,"~"+d(s.estimated_hours)+"h",1)):f("",!0)])]),s.hourly_rate?(r(),n("div",ct," @ $"+d(s.hourly_rate.toFixed(2))+"/hr ",1)):f("",!0)])):f("",!0),e("div",pt,[s.request?(r(),n("button",{key:0,onClick:o=>k(s.request),class:"p-2 text-gray-400 hover:text-blue-600 transition rounded-lg hover:bg-blue-50",title:"View Request"},[...i[10]||(i[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,mt)):f("",!0),e("button",{onClick:o=>R(s),class:"p-2 text-gray-400 hover:text-green-600 transition rounded-lg hover:bg-green-50",title:"Edit Task"},[...i[11]||(i[11]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,gt)])])])]))),128))])]),g(Pe,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=s=>c.value=s),task:D.value,onTaskSaved:P},null,8,["modelValue","task"])]))}},xt={class:"min-h-screen bg-gray-50"},yt={class:"bg-white shadow-sm border-b border-gray-200"},ft={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},bt={class:"flex justify-between items-center py-4"},ht={class:"flex items-center space-x-4"},_t={class:"flex items-center space-x-2 text-gray-700 hover:text-gray-900"},wt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},kt={class:"text-sm font-medium text-green-600"},Ct={class:"text-sm font-medium"},Vt={class:"flex space-x-6 border-t border-gray-200 -mb-px"},$t=["onClick"],Mt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Dt={key:0},Rt={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8"},qt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6"},At={class:"grid md:grid-cols-5 gap-4"},Ut=["value"],St={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},Tt={class:"overflow-x-auto"},jt={class:"min-w-full divide-y divide-gray-200"},Pt={class:"bg-white divide-y divide-gray-200"},Bt={key:0},It={key:1},Ht=["onClick"],Ot={class:"text-sm font-medium text-gray-900"},Lt={class:"text-sm text-gray-500"},zt={class:"px-6 py-4 whitespace-nowrap"},Ft={class:"text-sm text-gray-900"},Nt={class:"px-6 py-4 whitespace-nowrap"},Et={class:"text-sm text-gray-900"},Wt={class:"text-sm text-gray-500"},Gt={class:"px-6 py-4"},Jt={class:"text-sm text-gray-900"},Qt={class:"px-6 py-4 whitespace-nowrap"},Xt={class:"px-6 py-4 whitespace-nowrap"},Zt={key:0,class:"flex items-center"},Kt={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-2"},Yt={class:"text-xs font-medium text-green-600"},es={class:"text-sm text-gray-900"},ts={key:1,class:"text-sm text-gray-400"},ss={class:"px-6 py-4 whitespace-nowrap"},os={class:"text-sm text-gray-900"},ls={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},as=["onClick"],rs=["onClick"],ns={key:1},is={key:2},ds={key:3},us={key:4},cs={key:0,class:"space-y-4"},ps={class:"bg-gray-50 p-4 rounded-lg"},ms={class:"text-sm font-medium text-gray-900"},gs={class:"text-sm text-gray-500"},vs=["value"],ws={__name:"InternalRequestManagement",setup(C){const x=ae(),c=_("requests"),D=[{id:"requests",label:"All Requests"},{id:"tasks",label:"My Tasks"},{id:"maps",label:"GIS Maps"},{id:"districtplan",label:"District Plan"},{id:"analytics",label:"Analytics"}],y=_(""),V=_(""),M=_(""),w=_(""),b=_(""),a=_(!1),k=_(null),h=_(""),R=_(""),P=_(!1),p=J({url:"lodgeick.lodgeick.doctype.request.request.get_all_requests_for_staff",auto:!0}),i=J({url:"lodgeick.api.get_staff_users",auto:!0}),s=U(()=>{const u=p.data||[];return[...new Set(u.map(l=>l.council).filter(Boolean))].sort()}),o=U(()=>{const u=p.data||[];return{total:u.length,unassigned:u.filter(t=>!t.assigned_to).length,inProgress:u.filter(t=>t.status==="Under Review").length,rfi:u.filter(t=>t.status==="RFI Issued").length,completed:u.filter(t=>["Approved","Declined","Withdrawn"].includes(t.status)).length}}),m=U(()=>{let u=p.data||[];if(y.value){const t=y.value.toLowerCase();u=u.filter(l=>{var I,X,Z;return((I=l.request_number)==null?void 0:I.toLowerCase().includes(t))||((X=l.property_address)==null?void 0:X.toLowerCase().includes(t))||((Z=l.applicant_name)==null?void 0:Z.toLowerCase().includes(t))})}return V.value&&(u=u.filter(t=>t.status===V.value)),M.value&&(u=u.filter(t=>t.council===M.value)),w.value==="unassigned"?u=u.filter(t=>!t.assigned_to):w.value==="me"&&(u=u.filter(t=>t.assigned_to===W.user)),b.value&&(u=u.filter(t=>t.request_type===b.value)),u}),T=U(()=>W.user||"User"),re=U(()=>T.value.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)),ne=u=>u?u.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"?",Q=u=>{x.push({name:"InternalRequestDetail",params:{id:u}})},ie=u=>{k.value=u,h.value=u.assigned_to||"",R.value="",a.value=!0},de=()=>H(this,null,function*(){if(!h.value){alert("Please select a user to assign");return}P.value=!0;try{const t=yield(yield fetch("/api/method/lodgeick.api.assign_request",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:k.value.name,assigned_to:h.value,notes:R.value})})).json();if(t.message&&t.message.success)a.value=!1,k.value=null,h.value="",R.value="",p.reload(),alert("Request assigned successfully!");else throw new Error("Failed to assign request")}catch(u){console.error("Error assigning request:",u),alert("Failed to assign request. Please try again.")}finally{P.value=!1}}),ue=()=>{a.value=!1,k.value=null,h.value="",R.value=""},ce=[{label:"Public Dashboard",onClick:()=>{x.push({name:"Dashboard"})}},{label:"My Profile",onClick:()=>console.log("Profile")},{label:"Settings",onClick:()=>console.log("Settings")},{label:"Logout",onClick:()=>W.logout.submit()}];return(u,t)=>(r(),n("div",xt,[e("header",yt,[e("div",ft,[e("div",bt,[t[9]||(t[9]=O('<div class="flex items-center space-x-3"><div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg></div><div><h1 class="text-xl font-bold text-gray-900">Easy Council</h1><p class="text-xs text-gray-500">Internal Request Management</p></div></div>',1)),e("div",ht,[g(v(fe),{options:ce},{default:q(({open:l})=>[e("button",_t,[e("div",wt,[e("span",kt,d(re.value),1)]),e("span",Ct,d(T.value),1),t[8]||(t[8]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))])]),_:1})])]),e("div",Vt,[(r(),n(z,null,F(D,l=>e("button",{key:l.id,onClick:I=>c.value=l.id,class:N(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",c.value===l.id?"border-green-600 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},d(l.label),11,$t)),64))])])]),e("main",Mt,[c.value==="requests"?(r(),n("div",Dt,[e("div",Rt,[g(S,{title:"Total Requests",value:o.value.total,icon:"inbox",color:"blue"},null,8,["value"]),g(S,{title:"New/Unassigned",value:o.value.unassigned,icon:"alert-circle",color:"red"},null,8,["value"]),g(S,{title:"In Progress",value:o.value.inProgress,icon:"clock",color:"yellow"},null,8,["value"]),g(S,{title:"RFI Issued",value:o.value.rfi,icon:"help-circle",color:"orange"},null,8,["value"]),g(S,{title:"Completed",value:o.value.completed,icon:"check-circle",color:"green"},null,8,["value"])]),e("div",qt,[e("div",At,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Search",-1)),g(v(j),{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=l=>y.value=l),placeholder:"Request number, property..."},null,8,["modelValue"])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Council",-1)),A(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>M.value=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[t[11]||(t[11]=e("option",{value:""},"All Councils",-1)),(r(!0),n(z,null,F(s.value,l=>(r(),n("option",{key:l,value:l},d(l),9,Ut))),128))],512),[[B,M.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Status",-1)),A(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>V.value=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[13]||(t[13]=[O('<option value="">All Statuses</option><option value="Submitted">Submitted</option><option value="Under Review">Under Review</option><option value="RFI Issued">RFI Issued</option><option value="Approved">Approved</option><option value="Declined">Declined</option>',6)])],512),[[B,V.value]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Assigned To",-1)),A(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>w.value=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[15]||(t[15]=[e("option",{value:""},"All Staff",-1),e("option",{value:"unassigned"},"Unassigned",-1),e("option",{value:"me"},"Assigned to Me",-1)])],512),[[B,w.value]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Request Type",-1)),A(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>b.value=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...t[17]||(t[17]=[e("option",{value:""},"All Types",-1),e("option",{value:"Building Consent"},"Building Consent",-1),e("option",{value:"Resource Consent"},"Resource Consent",-1),e("option",{value:"LIM"},"LIM Report",-1)])],512),[[B,b.value]])])])]),e("div",St,[e("div",Tt,[e("table",jt,[t[21]||(t[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Request "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Council "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Applicant "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Property "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Assigned To "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Days Elapsed "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Pt,[v(p).loading?(r(),n("tr",Bt,[...t[19]||(t[19]=[e("td",{colspan:"8",class:"px-6 py-12 text-center text-gray-500"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})],-1)])])):!v(p).data||v(p).data.length===0?(r(),n("tr",It,[...t[20]||(t[20]=[e("td",{colspan:"8",class:"px-6 py-12 text-center text-gray-500"}," No requests found ",-1)])])):(r(!0),n(z,{key:2},F(m.value,l=>(r(),n("tr",{key:l.name,class:"hover:bg-gray-50 cursor-pointer"},[e("td",{class:"px-6 py-4 whitespace-nowrap",onClick:I=>Q(l.name)},[e("div",Ot,d(l.request_number),1),e("div",Lt,d(l.request_type),1)],8,Ht),e("td",zt,[e("div",Ft,d(l.council||"N/A"),1)]),e("td",Nt,[e("div",Et,d(l.applicant_name||l.applicant),1),e("div",Wt,d(l.applicant_email),1)]),e("td",Gt,[e("div",Jt,d(l.property_address),1)]),e("td",Qt,[g(be,{status:l.status},null,8,["status"])]),e("td",Xt,[l.assigned_to?(r(),n("div",Zt,[e("div",Kt,[e("span",Yt,d(ne(l.assigned_to)),1)]),e("span",es,d(l.assigned_to_name||l.assigned_to),1)])):(r(),n("span",ts,"Unassigned"))]),e("td",ss,[e("div",os,d(l.working_days_elapsed||0)+" days",1),l.working_days_remaining?(r(),n("div",{key:0,class:N(["text-xs",l.is_overdue?"text-red-600":"text-gray-500"])},d(l.working_days_remaining)+" remaining ",3)):f("",!0)]),e("td",ls,[e("button",{onClick:G(I=>ie(l),["stop"]),class:"text-green-600 hover:text-green-900 mr-3"}," Assign ",8,as),e("button",{onClick:G(I=>Q(l.name),["stop"]),class:"text-blue-600 hover:text-blue-900"}," View ",8,rs)])]))),128))])])])])])):f("",!0),c.value==="tasks"?(r(),n("div",ns,[g(vt)])):f("",!0),c.value==="maps"?(r(),n("div",is,[...t[22]||(t[22]=[O('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center"><svg class="w-20 h-20 text-blue-600 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path></svg><h3 class="text-2xl font-bold text-gray-900 mb-4">GIS Property Maps</h3><p class="text-gray-600 mb-8 max-w-2xl mx-auto"> Access Hutt City Council&#39;s GIS property viewer for detailed maps, zoning information, and property boundaries. The external site opens in a new tab due to security restrictions. </p><a href="https://eplan.huttcity.govt.nz/review/property/1998600/0/48?_t=property" target="_blank" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-base font-semibold shadow-lg hover:shadow-xl"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg> Open GIS Property Maps </a><p class="text-sm text-gray-500 mt-4">Opens in new browser tab</p></div>',1)])])):f("",!0),c.value==="districtplan"?(r(),n("div",ds,[...t[23]||(t[23]=[O('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center"><svg class="w-20 h-20 text-green-600 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><h3 class="text-2xl font-bold text-gray-900 mb-4">District Plan</h3><p class="text-gray-600 mb-8 max-w-2xl mx-auto"> Access Hutt City Council&#39;s District Plan including rules, zones, overlays, and planning provisions. The external ePlan site opens in a new tab due to security restrictions. </p><a href="https://eplan.huttcity.govt.nz/eplan" target="_blank" class="inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-base font-semibold shadow-lg hover:shadow-xl"><svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg> Open District Plan </a><p class="text-sm text-gray-500 mt-4">Opens in new browser tab</p></div>',1)])])):f("",!0),c.value==="analytics"?(r(),n("div",us,[...t[24]||(t[24]=[O('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center"><svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg><h3 class="text-lg font-medium text-gray-900 mb-2">Analytics Dashboard</h3><p class="text-gray-500">Performance metrics and reporting coming soon</p></div>',1)])])):f("",!0)]),g(v(le),{modelValue:a.value,"onUpdate:modelValue":t[7]||(t[7]=l=>a.value=l),options:{title:"Assign Request",size:"md"}},{"body-content":q(()=>[k.value?(r(),n("div",cs,[e("div",ps,[e("div",ms,d(k.value.request_number),1),e("div",gs,d(k.value.brief_description),1)]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$("Assign To "),e("span",{class:"text-red-500"},"*")],-1)),A(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>h.value=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[t[25]||(t[25]=e("option",{value:""},"Select a staff member",-1)),(r(!0),n(z,null,F(v(i).data,l=>(r(),n("option",{key:l.name,value:l.name},d(l.display_name),9,vs))),128))],512),[[B,h.value]]),t[27]||(t[27]=e("p",{class:"mt-1 text-sm text-gray-500"},"Select the staff member to assign this request to (showing name and primary role)",-1))]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notes (Optional)",-1)),A(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>R.value=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Add any notes about this assignment..."},null,512),[[oe,R.value]])])])):f("",!0)]),actions:q(()=>[g(v(E),{onClick:ue,variant:"outline"},{default:q(()=>[...t[29]||(t[29]=[$("Cancel",-1)])]),_:1}),g(v(E),{onClick:de,loading:P.value,variant:"solid",theme:"blue"},{default:q(()=>[...t[30]||(t[30]=[$(" Assign Request ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"])]))}};export{ws as default};
//# sourceMappingURL=InternalRequestManagement-DA-qhoE3.js.map
