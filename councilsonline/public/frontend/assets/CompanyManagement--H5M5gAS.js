var oe=Object.defineProperty;var X=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var $=(w,m,a)=>m in w?oe(w,m,{enumerable:!0,configurable:!0,writable:!0,value:a}):w[m]=a,M=(w,m)=>{for(var a in m||(m={}))le.call(m,a)&&$(w,a,m[a]);if(X)for(var a of X(m))ae.call(m,a)&&$(w,a,m[a]);return w};var h=(w,m,a)=>new Promise((n,V)=>{var U=g=>{try{i(a.next(g))}catch(C){V(C)}},_=g=>{try{i(a.throw(g))}catch(C){V(C)}},i=g=>g.done?n(g.value):Promise.resolve(g.value).then(U,_);i((a=a.apply(w,m)).next())});import{a5 as ne,B as u,c as re,D as ie,ac as de,a as r,o as l,b as t,e as b,R as p,P as x,a2 as v,t as d,O as E,u as c,_ as J,a6 as Z,ae as ue,F as G,W as H,n as me,ak as ce}from"./vue-vendor-B0shnPjy.js";import{h as k,I as j}from"./frappe-ui-D6fYUZUl.js";import"./ui-components-CzNebsXy.js";const pe={class:"min-h-screen bg-gray-50 p-6"},ve={class:"max-w-7xl mx-auto"},ye={class:"mb-8"},ge={class:"flex items-center justify-between"},fe={key:0,class:"text-center py-12"},be={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6"},xe={class:"flex items-start"},we={class:"text-red-700 mt-1"},ke={key:2,class:"space-y-6"},_e={class:"bg-white rounded-lg shadow border border-gray-200"},he={class:"p-6 border-b border-gray-200"},Ce={class:"flex items-center justify-between"},Se={class:"p-6"},je={class:"grid md:grid-cols-2 gap-4"},Ve={class:"grid md:grid-cols-2 gap-4"},Fe={class:"flex items-center justify-end space-x-3"},Te={key:1,class:"space-y-4"},Me={class:"grid md:grid-cols-2 gap-6"},Ue={class:"text-gray-900 font-medium mt-1"},Re={class:"text-gray-900 mt-1"},Ne={key:0},Ae={class:"text-gray-900 mt-1"},Ee={key:1},Pe={class:"text-gray-900 mt-1"},Oe={class:"text-gray-900 mt-1"},Be={class:"text-gray-900 mt-1"},De={class:"text-gray-900 mt-1"},Ie={class:"bg-white rounded-lg shadow border border-gray-200"},qe={class:"p-6 border-b border-gray-200"},Le={class:"flex items-center justify-between"},ze={class:"p-6"},Xe={class:"mb-8"},$e={class:"space-y-3"},Je={class:"flex items-center space-x-4"},Ze={class:"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold"},Ge={class:"font-medium text-gray-900"},He={class:"text-sm text-gray-600"},We={class:"flex items-center space-x-3"},Ke={key:0,class:"text-center py-8 text-gray-500"},Qe={key:1,class:"space-y-3"},Ye={class:"flex items-center space-x-4"},et={class:"w-10 h-10 rounded-full bg-gray-400 flex items-center justify-center text-white font-semibold"},tt={class:"font-medium text-gray-900"},st={class:"text-sm text-gray-600"},ot={class:"flex items-center space-x-3"},lt=["value","onChange"],at={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},nt={class:"bg-white rounded-lg shadow-xl max-w-md w-full"},rt={key:0},it={key:1,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},dt={class:"text-sm text-red-700"},ut={class:"flex items-center justify-end space-x-3 pt-4"},mt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ct={class:"bg-white rounded-lg shadow-xl max-w-md w-full p-6"},pt={class:"text-gray-700 mb-6"},vt={class:"flex items-center justify-end space-x-3"},xt={__name:"CompanyManagement",setup(w){ne();const m=u(!0),a=u(null),n=u(null),V=u(null),U=u(null),_=u(!1),i=u({}),g=u(!1),C=u(!1),f=u({email:"",role:"Submitter",designation:""}),P=u(!1),S=u(null),R=u(!1),N=u(null),O=u(!1),q=u([]),B=u([]),F=re(()=>U.value==="Admin");ie(()=>h(this,null,function*(){yield W(),yield A()}));function W(){return h(this,null,function*(){m.value=!0,a.value=null;try{const e=yield(yield fetch("/api/method/councilsonline.api.get_user_company_account",{method:"GET",headers:{"X-Frappe-CSRF-Token":window.csrf_token}})).json();e.message?(n.value=e.message,U.value=e.message.user_role,V.value=e.message.current_user,i.value=M({},e.message)):a.value="No company account found for this user"}catch(o){a.value="Failed to load company account",console.error("Error loading company account:",o)}finally{m.value=!1}})}function A(){return h(this,null,function*(){try{const e=yield(yield fetch("/api/method/councilsonline.api.get_company_users",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({company_name:n.value.name})})).json();e.message&&(q.value=e.message.admin_users||[],B.value=e.message.linked_users||[])}catch(o){console.error("Error loading users:",o)}})}function K(){_.value=!1,i.value=M({},n.value)}function Q(){return h(this,null,function*(){g.value=!0;try{const e=yield(yield fetch("/api/method/councilsonline.api.update_company_account",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({company_name:n.value.name,updates:i.value})})).json();e.message&&e.message.success?(n.value=M(M({},n.value),i.value),_.value=!1):alert("Failed to update company profile")}catch(o){console.error("Error updating company:",o),alert("Failed to update company profile")}finally{g.value=!1}})}function D(){C.value=!1,f.value={email:"",role:"Submitter",designation:""},S.value=null}function Y(){return h(this,null,function*(){var o;P.value=!0,S.value=null;try{const y=yield(yield fetch("/api/method/councilsonline.api.send_company_invitation",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({company_name:n.value.name,email:f.value.email,role:f.value.role,designation:f.value.designation})})).json();y.message&&y.message.success?(D(),yield A()):S.value=((o=y.message)==null?void 0:o.message)||"Failed to send invitation"}catch(e){console.error("Error sending invitation:",e),S.value="Failed to send invitation"}finally{P.value=!1}})}function L(o,e){N.value={email:o,role:e},R.value=!0}function ee(){return h(this,null,function*(){var o;O.value=!0;try{const y=yield(yield fetch("/api/method/councilsonline.api.remove_user_from_company",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({company_name:n.value.name,user_email:N.value.email})})).json();y.message&&y.message.success?(R.value=!1,N.value=null,yield A()):alert(((o=y.message)==null?void 0:o.message)||"Failed to remove user")}catch(e){console.error("Error removing user:",e),alert("Failed to remove user")}finally{O.value=!1}})}function te(o,e){return h(this,null,function*(){try{const T=yield(yield fetch("/api/method/councilsonline.api.update_user_company_role",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({company_name:n.value.name,user_email:o,new_role:e})})).json();T.message&&T.message.success?yield A():alert("Failed to update user role")}catch(y){console.error("Error updating user role:",y),alert("Failed to update user role")}})}function z(o){if(!o)return"?";const e=o.split("@")[0].split(".");return e.length>=2?(e[0][0]+e[1][0]).toUpperCase():o.substring(0,2).toUpperCase()}function se(o){return o?new Date(o).toLocaleDateString("en-NZ",{year:"numeric",month:"short",day:"numeric"}):"N/A"}return(o,e)=>{var T;const y=de("router-link");return l(),r("div",pe,[t("div",ve,[t("div",ye,[t("div",ge,[e[12]||(e[12]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"Company Account Management"),t("p",{class:"text-gray-600 mt-2"},"Manage your company profile, users, and permissions")],-1)),p(y,{to:{name:"Dashboard"},class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:x(()=>[...e[11]||(e[11]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),v(" Back to Dashboard ",-1)])]),_:1})])]),m.value?(l(),r("div",fe,[...e[13]||(e[13]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1),t("p",{class:"text-gray-600 mt-4"},"Loading company account...",-1)])])):a.value?(l(),r("div",be,[t("div",xe,[e[15]||(e[15]=t("svg",{class:"w-6 h-6 text-red-600 mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold text-red-900"},"Error Loading Company Account",-1)),t("p",we,d(a.value),1)])])])):n.value?(l(),r("div",ke,[t("div",_e,[t("div",he,[t("div",Ce,[e[16]||(e[16]=t("h2",{class:"text-xl font-semibold text-gray-900"},"Company Profile",-1)),F.value?(l(),E(c(k),{key:0,onClick:e[0]||(e[0]=s=>_.value=!_.value),variant:"outline",class:"text-sm"},{default:x(()=>[v(d(_.value?"Cancel":"Edit Profile"),1)]),_:1})):b("",!0)])]),t("div",Se,[_.value?(l(),r("form",{key:0,onSubmit:J(Q,["prevent"]),class:"space-y-6"},[t("div",je,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Company Name",-1)),p(c(j),{modelValue:i.value.company_name,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.company_name=s),type:"text",required:"",class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Legal Name",-1)),p(c(j),{modelValue:i.value.legal_name,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.legal_name=s),type:"text",required:"",class:"w-full"},null,8,["modelValue"])])]),t("div",Ve,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Primary Email",-1)),p(c(j),{modelValue:i.value.primary_email,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.primary_email=s),type:"email",required:"",class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Primary Phone",-1)),p(c(j),{modelValue:i.value.primary_phone,"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.primary_phone=s),type:"tel",required:"",class:"w-full"},null,8,["modelValue"])])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Registered Office Address",-1)),Z(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>i.value.registered_office_address=s),required:"",rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[ue,i.value.registered_office_address]])]),t("div",Fe,[p(c(k),{type:"button",onClick:K,variant:"outline"},{default:x(()=>[...e[22]||(e[22]=[v("Cancel",-1)])]),_:1}),p(c(k),{type:"submit",loading:g.value,variant:"solid",class:"bg-blue-600 hover:bg-blue-700 text-white"},{default:x(()=>[...e[23]||(e[23]=[v(" Save Changes ",-1)])]),_:1},8,["loading"])])],32)):(l(),r("div",Te,[t("div",Me,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-500"},"Company Name",-1)),t("p",Ue,d(n.value.company_name),1)]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-500"},"Legal Name",-1)),t("p",Re,d(n.value.legal_name),1)]),n.value.nzbn?(l(),r("div",Ne,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-500"},"NZBN",-1)),t("p",Ae,d(n.value.nzbn),1)])):b("",!0),n.value.company_type?(l(),r("div",Ee,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-500"},"Company Type",-1)),t("p",Pe,d(n.value.company_type),1)])):b("",!0),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-500"},"Primary Email",-1)),t("p",Oe,d(n.value.primary_email),1)]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-500"},"Primary Phone",-1)),t("p",Be,d(n.value.primary_phone),1)])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-500"},"Registered Office Address",-1)),t("p",De,d(n.value.registered_office_address),1)])]))])]),t("div",Ie,[t("div",qe,[t("div",Le,[e[32]||(e[32]=t("div",null,[t("h2",{class:"text-xl font-semibold text-gray-900"},"Team Members"),t("p",{class:"text-sm text-gray-600 mt-1"},"Manage users and their permissions")],-1)),F.value?(l(),E(c(k),{key:0,onClick:e[6]||(e[6]=s=>C.value=!0),variant:"solid",class:"bg-blue-600 hover:bg-blue-700 text-white"},{default:x(()=>[...e[31]||(e[31]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),v(" Invite User ",-1)])]),_:1})):b("",!0)])]),t("div",ze,[t("div",Xe,[e[35]||(e[35]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Administrators",-1)),t("div",$e,[(l(!0),r(G,null,H(q.value,s=>(l(),r("div",{key:s.name,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50"},[t("div",Je,[t("div",Ze,d(z(s.user)),1),t("div",null,[t("p",Ge,d(s.user),1),t("p",He,d(s.designation),1)])]),t("div",We,[e[34]||(e[34]=t("span",{class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"}," Admin ",-1)),F.value&&s.user!==V.value?(l(),E(c(k),{key:0,onClick:I=>L(s.user,"Admin"),variant:"outline",class:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400"},{default:x(()=>[...e[33]||(e[33]=[v(" Remove ",-1)])]),_:1},8,["onClick"])):b("",!0)])]))),128))])]),t("div",null,[e[38]||(e[38]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Team Members",-1)),B.value.length===0?(l(),r("div",Ke," No team members yet. Invite users to collaborate on applications. ")):(l(),r("div",Qe,[(l(!0),r(G,null,H(B.value,s=>(l(),r("div",{key:s.name,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50"},[t("div",Ye,[t("div",et,d(z(s.user)),1),t("div",null,[t("p",tt,d(s.user),1),t("p",st,"Added "+d(se(s.added_date)),1)])]),t("div",ot,[F.value?(l(),r("select",{key:0,value:s.role,onChange:I=>te(s.user,I.target.value),class:"px-3 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...e[36]||(e[36]=[t("option",{value:"Submitter"},"Submitter",-1),t("option",{value:"Viewer"},"Viewer",-1)])],40,lt)):(l(),r("span",{key:1,class:me(["inline-flex items-center px-3 py-1 rounded-full text-xs font-medium",s.role==="Submitter"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},d(s.role),3)),F.value?(l(),E(c(k),{key:2,onClick:I=>L(s.user,s.role),variant:"outline",class:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400"},{default:x(()=>[...e[37]||(e[37]=[v(" Remove ",-1)])]),_:1},8,["onClick"])):b("",!0)])]))),128))]))])])])])):b("",!0)]),C.value?(l(),r("div",at,[t("div",nt,[t("div",{class:"p-6 border-b border-gray-200"},[t("div",{class:"flex items-center justify-between"},[e[40]||(e[40]=t("h3",{class:"text-xl font-semibold text-gray-900"},"Invite User",-1)),t("button",{onClick:D,class:"text-gray-400 hover:text-gray-600"},[...e[39]||(e[39]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),t("form",{onSubmit:J(Y,["prevent"]),class:"p-6 space-y-4"},[t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Email Address",-1)),p(c(j),{modelValue:f.value.email,"onUpdate:modelValue":e[7]||(e[7]=s=>f.value.email=s),type:"email",required:"",placeholder:"user@example.com",class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Role",-1)),Z(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>f.value.role=s),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[...e[42]||(e[42]=[t("option",{value:"Admin"},"Admin - Full access, can manage users and billing",-1),t("option",{value:"Submitter"},"Submitter - Can create and submit applications",-1),t("option",{value:"Viewer"},"Viewer - Can only view applications",-1)])],512),[[ce,f.value.role]])]),f.value.role==="Admin"?(l(),r("div",rt,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Designation",-1)),p(c(j),{modelValue:f.value.designation,"onUpdate:modelValue":e[9]||(e[9]=s=>f.value.designation=s),type:"text",placeholder:"Manager, Director, etc.",class:"w-full"},null,8,["modelValue"])])):b("",!0),S.value?(l(),r("div",it,[t("p",dt,d(S.value),1)])):b("",!0),t("div",ut,[p(c(k),{type:"button",onClick:D,variant:"outline"},{default:x(()=>[...e[45]||(e[45]=[v("Cancel",-1)])]),_:1}),p(c(k),{type:"submit",loading:P.value,variant:"solid",class:"bg-blue-600 hover:bg-blue-700 text-white"},{default:x(()=>[...e[46]||(e[46]=[v(" Send Invitation ",-1)])]),_:1},8,["loading"])])],32)])])):b("",!0),R.value?(l(),r("div",mt,[t("div",ct,[e[51]||(e[51]=t("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"Remove User",-1)),t("p",pt,[e[47]||(e[47]=v(" Are you sure you want to remove ",-1)),t("strong",null,d((T=N.value)==null?void 0:T.email),1),e[48]||(e[48]=v(" from the company account? ",-1))]),t("div",vt,[p(c(k),{onClick:e[10]||(e[10]=s=>R.value=!1),variant:"outline"},{default:x(()=>[...e[49]||(e[49]=[v("Cancel",-1)])]),_:1}),p(c(k),{onClick:ee,loading:O.value,variant:"solid",class:"bg-red-600 hover:bg-red-700 text-white"},{default:x(()=>[...e[50]||(e[50]=[v(" Remove User ",-1)])]),_:1},8,["loading"])])])])):b("",!0)])}}};export{xt as default};
//# sourceMappingURL=CompanyManagement--H5M5gAS.js.map
