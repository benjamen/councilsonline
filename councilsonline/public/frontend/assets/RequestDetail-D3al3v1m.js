const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SendMessageModal--wyc0SE8.js","assets/vue-vendor-B0shnPjy.js","assets/frappe-ui-D6fYUZUl.js","assets/ui-components-CzNebsXy.js","assets/frappe-ui-BcYQ_VTL.css","assets/BookMeetingModal-DAzWoozx.js","assets/PaymentModal-B7NAsKFs.js"])))=>i.map(i=>d[i]);
var Fe=Object.defineProperty;var re=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var ie=(o,p,a)=>p in o?Fe(o,p,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[p]=a,O=(o,p)=>{for(var a in p||(p={}))Re.call(p,a)&&ie(o,a,p[a]);if(re)for(var a of re(p))je.call(p,a)&&ie(o,a,p[a]);return o};var A=(o,p,a)=>new Promise((l,m)=>{var k=v=>{try{D(a.next(v))}catch(M){m(M)}},P=v=>{try{D(a.throw(v))}catch(M){m(M)}},D=v=>v.done?l(v.value):Promise.resolve(v.value).then(k,P);D((a=a.apply(o,p)).next())});import{h as S,a as j,_ as J}from"./frappe-ui-D6fYUZUl.js";import{a as d,o as i,b as e,O as F,e as c,R as _,P as b,a2 as w,u as r,t as u,n as L,aj as Te,F as N,W as B,Q as Le,aq as Ee,a5 as Ve,B as q,w as le,c as T,as as Z}from"./vue-vendor-B0shnPjy.js";import{_ as de}from"./StatusBadge-BSS5uEy_.js";import{_ as ze}from"./RequestHeader-CFcOgVuT.js";import{u as Ie}from"./useStatutoryClock-BB4WEBrO.js";import"./ui-components-CzNebsXy.js";const He={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},Ue={class:"space-y-3"},Oe={class:"bg-blue-50 rounded-lg border border-blue-200 p-6 mt-6"},Je={class:"text-xs text-blue-800 mb-4"},Ze={key:0,class:"text-xs text-blue-800"},Xe={key:1,class:"space-y-2 text-xs text-blue-900"},Qe={key:0,class:"flex items-center space-x-2"},Ye=["href"],We={key:1,class:"flex items-center space-x-2"},Ge=["href"],Ke={__name:"RequestActionsCard",props:{workflowState:{type:String,required:!0},councilDetails:{type:Object,required:!0,default:()=>({loading:!1,data:null})},deleting:{type:Boolean,default:!1}},emits:["edit-draft","send-message","print-application","delete-draft"],setup(o){return(p,a)=>{var l;return i(),d("div",null,[e("div",He,[a[12]||(a[12]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Quick Actions",-1)),e("div",Ue,[o.workflowState==="Draft"?(i(),F(r(S),{key:0,onClick:a[0]||(a[0]=m=>p.$emit("edit-draft")),variant:"solid",theme:"blue",class:"w-full justify-start"},{prefix:b(()=>[...a[4]||(a[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])]),default:b(()=>[a[5]||(a[5]=w(" Edit Draft ",-1))]),_:1})):c("",!0),_(r(S),{onClick:a[1]||(a[1]=m=>p.$emit("send-message")),variant:"outline",class:"w-full justify-start"},{prefix:b(()=>[...a[6]||(a[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})],-1)])]),default:b(()=>[a[7]||(a[7]=w(" Send Message ",-1))]),_:1}),_(r(S),{onClick:a[2]||(a[2]=m=>p.$emit("print-application")),variant:"outline",class:"w-full justify-start"},{prefix:b(()=>[...a[8]||(a[8]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)])]),default:b(()=>[a[9]||(a[9]=w(" Print Application ",-1))]),_:1}),o.workflowState==="Draft"?(i(),F(r(S),{key:1,onClick:a[3]||(a[3]=m=>p.$emit("delete-draft")),variant:"outline",class:"w-full justify-start text-red-600 hover:text-red-700",loading:o.deleting},{prefix:b(()=>[...a[10]||(a[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 1 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])]),default:b(()=>[a[11]||(a[11]=w(" Delete Draft ",-1))]),_:1},8,["loading"])):c("",!0)])]),e("div",Oe,[a[15]||(a[15]=e("h3",{class:"text-sm font-semibold text-blue-900 mb-3"},"Need Help?",-1)),e("p",Je,"Contact "+u(((l=o.councilDetails.data)==null?void 0:l.council_name)||"the council")+" for assistance with your application.",1),o.councilDetails.loading?(i(),d("div",Ze," Loading contact information... ")):o.councilDetails.data?(i(),d("div",Xe,[o.councilDetails.data.contact_email?(i(),d("div",Qe,[a[13]||(a[13]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),e("a",{href:`mailto:${o.councilDetails.data.contact_email}`,class:"hover:underline"},u(o.councilDetails.data.contact_email),9,Ye)])):c("",!0),o.councilDetails.data.contact_phone?(i(),d("div",We,[a[14]||(a[14]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("a",{href:`tel:${o.councilDetails.data.contact_phone}`,class:"hover:underline"},u(o.councilDetails.data.contact_phone),9,Ge)])):c("",!0)])):c("",!0)])])}}},et={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},tt={class:"flex justify-between items-center mb-4"},st={class:"space-y-3"},at={class:"flex justify-between items-center py-2 border-b border-gray-100"},ot={class:"text-sm font-semibold text-gray-900"},nt={class:"flex justify-between items-center py-2 border-b border-gray-100"},rt={class:"text-sm font-semibold text-green-600"},it={class:"flex justify-between items-center py-2"},lt={class:"text-sm font-bold text-orange-600"},dt={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ut={class:"flex justify-between items-center mb-4"},ct={class:"space-y-3"},mt={class:"flex justify-between items-center py-2 border-b border-gray-100"},pt={class:"text-sm font-semibold text-gray-900"},ft={class:"flex justify-between items-center py-2 border-b border-gray-100"},gt={key:0,class:"flex justify-between items-center py-2"},yt={__name:"RequestFeesSection",props:{collectPayment:{type:Boolean,default:!1},makePayment:{type:Boolean,default:!1},paymentStatus:{type:String,default:null},totalFees:{type:Number,default:0},totalPaid:{type:Number,default:0},benefitAmount:{type:Number,default:0},selectedBankAccount:{type:String,default:null}},emits:["make-payment"],setup(o){return(p,a)=>(i(),d("div",null,[o.collectPayment?(i(),d("div",et,[e("div",tt,[a[1]||(a[1]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Fees & Payments",-1)),e("span",{class:L(["text-sm font-medium",o.paymentStatus==="Paid"?"text-green-600":"text-orange-600"])},u(o.paymentStatus||"Unpaid"),3)]),e("div",st,[e("div",at,[a[2]||(a[2]=e("span",{class:"text-sm text-gray-600"},"Total Fees",-1)),e("span",ot,"$"+u(o.totalFees.toFixed(2)),1)]),e("div",nt,[a[3]||(a[3]=e("span",{class:"text-sm text-gray-600"},"Total Paid",-1)),e("span",rt,"$"+u(o.totalPaid.toFixed(2)),1)]),e("div",it,[a[4]||(a[4]=e("span",{class:"text-sm font-medium text-gray-900"},"Outstanding",-1)),e("span",lt,"$"+u((o.totalFees-o.totalPaid).toFixed(2)),1)])]),o.totalFees>o.totalPaid?(i(),F(r(S),{key:0,onClick:a[0]||(a[0]=l=>p.$emit("make-payment")),variant:"solid",theme:"blue",class:"w-full mt-4"},{default:b(()=>[...a[5]||(a[5]=[w(" Make Payment ",-1)])]),_:1})):c("",!0)])):c("",!0),o.makePayment?(i(),d("div",dt,[e("div",ut,[a[6]||(a[6]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Payment to be Received",-1)),e("span",{class:L(["text-sm font-medium",o.paymentStatus==="Paid"?"text-green-600":"text-orange-600"])},u(o.paymentStatus||"Pending"),3)]),a[10]||(a[10]=Te('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4"><div class="flex items-start"><svg class="h-5 w-5 text-blue-600 mt-0.5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="flex-1"><p class="text-sm font-medium text-blue-900">Benefit Payment Information</p><p class="text-sm text-blue-700 mt-1"> Once your application is approved, you will receive payment from the council. Please ensure your bank details are up to date. </p></div></div></div>',1)),e("div",ct,[e("div",mt,[a[7]||(a[7]=e("span",{class:"text-sm text-gray-600"},"Benefit Amount",-1)),e("span",pt," $"+u(o.benefitAmount.toFixed(2)),1)]),e("div",ft,[a[8]||(a[8]=e("span",{class:"text-sm text-gray-600"},"Payment Status",-1)),e("span",{class:L(["text-sm font-semibold",o.paymentStatus==="Paid"?"text-green-600":"text-orange-600"])},u(o.paymentStatus||"Pending Approval"),3)]),o.selectedBankAccount?(i(),d("div",gt,[...a[9]||(a[9]=[e("span",{class:"text-sm text-gray-600"},"Payment Method",-1),e("span",{class:"text-sm font-medium text-gray-900"},"Bank Transfer",-1)])])):c("",!0)])])):c("",!0)]))}},xt={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},bt={class:"flex justify-between items-start mb-4"},_t={key:0,class:"space-y-4"},vt={class:"grid grid-cols-2 gap-3 text-sm"},ht={class:"ml-2 text-gray-900"},wt={class:"ml-2 text-gray-900"},kt={key:0,class:"col-span-2"},$t={class:"ml-2 text-gray-900"},qt={key:1,class:"col-span-2"},Dt={class:"ml-2 text-gray-900"},Mt={key:2,class:"col-span-2"},Ct={class:"ml-2 text-gray-900"},St={key:3,class:"col-span-2"},Pt=["href"],At={key:0,class:"mt-3 pt-3 border-t border-blue-200"},Nt={class:"mt-1 text-sm text-gray-900"},Bt={key:1,class:"mt-3 pt-3 border-t border-blue-200"},Ft={class:"mt-2 space-y-1"},Rt={key:2,class:"mt-4 pt-3 border-t border-blue-200 flex space-x-3"},jt=["onClick"],Tt=["onClick","disabled"],Lt={key:1,class:"text-center py-6"},Et={__name:"RequestMeetingsSection",props:{show:{type:Boolean,default:!1},meetings:{type:Array,default:()=>[]},cancelling:{type:Boolean,default:!1}},emits:["book-meeting","edit-meeting","cancel-meeting"],setup(o){const p=a=>a?new Date(a).toLocaleString("en-NZ",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return(a,l)=>o.show?(i(),d("div",xt,[e("div",bt,[l[1]||(l[1]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-900"},"Council Meeting"),e("p",{class:"text-sm text-gray-600 mt-1"}," Schedule a meeting with council planners to discuss your application ")],-1)),o.meetings&&o.meetings.length>0?(i(),d("span",{key:0,class:L(["px-3 py-1 rounded-full text-sm font-medium",{"bg-yellow-100 text-yellow-800":o.meetings[0].status==="Requested","bg-blue-100 text-blue-800":o.meetings[0].status==="Scheduled"||o.meetings[0].status==="Confirmed","bg-green-100 text-green-800":o.meetings[0].status==="Completed","bg-gray-100 text-gray-800":o.meetings[0].status==="Cancelled"}])},u(o.meetings[0].status),3)):c("",!0)]),o.meetings&&o.meetings.length>0?(i(),d("div",_t,[(i(!0),d(N,null,B(o.meetings,m=>(i(),d("div",{key:m.name,class:"border-l-4 border-blue-500 bg-blue-50 p-4 rounded"},[e("div",vt,[e("div",null,[l[2]||(l[2]=e("span",{class:"font-medium text-gray-700"},"Type:",-1)),e("span",ht,u(m.meeting_type),1)]),e("div",null,[l[3]||(l[3]=e("span",{class:"font-medium text-gray-700"},"Status:",-1)),e("span",wt,u(m.status),1)]),m.scheduled_start?(i(),d("div",kt,[l[4]||(l[4]=e("span",{class:"font-medium text-gray-700"},"Scheduled:",-1)),e("span",$t,u(p(m.scheduled_start)),1)])):c("",!0),m.meeting_format?(i(),d("div",qt,[l[5]||(l[5]=e("span",{class:"font-medium text-gray-700"},"Format:",-1)),e("span",Dt,u(m.meeting_format),1)])):c("",!0),m.meeting_location?(i(),d("div",Mt,[l[6]||(l[6]=e("span",{class:"font-medium text-gray-700"},"Location:",-1)),e("span",Ct,u(m.meeting_location),1)])):c("",!0),m.google_meet_link?(i(),d("div",St,[l[7]||(l[7]=e("span",{class:"font-medium text-gray-700"},"Meeting Link:",-1)),e("a",{href:m.google_meet_link,target:"_blank",class:"ml-2 text-blue-600 hover:underline"},"Join Meeting",8,Pt)])):c("",!0)]),m.meeting_purpose?(i(),d("div",At,[l[8]||(l[8]=e("span",{class:"font-medium text-gray-700 text-sm"},"Purpose:",-1)),e("p",Nt,u(m.meeting_purpose),1)])):c("",!0),m.status==="Requested"&&m.proposed_slots&&m.proposed_slots.length>0?(i(),d("div",Bt,[l[10]||(l[10]=e("span",{class:"font-medium text-gray-700 text-sm"},"Proposed Time Slots:",-1)),e("ul",Ft,[(i(!0),d(N,null,B(m.proposed_slots,(k,P)=>(i(),d("li",{key:P,class:"text-sm text-gray-900 flex items-center"},[l[9]||(l[9]=e("svg",{class:"w-4 h-4 mr-2 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),w(" "+u(p(k)),1)]))),128))])])):c("",!0),m.status==="Requested"||m.status==="Scheduled"?(i(),d("div",Rt,[e("button",{onClick:k=>a.$emit("edit-meeting",m),class:"flex-1 px-4 py-2 bg-white border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors text-sm font-medium"},[...l[11]||(l[11]=[e("svg",{class:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),w(" Edit Request ",-1)])],8,jt),e("button",{onClick:k=>a.$emit("cancel-meeting",m),disabled:o.cancelling,class:"flex-1 px-4 py-2 bg-white border border-red-600 text-red-600 rounded-lg hover:bg-red-50 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"},[...l[12]||(l[12]=[e("svg",{class:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),w(" Cancel Meeting ",-1)])],8,Tt)])):c("",!0)]))),128))])):(i(),d("div",Lt,[l[13]||(l[13]=e("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),l[14]||(l[14]=e("p",{class:"text-sm text-gray-600 mb-4"}," No meeting scheduled yet. Book a meeting to discuss your application with council planners. ",-1)),e("button",{onClick:l[0]||(l[0]=m=>a.$emit("book-meeting")),class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," Request Council Meeting ")]))])):c("",!0)}},Vt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},zt={key:0,class:"mb-6 p-4 bg-blue-50 rounded-lg"},It={class:"flex items-center justify-between mb-2"},Ht={class:"text-xs text-blue-700"},Ut={class:"w-full bg-blue-200 rounded-full h-2"},Ot={class:"mt-2 text-xs text-blue-700"},Jt={class:"space-y-4"},Zt={class:"flex items-start space-x-3"},Xt={class:"flex-1"},Qt={class:"text-xs text-gray-500"},Yt={key:0,class:"flex items-start space-x-3"},Wt={class:"flex-1"},Gt={class:"text-xs text-gray-500"},Kt={__name:"RequestTimelineCard",props:{clockData:{type:Object,required:!0,default:()=>({statutory_clock_started:!1,working_days_elapsed:0,working_days_remaining:20,statutory_clock_stopped:!1})},progressPercent:{type:Number,default:0},creation:{type:String,required:!0},modified:{type:String,required:!0}},setup(o){const p=a=>a?new Date(a).toLocaleDateString("en-NZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return(a,l)=>(i(),d("div",Vt,[l[5]||(l[5]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Processing Timeline",-1)),o.clockData.statutory_clock_started?(i(),d("div",zt,[e("div",It,[l[0]||(l[0]=e("span",{class:"text-sm font-medium text-blue-900"},"SLA / Statutory Clock",-1)),e("span",Ht,u(o.clockData.working_days_elapsed)+" of 20 days",1)]),e("div",Ut,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Le({width:`${o.progressPercent}%`})},null,4)]),e("p",Ot,u(o.clockData.statutory_clock_stopped?"Clock stopped (RFI issued)":`${o.clockData.working_days_remaining} days remaining`),1)])):c("",!0),e("div",Jt,[e("div",Zt,[l[2]||(l[2]=e("div",{class:"flex-shrink-0 w-8 h-8 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})])],-1)),e("div",Xt,[l[1]||(l[1]=e("p",{class:"text-sm font-medium text-gray-900"},"Application Created",-1)),e("p",Qt,u(p(o.creation)),1)])]),o.modified!==o.creation?(i(),d("div",Yt,[l[4]||(l[4]=e("div",{class:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})])],-1)),e("div",Wt,[l[3]||(l[3]=e("p",{class:"text-sm font-medium text-gray-900"},"Last Updated",-1)),e("p",Gt,u(p(o.modified)),1)])])):c("",!0)])]))}},es={class:"min-h-screen bg-gray-50"},ts={key:0,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12"},ss={key:1,class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},as={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},os={class:"lg:col-span-2 space-y-6"},ns={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},rs={class:"grid grid-cols-2 gap-4"},is={class:"mt-1 text-sm text-gray-900"},ls={class:"mt-1 text-sm text-gray-900"},ds={class:"mt-1"},us={class:"mt-1 text-sm text-gray-900"},cs={class:"mt-6 pt-6 border-t border-gray-200"},ms={class:"mt-1 text-sm text-gray-900"},ps={class:"mt-4"},fs=["innerHTML"],gs={key:0,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ys={class:"grid grid-cols-2 gap-4"},xs={key:0},bs={class:"mt-1 text-sm text-gray-900"},_s={key:1},vs={class:"mt-1 text-sm text-gray-900"},hs={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ws={class:"grid grid-cols-2 gap-4"},ks={class:"mt-1 text-sm text-gray-900"},$s={class:"mt-1 text-sm text-gray-900"},qs={class:"mt-1 text-sm text-gray-900"},Ds={class:"mt-1 text-sm text-gray-900"},Ms={key:0},Cs={class:"mt-1 text-sm text-gray-900"},Ss={key:1,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},Ps={class:"grid grid-cols-2 gap-4"},As={key:0},Ns={class:"mt-1 text-sm text-gray-900"},Bs={key:1},Fs={class:"mt-1 text-sm text-gray-900"},Rs={key:2},js={class:"mt-1 text-sm text-gray-900"},Ts={key:3},Ls={class:"mt-1 text-sm text-gray-900"},Es={key:4,class:"col-span-2"},Vs={class:"mt-1 text-sm text-gray-900"},zs={class:"text-lg font-semibold text-gray-900 mb-4"},Is={class:"space-y-4"},Hs={key:0,class:"text-md font-medium text-gray-700 mb-3"},Us={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Os={class:"text-sm font-medium text-gray-500"},Js={class:"mt-1 text-sm text-gray-900"},Zs={key:0,class:"text-gray-500 text-sm"},Xs={key:3,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},Qs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ys={class:"text-sm font-medium text-gray-500"},Ws={class:"mt-1 text-sm text-gray-900"},Gs={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},Ks={class:"flex justify-between items-center mb-4"},ea={key:0,class:"text-center py-8"},ta={class:"space-y-6"},da={__name:"RequestDetail",setup(o){const p=Z(()=>J(()=>import("./SendMessageModal--wyc0SE8.js"),__vite__mapDeps([0,1,2,3,4]))),a=Z(()=>J(()=>import("./BookMeetingModal-DAzWoozx.js"),__vite__mapDeps([5,1,2,3,4]))),l=Z(()=>J(()=>import("./PaymentModal-B7NAsKFs.js"),__vite__mapDeps([6,1,2,3,4]))),m=Ee(),k=Ve(),P=q(null),D=q(!1),v=q(!1),M=q(!1),E=q(!1),V=q(!1),R=q(!1),n=j({url:"frappe.client.get",params:{doctype:"Request",name:m.params.id},auto:!0}),z=j({url:"councilsonline.api.get_request_meetings",params:{request_id:m.params.id},auto:!0}),h=j({url:"councilsonline.api.get_request_type_config",auto:!1}),X=j({url:"frappe.client.get",auto:!1});le(()=>{var s;return(s=n.data)==null?void 0:s.request_type},s=>{s&&h.fetch({request_type_code:s})},{immediate:!0}),le(()=>{var s;return(s=n.data)==null?void 0:s.council},s=>{s&&X.fetch({doctype:"Council",name:s,fields:["name","council_name","contact_email","contact_phone"]})},{immediate:!0});const{clockData:ue,progressPercent:ce}=Ie(n),I=T(()=>{if(!n.data)return{};try{let s=null;if(n.data.draft_full_data&&(s=typeof n.data.draft_full_data=="string"?JSON.parse(n.data.draft_full_data):n.data.draft_full_data),!s)return{};const t=["name","owner","creation","modified","modified_by","docstatus","idx","council","request_type","request_number","status","requester","requester_name","requester_email","requester_phone","requester_signature","applicant_address","applicant_company","property","property_address","legal_description","brief_description","detailed_description","delivery_preference","invoice_to","invoice_recipient_name","invoice_recipient_email","purchase_order_number","total_fees","total_paid","payment_status","request_category","draft_current_step","draft_total_steps","draft_full_data","form_data","signature_date"],g={};return Object.keys(s).forEach(f=>{!t.includes(f)&&s[f]!==null&&s[f]!==""&&(g[f]=s[f])}),g}catch(s){return console.error("Error parsing form data:",s),{}}}),y=T(()=>{if(!n.data)return{};try{let s={};return n.data.draft_full_data&&(s=typeof n.data.draft_full_data=="string"?JSON.parse(n.data.draft_full_data):n.data.draft_full_data),O(O({},n.data),s)}catch(s){return console.error("Error merging form data:",s),n.data}}),Q=T(()=>{var s;return(s=h.data)!=null&&s.steps?h.data.steps.filter(t=>t.show_on_review):[]}),me=T(()=>{var s,t;return!!((s=y.value)!=null&&s.property_address||(t=h.data)!=null&&t.property_required)}),pe=s=>{if(!s.sections)return!1;for(const t of s.sections)if(t.show_on_review){for(const g of t.fields)if(g.show_on_review&&n.data[g.field_name])return!0}return!1},fe=(s,t)=>{if(t==null||t==="")return"Not provided";if(s.field_type==="Check")return t?"Yes":"No";if(s.field_type==="Date"&&t)try{return new Date(t).toLocaleDateString("en-NZ",{year:"numeric",month:"long",day:"numeric"})}catch(g){return t}return s.field_type==="Currency"&&t?`$${Number.parseFloat(t).toFixed(2)}`:Array.isArray(t)?t.join(", "):t},ge=s=>s.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),ye=s=>{if(s==null||s==="")return"Not provided";if(typeof s=="boolean")return s?"Yes":"No";if(Array.isArray(s))return s.join(", ");if(typeof s=="object")return JSON.stringify(s);if(typeof s=="string"&&/^\d{4}-\d{2}-\d{2}/.test(s))try{return new Date(s).toLocaleDateString("en-NZ",{year:"numeric",month:"long",day:"numeric"})}catch(t){return s}return s},xe=s=>{if(!s)return null;if(typeof s=="string")return s;if(s.full_address)return s.full_address;const t=[];return s.address_line&&t.push(s.address_line),s.barangay&&t.push(`Brgy. ${s.barangay}`),s.municipality&&t.push(s.municipality),s.province&&t.push(s.province),s.zip_code&&t.push(s.zip_code),t.length>0?t.join(", "):null},be=()=>{k.push({name:"Dashboard"})},_e=s=>s?new Date(s).toLocaleDateString("en-NZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",ve=()=>{P.value.click()},he=s=>A(this,null,function*(){const t=Array.from(s.target.files);if(t.length!==0){D.value=!0;try{for(const g of t){const f=new FormData;f.append("file",g),f.append("doctype","Request"),f.append("docname",n.data.name),f.append("is_private",0),yield fetch("/api/method/upload_file",{method:"POST",headers:{"X-Frappe-CSRF-Token":window.csrf_token},body:f})}alert(`${t.length} document(s) uploaded successfully!`),n.reload(),s.target.value=""}catch(g){console.error("Error uploading file:",g),alert("Failed to upload document. Please try again.")}finally{D.value=!1}}}),we=()=>{V.value=!0},ke=()=>{n.reload()},$e=()=>{window.print()},qe=()=>{if(!n.data){alert("Error: Request data not loaded");return}if(!n.data.request_type){alert("Error: Request type missing");return}const s=`/request/new?type=${encodeURIComponent(n.data.request_type)}&draft=${encodeURIComponent(n.data.name)}`;k.push(s)},De=()=>A(this,null,function*(){if(confirm("Are you sure you want to delete this draft application? This action cannot be undone.")){M.value=!0;try{yield fetch("/api/method/frappe.client.delete",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({doctype:"Request",name:n.data.name})}),alert("Draft deleted successfully"),k.push({name:"Dashboard"})}catch(s){console.error("Error deleting draft:",s),alert("Failed to delete draft. Please try again.")}finally{M.value=!1}}}),Me=()=>A(this,null,function*(){if(confirm("Are you sure you want to submit this application? Once submitted, it cannot be edited.")){v.value=!0;try{const t=yield(yield fetch("/api/method/councilsonline.councilsonline.doctype.request.request.submit_application",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({request_id:n.data.name})})).json();if(t.message&&t.message.success)alert(`Application submitted successfully! Request Number: ${t.message.request_number}`),n.reload();else throw new Error("Failed to submit application")}catch(s){console.error("Error submitting application:",s),alert("Failed to submit application. Please try again.")}finally{v.value=!1}}}),H=q(!1),Ce=()=>{H.value=!0},Se=s=>{const t=s.warning||`Invoice requested successfully!

Invoice #${s.invoice_number}
An email has been sent to ${s.email}`;alert(t),n.reload()},Pe=()=>{R.value=!0},Ae=s=>A(this,null,function*(){alert(`Meeting request submitted successfully!

Meeting ID: ${s.meeting_id}
Status: ${s.status}

A council planner will contact you within 2 business days.`),U.value=null,yield z.reload()}),U=q(null),Ne=s=>{U.value=s,R.value=!0},Be=s=>A(this,null,function*(){var t;if(confirm(`Are you sure you want to cancel this meeting request?

Meeting Type: ${s.meeting_type}
Status: ${s.status}

This action cannot be undone.`)){E.value=!0;try{const f=yield(yield fetch("/api/method/councilsonline.api.cancel_meeting",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify({meeting_id:s.name})})).json();if(f.message&&f.message.success)alert("Meeting cancelled successfully."),yield z.reload();else throw new Error(((t=f.message)==null?void 0:t.error)||"Failed to cancel meeting")}catch(g){console.error("Error cancelling meeting:",g),alert(`Failed to cancel meeting: ${g.message}

Please try again or contact support.`)}finally{E.value=!1}}});return(s,t)=>{var g,f,Y,W,G,K,ee,te,se,ae,oe,ne;return i(),d("div",es,[_(ze,{title:((g=r(n).data)==null?void 0:g.request_number)||"Loading...",subtitle:(f=r(n).data)==null?void 0:f.request_type,loading:r(n).loading,onBack:be},{actions:b(()=>{var x;return[r(n).data?(i(),F(de,{key:0,status:r(n).data.workflow_state},null,8,["status"])):c("",!0),((x=r(n).data)==null?void 0:x.workflow_state)==="Draft"?(i(),F(r(S),{key:1,onClick:Me,variant:"solid",theme:"blue",loading:v.value},{default:b(()=>[...t[3]||(t[3]=[w(" Submit Application ",-1)])]),_:1},8,["loading"])):c("",!0)]}),_:1},8,["title","subtitle","loading"]),e("input",{ref_key:"fileInput",ref:P,type:"file",multiple:"",class:"hidden",onChange:he},null,544),r(n).loading?(i(),d("div",ts,[...t[4]||(t[4]=[e("div",{class:"text-center"},[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e("p",{class:"mt-4 text-gray-500"},"Loading request details...")],-1)])])):r(n).data?(i(),d("div",ss,[e("div",as,[e("div",os,[e("div",ns,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Application Overview",-1)),e("div",rs,[e("div",null,[t[5]||(t[5]=e("label",{class:"text-sm font-medium text-gray-500"},"Request Number",-1)),e("p",is,u(r(n).data.request_number),1)]),e("div",null,[t[6]||(t[6]=e("label",{class:"text-sm font-medium text-gray-500"},"Type",-1)),e("p",ls,u(r(n).data.request_type),1)]),e("div",null,[t[7]||(t[7]=e("label",{class:"text-sm font-medium text-gray-500"},"Status",-1)),e("div",ds,[_(de,{status:r(n).data.workflow_state},null,8,["status"])])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-gray-500"},"Submitted Date",-1)),e("p",us,u(_e(r(n).data.creation)),1)])]),e("div",cs,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-gray-500"},"Brief Description",-1)),e("p",ms,u(r(n).data.brief_description||"N/A"),1)]),e("div",ps,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-gray-500"},"Detailed Description",-1)),e("div",{class:"mt-1 text-sm text-gray-900 prose prose-sm max-w-none",innerHTML:r(n).data.detailed_description||"N/A"},null,8,fs)])]),me.value?(i(),d("div",gs,[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Property Information",-1)),e("div",ys,[y.value.property_address?(i(),d("div",xs,[t[12]||(t[12]=e("label",{class:"text-sm font-medium text-gray-500"},"Address",-1)),e("p",bs,u(y.value.property_address),1)])):c("",!0),y.value.legal_description?(i(),d("div",_s,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-gray-500"},"Legal Description",-1)),e("p",vs,u(y.value.legal_description),1)])):c("",!0)])])):c("",!0),e("div",hs,[t[20]||(t[20]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Applicant Information",-1)),e("div",ws,[e("div",null,[t[15]||(t[15]=e("label",{class:"text-sm font-medium text-gray-500"},"Name",-1)),e("p",ks,u(y.value.full_name||y.value.requester_name||"N/A"),1)]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-sm font-medium text-gray-500"},"Email",-1)),e("p",$s,u(y.value.requester_email||"N/A"),1)]),e("div",null,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-gray-500"},"Phone",-1)),e("p",qs,u(y.value.mobile_number||y.value.requester_phone||"N/A"),1)]),e("div",null,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-gray-500"},"Address",-1)),e("p",Ds,u(xe(y.value.address_line)||y.value.applicant_address||"N/A"),1)]),y.value.applicant_company?(i(),d("div",Ms,[t[19]||(t[19]=e("label",{class:"text-sm font-medium text-gray-500"},"Company/Organization",-1)),e("p",Cs,u(y.value.applicant_company),1)])):c("",!0)])]),(Y=r(h).data)!=null&&Y.collect_payment?(i(),d("div",Ss,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Delivery & Payment Preferences",-1)),e("div",Ps,[r(n).data.delivery_preference?(i(),d("div",As,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-gray-500"},"Delivery Preference",-1)),e("p",Ns,u(r(n).data.delivery_preference),1)])):c("",!0),r(n).data.invoice_to?(i(),d("div",Bs,[t[22]||(t[22]=e("label",{class:"text-sm font-medium text-gray-500"},"Invoice To",-1)),e("p",Fs,u(r(n).data.invoice_to),1)])):c("",!0),r(n).data.invoice_recipient_name?(i(),d("div",Rs,[t[23]||(t[23]=e("label",{class:"text-sm font-medium text-gray-500"},"Invoice Recipient Name",-1)),e("p",js,u(r(n).data.invoice_recipient_name),1)])):c("",!0),r(n).data.invoice_recipient_email?(i(),d("div",Ts,[t[24]||(t[24]=e("label",{class:"text-sm font-medium text-gray-500"},"Invoice Recipient Email",-1)),e("p",Ls,u(r(n).data.invoice_recipient_email),1)])):c("",!0),r(n).data.purchase_order_number?(i(),d("div",Es,[t[25]||(t[25]=e("label",{class:"text-sm font-medium text-gray-500"},"Purchase Order Number",-1)),e("p",Vs,u(r(n).data.purchase_order_number),1)])):c("",!0)])])):c("",!0),_(Et,{show:(W=r(h).data)==null?void 0:W.council_meeting_available,meetings:r(z).data,cancelling:E.value,onBookMeeting:Pe,onEditMeeting:Ne,onCancelMeeting:Be},null,8,["show","meetings","cancelling"]),Q.value.length>0?(i(!0),d(N,{key:2},B(Q.value,x=>(i(),d("div",{key:x.step_code,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},[e("h2",zs,u(x.step_title),1),e("div",Is,[(i(!0),d(N,null,B(x.sections.filter($=>$.show_on_review),$=>(i(),d("div",{key:$.section_code},[$.section_title?(i(),d("h3",Hs,u($.section_title),1)):c("",!0),e("div",Us,[(i(!0),d(N,null,B($.fields.filter(C=>C.show_on_review),C=>(i(),d("div",{key:C.field_name,class:"border-b border-gray-100 pb-3"},[e("label",Os,u(C.review_label||C.field_label),1),e("p",Js,u(fe(C,y.value[C.field_name])),1)]))),128))])]))),128)),pe(x)?c("",!0):(i(),d("p",Zs," No information to display "))])]))),128)):I.value&&Object.keys(I.value).length>0?(i(),d("div",Xs,[t[27]||(t[27]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Application Details",-1)),e("div",Qs,[(i(!0),d(N,null,B(I.value,(x,$)=>(i(),d("div",{key:$,class:"border-b border-gray-100 pb-3"},[e("label",Ys,u(ge($)),1),e("p",Ws,u(ye(x)),1)]))),128))])])):c("",!0),_(yt,{"collect-payment":(G=r(h).data)==null?void 0:G.collect_payment,"make-payment":(K=r(h).data)==null?void 0:K.make_payment,"payment-status":r(n).data.payment_status,"total-fees":r(n).data.total_fees||0,"total-paid":r(n).data.total_paid||0,"benefit-amount":((ee=r(h).data)==null?void 0:ee.base_fee)||0,"selected-bank-account":r(n).data.selected_bank_account,onMakePayment:Ce},null,8,["collect-payment","make-payment","payment-status","total-fees","total-paid","benefit-amount","selected-bank-account"]),e("div",Gs,[e("div",Ks,[t[30]||(t[30]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Documents",-1)),_(r(S),{onClick:ve,variant:"outline",size:"sm",loading:D.value},{prefix:b(()=>[...t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)])]),default:b(()=>[t[29]||(t[29]=w(" Upload Document ",-1))]),_:1},8,["loading"])]),!r(n).data.attachments||r(n).data.attachments.length===0?(i(),d("div",ea,[...t[31]||(t[31]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"mt-2 text-sm text-gray-500"},"No documents uploaded yet",-1)])])):c("",!0)])]),e("div",ta,[_(Kt,{"clock-data":r(ue),"progress-percent":r(ce),creation:r(n).data.creation,modified:r(n).data.modified},null,8,["clock-data","progress-percent","creation","modified"]),_(Ke,{"workflow-state":r(n).data.workflow_state,"council-details":r(X),deleting:M.value,onEditDraft:qe,onSendMessage:we,onPrintApplication:$e,onDeleteDraft:De},null,8,["workflow-state","council-details","deleting"])])])])):c("",!0),_(r(p),{show:V.value,"onUpdate:show":t[0]||(t[0]=x=>V.value=x),"request-id":r(m).params.id,onSent:ke},null,8,["show","request-id"]),_(r(a),{show:R.value,"onUpdate:show":t[1]||(t[1]=x=>R.value=x),"request-id":r(m).params.id,"request-type-code":(te=r(h).data)==null?void 0:te.type_code,"council-code":(se=r(n).data)==null?void 0:se.council,meeting:U.value,onBooked:Ae},null,8,["show","request-id","request-type-code","council-code","meeting"]),_(r(l),{show:H.value,"onUpdate:show":t[2]||(t[2]=x=>H.value=x),"request-id":r(m).params.id,"total-amount":((ae=r(n).data)==null?void 0:ae.total_fees_incl_gst)||0,"fees-excl-gst":((oe=r(n).data)==null?void 0:oe.total_fees_excl_gst)||0,gst:((ne=r(n).data)==null?void 0:ne.gst_amount)||0,"stripe-enabled":!1,onInvoiceRequested:Se},null,8,["show","request-id","total-amount","fees-excl-gst","gst"])])}}};export{da as default};
//# sourceMappingURL=RequestDetail-D3al3v1m.js.map
