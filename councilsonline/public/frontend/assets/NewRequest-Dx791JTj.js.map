{"version":3,"mappings":"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","names":["state","_a","_b","newStep","maxStep","configIndex","stepIndex","requestTypeCode","draftId","__async","configResource","resolve","checkLoaded","error","resource","draft","draftStep","sanitizedData","key","value","item","fileUrl","result","fieldName","fields","isValid","router","store","showSaveDraftModal","showValidationModal","showMeetingModal","showSubmissionSuccessModal","submissionResult","handleBookMeeting","handleMeetingBooked","meetingData","showValidationErrors","errors","handleSaveDraft","handleSaveAndClose","handleSubmit","savePersonalInfoToProfile","saveAddressesToProfile","formData","personalInfo","addressFields","addressData","handleViewRequestFromModal","requestId","handleGoToDashboardFromModal","councilCode","councilStore","totalSteps","stepTitles","titles","s","usesConfigurableSteps","currentStepConfig","dynamicStepIndex","shouldShowMeetingBanner","getCurrentStepTitle","index","getCurrentStepConfig","dynamicStepsStart","getCouncilName","expression","cleanExpression","section","field","e","validation","validationType","minAge","today","born","age","m","isValidating","validateConfigField","fieldConfig","utilValidateField","validateStep","stepConfig","evaluateDependsOn","addressLineData","clearErrors","clearFieldError","options","validationErrors","onValidationError","canNavigateNext","canSaveDraft","handleNext","handlePrevious","goBack","loadUserProfile","headers","err","defaultProperty","p","defaultCouncil","c","getApplicationAutoFill","profile","autoFillData","prop","applyAutoFill","overrideExisting","fieldsToSkip","getAllProperties","getAllCouncils","getAllClients","isProfileComplete","hasBasicInfo","_c","profileCompletionPercentage","completed","total","route","onRequestTypeSelected","requestTypes","selectedRequestTypeDetails","loadRequestTypes","selectRequestType","initialize","setupRouteGuard","to","from","next","setupAgeValidation","newDate","props","__props","progressPercentage","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","emit","__emit","_createBlock","_unref","Button","_cache","_createTextVNode","selectType","type","updatedValue","__spreadProps","__spreadValues","_Fragment","_renderList","$event","_normalizeClass","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","handleContinue","currentPath","_hoisted_7","_hoisted_13","_hoisted_15","requestType","birthDate","birth","monthDiff","income","step","docs","missing","dateStr","status","html","tmp","text","maxLength","clean","hasRCRequirements","doc","SaveDraftModal","ValidationErrorModal","BookMeetingModal","SubmissionSuccessModal","DynamicStepRenderer","isResourceConsent","formatApplicationFee","fee","isPH","currency","_createVNode","RequestHeader","RequestProgress","Step2RequestType","Step3ProcessInfo","location","args","StepNavigation"],"ignoreList":[],"sources":["../../../../frontend/src/stores/requestStore.js","../../../../frontend/src/composables/useRequestModals.js","../../../../frontend/src/composables/useStepConfiguration.js","../../../../frontend/src/utils/conditionalLogic.js","../../../../frontend/src/utils/fieldValidation.js","../../../../frontend/src/composables/useStepValidation.ts","../../../../frontend/src/composables/useRequestFormNavigation.js","../../../../frontend/src/composables/useUserProfile.js","../../../../frontend/src/composables/useRequestLifecycle.js","../../../../frontend/src/components/request/RequestProgress.vue","../../../../frontend/src/components/request/StepNavigation.vue","../../../../frontend/src/components/request-steps/Step2RequestType.vue","../../../../frontend/src/components/request-steps/Step3ProcessInfo.vue","../../../../frontend/src/components/request-steps/ReviewStep.vue","../../../../frontend/src/pages/NewRequest.vue"],"sourcesContent":["import { defineStore } from \"pinia\"\nimport { requestService } from \"../services\"\n\nexport const useRequestStore = defineStore(\"request\", {\n\tpersist: {\n\t\tkey: \"requestStore\",\n\t\tstorage: localStorage,\n\t\tpaths: [\"currentRequestId\", \"formData\", \"currentStep\", \"requestTypeCode\"],\n\t},\n\tstate: () => ({\n\t\t// Current request being edited\n\t\tcurrentRequestId: null,\n\t\trequestTypeCode: null,\n\t\trequestTypeConfig: null,\n\n\t\t// Form state\n\t\tformData: {},\n\t\tcurrentStep: 0,\n\n\t\t// Validation\n\t\tstepValidationStatus: {}, // { 0: true, 1: false, ... }\n\n\t\t// UI state\n\t\tisSaving: false,\n\t\tisSubmitting: false,\n\t\tlastSaved: null,\n\n\t\t// Error state\n\t\terror: null,\n\t}),\n\n\tgetters: {\n\t\tisFirstStep: (state) => state.currentStep === 0,\n\n\t\t// === SINGLE-TENANT: Total Steps (matches logic in NewRequest.vue) ===\n\t\ttotalSteps: (state) => {\n\t\t\tif (state.requestTypeConfig?.steps) {\n\t\t\t\t// Single-tenant: Type (0) + Process Info (1) + Dynamic Steps + Review (Last)\n\t\t\t\treturn state.requestTypeConfig.steps.length + 3\n\t\t\t}\n\t\t\treturn 3 // Default: Type, Process Info, Review (no Council step)\n\t\t},\n\t\t// =================================================================\n\n\t\t// === FIXED GETTER: isLastStep ===\n\t\tisLastStep: (state) => {\n\t\t\t// Use the new, correct totalSteps getter\n\t\t\treturn state.currentStep === state.totalSteps - 1\n\t\t},\n\t\t// ================================\n\n\t\tcurrentStepConfig: (state) => {\n\t\t\t// NOTE: This getter still uses the wrong index if totalSteps were used,\n\t\t\t// but the parent component uses its own calculation. Keeping it as-is\n\t\t\t// since it is not currently used by the parent for dynamic steps.\n\t\t\treturn state.requestTypeConfig?.steps?.[state.currentStep]\n\t\t},\n\n\t\tcanNavigateNext: (state) => {\n\t\t\treturn state.stepValidationStatus[state.currentStep] === true\n\t\t},\n\n\t\tcompletionPercentage: (state) => {\n\t\t\tif (state.totalSteps === 0) return 0\n\t\t\treturn Math.round(((state.currentStep + 1) / state.totalSteps) * 100)\n\t\t},\n\n\t\thasUnsavedChanges: (state) => {\n\t\t\t// Check if form data exists and last saved is more than 30 seconds ago\n\t\t\tif (!state.lastSaved) return Object.keys(state.formData).length > 0\n\t\t\tconst now = new Date()\n\t\t\tconst diff = now - state.lastSaved\n\t\t\treturn diff > 30000 // 30 seconds\n\t\t},\n\t},\n\n\tactions: {\n\t\t// ... (initialize, loadDraft, saveProgress, saveDraft, submitRequest actions remain unchanged)\n\n\t\t/**\n\t\t * Navigate to next step with validation\n\t\t */\n\t\tnextStep() {\n\t\t\tconst newStep = this.currentStep + 1\n\t\t\tconst maxStep = this.totalSteps - 1\n\n\t\t\t// Bounds check\n\t\t\tif (newStep > maxStep) {\n\t\t\t\tconsole.error(\"[Store] Navigation beyond bounds prevented\", {\n\t\t\t\t\tcurrentStep: this.currentStep,\n\t\t\t\t\tnewStep,\n\t\t\t\t\tmaxStep,\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Config validation for dynamic steps (steps 2 to totalSteps-2)\n\t\t\t// Dynamic steps need configuration from backend\n\t\t\tconst isDynamicStep = newStep >= 2 && newStep < maxStep\n\t\t\tif (isDynamicStep && this.requestTypeConfig?.steps) {\n\t\t\t\t// Calculate actual step index in requestTypeConfig.steps array\n\t\t\t\t// Dynamic steps: step 2 = steps[0], step 3 = steps[1], etc.\n\t\t\t\tconst configIndex = newStep - 2\n\t\t\t\tconst config = this.requestTypeConfig.steps[configIndex]\n\n\t\t\t\tif (!config) {\n\t\t\t\t\tconsole.error(\"[Store] Missing step config, redirecting to review\", {\n\t\t\t\t\t\tcurrentStep: this.currentStep,\n\t\t\t\t\t\tnewStep,\n\t\t\t\t\t\tconfigIndex,\n\t\t\t\t\t\ttotalConfigSteps: this.requestTypeConfig.steps.length,\n\t\t\t\t\t})\n\t\t\t\t\t// Jump to final review step instead of showing error\n\t\t\t\t\tthis.currentStep = maxStep\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.currentStep = newStep\n\t\t},\n\n\t\t/**\n\t\t * Navigate to previous step\n\t\t */\n\t\tpreviousStep() {\n\t\t\tif (!this.isFirstStep) {\n\t\t\t\tthis.currentStep--\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Jump to specific step\n\t\t */\n\t\tgoToStep(stepIndex) {\n\t\t\t// Use the correct totalSteps getter\n\t\t\tif (stepIndex >= 0 && stepIndex < this.totalSteps) {\n\t\t\t\tthis.currentStep = stepIndex\n\t\t\t}\n\t\t},\n\t\t// ... (updateField, updateFields, setStepValidation, clearError, reset actions remain unchanged)\n\n\t\t// All the boilerplate logic for initialize, loadDraft, saveProgress, etc. goes here\n\t\t// ...\n\t\tasync initialize(requestTypeCode, draftId = null) {\n\t\t\ttry {\n\t\t\t\tthis.requestTypeCode = requestTypeCode\n\t\t\t\tthis.error = null\n\n\t\t\t\tconsole.log(\"[RequestStore] initialize called:\", {\n\t\t\t\t\trequestTypeCode,\n\t\t\t\t\tdraftId,\n\t\t\t\t})\n\n\t\t\t\t// Load request type config\n\t\t\t\tconst configResource =\n\t\t\t\t\trequestService.getRequestTypeConfig(requestTypeCode)\n\n\t\t\t\t// Wait for config to load\n\t\t\t\tawait new Promise((resolve) => {\n\t\t\t\t\tconst checkLoaded = setInterval(() => {\n\t\t\t\t\t\tif (!configResource.loading) {\n\t\t\t\t\t\t\tclearInterval(checkLoaded)\n\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100)\n\t\t\t\t})\n\n\t\t\t\tthis.requestTypeConfig = configResource.data\n\n\t\t\t\tif (draftId) {\n\t\t\t\t\t// Load existing draft\n\t\t\t\t\tawait this.loadDraft(draftId)\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to initialize request:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to load request type\"\n\t\t\t}\n\t\t},\n\n\t\tasync loadDraft(draftId) {\n\t\t\ttry {\n\t\t\t\tconst resource = requestService.getRequest(draftId)\n\n\t\t\t\t// Wait for load\n\t\t\t\tawait new Promise((resolve) => {\n\t\t\t\t\tconst checkLoaded = setInterval(() => {\n\t\t\t\t\t\tif (!resource.loading) {\n\t\t\t\t\t\t\tclearInterval(checkLoaded)\n\t\t\t\t\t\t\tresolve()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100)\n\t\t\t\t})\n\n\t\t\t\tconst draft = resource.data\n\t\t\t\tthis.currentRequestId = draftId\n\n\t\t\t\t// Parse the full form data from draft_full_data JSON field\n\t\t\t\tif (draft.draft_full_data) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.formData = JSON.parse(draft.draft_full_data)\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(\"Failed to parse draft_full_data:\", error)\n\t\t\t\t\t\tthis.formData = draft.form_data || {}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.formData = draft.form_data || {}\n\t\t\t\t}\n\n\t\t\t\t// Use draft_current_step from the document (clamp to valid range)\n\t\t\t\tconst draftStep = draft.draft_current_step || 0\n\t\t\t\tconst maxStep = this.totalSteps - 1\n\t\t\t\tthis.currentStep = Math.min(Math.max(0, draftStep), maxStep)\n\n\t\t\t\tif (draftStep !== this.currentStep) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`[RequestStore] Draft had invalid step ${draftStep}, clamped to ${this.currentStep} (max: ${maxStep})`,\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to load draft:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to load draft\"\n\t\t\t}\n\t\t},\n\n\t\tasync saveProgress() {\n\t\t\t// Prevent concurrent saves\n\t\t\tif (this.isSaving) {\n\t\t\t\tconsole.log(\"[RequestStore] Save already in progress, skipping\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Ensure formData has request_id if store has one\n\t\t\tif (this.currentRequestId && !this.formData.request_id) {\n\t\t\t\tconsole.warn(\"[RequestStore] Syncing request_id to formData\")\n\t\t\t\tthis.formData.request_id = this.currentRequestId\n\t\t\t}\n\n\t\t\tconsole.log(\"[RequestStore] saveProgress called\", {\n\t\t\t\thasRequestId: !!this.currentRequestId,\n\t\t\t\tformDataHasId: !!this.formData.request_id,\n\t\t\t\tcurrentStep: this.currentStep,\n\t\t\t\tisSaving: this.isSaving,\n\t\t\t})\n\n\t\t\tthis.isSaving = true\n\t\t\tthis.error = null\n\n\t\t\ttry {\n\t\t\t\t// Sanitize formData to remove File objects (files need separate upload)\n\t\t\t\tconst sanitizedData = {}\n\t\t\t\tfor (const [key, value] of Object.entries(this.formData)) {\n\t\t\t\t\t// Skip File objects - they should be uploaded separately\n\t\t\t\t\tif (value instanceof File) {\n\t\t\t\t\t\tconsole.warn(`[RequestStore] Skipping File object for key: ${key}`)\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert file arrays to URL strings (Bug #6 fix)\n\t\t\t\t\tif (Array.isArray(value) && value.length > 0) {\n\t\t\t\t\t\t// Check if this is a file upload array (has file_url property)\n\t\t\t\t\t\tconst isFileArray = value.some(\n\t\t\t\t\t\t\t(item) => item && typeof item === \"object\" && item.file_url,\n\t\t\t\t\t\t)\n\t\t\t\t\t\tif (isFileArray) {\n\t\t\t\t\t\t\t// Extract the file_url from the first item\n\t\t\t\t\t\t\tconst fileUrl = value[0].file_url\n\t\t\t\t\t\t\tif (fileUrl && typeof fileUrl === \"string\") {\n\t\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t\t`[RequestStore] Converting file array to URL string for ${key}:`,\n\t\t\t\t\t\t\t\t\tfileUrl,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tsanitizedData[key] = fileUrl\n\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\t`[RequestStore] File array for ${key} does not have valid file_url, skipping`,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tcontinue\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Skip undefined/null but allow empty strings and false\n\t\t\t\t\tif (value !== undefined && value !== null) {\n\t\t\t\t\t\tsanitizedData[key] = value\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ensure we have some data to send\n\t\t\t\tif (Object.keys(sanitizedData).length === 0 && !this.currentRequestId) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"No form data to save. Please fill in at least one field.\",\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"[RequestStore] Sending sanitized data with\",\n\t\t\t\t\tObject.keys(sanitizedData).length,\n\t\t\t\t\t\"fields\",\n\t\t\t\t)\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"[RequestStore] Sanitized data keys:\",\n\t\t\t\t\tObject.keys(sanitizedData),\n\t\t\t\t)\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"[RequestStore] Sanitized data:\",\n\t\t\t\t\tJSON.stringify(sanitizedData, null, 2),\n\t\t\t\t)\n\n\t\t\t\tconst result = await requestService.createDraft(\n\t\t\t\t\tsanitizedData,\n\t\t\t\t\tthis.currentStep,\n\t\t\t\t)\n\n\t\t\t\tif (!this.currentRequestId) {\n\t\t\t\t\tthis.currentRequestId = result.request_id\n\t\t\t\t\t// Ensure subsequent saves include request_id to update existing draft\n\t\t\t\t\tthis.formData.request_id = result.request_id\n\n\t\t\t\t\t// Backup to localStorage\n\t\t\t\t\tlocalStorage.setItem(\"current_draft_id\", result.request_id)\n\t\t\t\t}\n\n\t\t\t\tthis.lastSaved = new Date()\n\n\t\t\t\treturn result // Return for caller\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Save failed:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to save progress\"\n\t\t\t\tthrow error\n\t\t\t} finally {\n\t\t\t\tthis.isSaving = false\n\t\t\t}\n\t\t},\n\n\t\tasync saveDraft() {\n\t\t\treturn this.saveProgress()\n\t\t},\n\n\t\tasync submitRequest() {\n\t\t\tthis.isSubmitting = true\n\t\t\tthis.error = null\n\n\t\t\ttry {\n\t\t\t\t// Save current progress first\n\t\t\t\tif (!this.currentRequestId) {\n\t\t\t\t\tawait this.saveProgress()\n\t\t\t\t}\n\n\t\t\t\t// Submit the request and get result\n\t\t\t\tconst result = await requestService.submitRequest(this.currentRequestId)\n\n\t\t\t\t// Clear state\n\t\t\t\tthis.reset()\n\n\t\t\t\t// Return submission result with SLA info\n\t\t\t\treturn result\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Submit failed:\", error)\n\t\t\t\tthis.error = error.message || \"Failed to submit request\"\n\t\t\t\tthrow error\n\t\t\t} finally {\n\t\t\t\tthis.isSubmitting = false\n\t\t\t}\n\t\t},\n\n\t\tupdateField(fieldName, value) {\n\t\t\tthis.formData[fieldName] = value\n\t\t},\n\n\t\tupdateFields(fields) {\n\t\t\tObject.assign(this.formData, fields)\n\t\t},\n\n\t\tsetStepValidation(stepIndex, isValid) {\n\t\t\tthis.stepValidationStatus[stepIndex] = isValid\n\t\t},\n\n\t\tclearError() {\n\t\t\tthis.error = null\n\t\t},\n\n\t\treset() {\n\t\t\tconsole.log(\"[RequestStore] reset() called - clearing all state\")\n\n\t\t\tthis.currentRequestId = null\n\t\t\tthis.requestTypeCode = null\n\t\t\tthis.requestTypeConfig = null\n\n\t\t\t// Clear formData completely - don't just reassign\n\t\t\tObject.keys(this.formData).forEach((key) => {\n\t\t\t\tdelete this.formData[key]\n\t\t\t})\n\t\t\tthis.formData = {} // Reset to empty object\n\n\t\t\tthis.currentStep = 0\n\t\t\tthis.stepValidationStatus = {}\n\t\t\tthis.isSaving = false\n\t\t\tthis.isSubmitting = false\n\t\t\tthis.lastSaved = null\n\t\t\tthis.error = null\n\n\t\t\t// Clear localStorage backup\n\t\t\tlocalStorage.removeItem(\"current_draft_id\")\n\t\t},\n\t},\n})\n","import { ref } from \"vue\"\nimport { useRouter } from \"vue-router\"\nimport { call } from \"frappe-ui\"\nimport { useRequestStore } from \"../stores/requestStore\"\n\n/**\n * Composable for managing request form modals\n * Handles save draft, validation error, meeting booking, and submission success modals\n *\n * @returns {Object} Modal state and handlers\n */\nexport function useRequestModals() {\n\tconst router = useRouter()\n\tconst store = useRequestStore()\n\n\t// Modal visibility state\n\tconst showSaveDraftModal = ref(false)\n\tconst showValidationModal = ref(false)\n\tconst showMeetingModal = ref(false)\n\tconst showSubmissionSuccessModal = ref(false)\n\n\t// Submission result data\n\tconst submissionResult = ref(null)\n\n\t/**\n\t * Open meeting booking modal\n\t */\n\tfunction handleBookMeeting() {\n\t\tshowMeetingModal.value = true\n\t}\n\n\t/**\n\t * Handle meeting booked callback\n\t * @param {Object} meetingData - Data about the booked meeting\n\t */\n\tfunction handleMeetingBooked(meetingData) {\n\t\tconsole.log(\"Meeting booked:\", meetingData)\n\t\tshowMeetingModal.value = false\n\t}\n\n\t/**\n\t * Show validation errors modal\n\t * @param {Object} errors - Validation errors to display\n\t */\n\tfunction showValidationErrors(errors) {\n\t\tshowValidationModal.value = true\n\t}\n\n\t/**\n\t * Handle save draft action\n\t */\n\tasync function handleSaveDraft() {\n\t\ttry {\n\t\t\tawait store.saveDraft()\n\t\t\tif (store.currentRequestId) {\n\t\t\t\trouter.push(`/request/${store.currentRequestId}`)\n\t\t\t} else {\n\t\t\t\tshowSaveDraftModal.value = true\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to save draft:\", error)\n\t\t}\n\t}\n\n\t/**\n\t * Handle save and close action\n\t */\n\tasync function handleSaveAndClose() {\n\t\ttry {\n\t\t\tawait store.saveDraft()\n\t\t\tstore.reset()\n\t\t\trouter.push({ name: \"Dashboard\" })\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to save draft:\", error)\n\t\t}\n\t}\n\n\t/**\n\t * Handle form submission\n\t */\n\tasync function handleSubmit() {\n\t\ttry {\n\t\t\tconst result = await store.submitRequest()\n\t\t\tsubmissionResult.value = result\n\t\t\tshowSubmissionSuccessModal.value = true\n\n\t\t\t// After successful submission, auto-save personal info to profile\n\t\t\tawait savePersonalInfoToProfile()\n\n\t\t\t// Also save any addresses marked for profile saving\n\t\t\tawait saveAddressesToProfile()\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to submit request:\", error)\n\t\t}\n\t}\n\n\t/**\n\t * Save personal information to user profile after submission\n\t * Auto-saves all personal details, identity docs, economic status, and payment preferences\n\t */\n\tasync function savePersonalInfoToProfile() {\n\t\tconst formData = store.formData\n\t\tif (!formData) return\n\n\t\t// Collect personal info fields from formData\n\t\tconst personalInfo = {}\n\n\t\t// Personal Details\n\t\tif (formData.birth_date) personalInfo.birth_date = formData.birth_date\n\t\tif (formData.sex) personalInfo.sex = formData.sex\n\t\tif (formData.civil_status) personalInfo.civil_status = formData.civil_status\n\n\t\t// Contact\n\t\tif (formData.mobile_number) personalInfo.mobile_number = formData.mobile_number\n\n\t\t// Address\n\t\tif (formData.address_line) personalInfo.address_line = formData.address_line\n\t\tif (formData.barangay) personalInfo.barangay = formData.barangay\n\t\tif (formData.municipality) personalInfo.municipality = formData.municipality\n\t\tif (formData.province) personalInfo.province = formData.province\n\n\t\t// Identity Documents\n\t\tif (formData.philsys_id) personalInfo.philsys_id = formData.philsys_id\n\t\tif (formData.sss_number) personalInfo.sss_number = formData.sss_number\n\t\tif (formData.osca_id) personalInfo.osca_id = formData.osca_id\n\n\t\t// Economic Status\n\t\tif (formData.monthly_income !== undefined) personalInfo.monthly_income = formData.monthly_income\n\t\tif (formData.income_source) personalInfo.income_source = formData.income_source\n\t\tif (formData.household_size !== undefined) personalInfo.household_size = formData.household_size\n\t\tif (formData.living_arrangement) personalInfo.living_arrangement = formData.living_arrangement\n\t\tif (formData.is_4ps_beneficiary !== undefined) personalInfo.is_4ps_beneficiary = formData.is_4ps_beneficiary\n\n\t\t// Payment Preferences\n\t\tif (formData.payment_preference) personalInfo.payment_preference = formData.payment_preference\n\t\tif (formData.bank_name) personalInfo.bank_name = formData.bank_name\n\t\tif (formData.bank_account_number) personalInfo.bank_account_number = formData.bank_account_number\n\t\tif (formData.bank_account_holder) personalInfo.bank_account_holder = formData.bank_account_holder\n\n\t\t// Only save if we have data\n\t\tif (Object.keys(personalInfo).length > 0) {\n\t\t\ttry {\n\t\t\t\tconst result = await call(\"councilsonline.api.auth.save_personal_info_to_profile\", personalInfo)\n\t\t\t\tif (result && result.fields_count > 0) {\n\t\t\t\t\tconsole.log(`Saved ${result.fields_count} fields to user profile`)\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\t// Don't fail submission if profile save fails\n\t\t\t\tconsole.error(\"Failed to save personal info to profile:\", error)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Save addresses to user profile if marked for saving\n\t * Looks for address fields with _save_to_profile flag\n\t */\n\tasync function saveAddressesToProfile() {\n\t\tconst formData = store.formData\n\t\tif (!formData) return\n\n\t\t// Check common address field names that might have _save_to_profile flag\n\t\tconst addressFields = [\n\t\t\t\"residential_address\",\n\t\t\t\"address\",\n\t\t\t\"property_address\",\n\t\t\t\"applicant_address\",\n\t\t]\n\n\t\tfor (const fieldName of addressFields) {\n\t\t\tconst addressData = formData[fieldName]\n\t\t\tif (\n\t\t\t\taddressData &&\n\t\t\t\ttypeof addressData === \"object\" &&\n\t\t\t\taddressData._save_to_profile\n\t\t\t) {\n\t\t\t\ttry {\n\t\t\t\t\tawait call(\"councilsonline.api.auth.add_user_property\", {\n\t\t\t\t\t\tstreet: addressData.address_line,\n\t\t\t\t\t\tbarangay: addressData.barangay,\n\t\t\t\t\t\tmunicipality: addressData.municipality,\n\t\t\t\t\t\tprovince: addressData.province,\n\t\t\t\t\t\tzip_code: addressData.zip_code,\n\t\t\t\t\t\tis_default: false,\n\t\t\t\t\t})\n\t\t\t\t\tconsole.log(`Property saved to profile from field: ${fieldName}`)\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// Don't fail submission if property save fails\n\t\t\t\t\tconsole.error(`Failed to save property from ${fieldName}:`, error)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Handle view request from success modal\n\t * @param {string} requestId - Request ID to view\n\t */\n\tfunction handleViewRequestFromModal(requestId) {\n\t\tshowSubmissionSuccessModal.value = false\n\t\trouter.push(`/request/${requestId}`)\n\t}\n\n\t/**\n\t * Handle go to dashboard from success modal\n\t */\n\tfunction handleGoToDashboardFromModal() {\n\t\tshowSubmissionSuccessModal.value = false\n\t\tconst councilCode = store.formData.council\n\t\tif (councilCode) {\n\t\t\trouter.push(`/council/${councilCode}/dashboard`)\n\t\t} else {\n\t\t\trouter.push(\"/dashboard\")\n\t\t}\n\t}\n\n\treturn {\n\t\t// Modal visibility\n\t\tshowSaveDraftModal,\n\t\tshowValidationModal,\n\t\tshowMeetingModal,\n\t\tshowSubmissionSuccessModal,\n\n\t\t// Data\n\t\tsubmissionResult,\n\n\t\t// Handlers\n\t\thandleBookMeeting,\n\t\thandleMeetingBooked,\n\t\tshowValidationErrors,\n\t\thandleSaveDraft,\n\t\thandleSaveAndClose,\n\t\thandleSubmit,\n\t\thandleViewRequestFromModal,\n\t\thandleGoToDashboardFromModal,\n\t}\n}\n","import { computed } from \"vue\"\nimport { useRequestStore } from \"../stores/requestStore\"\nimport { useSiteCouncilStore } from \"../stores/siteCouncil\"\n\n/**\n * Composable for request step configuration\n * Manages step titles, totals, and dynamic step configuration\n *\n * @returns {Object} Step configuration computed properties and methods\n */\nexport function useStepConfiguration() {\n\tconst store = useRequestStore()\n\tconst councilStore = useSiteCouncilStore()\n\n\t/**\n\t * Total number of steps including fixed and dynamic steps\n\t * Single-tenant: Type (0) + Process Info (1) + Dynamic Steps + Review (Last)\n\t */\n\tconst totalSteps = computed(() => {\n\t\tif (store.requestTypeConfig?.steps) {\n\t\t\treturn store.requestTypeConfig.steps.length + 3\n\t\t}\n\t\treturn 3 // Default: Type, Process Info, Review\n\t})\n\n\t/**\n\t * Array of step titles for progress indicator\n\t */\n\tconst stepTitles = computed(() => {\n\t\tconst titles = [\"Type\", \"Process Info\"]\n\t\tif (store.requestTypeConfig?.steps) {\n\t\t\ttitles.push(...store.requestTypeConfig.steps.map((s) => s.step_title))\n\t\t}\n\t\ttitles.push(\"Review\")\n\t\treturn titles\n\t})\n\n\t/**\n\t * Whether the request type uses configurable dynamic steps\n\t */\n\tconst usesConfigurableSteps = computed(() => {\n\t\treturn (\n\t\t\tstore.requestTypeConfig?.steps && store.requestTypeConfig.steps.length > 0\n\t\t)\n\t})\n\n\t/**\n\t * Current step configuration (for dynamic validation)\n\t */\n\tconst currentStepConfig = computed(() => {\n\t\tif (!store.requestTypeConfig?.steps) return null\n\n\t\t// Single-tenant: Steps 0-1 are fixed (Type, Process Info)\n\t\t// Dynamic steps start at index 2\n\t\tconst dynamicStepIndex = store.currentStep - 2\n\n\t\tif (\n\t\t\tdynamicStepIndex >= 0 &&\n\t\t\tdynamicStepIndex < store.requestTypeConfig.steps.length\n\t\t) {\n\t\t\treturn store.requestTypeConfig.steps[dynamicStepIndex]\n\t\t}\n\n\t\treturn null\n\t})\n\n\t/**\n\t * Whether to show the council meeting banner\n\t */\n\tconst shouldShowMeetingBanner = computed(() => {\n\t\treturn (\n\t\t\tstore.currentStep > 1 &&\n\t\t\tstore.currentStep < totalSteps.value - 1 &&\n\t\t\tstore.requestTypeConfig?.council_meeting_available === 1\n\t\t)\n\t})\n\n\t/**\n\t * Get the title of the current step\n\t * @returns {string} Current step title\n\t */\n\tfunction getCurrentStepTitle() {\n\t\tconst index = store.currentStep\n\t\tif (index >= 0 && index < stepTitles.value.length) {\n\t\t\treturn stepTitles.value[index]\n\t\t}\n\t\treturn \"\"\n\t}\n\n\t/**\n\t * Get the configuration for the current step\n\t * @returns {Object|null} Step configuration or null for fixed steps\n\t */\n\tfunction getCurrentStepConfig() {\n\t\tconst index = store.currentStep\n\t\tconst dynamicStepsStart = 2 // Single-tenant: 0=Type, 1=Process Info, 2+=Dynamic\n\n\t\t// Return null for fixed steps and Review step\n\t\tif (index < dynamicStepsStart || index >= totalSteps.value - 1) {\n\t\t\treturn null\n\t\t}\n\n\t\tif (store.requestTypeConfig?.steps) {\n\t\t\tconst stepIndex = index - dynamicStepsStart\n\t\t\tif (stepIndex >= 0 && stepIndex < store.requestTypeConfig.steps.length) {\n\t\t\t\treturn store.requestTypeConfig.steps[stepIndex]\n\t\t\t}\n\t\t}\n\n\t\treturn null\n\t}\n\n\t/**\n\t * Get the council name for display\n\t * @returns {string} Council name\n\t */\n\tfunction getCouncilName() {\n\t\treturn councilStore.councilData?.council_name || \"Council\"\n\t}\n\n\treturn {\n\t\t// Computed\n\t\ttotalSteps,\n\t\tstepTitles,\n\t\tusesConfigurableSteps,\n\t\tcurrentStepConfig,\n\t\tshouldShowMeetingBanner,\n\n\t\t// Methods\n\t\tgetCurrentStepTitle,\n\t\tgetCurrentStepConfig,\n\t\tgetCouncilName,\n\t}\n}\n","/**\n * Conditional Logic Utility for Request Type Configuration\n *\n * Evaluates `depends_on` expressions from step_configs, step_sections, and step_fields\n *\n * Expression formats supported:\n * - eval:formData.field_name=='value'  (frontend style)\n * - eval:doc.field_name=='value'       (Frappe backend style - alias for formData)\n * - eval:formData.field_name!='value'\n * - eval:formData.field_name\n * - eval:!formData.field_name\n * - eval:formData.field_name>5\n * - eval:formData.field_name=='value1' || formData.field_name=='value2'\n * - eval:formData.field_name=='value1' && formData.other_field=='value2'\n * - eval:doc.payment_method=='Bank Deposit'  (Frappe style - commonly used)\n */\n\n/**\n * Safely evaluates a depends_on expression\n *\n * @param {string} expression - The depends_on expression (e.g., \"eval:formData.requester_type=='Company'\")\n * @param {object} formData - The current form data\n * @returns {boolean} - True if condition is met, false otherwise\n */\nexport function evaluateCondition(expression, formData) {\n\t// If no expression, always show\n\tif (!expression || expression.trim() === \"\") {\n\t\treturn true\n\t}\n\n\t// Remove 'eval:' prefix if present\n\tlet cleanExpression = expression.trim()\n\tif (cleanExpression.startsWith(\"eval:\")) {\n\t\tcleanExpression = cleanExpression.substring(5).trim()\n\t}\n\n\ttry {\n\t\t// Create a safe evaluation context with both formData and doc (alias)\n\t\t// This prevents access to dangerous globals like window, document, etc.\n\t\t// 'doc' is an alias for formData to support Frappe-style expressions\n\t\tconst safeEval = new Function(\n\t\t\t\"formData\",\n\t\t\t\"doc\",\n\t\t\t`\n      'use strict';\n      try {\n        return Boolean(${cleanExpression});\n      } catch (e) {\n        console.warn('[Conditional Logic] Evaluation error:', e.message);\n        return false;\n      }\n    `,\n\t\t)\n\n\t\t// Pass formData as both parameters so both 'formData' and 'doc' work\n\t\tconst result = safeEval(formData, formData)\n\t\treturn result\n\t} catch (error) {\n\t\tconsole.error(\n\t\t\t\"[Conditional Logic] Failed to evaluate expression:\",\n\t\t\texpression,\n\t\t\terror,\n\t\t)\n\t\t// On error, default to showing the field/section (fail open)\n\t\treturn true\n\t}\n}\n\n/**\n * Evaluates step visibility based on depends_on\n *\n * @param {object} step - Step config object with optional depends_on\n * @param {object} formData - Current form data\n * @returns {boolean} - Whether step should be visible\n */\nexport function isStepVisible(step, formData) {\n\tif (!step) return false\n\tif (!step.is_enabled) return false\n\tif (!step.depends_on) return true\n\n\treturn evaluateCondition(step.depends_on, formData)\n}\n\n/**\n * Evaluates section visibility based on depends_on\n *\n * @param {object} section - Section config object with optional depends_on\n * @param {object} formData - Current form data\n * @returns {boolean} - Whether section should be visible\n */\nexport function isSectionVisible(section, formData) {\n\tif (!section) return false\n\tif (!section.is_enabled) return false\n\tif (!section.depends_on) return true\n\n\treturn evaluateCondition(section.depends_on, formData)\n}\n\n/**\n * Evaluates field visibility based on depends_on\n *\n * @param {object} field - Field config object with optional depends_on\n * @param {object} formData - Current form data\n * @returns {boolean} - Whether field should be visible\n */\nexport function isFieldVisible(field, formData) {\n\tif (!field) return false\n\tif (!field.depends_on) return true\n\n\treturn evaluateCondition(field.depends_on, formData)\n}\n\n/**\n * Filters an array of items based on their depends_on conditions\n *\n * @param {array} items - Array of steps/sections/fields with optional depends_on\n * @param {object} formData - Current form data\n * @param {function} visibilityFn - Function to check visibility (isStepVisible, isSectionVisible, isFieldVisible)\n * @returns {array} - Filtered array of visible items\n */\nexport function filterVisibleItems(items, formData, visibilityFn) {\n\tif (!items || !Array.isArray(items)) return []\n\n\treturn items.filter((item) => visibilityFn(item, formData))\n}\n\n/**\n * Example expressions and their evaluations:\n *\n * Expression: \"eval:formData.requester_type=='Company'\"\n * formData: { applicant_type: 'Company' }\n * Result: true\n *\n * Expression: \"eval:formData.has_agent\"\n * formData: { has_agent: 1 }\n * Result: true\n *\n * Expression: \"eval:!formData.has_agent\"\n * formData: { has_agent: 0 }\n * Result: true\n *\n * Expression: \"eval:formData.age>65\"\n * formData: { age: 70 }\n * Result: true\n *\n * Expression: \"eval:formData.consent_type=='Land Use' || formData.consent_type=='Subdivision'\"\n * formData: { consent_type: 'Land Use' }\n * Result: true\n */\n","/**\n * Field Validation Utility for Request Type Configuration\n *\n * Executes validation JavaScript from step_fields configuration\n *\n * Validation formats supported:\n * - \"email\" - Email format validation\n * - \"phone\" - Phone number validation\n * - \"url\" - URL format validation\n * - \"number\" - Numeric validation\n * - \"eval:formData.age >= 18\" - Custom JavaScript expression\n * - \"eval:formData.password === formData.confirm_password\" - Field comparison\n */\n\n/**\n * Validates an email address\n * @param {string} value - Email to validate\n * @returns {boolean} - True if valid email\n */\nfunction validateEmail(value) {\n\tif (!value) return true // Empty is valid (use is_required for mandatory)\n\tconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n\treturn emailRegex.test(value)\n}\n\n/**\n * Validates a phone number\n * @param {string} value - Phone to validate\n * @returns {boolean} - True if valid phone\n */\nfunction validatePhone(value) {\n\tif (!value) return true\n\t// Accepts: +64 21 123 4567, 021234567, (021) 123-4567, etc.\n\tconst phoneRegex =\n\t\t/^[\\+]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[(]?[0-9]{1,4}[)]?[-\\s\\.]?[0-9]{1,9}$/\n\treturn phoneRegex.test(value.replace(/\\s/g, \"\"))\n}\n\n/**\n * Validates a URL\n * @param {string} value - URL to validate\n * @returns {boolean} - True if valid URL\n */\nfunction validateUrl(value) {\n\tif (!value) return true\n\ttry {\n\t\tnew URL(value)\n\t\treturn true\n\t} catch {\n\t\treturn false\n\t}\n}\n\n/**\n * Validates a number\n * @param {*} value - Value to validate\n * @returns {boolean} - True if valid number\n */\nfunction validateNumber(value) {\n\tif (value === \"\" || value === null || value === undefined) return true\n\treturn !isNaN(Number.parseFloat(value)) && isFinite(value)\n}\n\n/**\n * Safely evaluates a custom validation expression\n *\n * @param {string} expression - The validation expression (e.g., \"eval:formData.age >= 18\")\n * @param {*} value - The field value\n * @param {object} formData - The current form data\n * @returns {boolean} - True if validation passes\n */\nfunction evaluateCustomValidation(expression, value, formData) {\n\t// Remove 'eval:' prefix if present\n\tlet cleanExpression = expression.trim()\n\tif (cleanExpression.startsWith(\"eval:\")) {\n\t\tcleanExpression = cleanExpression.substring(5).trim()\n\t}\n\n\ttry {\n\t\t// Create a safe evaluation context with formData and value\n\t\t// This prevents access to dangerous globals like window, document, etc.\n\t\tconst safeEval = new Function(\n\t\t\t\"formData\",\n\t\t\t\"value\",\n\t\t\t`\n\t\t\t'use strict';\n\t\t\ttry {\n\t\t\t\treturn Boolean(${cleanExpression});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('[Field Validation] Evaluation error:', e.message);\n\t\t\t\treturn true; // Fail open on evaluation error\n\t\t\t}\n\t\t`,\n\t\t)\n\n\t\tconst result = safeEval(formData, value)\n\t\treturn result\n\t} catch (error) {\n\t\tconsole.error(\n\t\t\t\"[Field Validation] Failed to evaluate expression:\",\n\t\t\texpression,\n\t\t\terror,\n\t\t)\n\t\t// On error, default to passing validation (fail open)\n\t\treturn true\n\t}\n}\n\n/**\n * Validates a field value based on validation rule\n *\n * @param {*} value - The field value to validate\n * @param {string} validation - Validation rule (email, phone, url, number, or eval:expression)\n * @param {object} formData - Current form data (for custom validations)\n * @returns {object} - {valid: boolean, message: string}\n */\nexport function validateField(value, validation, formData = {}) {\n\tif (!validation) {\n\t\treturn { valid: true, message: \"\" }\n\t}\n\n\tconst validationType = validation.toLowerCase()\n\n\t// Built-in validation types\n\tswitch (validationType) {\n\t\tcase \"email\":\n\t\t\tif (!validateEmail(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid email address\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase \"phone\":\n\t\t\tif (!validatePhone(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid phone number\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase \"url\":\n\t\t\tif (!validateUrl(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid URL\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tcase \"number\":\n\t\t\tif (!validateNumber(value)) {\n\t\t\t\treturn { valid: false, message: \"Please enter a valid number\" }\n\t\t\t}\n\t\t\tbreak\n\n\t\tdefault:\n\t\t\t// Age validation: min_age:60 format\n\t\t\tif (validationType.startsWith(\"min_age:\")) {\n\t\t\t\tconst minAge = parseInt(validationType.split(\":\")[1], 10)\n\t\t\t\tif (value && !isNaN(minAge)) {\n\t\t\t\t\tconst today = new Date()\n\t\t\t\t\tconst born = new Date(value)\n\t\t\t\t\tlet age = today.getFullYear() - born.getFullYear()\n\t\t\t\t\tconst m = today.getMonth() - born.getMonth()\n\t\t\t\t\tif (m < 0 || (m === 0 && today.getDate() < born.getDate())) {\n\t\t\t\t\t\tage--\n\t\t\t\t\t}\n\t\t\t\t\tif (age < minAge) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tvalid: false,\n\t\t\t\t\t\t\tmessage: `Applicant must be ${minAge} years or older`,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\n\t\t\t// Custom validation expression (starts with eval:)\n\t\t\tif (validation.startsWith(\"eval:\")) {\n\t\t\t\tif (!evaluateCustomValidation(validation, value, formData)) {\n\t\t\t\t\treturn { valid: false, message: \"Validation failed\" }\n\t\t\t\t}\n\t\t\t}\n\t}\n\n\treturn { valid: true, message: \"\" }\n}\n\n/**\n * Validates all fields in a section\n *\n * @param {array} fields - Array of field objects with validation rules\n * @param {object} formData - Current form data\n * @returns {object} - {valid: boolean, errors: {fieldName: message}}\n */\nexport function validateSection(fields, formData) {\n\tconst errors = {}\n\tlet valid = true\n\n\tfields.forEach((field) => {\n\t\tconst value = formData[field.field_name]\n\n\t\t// Check required\n\t\tif (\n\t\t\tfield.is_required &&\n\t\t\t(value === \"\" || value === null || value === undefined)\n\t\t) {\n\t\t\terrors[field.field_name] = `${field.field_label} is required`\n\t\t\tvalid = false\n\t\t\treturn\n\t\t}\n\n\t\t// Check validation rule\n\t\tif (field.validation) {\n\t\t\tconst result = validateField(value, field.validation, formData)\n\t\t\tif (!result.valid) {\n\t\t\t\terrors[field.field_name] = result.message\n\t\t\t\tvalid = false\n\t\t\t}\n\t\t}\n\t})\n\n\treturn { valid, errors }\n}\n\n/**\n * Validates all fields in a step\n *\n * @param {object} stepConfig - Step configuration with sections and fields\n * @param {object} formData - Current form data\n * @returns {object} - {valid: boolean, errors: {fieldName: message}}\n */\nexport function validateStep(stepConfig, formData) {\n\tif (!stepConfig || !stepConfig.sections) {\n\t\treturn { valid: true, errors: {} }\n\t}\n\n\tlet allErrors = {}\n\tlet allValid = true\n\n\tstepConfig.sections.forEach((section) => {\n\t\tif (section.fields && Array.isArray(section.fields)) {\n\t\t\tconst sectionResult = validateSection(section.fields, formData)\n\t\t\tif (!sectionResult.valid) {\n\t\t\t\tallValid = false\n\t\t\t\tallErrors = { ...allErrors, ...sectionResult.errors }\n\t\t\t}\n\t\t}\n\t})\n\n\treturn { valid: allValid, errors: allErrors }\n}\n\n/**\n * Example validation expressions:\n *\n * Email validation:\n *   validation: \"email\"\n *\n * Phone validation:\n *   validation: \"phone\"\n *\n * Minimum age from birth date (e.g., SPISC requires 60+):\n *   validation: \"min_age:60\"\n *\n * Custom age requirement:\n *   validation: \"eval:value >= 18\"\n *\n * Password confirmation:\n *   validation: \"eval:value === formData.password\"\n *\n * Conditional validation:\n *   validation: \"eval:formData.requester_type !== 'Individual' || value.length > 0\"\n *\n * Date range:\n *   validation: \"eval:new Date(value) >= new Date('2020-01-01')\"\n */\n","/**\n * Step-based validation for Request Type configuration\n * Integrates with existing fieldValidation.js utility\n */\n\nimport { type Ref, ref } from \"vue\"\nimport { evaluateCondition } from \"../utils/conditionalLogic\"\nimport { validateField as utilValidateField } from \"../utils/fieldValidation\"\n\nexport interface StepValidationReturn {\n\t/** Object containing field names and error messages */\n\terrors: Ref<Record<string, string>>\n\n\t/** Whether validation is in progress */\n\tisValidating: Ref<boolean>\n\n\t/** Validate single field with config */\n\tvalidateConfigField: (\n\t\tfieldName: string,\n\t\tvalue: any,\n\t\tfieldConfig: any,\n\t\tformData?: any,\n\t) => boolean\n\n\t/** Validate entire step */\n\tvalidateStep: (stepConfig: any, formData: any) => Promise<boolean>\n\n\t/** Clear all errors */\n\tclearErrors: () => void\n\n\t/** Clear specific field error */\n\tclearFieldError: (fieldName: string) => void\n}\n\nexport function useStepValidation(): StepValidationReturn {\n\tconst errors = ref<Record<string, string>>({})\n\tconst isValidating = ref(false)\n\n\t/**\n\t * Validate single field with Request Type config\n\t */\n\tfunction validateConfigField(\n\t\tfieldName: string,\n\t\tvalue: any,\n\t\tfieldConfig: any,\n\t\tformData: any = {},\n\t): boolean {\n\t\t// Use utility validation\n\t\tconst result = utilValidateField(value, fieldConfig.validation, formData)\n\n\t\tif (!result.valid) {\n\t\t\terrors.value[fieldName] = result.message\n\t\t\treturn false\n\t\t}\n\n\t\t// Check required\n\t\tif (\n\t\t\tfieldConfig.is_required &&\n\t\t\t(value === \"\" || value === null || value === undefined)\n\t\t) {\n\t\t\terrors.value[fieldName] = `${fieldConfig.field_label} is required`\n\t\t\treturn false\n\t\t}\n\n\t\t// Clear error if valid\n\t\tdelete errors.value[fieldName]\n\t\treturn true\n\t}\n\n\t/**\n\t * Validate entire step based on config\n\t */\n\tasync function validateStep(\n\t\tstepConfig: any,\n\t\tformData: any,\n\t): Promise<boolean> {\n\t\tisValidating.value = true\n\t\terrors.value = {}\n\n\t\tlet isValid = true\n\n\t\tfor (const section of stepConfig.sections || []) {\n\t\t\t// Check section depends_on\n\t\t\tif (section.depends_on) {\n\t\t\t\tconst shouldShow = evaluateDependsOn(section.depends_on, formData)\n\t\t\t\tif (!shouldShow) continue\n\t\t\t}\n\n\t\t\tfor (const field of section.fields || []) {\n\t\t\t\t// Check field depends_on\n\t\t\t\tif (field.depends_on) {\n\t\t\t\t\tconst shouldShow = evaluateDependsOn(field.depends_on, formData)\n\t\t\t\t\tif (!shouldShow) continue\n\t\t\t\t}\n\n\t\t\t\t// Get field value - check for nested address fields\n\t\t\t\tlet value = formData[field.field_name]\n\n\t\t\t\t// Philippine address component fields are nested in address_line object\n\t\t\t\tconst addressComponentFields = [\n\t\t\t\t\t\"barangay\",\n\t\t\t\t\t\"municipality\",\n\t\t\t\t\t\"province\",\n\t\t\t\t\t\"city\",\n\t\t\t\t\t\"region\",\n\t\t\t\t\t\"zip_code\",\n\t\t\t\t\t\"postal_code\",\n\t\t\t\t]\n\t\t\t\tif (addressComponentFields.includes(field.field_name) && !value) {\n\t\t\t\t\t// Check if there's an address_line object containing this field\n\t\t\t\t\tconst addressLineData =\n\t\t\t\t\t\tformData[\"address_line\"] ||\n\t\t\t\t\t\tformData[\"street\"] ||\n\t\t\t\t\t\tformData[\"residential_address\"] ||\n\t\t\t\t\t\tformData[\"property_address\"]\n\t\t\t\t\tif (addressLineData && typeof addressLineData === \"object\") {\n\t\t\t\t\t\tvalue = addressLineData[field.field_name]\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst fieldValid = validateConfigField(\n\t\t\t\t\tfield.field_name,\n\t\t\t\t\tvalue,\n\t\t\t\t\tfield,\n\t\t\t\t\tformData,\n\t\t\t\t)\n\n\t\t\t\tif (!fieldValid) {\n\t\t\t\t\tisValid = false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tisValidating.value = false\n\t\treturn isValid\n\t}\n\n\t/**\n\t * Evaluate depends_on expression\n\t */\n\tfunction evaluateDependsOn(expression: string, formData: any): boolean {\n\t\ttry {\n\t\t\treturn evaluateCondition(expression, formData)\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error evaluating depends_on:\", error)\n\t\t\treturn true // Show field on error\n\t\t}\n\t}\n\n\t/**\n\t * Clear all errors\n\t */\n\tfunction clearErrors() {\n\t\terrors.value = {}\n\t}\n\n\t/**\n\t * Clear specific field error\n\t */\n\tfunction clearFieldError(fieldName: string) {\n\t\tdelete errors.value[fieldName]\n\t}\n\n\treturn {\n\t\terrors,\n\t\tisValidating,\n\t\tvalidateConfigField,\n\t\tvalidateStep,\n\t\tclearErrors,\n\t\tclearFieldError,\n\t}\n}\n\n/**\n * Example usage in NewRequest.vue:\n *\n * ```typescript\n * import { useStepValidation } from '@/composables/useStepValidation'\n *\n * const { errors, validateStep, clearErrors } = useStepValidation()\n *\n * async function handleNext() {\n *   const isValid = await validateStep(currentStepConfig.value, formData.value)\n *   if (!isValid) {\n *     showValidationModal.value = true\n *     return\n *   }\n *   // Continue...\n * }\n * ```\n */\n","import { computed } from \"vue\"\nimport { useRouter } from \"vue-router\"\nimport { useRequestStore } from \"../stores/requestStore\"\nimport { useStepValidation } from \"./useStepValidation\"\n\n/**\n * Composable for request form navigation logic\n * Handles step navigation, validation, auto-save, and draft management\n *\n * @param {Object} options - Configuration options\n * @param {Function} options.getCurrentStepConfig - Function to get current step config\n * @param {import('vue').ComputedRef} options.totalSteps - Total number of steps\n * @param {import('vue').ComputedRef} options.usesConfigurableSteps - Whether using configurable steps\n * @param {Function} options.onValidationError - Callback for validation errors\n * @returns {Object} Navigation functions and computed properties\n */\nexport function useRequestFormNavigation(options = {}) {\n\tconst router = useRouter()\n\tconst store = useRequestStore()\n\tconst { errors: validationErrors, validateStep } = useStepValidation()\n\n\tconst {\n\t\tgetCurrentStepConfig = () => null,\n\t\ttotalSteps = computed(() => 3),\n\t\tusesConfigurableSteps = computed(() => false),\n\t\tonValidationError = () => {},\n\t} = options\n\n\t/**\n\t * Whether user can navigate to next step\n\t * Always returns true as validation happens on attempt\n\t */\n\tconst canNavigateNext = computed(() => true)\n\n\t/**\n\t * Whether user can save draft\n\t * Only allowed after step 2 (single-tenant mode)\n\t */\n\tconst canSaveDraft = computed(() => store.currentStep >= 2)\n\n\t/**\n\t * Navigate to next step with validation and auto-save\n\t */\n\tasync function handleNext() {\n\t\t// Step 0: Require request type selection\n\t\tif (store.currentStep === 0 && !store.formData.request_type) {\n\t\t\talert(\"Please select a request type before continuing.\")\n\t\t\treturn\n\t\t}\n\n\t\t// Validate current step for dynamic steps\n\t\tif (\n\t\t\tstore.currentStep >= 1 &&\n\t\t\tusesConfigurableSteps.value &&\n\t\t\tgetCurrentStepConfig()\n\t\t) {\n\t\t\tconst stepConfig = getCurrentStepConfig()\n\t\t\tconst isValid = await validateStep(stepConfig, store.formData)\n\n\t\t\tif (!isValid) {\n\t\t\t\tconsole.error(\"[Navigation] Validation failed:\", validationErrors.value)\n\t\t\t\tonValidationError(validationErrors.value)\n\t\t\t\treturn // Block navigation\n\t\t\t}\n\t\t}\n\n\t\t// Auto-save after Process Info step to create draft\n\t\tif (store.currentStep === 1 && !store.currentRequestId) {\n\t\t\tconsole.log(\"[Navigation] Auto-saving draft after Process Info step...\")\n\t\t\tawait store.saveDraft()\n\t\t\tconsole.log(\"[Navigation] Draft saved with ID:\", store.currentRequestId)\n\n\t\t\t// Redirect if no dynamic steps configured\n\t\t\tif (!usesConfigurableSteps.value && store.currentRequestId) {\n\t\t\t\tconsole.log(\n\t\t\t\t\t\"[Navigation] No dynamic steps, redirecting to detail page...\",\n\t\t\t\t)\n\t\t\t\trouter.push(`/request/${store.currentRequestId}`)\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\n\t\t// Auto-save existing drafts before navigation\n\t\tif (store.currentRequestId) {\n\t\t\tawait store.saveProgress()\n\t\t}\n\n\t\t// Advance to next step (but not beyond Review step)\n\t\tif (store.currentStep < totalSteps.value - 1) {\n\t\t\tstore.nextStep()\n\t\t}\n\t}\n\n\t/**\n\t * Navigate to previous step\n\t */\n\tfunction handlePrevious() {\n\t\tstore.previousStep()\n\t}\n\n\t/**\n\t * Go back to dashboard\n\t */\n\tfunction goBack() {\n\t\tstore.reset()\n\t\trouter.push(\"/dashboard\")\n\t}\n\n\treturn {\n\t\tcanNavigateNext,\n\t\tcanSaveDraft,\n\t\tvalidationErrors,\n\t\thandleNext,\n\t\thandlePrevious,\n\t\tgoBack,\n\t}\n}\n","/**\n * Composable for User Profile management and auto-fill functionality\n * Loads user profile data and provides auto-fill for application forms\n */\n\nimport { computed, ref } from \"vue\"\n\nconst userProfile = ref(null)\nconst loading = ref(false)\nconst error = ref(null)\n\nexport function useUserProfile() {\n\t/**\n\t * Fetch user profile from backend\n\t */\n\tconst loadUserProfile = async () => {\n\t\tloading.value = true\n\t\terror.value = null\n\n\t\ttry {\n\t\t\tconst headers = {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t}\n\n\t\t\t// Add CSRF token if available\n\t\t\tif (window.csrf_token) {\n\t\t\t\theaders[\"X-Frappe-CSRF-Token\"] = window.csrf_token\n\t\t\t}\n\n\t\t\tconst response = await fetch(\n\t\t\t\t\"/api/method/councilsonline.api.get_user_profile\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\theaders: headers,\n\t\t\t\t\tcredentials: \"include\",\n\t\t\t\t},\n\t\t\t)\n\n\t\t\tconst result = await response.json()\n\n\t\t\t// Backend returns profile data directly in result.message\n\t\t\t// No need to check for success flag\n\t\t\tif (result.message) {\n\t\t\t\tuserProfile.value = result.message\n\t\t\t\treturn userProfile.value\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Failed to load profile\")\n\t\t\t}\n\t\t} catch (err) {\n\t\t\terror.value = err.message\n\t\t\tconsole.error(\"Error loading user profile:\", err)\n\t\t\treturn null\n\t\t} finally {\n\t\t\tloading.value = false\n\t\t}\n\t}\n\n\t/**\n\t * Get default property\n\t */\n\tconst defaultProperty = computed(() => {\n\t\tif (!userProfile.value?.properties) return null\n\t\treturn (\n\t\t\tuserProfile.value.properties.find((p) => p.is_default) ||\n\t\t\tuserProfile.value.properties[0]\n\t\t)\n\t})\n\n\t/**\n\t * Get default council\n\t */\n\tconst defaultCouncil = computed(() => {\n\t\tif (!userProfile.value?.councils) return null\n\t\treturn (\n\t\t\tuserProfile.value.councils.find((c) => c.is_default) ||\n\t\t\tuserProfile.value.councils[0]\n\t\t)\n\t})\n\n\t/**\n\t * Get auto-fill data for Resource Consent Application\n\t * Returns object with all fields that can be auto-filled from profile\n\t */\n\tconst getApplicationAutoFill = () => {\n\t\tif (!userProfile.value) return {}\n\n\t\tconst profile = userProfile.value\n\t\tconst autoFillData = {}\n\n\t\t// STEP 1: Council Selection\n\t\tif (defaultCouncil.value) {\n\t\t\tautoFillData.council = defaultCouncil.value.council_id\n\t\t\tautoFillData.council_name = defaultCouncil.value.council_name\n\t\t}\n\n\t\t// STEP 4: Applicant & Proposal (FRD Step 1)\n\t\t// Basic Applicant Details\n\t\tautoFillData.requester_name = profile.full_name\n\t\tautoFillData.requester_email = profile.user // Email from User account\n\t\tautoFillData.requester_phone = profile.phone\n\t\tautoFillData.requester_type = profile.user_role // 'Individual' or 'Agent'\n\n\t\t// Individual: Postal Address\n\t\tif (profile.user_role === \"Individual\") {\n\t\t\tif (profile.postal_street) {\n\t\t\t\tautoFillData.applicant_address =\n\t\t\t\t\t`${profile.postal_street}, ${profile.postal_suburb || \"\"}, ${profile.postal_city || \"\"} ${profile.postal_postcode || \"\"}`.trim()\n\t\t\t}\n\t\t}\n\n\t\t// Agent: Business Details\n\t\tif (profile.user_role === \"Agent\") {\n\t\t\tautoFillData.agent_required = true\n\t\t\tautoFillData.agent_id = profile.user\n\t\t\tautoFillData.agent_company = profile.company_name\n\t\t\tautoFillData.agent_email = profile.business_email || profile.user\n\t\t\tautoFillData.agent_phone = profile.business_phone || profile.phone\n\n\t\t\tif (profile.business_street) {\n\t\t\t\tautoFillData.agent_address =\n\t\t\t\t\t`${profile.business_street}, ${profile.business_suburb || \"\"}, ${profile.business_city || \"\"} ${profile.business_postcode || \"\"}`.trim()\n\t\t\t}\n\n\t\t\t// Agent preferences\n\t\t\tif (profile.default_communication_route) {\n\t\t\t\tautoFillData.correspondence_recipient =\n\t\t\t\t\tprofile.default_communication_route === \"Agent Only\"\n\t\t\t\t\t\t? \"Agent\"\n\t\t\t\t\t\t: \"Both\"\n\t\t\t}\n\n\t\t\tif (profile.default_invoice_recipient) {\n\t\t\t\tautoFillData.invoice_responsible_party =\n\t\t\t\t\tprofile.default_invoice_recipient\n\t\t\t}\n\t\t}\n\n\t\t// Default Property\n\t\tif (defaultProperty.value) {\n\t\t\tconst prop = defaultProperty.value\n\t\t\tautoFillData.property =\n\t\t\t\t`${prop.street}, ${prop.suburb || \"\"}, ${prop.city || \"\"} ${prop.postcode || \"\"}`.trim()\n\t\t\tautoFillData.property_address = autoFillData.property\n\t\t\tautoFillData.property_legal_description = prop.legal_description\n\t\t\tautoFillData.ownership_status = prop.ownership_status\n\t\t}\n\n\t\t// Communication Preferences\n\t\tif (profile.comm_email || profile.comm_phone || profile.comm_post) {\n\t\t\tautoFillData.communication_preferences = {\n\t\t\t\temail: profile.comm_email || false,\n\t\t\t\tphone: profile.comm_phone || false,\n\t\t\t\tpost: profile.comm_post || false,\n\t\t\t}\n\t\t}\n\n\t\t// Invoice Preference\n\t\tif (profile.invoice_preference) {\n\t\t\tautoFillData.invoice_delivery_method = profile.invoice_preference\n\t\t}\n\n\t\t// ===== PHILIPPINES PERSONAL INFORMATION (SPISC) =====\n\n\t\t// Personal Details (Philippines)\n\t\tif (profile.birth_date) {\n\t\t\tautoFillData.birth_date = profile.birth_date\n\t\t}\n\t\tif (profile.sex) {\n\t\t\tautoFillData.sex = profile.sex\n\t\t}\n\t\tif (profile.civil_status) {\n\t\t\tautoFillData.civil_status = profile.civil_status\n\t\t}\n\n\t\t// Mobile number (use phone)\n\t\tif (profile.phone) {\n\t\t\tautoFillData.mobile_number = profile.phone\n\t\t}\n\n\t\t// PH Address fields\n\t\tif (profile.postal_street) {\n\t\t\tautoFillData.address_line = profile.postal_street\n\t\t}\n\t\tif (profile.postal_suburb) {\n\t\t\tautoFillData.barangay = profile.postal_suburb\n\t\t}\n\t\tif (profile.postal_city) {\n\t\t\tautoFillData.municipality = profile.postal_city\n\t\t}\n\t\tif (profile.postal_province) {\n\t\t\tautoFillData.province = profile.postal_province\n\t\t}\n\n\t\t// Identity Documents\n\t\tif (profile.philsys_id) {\n\t\t\tautoFillData.philsys_id = profile.philsys_id\n\t\t}\n\t\tif (profile.sss_number) {\n\t\t\tautoFillData.sss_number = profile.sss_number\n\t\t}\n\t\tif (profile.osca_id) {\n\t\t\tautoFillData.osca_id = profile.osca_id\n\t\t}\n\n\t\t// Economic Status\n\t\tif (profile.monthly_income !== undefined && profile.monthly_income !== null) {\n\t\t\tautoFillData.monthly_income = profile.monthly_income\n\t\t}\n\t\tif (profile.income_source) {\n\t\t\tautoFillData.income_source = profile.income_source\n\t\t}\n\t\tif (profile.household_size !== undefined && profile.household_size !== null) {\n\t\t\tautoFillData.household_size = profile.household_size\n\t\t}\n\t\tif (profile.living_arrangement) {\n\t\t\tautoFillData.living_arrangement = profile.living_arrangement\n\t\t}\n\t\tif (profile.is_4ps_beneficiary !== undefined) {\n\t\t\tautoFillData.is_4ps_beneficiary = profile.is_4ps_beneficiary\n\t\t}\n\n\t\t// Payment Preferences\n\t\tif (profile.preferred_payment_method) {\n\t\t\tautoFillData.payment_preference = profile.preferred_payment_method\n\t\t}\n\t\tif (profile.bank_name) {\n\t\t\tautoFillData.bank_name = profile.bank_name\n\t\t}\n\t\tif (profile.bank_account_number) {\n\t\t\tautoFillData.bank_account_number = profile.bank_account_number\n\t\t}\n\t\tif (profile.bank_account_holder) {\n\t\t\tautoFillData.bank_account_holder = profile.bank_account_holder\n\t\t}\n\n\t\treturn autoFillData\n\t}\n\n\t/**\n\t * Apply auto-fill to form data\n\t * @param {Object} formData - The form data object to update\n\t * @param {Object} options - Options for auto-fill behavior\n\t * @returns {Object} Updated form data\n\t */\n\tconst applyAutoFill = (formData, options = {}) => {\n\t\tconst {\n\t\t\toverrideExisting = false, // If true, override existing values\n\t\t\tfieldsToSkip = [], // Array of field names to skip\n\t\t} = options\n\n\t\tconst autoFillData = getApplicationAutoFill()\n\n\t\tObject.keys(autoFillData).forEach((key) => {\n\t\t\t// Skip if field is in skip list\n\t\t\tif (fieldsToSkip.includes(key)) return\n\n\t\t\t// Skip if field already has value and we're not overriding\n\t\t\tif (!overrideExisting && formData[key]) return\n\n\t\t\t// Apply auto-fill value\n\t\t\tformData[key] = autoFillData[key]\n\t\t})\n\n\t\treturn formData\n\t}\n\n\t/**\n\t * Get all properties for dropdown/selection\n\t */\n\tconst getAllProperties = computed(() => {\n\t\treturn userProfile.value?.properties || []\n\t})\n\n\t/**\n\t * Get all councils for dropdown/selection\n\t */\n\tconst getAllCouncils = computed(() => {\n\t\treturn userProfile.value?.councils || []\n\t})\n\n\t/**\n\t * Get all clients (Agent only)\n\t */\n\tconst getAllClients = computed(() => {\n\t\treturn userProfile.value?.clients || []\n\t})\n\n\t/**\n\t * Check if profile is complete\n\t */\n\tconst isProfileComplete = computed(() => {\n\t\tif (!userProfile.value) return false\n\n\t\tconst profile = userProfile.value\n\n\t\t// Basic required fields\n\t\tconst hasBasicInfo = profile.full_name && profile.phone && profile.user_role\n\n\t\t// Role-specific completeness\n\t\tif (profile.user_role === \"Individual\") {\n\t\t\treturn (\n\t\t\t\thasBasicInfo &&\n\t\t\t\t(profile.properties?.length > 0 || false) &&\n\t\t\t\t(profile.councils?.length > 0 || false)\n\t\t\t)\n\t\t} else if (profile.user_role === \"Agent\") {\n\t\t\treturn (\n\t\t\t\thasBasicInfo &&\n\t\t\t\tprofile.company_name &&\n\t\t\t\t(profile.councils?.length > 0 || false)\n\t\t\t)\n\t\t}\n\n\t\treturn hasBasicInfo\n\t})\n\n\t/**\n\t * Get profile completion percentage\n\t */\n\tconst profileCompletionPercentage = computed(() => {\n\t\tif (!userProfile.value) return 0\n\n\t\tconst profile = userProfile.value\n\t\tlet completed = 0\n\t\tlet total = 0\n\n\t\t// Basic fields (weight: 30%)\n\t\tconst basicFields = [\"full_name\", \"phone\", \"user_role\"]\n\t\tbasicFields.forEach((field) => {\n\t\t\ttotal++\n\t\t\tif (profile[field]) completed++\n\t\t})\n\n\t\t// Contact preferences (weight: 10%)\n\t\ttotal++\n\t\tif (profile.comm_email || profile.comm_phone || profile.comm_post)\n\t\t\tcompleted++\n\n\t\t// Properties (weight: 30%)\n\t\ttotal++\n\t\tif (profile.properties && profile.properties.length > 0) completed++\n\n\t\t// Councils (weight: 20%)\n\t\ttotal++\n\t\tif (profile.councils && profile.councils.length > 0) completed++\n\n\t\t// Role-specific (weight: 10%)\n\t\tif (profile.user_role === \"Agent\") {\n\t\t\ttotal++\n\t\t\tif (profile.company_name) completed++\n\t\t} else {\n\t\t\ttotal++\n\t\t\tif (profile.postal_street) completed++\n\t\t}\n\n\t\treturn Math.round((completed / total) * 100)\n\t})\n\n\treturn {\n\t\tuserProfile,\n\t\tloading,\n\t\terror,\n\t\tloadUserProfile,\n\t\tgetApplicationAutoFill,\n\t\tapplyAutoFill,\n\t\tdefaultProperty,\n\t\tdefaultCouncil,\n\t\tgetAllProperties,\n\t\tgetAllCouncils,\n\t\tgetAllClients,\n\t\tisProfileComplete,\n\t\tprofileCompletionPercentage,\n\t}\n}\n\n// Export singleton instance for global state\nlet instance = null\n\nexport function useGlobalUserProfile() {\n\tif (!instance) {\n\t\tinstance = useUserProfile()\n\t}\n\treturn instance\n}\n","import { ref, watch } from \"vue\"\nimport { onBeforeRouteLeave, useRoute, useRouter } from \"vue-router\"\nimport { useRequestStore } from \"../stores/requestStore\"\nimport { useSiteCouncilStore } from \"../stores/siteCouncil\"\nimport { useUserProfile } from \"./useUserProfile\"\n\n/**\n * Composable for request form lifecycle management\n * Handles initialization, draft loading, auto-fill, and navigation guards\n *\n * @param {Object} options - Configuration options\n * @param {Function} options.onRequestTypeSelected - Callback when request type is selected\n * @returns {Object} Lifecycle state and methods\n */\nexport function useRequestLifecycle(options = {}) {\n\tconst route = useRoute()\n\tconst router = useRouter()\n\tconst store = useRequestStore()\n\tconst councilStore = useSiteCouncilStore()\n\n\tconst { onRequestTypeSelected = () => {} } = options\n\n\t// State\n\tconst requestTypes = ref({ loading: false, data: [] })\n\tconst selectedRequestTypeDetails = ref(null)\n\n\t/**\n\t * Load available request types for the council\n\t */\n\tasync function loadRequestTypes() {\n\t\trequestTypes.value.loading = true\n\t\tawait councilStore.loadCouncil()\n\t\trequestTypes.value = {\n\t\t\tloading: false,\n\t\t\tdata: councilStore.availableRequestTypes || [],\n\t\t}\n\t}\n\n\t/**\n\t * Handle request type selection\n\t * @param {string} requestTypeCode - Selected request type code\n\t */\n\tasync function selectRequestType(requestTypeCode) {\n\t\tstore.updateField(\"request_type\", requestTypeCode)\n\t\tawait store.initialize(requestTypeCode)\n\t\tselectedRequestTypeDetails.value = store.requestTypeConfig\n\n\t\tif (!store.requestTypeConfig) {\n\t\t\tconsole.error(\"[Lifecycle] Failed to load request type config\")\n\t\t\treturn\n\t\t}\n\n\t\tonRequestTypeSelected(requestTypeCode)\n\t}\n\n\t/**\n\t * Initialize the request form\n\t * Handles draft loading, auto-fill, and URL parameters\n\t */\n\tasync function initialize() {\n\t\tconst requestTypeCode = route.query.type\n\t\tconst draftId = route.query.draft\n\n\t\tconsole.log(\n\t\t\t\"[Lifecycle] Initialization - type:\",\n\t\t\trequestTypeCode,\n\t\t\t\"draft:\",\n\t\t\tdraftId,\n\t\t)\n\n\t\t// Clean state for fresh requests\n\t\tif (!draftId && !route.query.draft) {\n\t\t\tstore.reset()\n\t\t}\n\n\t\t// Auto-fill user profile data for new requests\n\t\tif (!draftId) {\n\t\t\tconst { getApplicationAutoFill, applyAutoFill } = useUserProfile()\n\t\t\ttry {\n\t\t\t\tawait getApplicationAutoFill()\n\t\t\t\tapplyAutoFill(store.formData, { overrideExisting: false })\n\t\t\t} catch (error) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t\"[Lifecycle] Failed to load user profile for auto-fill:\",\n\t\t\t\t\terror,\n\t\t\t\t)\n\t\t\t}\n\t\t}\n\n\t\t// Handle draft loading (takes precedence)\n\t\tif (draftId && requestTypeCode) {\n\t\t\tawait store.initialize(requestTypeCode, draftId)\n\t\t\tselectedRequestTypeDetails.value = store.requestTypeConfig\n\t\t\treturn\n\t\t}\n\n\t\t// Load council and request types\n\t\tawait loadRequestTypes()\n\n\t\t// Handle request type pre-selection from URL\n\t\tif (requestTypeCode && !draftId) {\n\t\t\tconsole.log(\"[Lifecycle] Request type provided in URL:\", requestTypeCode)\n\t\t\tawait store.initialize(requestTypeCode)\n\t\t\tselectedRequestTypeDetails.value = store.requestTypeConfig\n\t\t\tstore.updateField(\"request_type\", requestTypeCode)\n\t\t\tstore.currentStep = 1 // Skip to Process Info\n\t\t\tconsole.log(\"[Lifecycle] Advanced to step 1 (Process Info)\")\n\t\t}\n\t}\n\n\t/**\n\t * Setup navigation guard for unsaved changes\n\t */\n\tfunction setupRouteGuard() {\n\t\tonBeforeRouteLeave((to, from, next) => {\n\t\t\t// Allow navigation if submitting or no draft exists\n\t\t\tif (store.isSubmitting || !store.currentRequestId) {\n\t\t\t\tstore.reset()\n\t\t\t\tnext()\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Check for unsaved changes\n\t\t\tconst hasChanges =\n\t\t\t\tstore.formData &&\n\t\t\t\tObject.keys(store.formData).some(\n\t\t\t\t\t(key) =>\n\t\t\t\t\t\tstore.formData[key] !== undefined &&\n\t\t\t\t\t\tstore.formData[key] !== null &&\n\t\t\t\t\t\tstore.formData[key] !== \"\",\n\t\t\t\t)\n\n\t\t\tif (\n\t\t\t\thasChanges &&\n\t\t\t\t!confirm(\n\t\t\t\t\t\"You have unsaved changes. Do you want to leave without saving?\",\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tnext(false)\n\t\t\t} else {\n\t\t\t\tif (!to.path.includes(\"/request/\")) {\n\t\t\t\t\tstore.reset()\n\t\t\t\t}\n\t\t\t\tnext()\n\t\t\t}\n\t\t})\n\t}\n\n\t/**\n\t * Setup age calculation watcher for applications with birth_date field\n\t * Auto-calculates age from birth_date for display purposes\n\t * Note: Age validation is now configured in Request Type field config (validation: \"min_age:60\")\n\t */\n\tfunction setupAgeValidation() {\n\t\twatch(\n\t\t\t() => store.formData.birth_date,\n\t\t\t(newDate) => {\n\t\t\t\tif (newDate) {\n\t\t\t\t\tconst today = new Date()\n\t\t\t\t\tconst born = new Date(newDate)\n\t\t\t\t\tlet age = today.getFullYear() - born.getFullYear()\n\t\t\t\t\tconst m = today.getMonth() - born.getMonth()\n\t\t\t\t\tif (m < 0 || (m === 0 && today.getDate() < born.getDate())) {\n\t\t\t\t\t\tage--\n\t\t\t\t\t}\n\t\t\t\t\tstore.updateField(\"age\", age)\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\t}\n\n\treturn {\n\t\t// State\n\t\trequestTypes,\n\t\tselectedRequestTypeDetails,\n\n\t\t// Methods\n\t\tloadRequestTypes,\n\t\tselectRequestType,\n\t\tinitialize,\n\t\tsetupRouteGuard,\n\t\tsetupAgeValidation,\n\t}\n}\n","<script setup>\nimport { computed } from \"vue\"\n\nconst props = defineProps({\n\tcurrentStep: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\ttotalSteps: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\tstepTitles: {\n\t\ttype: Array,\n\t\tdefault: () => [],\n\t},\n})\n\nconst progressPercentage = computed(() => {\n\tif (props.totalSteps === 0) return 0\n\treturn Math.round(((props.currentStep + 1) / props.totalSteps) * 100)\n})\n\nconst getStepStatus = (stepIndex) => {\n\tif (stepIndex < props.currentStep) return \"completed\"\n\tif (stepIndex === props.currentStep) return \"current\"\n\treturn \"upcoming\"\n}\n</script>\n\n<template>\n\t<div class=\"mb-8\">\n\t\t<!-- Progress Bar -->\n\t\t<div class=\"relative mb-6\">\n\t\t\t<div class=\"overflow-hidden h-2 text-xs flex rounded bg-gray-200\">\n\t\t\t\t<div\n\t\t\t\t\t:style=\"{ width: progressPercentage + '%' }\"\n\t\t\t\t\tclass=\"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-600 transition-all duration-500\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"flex justify-between mt-2\">\n\t\t\t\t<span class=\"text-sm font-medium text-gray-700\">\n\t\t\t\t\t{{ stepTitles[currentStep] || `Step ${currentStep + 1}` }}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"text-sm font-medium text-gray-700\">\n\t\t\t\t\t{{ progressPercentage }}% Complete\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Step Indicators (temporarily hidden) -->\n\t\t<!-- <nav aria-label=\"Progress\" v-if=\"stepTitles.length > 0\">\n\t\t\t<ol class=\"flex items-center\">\n\t\t\t\t<li\n\t\t\t\t\tv-for=\"(title, index) in stepTitles\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t'relative',\n\t\t\t\t\t\tindex !== stepTitles.length - 1 ? 'pr-8 sm:pr-20 flex-1' : ''\n\t\t\t\t\t]\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"index !== stepTitles.length - 1\"\n\t\t\t\t\t\tclass=\"absolute inset-0 flex items-center\"\n\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'h-0.5 w-full',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'completed' ? 'bg-blue-600' : 'bg-gray-200'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"relative flex items-center group\">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'completed'\n\t\t\t\t\t\t\t\t\t? 'bg-blue-600 text-white'\n\t\t\t\t\t\t\t\t\t: getStepStatus(index) === 'current'\n\t\t\t\t\t\t\t\t\t? 'bg-white border-2 border-blue-600 text-blue-600'\n\t\t\t\t\t\t\t\t\t: 'bg-white border-2 border-gray-300 text-gray-500'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-if=\"getStepStatus(index) === 'completed'\">\n\t\t\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t{{ index + 1 }}\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if=\"title\"\n\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t'ml-3 text-sm font-medium hidden sm:block',\n\t\t\t\t\t\t\t\tgetStepStatus(index) === 'current'\n\t\t\t\t\t\t\t\t\t? 'text-blue-600'\n\t\t\t\t\t\t\t\t\t: getStepStatus(index) === 'completed'\n\t\t\t\t\t\t\t\t\t? 'text-gray-900'\n\t\t\t\t\t\t\t\t\t: 'text-gray-500'\n\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t</ol>\n\t\t</nav> -->\n\t</div>\n</template>\n","<script setup>\nimport { Button } from \"frappe-ui\"\n\nconst props = defineProps({\n\tcurrentStep: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\ttotalSteps: {\n\t\ttype: Number,\n\t\trequired: true,\n\t},\n\tisLastStep: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\tcanGoNext: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\tcanSaveDraft: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n\tisSaving: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\tisSubmitting: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n})\n\nconst emit = defineEmits([\"next\", \"previous\", \"save-draft\", \"submit\"])\n\nconst handleNext = () => {\n\temit(\"next\")\n}\n\nconst handlePrevious = () => {\n\temit(\"previous\")\n}\n\nconst handleSaveDraft = () => {\n\temit(\"save-draft\")\n}\n\nconst handleSubmit = () => {\n\temit(\"submit\")\n}\n</script>\n\n<template>\n\t<div class=\"mt-8 pt-6 border-t border-gray-200\">\n\t\t<div class=\"flex items-center justify-between\">\n\t\t\t<!-- Previous Button -->\n\t\t\t<div>\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"currentStep > 0\"\n\t\t\t\t\t@click=\"handlePrevious\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t:disabled=\"isSaving || isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\tPrevious\n\t\t\t\t</Button>\n\t\t\t</div>\n\n\t\t\t<!-- Right side buttons -->\n\t\t\t<div class=\"flex items-center space-x-3\">\n\t\t\t\t<!-- Save Draft Button - Only show after council, type, and process info steps -->\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"canSaveDraft\"\n\t\t\t\t\t@click=\"handleSaveDraft\"\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t:loading=\"isSaving\"\n\t\t\t\t\t:disabled=\"isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"!isSaving\" #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ isSaving ? 'Saving...' : 'Save Draft' }}\n\t\t\t\t</Button>\n\n\t\t\t\t<!-- Next or Submit Button -->\n\t\t\t\t<Button\n\t\t\t\t\tv-if=\"!isLastStep\"\n\t\t\t\t\t@click=\"handleNext\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"blue\"\n\t\t\t\t\t:disabled=\"!canGoNext || isSaving || isSubmitting\"\n\t\t\t\t>\n\t\t\t\t\tNext\n\t\t\t\t\t<template #suffix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5l7 7-7 7\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t</Button>\n\n\t\t\t\t<Button\n\t\t\t\t\tv-else\n\t\t\t\t\t@click=\"handleSubmit\"\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"green\"\n\t\t\t\t\t:loading=\"isSubmitting\"\n\t\t\t\t\t:disabled=\"!canGoNext || isSaving\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"!isSubmitting\" #prefix>\n\t\t\t\t\t\t<svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ isSubmitting ? 'Submitting...' : 'Submit Application' }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<!-- Help Text -->\n\t\t<div class=\"mt-4 text-center\">\n\t\t\t<p class=\"text-sm text-gray-500\">\n\t\t\t\tYour progress is automatically saved. You can return to complete this application later.\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</template>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Select Application Type</h2>\n    <p class=\"text-gray-600 mb-8\">Choose the type of consent you wish to apply for</p>\n\n    <div v-if=\"requestTypes.loading\" class=\"text-center py-12\">\n      <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n    </div>\n\n    <div v-else class=\"grid md:grid-cols-2 gap-4\">\n      <div\n        v-for=\"type in requestTypes.data\"\n        :key=\"type.name\"\n        @click=\"selectType(type)\"\n        class=\"border-2 rounded-lg p-6 cursor-pointer transition-all hover:shadow-md\"\n        :class=\"modelValue.request_type === type.name ? 'border-blue-600 bg-blue-50' : 'border-gray-200 hover:border-blue-300'\"\n      >\n        <div class=\"flex items-start justify-between\">\n          <div class=\"flex-1\">\n            <h3 class=\"text-lg font-semibold text-gray-900 mb-2\">{{ type.type_name }}</h3>\n            <p class=\"text-sm text-gray-600\" v-html=\"type.description || 'No description available'\"></p>\n            <div class=\"mt-4 flex items-center space-x-4 text-xs text-gray-500\">\n              <span v-if=\"type.base_fee\">Fee: ${{ type.base_fee }}</span>\n              <span v-if=\"type.processing_sla_days\">{{ type.processing_sla_days }} days</span>\n              <span v-if=\"type.category\" class=\"px-2 py-1 bg-gray-100 rounded\">{{ type.category }}</span>\n            </div>\n          </div>\n          <div v-if=\"modelValue.request_type === type.name\" class=\"ml-4\">\n            <div class=\"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center\">\n              <svg class=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n              </svg>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { defineEmits, defineProps } from \"vue\"\n\nconst props = defineProps({\n\tmodelValue: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\trequestTypes: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n})\n\nconst emit = defineEmits([\"update:modelValue\", \"type-selected\"])\n\nconst selectType = (type) => {\n\tconsole.log(\"[Step2RequestType] selectType called with:\", type.name)\n\tconsole.log(\"[Step2RequestType] props.modelValue:\", props.modelValue)\n\tconsole.log(\n\t\t\"[Step2RequestType] props.modelValue.council:\",\n\t\tprops.modelValue.council,\n\t)\n\n\tconst updatedValue = {\n\t\t...props.modelValue,\n\t\trequest_type: type.name,\n\t}\n\n\tconsole.log(\"[Step2RequestType] Emitting updatedValue:\", updatedValue)\n\temit(\"update:modelValue\", updatedValue)\n\temit(\"type-selected\", type.name)\n}\n</script>\n","<template>\n  <div>\n    <h2 class=\"text-2xl font-bold text-gray-900 mb-2\">Council Process Information</h2>\n    <p class=\"text-gray-600 mb-6\">Understanding {{ councilName }}'s process for this application</p>\n\n    <div v-if=\"requestTypeDetails\" class=\"space-y-6\">\n\n      <!-- Note: Council Meeting booking has been moved to before the application starts -->\n      <!-- Users can book meetings from the request type selection page -->\n\n      <div class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <div class=\"flex items-start justify-between mb-4\">\n          <div>\n            <h3 class=\"text-xl font-semibold text-gray-900\">{{ requestTypeDetails.request_type_name }}</h3>\n            <p v-if=\"requestTypeDetails.category\" class=\"text-sm text-gray-500 mt-1\">\n              {{ requestTypeDetails.category }}\n            </p>\n          </div>\n        </div>\n\n        <div class=\"grid md:grid-cols-3 gap-4 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Application Fee</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              ${{ requestTypeDetails.base_fee || '0' }}\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Plus any additional costs</div>\n          </div>\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Processing Time</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              {{ requestTypeDetails.sla_days || 'N/A' }} <span class=\"text-base\">days</span>\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Standard timeframe</div>\n          </div>\n          <div>\n            <div class=\"text-xs text-blue-600 font-medium uppercase\">Payment Required</div>\n            <div class=\"text-2xl font-bold text-blue-900 mt-1\">\n              {{ requestTypeDetails.requires_payment ? 'Yes' : 'No' }}\n            </div>\n            <div class=\"text-xs text-blue-600 mt-1\">Before processing</div>\n          </div>\n        </div>\n      </div>\n\n      <div v-if=\"requestTypeDetails.process_description\" class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <h4 class=\"text-lg font-semibold text-gray-900 mb-4\">How This Works</h4>\n        <div class=\"prose prose-sm max-w-none text-gray-700\" v-html=\"requestTypeDetails.process_description\"></div>\n      </div>\n\n      <div v-else-if=\"requestTypeDetails.description\" class=\"bg-white border border-gray-200 rounded-lg p-6\">\n        <h4 class=\"text-lg font-semibold text-gray-900 mb-4\">About This Application</h4>\n        <div class=\"prose prose-sm max-w-none text-gray-700\" v-html=\"requestTypeDetails.description\"></div>\n      </div>\n\n      <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n        <div class=\"flex items-start\">\n          <svg class=\"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-yellow-900 text-sm\">Before You Continue</h5>\n            <p class=\"text-yellow-800 text-sm mt-1\">\n              Please review this information carefully. Make sure you understand the process, fees, and timeframes before proceeding with your application.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"flex justify-center pt-4\">\n        <button\n          type=\"button\"\n          @click=\"handleContinue\"\n          class=\"px-8 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors\"\n        >\n          I Understand - Continue to Application\n        </button>\n      </div>\n    </div>\n\n    <div v-else class=\"text-center py-12\">\n      <p class=\"text-gray-500\">No request type selected. Please go back and select a request type.</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { session } from \"@/data/session\"\nimport { defineEmits, defineProps } from \"vue\"\nimport { useRouter } from \"vue-router\"\n\nconst router = useRouter()\n\nconst props = defineProps({\n\trequestTypeDetails: {\n\t\ttype: Object,\n\t\tdefault: null,\n\t},\n\tcouncilName: {\n\t\ttype: String,\n\t\tdefault: \"\",\n\t},\n\tmodelValue: {\n\t\ttype: Object,\n\t\tdefault: () => ({}),\n\t},\n})\n\nconst emit = defineEmits([\"continue\", \"update:modelValue\"])\n\nconst handleContinue = () => {\n\t// Check if user is logged in before allowing them to continue\n\tif (!session.isLoggedIn) {\n\t\t// Save current URL to redirect back after login\n\t\tconst currentPath = window.location.pathname + window.location.search\n\t\trouter.push({\n\t\t\tname: \"Login\",\n\t\t\tquery: { redirect: currentPath },\n\t\t})\n\t\treturn\n\t}\n\n\t// User is logged in, proceed normally\n\temit(\"continue\")\n}\n</script>\n","<template>\n  <div class=\"px-4 sm:px-0\">\n    <h2 class=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">Review & Submit</h2>\n    <p class=\"text-sm sm:text-base text-gray-600 mb-6 sm:mb-8\">Review your application details before submitting</p>\n\n    <div class=\"space-y-4 sm:space-y-6\">\n      <!-- Application Summary -->\n      <div class=\"bg-blue-50 border border-blue-200 rounded-lg p-4 sm:p-6\">\n        <div class=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-0\">\n          <div>\n            <h3 class=\"text-base sm:text-lg font-semibold text-blue-900\">{{ requestTypeName }}</h3>\n            <p class=\"text-xs sm:text-sm text-blue-700 mt-1\">{{ councilName }}</p>\n          </div>\n          <div class=\"sm:text-right\">\n            <div class=\"text-xs sm:text-sm text-blue-600 font-medium\">Application Fee</div>\n            <div class=\"text-xl sm:text-2xl font-bold text-blue-900\">{{ applicationFee }}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- SPISC Eligibility Summary (show for SPISC applications) -->\n      <div v-if=\"isSPISCApplication\" class=\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-green-100 px-4 sm:px-6 py-3 border-b border-green-200\">\n          <h3 class=\"font-semibold text-green-900 text-sm sm:text-base flex items-center gap-2\">\n            <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\" />\n            </svg>\n            Eligibility Summary\n          </h3>\n        </div>\n        <div class=\"p-4 sm:p-6\">\n          <div class=\"grid md:grid-cols-3 gap-4\">\n            <div class=\"flex items-center gap-3\">\n              <div :class=\"ageEligible ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'\" class=\"p-2 rounded-full\">\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                </svg>\n              </div>\n              <div>\n                <p class=\"text-sm text-gray-500\">Age</p>\n                <p class=\"font-semibold\" :class=\"ageEligible ? 'text-green-700' : 'text-red-700'\">\n                  {{ calculatedAge !== null ? `${calculatedAge} years old` : 'Not provided' }}\n                </p>\n                <p v-if=\"ageEligible\" class=\"text-xs text-green-600\">Meets 60+ requirement</p>\n                <p v-else-if=\"calculatedAge !== null\" class=\"text-xs text-red-600\">Must be 60 or older</p>\n              </div>\n            </div>\n            <div class=\"flex items-center gap-3\">\n              <div :class=\"incomeEligible ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'\" class=\"p-2 rounded-full\">\n                <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n              </div>\n              <div>\n                <p class=\"text-sm text-gray-500\">Monthly Income</p>\n                <p class=\"font-semibold\" :class=\"incomeEligible ? 'text-green-700' : 'text-yellow-700'\">\n                  {{ formatCurrency(modelValue.monthly_income) }}\n                </p>\n                <p v-if=\"incomeEligible\" class=\"text-xs text-green-600\">Below poverty threshold</p>\n                <p v-else class=\"text-xs text-yellow-600\">May affect eligibility</p>\n              </div>\n            </div>\n            <div class=\"flex items-center gap-3\">\n              <div :class=\"overallEligible ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'\" class=\"p-2 rounded-full\">\n                <svg v-if=\"overallEligible\" class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <svg v-else class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                </svg>\n              </div>\n              <div>\n                <p class=\"text-sm text-gray-500\">Preliminary Status</p>\n                <p class=\"font-semibold\" :class=\"overallEligible ? 'text-green-700' : 'text-yellow-700'\">\n                  {{ overallEligible ? 'Likely Eligible' : 'Needs Review' }}\n                </p>\n                <p class=\"text-xs text-gray-500\">Final assessment by council</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Applicant Details -->\n      <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Applicant Details</h3>\n        </div>\n        <div class=\"p-4 sm:p-6 space-y-3\">\n          <div class=\"grid md:grid-cols-2 gap-4\">\n            <div>\n              <span class=\"text-sm text-gray-500\">Name:</span>\n              <p class=\"font-medium\">{{ applicantName || 'Not provided' }}</p>\n            </div>\n            <div>\n              <span class=\"text-sm text-gray-500\">Email:</span>\n              <p class=\"font-medium\">{{ applicantEmail || 'Not provided' }}</p>\n            </div>\n            <div>\n              <span class=\"text-sm text-gray-500\">Phone:</span>\n              <p class=\"font-medium\">{{ applicantPhone || 'Not provided' }}</p>\n            </div>\n            <div v-if=\"modelValue.applicant_company\">\n              <span class=\"text-sm text-gray-500\">Company:</span>\n              <p class=\"font-medium\">{{ modelValue.applicant_company }}</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Property Details (only show if request type has property information) -->\n      <div v-if=\"hasPropertyDetails\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Property Details</h3>\n        </div>\n        <div class=\"p-4 sm:p-6\">\n          <div v-if=\"modelValue.property_address\" class=\"space-y-2\">\n            <div>\n              <span class=\"text-sm text-gray-500\">Address:</span>\n              <p class=\"font-medium\">{{ modelValue.property_address }}</p>\n            </div>\n            <div v-if=\"modelValue.legal_description\">\n              <span class=\"text-sm text-gray-500\">Legal Description:</span>\n              <p class=\"font-medium\">{{ modelValue.legal_description }}</p>\n            </div>\n          </div>\n          <p v-else class=\"text-gray-500\">No property selected</p>\n        </div>\n      </div>\n\n      <!-- Delivery Preference (only show if request type collects payment) -->\n      <div v-if=\"requestTypeDetails?.collect_payment\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Delivery & Payment</h3>\n        </div>\n        <div class=\"p-4 sm:p-6 space-y-3\">\n          <div>\n            <span class=\"text-sm text-gray-500\">Delivery Preference:</span>\n            <p class=\"font-medium\">{{ modelValue.delivery_preference || 'Not selected' }}</p>\n          </div>\n          <div>\n            <span class=\"text-sm text-gray-500\">Invoice To:</span>\n            <p class=\"font-medium\">{{ modelValue.invoice_to || 'Not specified' }}</p>\n          </div>\n        </div>\n      </div>\n\n      <!-- Dynamic Review Sections (for configured request types) - ALL STEPS -->\n      <template v-if=\"usesConfigurableSteps && allStepsWithData.length > 0\">\n        <div\n          v-for=\"step in allStepsWithData\"\n          :key=\"step.step_code\"\n          class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\"\n        >\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200 flex items-center justify-between\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">{{ step.step_title }}</h3>\n            <span v-if=\"getStepCompleteness(step)\" class=\"text-xs text-green-600 flex items-center gap-1\">\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\n              </svg>\n              Complete\n            </span>\n          </div>\n          <div class=\"p-4 sm:p-6 space-y-4\">\n            <template v-for=\"section in step.sections\" :key=\"section.section_code\">\n              <!-- Only show section if it has visible fields with values or show_on_review -->\n              <div v-if=\"shouldShowSection(section)\" class=\"space-y-3\">\n                <h4 v-if=\"section.section_title\" class=\"text-sm font-medium text-gray-700 border-b border-gray-100 pb-1\">\n                  {{ section.section_title }}\n                </h4>\n                <div class=\"grid md:grid-cols-2 gap-4\">\n                  <template v-for=\"field in section.fields\" :key=\"field.field_name\">\n                    <div v-if=\"shouldShowField(field)\" :class=\"isLongField(field) ? 'md:col-span-2' : ''\">\n                      <span class=\"text-sm text-gray-500\">{{ field.review_label || field.field_label }}:</span>\n                      <div class=\"font-medium\">\n                        <!-- Attachment fields -->\n                        <template v-if=\"field.field_type === 'Attach' || field.field_type === 'Attach Image'\">\n                          <div v-if=\"getFieldValue(field.field_name)\" class=\"flex items-center gap-2 text-green-600\">\n                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                            </svg>\n                            <span>File uploaded</span>\n                            <a v-if=\"getAttachmentUrl(field.field_name)\" :href=\"getAttachmentUrl(field.field_name)\" target=\"_blank\" class=\"text-blue-600 hover:underline text-sm\">(View)</a>\n                          </div>\n                          <span v-else class=\"text-gray-400\">Not uploaded</span>\n                        </template>\n                        <!-- Checkbox fields -->\n                        <template v-else-if=\"field.field_type === 'Check'\">\n                          <span :class=\"modelValue[field.field_name] ? 'text-green-600' : 'text-gray-400'\">\n                            {{ modelValue[field.field_name] ? 'Yes' : 'No' }}\n                          </span>\n                        </template>\n                        <!-- Date fields -->\n                        <template v-else-if=\"field.field_type === 'Date'\">\n                          <span>{{ formatDate(modelValue[field.field_name]) }}</span>\n                          <span v-if=\"field.field_name === 'birth_date' && calculatedAge !== null\" class=\"text-gray-500 text-sm ml-2\">\n                            ({{ calculatedAge }} years old)\n                          </span>\n                        </template>\n                        <!-- Currency fields -->\n                        <template v-else-if=\"field.field_type === 'Currency'\">\n                          {{ formatCurrency(modelValue[field.field_name]) }}\n                        </template>\n                        <!-- Pickup Schedule -->\n                        <template v-else-if=\"field.field_type === 'Pickup Schedule'\">\n                          <span v-if=\"modelValue[field.field_name]\">\n                            {{ formatPickupSchedule(modelValue[field.field_name]) }}\n                          </span>\n                          <span v-else class=\"text-gray-400\">Not scheduled</span>\n                        </template>\n                        <!-- Default -->\n                        <template v-else>\n                          {{ formatFieldValue(field, modelValue[field.field_name]) }}\n                        </template>\n                      </div>\n                    </div>\n                  </template>\n                </div>\n              </div>\n            </template>\n            <p v-if=\"!hasAnyContent(step)\" class=\"text-gray-500 text-sm\">\n              No information entered for this step\n            </p>\n          </div>\n        </div>\n      </template>\n\n      <!-- Uploaded Documents Summary -->\n      <div v-if=\"uploadedDocuments.length > 0\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n        <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n          <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base flex items-center gap-2\">\n            <svg class=\"w-5 h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n            </svg>\n            Uploaded Documents ({{ uploadedDocuments.length }})\n          </h3>\n        </div>\n        <div class=\"p-4 sm:p-6\">\n          <div class=\"grid md:grid-cols-2 gap-3\">\n            <div v-for=\"doc in uploadedDocuments\" :key=\"doc.field_name\" class=\"flex items-center gap-3 p-2 bg-gray-50 rounded\">\n              <svg class=\"w-5 h-5 text-green-600 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n              <div class=\"flex-1 min-w-0\">\n                <p class=\"text-sm font-medium text-gray-900 truncate\">{{ doc.label }}</p>\n                <a v-if=\"doc.url\" :href=\"doc.url\" target=\"_blank\" class=\"text-xs text-blue-600 hover:underline\">View file</a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Missing Documents Warning -->\n      <div v-if=\"missingRequiredDocuments.length > 0\" class=\"bg-orange-50 border border-orange-200 rounded-lg p-4\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-orange-900 text-xs sm:text-sm\">Missing Required Documents</h5>\n            <ul class=\"mt-1 text-orange-800 text-xs sm:text-sm list-disc list-inside\">\n              <li v-for=\"doc in missingRequiredDocuments\" :key=\"doc.field_name\">{{ doc.label }}</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <!-- Resource Consent Specific Details -->\n      <template v-if=\"isResourceConsent\">\n        <!-- Consent Types -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Consent Types & Activity Status</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-3\">\n              <div>\n                <span class=\"text-sm text-gray-500\">Consent Types:</span>\n                <div class=\"mt-2 flex flex-wrap gap-2\">\n                  <span\n                    v-if=\"modelValue.consent_type_land_use\"\n                    class=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium\"\n                  >\n                    Land Use Consent\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_subdivision\"\n                    class=\"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium\"\n                  >\n                    Subdivision Consent\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_discharge\"\n                    class=\"px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-medium\"\n                  >\n                    Discharge Permit\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_water\"\n                    class=\"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium\"\n                  >\n                    Water Permit\n                  </span>\n                  <span\n                    v-if=\"modelValue.consent_type_coastal\"\n                    class=\"px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-sm font-medium\"\n                  >\n                    Coastal Permit\n                  </span>\n                  <span v-if=\"!hasAnyConsentType\" class=\"text-gray-500\">\n                    None selected\n                  </span>\n                </div>\n              </div>\n              <div>\n                <span class=\"text-sm text-gray-500\">Activity Status:</span>\n                <div class=\"mt-1 inline-flex items-center\">\n                  <span\n                    class=\"px-3 py-1 rounded-full text-sm font-medium\"\n                    :class=\"activityStatusClass\"\n                  >\n                    {{ modelValue.activity_status_type || 'Not specified' }}\n                  </span>\n                </div>\n              </div>\n              <div v-if=\"modelValue.activity_title\">\n                <span class=\"text-sm text-gray-500\">Activity Title:</span>\n                <p class=\"font-medium break-words\">{{ modelValue.activity_title }}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Natural Hazards -->\n        <div v-if=\"hasNaturalHazards\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Natural Hazards</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"flex flex-wrap gap-2\">\n              <span\n                v-if=\"modelValue.hazard_flooding\"\n                class=\"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                Flood Hazard\n              </span>\n              <span\n                v-if=\"modelValue.hazard_earthquake\"\n                class=\"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                Earthquake/Fault Line\n              </span>\n              <span\n                v-if=\"modelValue.hazard_landslip\"\n                class=\"px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                Landslip/Slope Instability\n              </span>\n              <span\n                v-if=\"modelValue.hazard_coastal\"\n                class=\"px-3 py-1 bg-cyan-100 text-cyan-800 rounded-full text-sm font-medium inline-flex items-center gap-1\"\n              >\n                Coastal Hazard\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <!-- Consultation & Affected Parties -->\n        <div v-if=\"hasConsultation\" class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Consultation & Affected Parties</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-3\">\n              <div>\n                <span class=\"text-sm text-gray-500\">Consultation Undertaken:</span>\n                <p class=\"font-medium\">{{ modelValue.consultation_undertaken || 'Not specified' }}</p>\n              </div>\n              <div v-if=\"modelValue.consultation_summary\">\n                <span class=\"text-sm text-gray-500\">Consultation Summary:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ modelValue.consultation_summary }}</p>\n              </div>\n              <div v-if=\"modelValue.affected_parties_details\">\n                <span class=\"text-sm text-gray-500\">Affected Parties:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ stripHtml(modelValue.affected_parties_details) }}</p>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                <svg\n                  class=\"w-5 h-5\"\n                  :class=\"modelValue.written_approvals_obtained ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span :class=\"modelValue.written_approvals_obtained ? 'text-gray-900' : 'text-gray-500'\">\n                  Written Approvals {{ modelValue.written_approvals_obtained ? 'Obtained' : 'Not Obtained' }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- AEE Summary -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Assessment of Environmental Effects</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-4\">\n              <div v-if=\"modelValue.activity_description\">\n                <span class=\"text-sm text-gray-500\">Activity Description:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.activity_description\"></div>\n              </div>\n              <div v-if=\"modelValue.aee_full_assessment\">\n                <span class=\"text-sm text-gray-500\">Full Assessment:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.aee_full_assessment\"></div>\n              </div>\n              <div v-if=\"modelValue.positive_effects_description\">\n                <span class=\"text-sm text-gray-500\">Positive Effects:</span>\n                <p class=\"text-sm mt-1 line-clamp-3\">{{ modelValue.positive_effects_description }}</p>\n              </div>\n              <div v-if=\"modelValue.effects_visual_amenity || modelValue.effects_traffic_parking || modelValue.effects_noise\">\n                <span class=\"text-sm text-gray-500\">Adverse Effects Summary:</span>\n                <ul class=\"text-sm mt-1 space-y-1 list-disc list-inside\">\n                  <li v-if=\"modelValue.effects_visual_amenity\">Visual/Amenity: {{ truncate(modelValue.effects_visual_amenity, 50) }}</li>\n                  <li v-if=\"modelValue.effects_traffic_parking\">Traffic/Parking: {{ truncate(modelValue.effects_traffic_parking, 50) }}</li>\n                  <li v-if=\"modelValue.effects_noise\">Noise: {{ truncate(modelValue.effects_noise, 50) }}</li>\n                </ul>\n              </div>\n              <div v-if=\"modelValue.mitigation_measures\">\n                <span class=\"text-sm text-gray-500\">Mitigation Measures:</span>\n                <div class=\"text-sm mt-1 line-clamp-3\" v-html=\"modelValue.mitigation_measures\"></div>\n              </div>\n              <p v-if=\"!hasAEEContent\" class=\"text-gray-500 text-sm\">\n                AEE not yet completed\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Statutory Declarations -->\n        <div class=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n          <div class=\"bg-gray-50 px-4 sm:px-6 py-3 border-b border-gray-200\">\n            <h3 class=\"font-semibold text-gray-900 text-sm sm:text-base\">Statutory Declarations</h3>\n          </div>\n          <div class=\"p-4 sm:p-6\">\n            <div class=\"space-y-2\">\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_accuracy || modelValue.declaration_rma_compliance) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_accuracy || modelValue.declaration_rma_compliance) ? 'text-gray-900' : 'text-gray-500'\">\n                  Declaration of Accuracy & RMA Compliance\n                </span>\n              </div>\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_authority || modelValue.declaration_authorized) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_authority || modelValue.declaration_authorized) ? 'text-gray-900' : 'text-gray-500'\">\n                  Declaration of Authority to Apply\n                </span>\n              </div>\n              <div class=\"flex items-start gap-2\">\n                <svg\n                  class=\"w-5 h-5 flex-shrink-0 mt-0.5\"\n                  :class=\"(modelValue.declaration_acknowledgment || modelValue.declaration_public_information) ? 'text-green-600' : 'text-gray-400'\"\n                  fill=\"none\"\n                  stroke=\"currentColor\"\n                  viewBox=\"0 0 24 24\"\n                >\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n                <span class=\"text-sm\" :class=\"(modelValue.declaration_acknowledgment || modelValue.declaration_public_information) ? 'text-gray-900' : 'text-gray-500'\">\n                  Public Information & Privacy Acknowledgment\n                </span>\n              </div>\n              <div v-if=\"modelValue.requester_signature\" class=\"mt-4 pt-4 border-t border-gray-200\">\n                <span class=\"text-sm text-gray-500\">Signed by:</span>\n                <p class=\"font-medium\">{{ modelValue.requester_signature }}</p>\n                <p v-if=\"modelValue.signature_date\" class=\"text-sm text-gray-500\">\n                  Date: {{ formatSignatureDate(modelValue.signature_date) }}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </template>\n\n      <!-- Important Notice -->\n      <div class=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 sm:p-6\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 sm:w-6 sm:h-6 text-yellow-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n          <div>\n            <h4 class=\"font-semibold text-yellow-900 text-sm sm:text-base\">Before You Submit</h4>\n            <ul class=\"mt-2 text-xs sm:text-sm text-yellow-800 space-y-1 list-disc list-inside\">\n              <li>Review all information carefully for accuracy and completeness</li>\n              <li>Ensure all required fields are completed</li>\n              <li v-if=\"isResourceConsent\">For Resource Consent applications, verify all statutory declarations are confirmed</li>\n              <li v-if=\"isSPISCApplication\">Ensure all required documents are uploaded</li>\n              <li>Once submitted, you cannot edit the application (you may need to withdraw and resubmit)</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <!-- Completeness Check -->\n      <div v-if=\"!isComplete\" class=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n        <div class=\"flex items-start gap-2 sm:gap-3\">\n          <svg class=\"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          </svg>\n          <div>\n            <h5 class=\"font-semibold text-red-900 text-xs sm:text-sm\">Application Incomplete</h5>\n            <p class=\"text-red-800 text-xs sm:text-sm mt-1\">\n              Please complete all required sections before submitting. Use the Previous button to go back and fill in missing information.\n            </p>\n            <ul v-if=\"missingFields.length > 0\" class=\"mt-2 text-red-700 text-xs list-disc list-inside\">\n              <li v-for=\"field in missingFields.slice(0, 5)\" :key=\"field\">{{ field }}</li>\n              <li v-if=\"missingFields.length > 5\">...and {{ missingFields.length - 5 }} more</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { computed, defineProps } from \"vue\"\n\nconst props = defineProps({\n\tmodelValue: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\tcouncilName: {\n\t\ttype: String,\n\t\tdefault: \"Council\",\n\t},\n\trequestTypeName: {\n\t\ttype: String,\n\t\tdefault: \"Application\",\n\t},\n\tapplicationFee: {\n\t\ttype: String,\n\t\tdefault: \"TBD\",\n\t},\n\tisResourceConsent: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\tstepConfigs: {\n\t\ttype: Array,\n\t\tdefault: () => [],\n\t},\n\tusesConfigurableSteps: {\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t},\n\trequestTypeDetails: {\n\t\ttype: Object,\n\t\tdefault: null,\n\t},\n})\n\n// Check if this is a SPISC application\nconst isSPISCApplication = computed(() => {\n\tconst requestType = props.requestTypeName?.toLowerCase() || \"\"\n\treturn requestType.includes(\"spisc\") || requestType.includes(\"social pension\")\n})\n\n// Applicant details - handle both standard and SPISC field names\nconst applicantName = computed(() => {\n\treturn props.modelValue.requester_name ||\n\t       props.modelValue.full_name ||\n\t       props.modelValue.applicant_name ||\n\t       null\n})\n\nconst applicantEmail = computed(() => {\n\treturn props.modelValue.requester_email ||\n\t       props.modelValue.email ||\n\t       props.modelValue.applicant_email ||\n\t       null\n})\n\nconst applicantPhone = computed(() => {\n\treturn props.modelValue.requester_phone ||\n\t       props.modelValue.mobile_number ||\n\t       props.modelValue.phone ||\n\t       props.modelValue.applicant_phone ||\n\t       null\n})\n\n// Calculate age from birth_date\nconst calculatedAge = computed(() => {\n\tconst birthDate = props.modelValue.birth_date\n\tif (!birthDate) return null\n\n\tconst today = new Date()\n\tconst birth = new Date(birthDate)\n\tlet age = today.getFullYear() - birth.getFullYear()\n\tconst monthDiff = today.getMonth() - birth.getMonth()\n\n\tif (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\n\t\tage--\n\t}\n\n\treturn age\n})\n\n// SPISC eligibility checks\nconst ageEligible = computed(() => {\n\treturn calculatedAge.value !== null && calculatedAge.value >= 60\n})\n\nconst incomeEligible = computed(() => {\n\tconst income = props.modelValue.monthly_income\n\tif (income === undefined || income === null) return true // Don't show as ineligible if not filled\n\treturn Number(income) < 10000 // PHP 10,000 poverty threshold\n})\n\nconst overallEligible = computed(() => {\n\treturn ageEligible.value && incomeEligible.value\n})\n\n// Get all steps with their data for review (not filtered by show_on_review)\nconst allStepsWithData = computed(() => {\n\tif (!props.usesConfigurableSteps || !props.stepConfigs) {\n\t\treturn []\n\t}\n\t// Return all steps that have show_on_review=true at step level OR have any data\n\treturn props.stepConfigs.filter((step) => {\n\t\t// Always show steps marked for review\n\t\tif (step.show_on_review) return true\n\t\t// Also show if step has any entered data\n\t\treturn hasAnyContent(step)\n\t})\n})\n\n// Check if property details should be displayed\nconst hasPropertyDetails = computed(() => {\n\t// Always show for resource consent\n\tif (props.isResourceConsent) {\n\t\treturn true\n\t}\n\n\t// Check if property data actually exists in the request\n\treturn !!(props.modelValue.property || props.modelValue.property_address)\n})\n\n// Get field value, handling various formats\nconst getFieldValue = (fieldName) => {\n\tconst value = props.modelValue[fieldName]\n\tif (value === undefined || value === null || value === \"\") return null\n\n\t// Handle file upload arrays\n\tif (Array.isArray(value) && value.length > 0) {\n\t\tif (value[0]?.file_url) return value[0].file_url\n\t}\n\n\treturn value\n}\n\n// Get attachment URL for viewing\nconst getAttachmentUrl = (fieldName) => {\n\tconst value = props.modelValue[fieldName]\n\tif (!value) return null\n\n\t// Handle file upload arrays\n\tif (Array.isArray(value) && value.length > 0) {\n\t\treturn value[0]?.file_url || value[0]\n\t}\n\n\t// Handle string URL\n\tif (typeof value === \"string\" && value.startsWith(\"/\")) {\n\t\treturn value\n\t}\n\n\treturn null\n}\n\n// Determine if a section should be shown\nconst shouldShowSection = (section) => {\n\t// Check depends_on condition\n\tif (section.depends_on) {\n\t\tconst condition = section.depends_on.replace(\"eval:\", \"\").replace(/doc\\./g, \"props.modelValue.\")\n\t\ttry {\n\t\t\t// eslint-disable-next-line no-eval\n\t\t\tif (!eval(condition)) return false\n\t\t} catch (e) {\n\t\t\t// If eval fails, show the section\n\t\t}\n\t}\n\n\t// Show if marked for review or has any data\n\tif (section.show_on_review) return true\n\n\t// Check if any field has data\n\tfor (const field of section.fields || []) {\n\t\tif (getFieldValue(field.field_name)) return true\n\t}\n\n\treturn false\n}\n\n// Determine if a field should be shown\nconst shouldShowField = (field) => {\n\t// Check depends_on condition\n\tif (field.depends_on) {\n\t\tconst condition = field.depends_on.replace(\"eval:\", \"\").replace(/doc\\./g, \"props.modelValue.\")\n\t\ttry {\n\t\t\t// eslint-disable-next-line no-eval\n\t\t\tif (!eval(condition)) return false\n\t\t} catch (e) {\n\t\t\t// If eval fails, show the field\n\t\t}\n\t}\n\n\t// Show if marked for review or has data\n\treturn field.show_on_review || getFieldValue(field.field_name) !== null\n}\n\n// Check if field should span full width\nconst isLongField = (field) => {\n\treturn field.field_type === \"Text Editor\" ||\n\t       field.field_type === \"Small Text\" ||\n\t       field.field_type === \"Long Text\" ||\n\t       (field.field_type === \"Data\" && (field.field_label || \"\").length > 50)\n}\n\n// Check if a step has any content\nconst hasAnyContent = (step) => {\n\tif (!step.sections) return false\n\n\tfor (const section of step.sections) {\n\t\tfor (const field of section.fields || []) {\n\t\t\tif (getFieldValue(field.field_name) !== null) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false\n}\n\n// Check step completeness\nconst getStepCompleteness = (step) => {\n\tif (!step.sections) return false\n\n\tfor (const section of step.sections) {\n\t\tfor (const field of section.fields || []) {\n\t\t\tif (field.is_required && !getFieldValue(field.field_name)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true\n}\n\n// Get list of uploaded documents\nconst uploadedDocuments = computed(() => {\n\tconst docs = []\n\n\tfor (const step of props.stepConfigs || []) {\n\t\tfor (const section of step.sections || []) {\n\t\t\tfor (const field of section.fields || []) {\n\t\t\t\tif ((field.field_type === \"Attach\" || field.field_type === \"Attach Image\") && getFieldValue(field.field_name)) {\n\t\t\t\t\tdocs.push({\n\t\t\t\t\t\tfield_name: field.field_name,\n\t\t\t\t\t\tlabel: field.field_label,\n\t\t\t\t\t\turl: getAttachmentUrl(field.field_name),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn docs\n})\n\n// Get list of missing required documents\nconst missingRequiredDocuments = computed(() => {\n\tconst missing = []\n\n\tfor (const step of props.stepConfigs || []) {\n\t\tfor (const section of step.sections || []) {\n\t\t\tfor (const field of section.fields || []) {\n\t\t\t\tif ((field.field_type === \"Attach\" || field.field_type === \"Attach Image\") && field.is_required && !getFieldValue(field.field_name)) {\n\t\t\t\t\tmissing.push({\n\t\t\t\t\t\tfield_name: field.field_name,\n\t\t\t\t\t\tlabel: field.field_label,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn missing\n})\n\n// Get list of missing required fields\nconst missingFields = computed(() => {\n\tconst missing = []\n\n\tfor (const step of props.stepConfigs || []) {\n\t\tfor (const section of step.sections || []) {\n\t\t\t// Check depends_on for section\n\t\t\tif (section.depends_on) {\n\t\t\t\tconst condition = section.depends_on.replace(\"eval:\", \"\").replace(/doc\\./g, \"props.modelValue.\")\n\t\t\t\ttry {\n\t\t\t\t\t// eslint-disable-next-line no-eval\n\t\t\t\t\tif (!eval(condition)) continue\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// If eval fails, check the section\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const field of section.fields || []) {\n\t\t\t\tif (!field.is_required) continue\n\n\t\t\t\t// Check depends_on for field\n\t\t\t\tif (field.depends_on) {\n\t\t\t\t\tconst condition = field.depends_on.replace(\"eval:\", \"\").replace(/doc\\./g, \"props.modelValue.\")\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// eslint-disable-next-line no-eval\n\t\t\t\t\t\tif (!eval(condition)) continue\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// If eval fails, check the field\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!getFieldValue(field.field_name)) {\n\t\t\t\t\tmissing.push(field.field_label)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn missing\n})\n\n// Format field value for display\nconst formatFieldValue = (field, value) => {\n\tif (value === undefined || value === null || value === \"\") {\n\t\treturn \"Not provided\"\n\t}\n\n\t// Check field type\n\tif (field.field_type === \"Check\") {\n\t\treturn value ? \"Yes\" : \"No\"\n\t}\n\n\tif (field.field_type === \"Date\" && value) {\n\t\treturn formatDate(value)\n\t}\n\n\tif (field.field_type === \"Currency\" && value) {\n\t\treturn formatCurrency(value)\n\t}\n\n\tif (field.field_type === \"Select\") {\n\t\treturn value\n\t}\n\n\tif (field.field_type === \"Attach\" || field.field_type === \"Attach Image\") {\n\t\treturn value ? \"File attached\" : \"Not provided\"\n\t}\n\n\tif (field.field_type === \"Int\") {\n\t\treturn String(value)\n\t}\n\n\treturn value\n}\n\n// Format date for display\nconst formatDate = (dateStr) => {\n\tif (!dateStr) return \"Not provided\"\n\ttry {\n\t\treturn new Date(dateStr).toLocaleDateString(\"en-PH\", {\n\t\t\tyear: \"numeric\",\n\t\t\tmonth: \"long\",\n\t\t\tday: \"numeric\",\n\t\t})\n\t} catch (e) {\n\t\treturn dateStr\n\t}\n}\n\n// Format currency for display\nconst formatCurrency = (value) => {\n\tif (value === undefined || value === null || value === \"\") return \"Not provided\"\n\treturn `PHP ${Number(value).toLocaleString(\"en-PH\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`\n}\n\n// Format pickup schedule for display\nconst formatPickupSchedule = (value) => {\n\tif (!value) return \"Not scheduled\"\n\tif (typeof value === \"object\") {\n\t\treturn `${value.date || \"Date TBD\"} at ${value.time || \"Time TBD\"}`\n\t}\n\treturn value\n}\n\n// RC-specific computed properties\nconst hasAnyConsentType = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.consent_type_land_use ||\n\t\tprops.modelValue.consent_type_subdivision ||\n\t\tprops.modelValue.consent_type_discharge ||\n\t\tprops.modelValue.consent_type_water ||\n\t\tprops.modelValue.consent_type_coastal\n\t)\n})\n\nconst activityStatusClass = computed(() => {\n\tconst status = props.modelValue.activity_status_type\n\tif (status === \"Permitted\") return \"bg-green-100 text-green-800\"\n\tif (status === \"Controlled\") return \"bg-blue-100 text-blue-800\"\n\tif (status === \"Restricted Discretionary\")\n\t\treturn \"bg-yellow-100 text-yellow-800\"\n\tif (status === \"Discretionary\") return \"bg-orange-100 text-orange-800\"\n\tif (status === \"Non-Complying\") return \"bg-red-100 text-red-800\"\n\tif (status === \"Prohibited\") return \"bg-gray-800 text-white\"\n\treturn \"bg-gray-100 text-gray-800\"\n})\n\nconst hasNaturalHazards = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.hazard_flooding ||\n\t\tprops.modelValue.hazard_earthquake ||\n\t\tprops.modelValue.hazard_landslip ||\n\t\tprops.modelValue.hazard_coastal\n\t)\n})\n\nconst hasConsultation = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.consultation_undertaken ||\n\t\tprops.modelValue.consultation_summary ||\n\t\tprops.modelValue.affected_parties_details ||\n\t\tprops.modelValue.written_approvals_obtained\n\t)\n})\n\nconst hasAEEContent = computed(() => {\n\treturn !!(\n\t\tprops.modelValue.activity_description ||\n\t\tprops.modelValue.aee_full_assessment ||\n\t\tprops.modelValue.positive_effects_description ||\n\t\tprops.modelValue.effects_visual_amenity ||\n\t\tprops.modelValue.effects_traffic_parking ||\n\t\tprops.modelValue.effects_noise ||\n\t\tprops.modelValue.mitigation_measures ||\n\t\t// Legacy fields\n\t\tprops.modelValue.aee_activity_description ||\n\t\tprops.modelValue.aee_existing_environment ||\n\t\tprops.modelValue.assessment_of_effects ||\n\t\tprops.modelValue.aee_document\n\t)\n})\n\n// Helper functions\nconst stripHtml = (html) => {\n\tif (!html) return \"\"\n\tconst tmp = document.createElement(\"div\")\n\ttmp.innerHTML = html\n\treturn tmp.textContent || tmp.innerText || \"\"\n}\n\nconst truncate = (text, maxLength) => {\n\tif (!text) return \"\"\n\tconst clean = stripHtml(text)\n\tif (clean.length <= maxLength) return clean\n\treturn clean.substring(0, maxLength) + \"...\"\n}\n\nconst formatSignatureDate = (dateStr) => {\n\tif (!dateStr) return \"\"\n\ttry {\n\t\treturn new Date(dateStr).toLocaleDateString(\"en-PH\", {\n\t\t\tyear: \"numeric\",\n\t\t\tmonth: \"long\",\n\t\t\tday: \"numeric\",\n\t\t})\n\t} catch (e) {\n\t\treturn dateStr\n\t}\n}\n\nconst isComplete = computed(() => {\n\t// For SPISC, check dynamic fields\n\tif (isSPISCApplication.value) {\n\t\t// Check if any required fields are missing\n\t\treturn missingFields.value.length === 0 && missingRequiredDocuments.value.length === 0\n\t}\n\n\t// Basic required fields for other types\n\tconst hasBasicInfo = !!(\n\t\tprops.modelValue.council &&\n\t\tprops.modelValue.request_type &&\n\t\t(props.modelValue.requester_name || props.modelValue.full_name) &&\n\t\t(props.modelValue.requester_email || props.modelValue.email)\n\t)\n\n\t// If RC, check additional requirements\n\tif (props.isResourceConsent) {\n\t\tconst hasRCRequirements = !!(\n\t\t\thasAnyConsentType.value &&\n\t\t\tprops.modelValue.activity_status_type &&\n\t\t\tprops.modelValue.activity_description &&\n\t\t\tprops.modelValue.aee_full_assessment &&\n\t\t\tprops.modelValue.declaration_accuracy &&\n\t\t\tprops.modelValue.declaration_authority &&\n\t\t\tprops.modelValue.declaration_acknowledgment\n\t\t)\n\t\treturn hasBasicInfo && hasRCRequirements\n\t}\n\n\treturn hasBasicInfo\n})\n</script>\n\n<style scoped>\n.line-clamp-3 {\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n}\n</style>\n","<template>\n    <div class=\"min-h-screen bg-gray-50\">\n        <RequestHeader title=\"New Application\" @back=\"goBack\">\n            <template #actions>\n                <Button\n                    v-if=\"canSaveDraft\"\n                    @click=\"handleSaveDraft\"\n                    variant=\"outline\"\n                    theme=\"gray\"\n                    :loading=\"store.isSaving\"\n                >\n                    Save Draft\n                </Button>\n                <Button\n                    v-if=\"canSaveDraft\"\n                    @click=\"handleSaveAndClose\"\n                    variant=\"outline\"\n                    theme=\"gray\"\n                    :loading=\"store.isSaving\"\n                >\n                    Save and Close\n                </Button>\n            </template>\n        </RequestHeader>\n\n        <div class=\"bg-white border-b border-gray-200\">\n            <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n                <RequestProgress\n                    :current-step=\"store.currentStep\"\n                    :total-steps=\"totalSteps\"\n                    :step-titles=\"stepTitles\"\n                />\n            </div>\n        </div>\n\n        <main class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div class=\"bg-white rounded-lg shadow-sm border border-gray-200 p-8\">\n                <!-- Skip Council step in single-tenant mode -->\n                <div v-if=\"getCurrentStepTitle() === 'Type'\">\n                    <Step2RequestType\n                        v-model=\"store.formData\"\n                        :request-types=\"requestTypes\"\n                        @type-selected=\"selectRequestType\"\n                    />\n                </div>\n\n                <div v-else-if=\"getCurrentStepTitle() === 'Process Info'\">\n                    <Step3ProcessInfo\n                        :request-type-details=\"selectedRequestTypeDetails\"\n                        :council-name=\"getCouncilName()\"\n                        v-model=\"store.formData\"\n                        @continue=\"handleNext\"\n                    />\n                </div>\n\n                <!-- Review step: Show when at or beyond last step (defensive check for out-of-bounds) -->\n                <div v-else-if=\"store.currentStep >= totalSteps - 1\">\n                    <ReviewStep\n                        v-model=\"store.formData\"\n                        :council-name=\"store.formData.council || 'Council'\"\n                        :request-type-name=\"store.formData.request_type || 'Application'\"\n                        :application-fee=\"formatApplicationFee(store.requestTypeConfig?.base_fee)\"\n                        :is-resource-consent=\"isResourceConsent\"\n                        :step-configs=\"store.requestTypeConfig?.steps || []\"\n                        :uses-configurable-steps=\"usesConfigurableSteps\"\n                        :request-type-details=\"store.requestTypeConfig\"\n                    />\n                </div>\n\n                <DynamicStepRenderer\n                    v-else-if=\"usesConfigurableSteps && getCurrentStepConfig()\"\n                    :stepConfig=\"getCurrentStepConfig()\"\n                    v-model=\"store.formData\"\n                />\n\n                <div v-else class=\"text-center py-12\">\n                    <div class=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-100 mb-4\">\n                        <svg class=\"h-8 w-8 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                        </svg>\n                    </div>\n                    <h3 class=\"text-lg font-medium text-gray-900 mb-2\">Unable to Load This Step</h3>\n                    <p class=\"text-sm text-gray-600 mb-6\">\n                        We're having trouble loading this step. Please try refreshing or go back to continue your application.\n                    </p>\n                    <div class=\"flex gap-3 justify-center\">\n                        <button\n                            @click=\"location.reload()\"\n                            class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n                        >\n                            Refresh Page\n                        </button>\n                        <button\n                            @click=\"handlePrevious\"\n                            class=\"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition\"\n                        >\n                            Go Back\n                        </button>\n                        <button\n                            @click=\"router.push('/dashboard')\"\n                            class=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition\"\n                        >\n                            Return to Dashboard\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Council Meeting Banner (shown after Process Info step) -->\n            <div\n                v-if=\"shouldShowMeetingBanner\"\n                class=\"mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 shadow-sm\"\n            >\n                <div class=\"flex items-start justify-between\">\n                    <div class=\"flex-1\">\n                        <div class=\"flex items-center gap-2 mb-2\">\n                            <svg class=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                            </svg>\n                            <h3 class=\"text-lg font-semibold text-gray-900\">Council Meeting Available</h3>\n                        </div>\n                        <p class=\"text-sm text-gray-700 mb-3\">\n                            Schedule a meeting with council planners to discuss your application before submitting.\n                            This optional step can help clarify requirements and improve your application.\n                        </p>\n                        <button\n                            @click=\"handleBookMeeting\"\n                            class=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium\"\n                        >\n                            Request Council Meeting\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <StepNavigation\n                :current-step=\"store.currentStep\"\n                :total-steps=\"totalSteps\"\n                :is-last-step=\"store.isLastStep\"\n                :can-go-next=\"canNavigateNext\"\n                :can-save-draft=\"canSaveDraft\"\n                :is-saving=\"store.isSaving\"\n                :is-submitting=\"store.isSubmitting\"\n                @next=\"handleNext\"\n                @previous=\"handlePrevious\"\n                @save-draft=\"handleSaveDraft\"\n                @submit=\"handleSubmit\"\n            />\n        </main>\n\n        <SaveDraftModal\n            v-model:show=\"showSaveDraftModal\"\n            :draft-id=\"store.currentRequestId\"\n        />\n\n        <ValidationErrorModal\n            v-model:show=\"showValidationModal\"\n            :errors=\"validationErrors\"\n        />\n\n        <BookMeetingModal\n            v-model:show=\"showMeetingModal\"\n            :request-id=\"store.currentRequestId\"\n            :request-type-code=\"store.formData.request_type\"\n            :council-code=\"store.formData.council\"\n            @booked=\"handleMeetingBooked\"\n        />\n\n        <SubmissionSuccessModal\n            :open=\"showSubmissionSuccessModal\"\n            :request-number=\"submissionResult?.request_number\"\n            :request-id=\"submissionResult?.request_id\"\n            :sla-info=\"submissionResult?.sla_info\"\n            @close=\"showSubmissionSuccessModal = false\"\n            @view-request=\"handleViewRequestFromModal\"\n            @go-to-dashboard=\"handleGoToDashboardFromModal\"\n        />\n    </div>\n</template>\n\n<script setup>\nimport { Button } from \"frappe-ui\"\nimport { computed, defineAsyncComponent, onMounted } from \"vue\"\nimport { useRouter } from \"vue-router\"\n\n// Composables - all logic extracted for maintainability\nimport { useRequestModals } from \"../composables/useRequestModals\"\nimport { useStepConfiguration } from \"../composables/useStepConfiguration\"\nimport { useRequestFormNavigation } from \"../composables/useRequestFormNavigation\"\nimport { useRequestLifecycle } from \"../composables/useRequestLifecycle\"\nimport { useRequestStore } from \"../stores/requestStore\"\n\n// Components\nimport RequestHeader from \"../components/request/RequestHeader.vue\"\nimport RequestProgress from \"../components/request/RequestProgress.vue\"\nimport StepNavigation from \"../components/request/StepNavigation.vue\"\n\n// Lazy-loaded modals\nconst SaveDraftModal = defineAsyncComponent(\n\t() => import(\"../components/modals/SaveDraftModal.vue\"),\n)\nconst ValidationErrorModal = defineAsyncComponent(\n\t() => import(\"../components/modals/ValidationErrorModal.vue\"),\n)\nconst BookMeetingModal = defineAsyncComponent(\n\t() => import(\"../components/modals/BookMeetingModal.vue\"),\n)\nconst SubmissionSuccessModal = defineAsyncComponent(\n\t() => import(\"../components/modals/SubmissionSuccessModal.vue\"),\n)\n\n// Step components\nimport Step2RequestType from \"../components/request-steps/Step2RequestType.vue\"\nimport Step3ProcessInfo from \"../components/request-steps/Step3ProcessInfo.vue\"\nconst DynamicStepRenderer = defineAsyncComponent(\n\t() => import(\"../components/DynamicStepRenderer.vue\"),\n)\nimport ReviewStep from \"../components/request-steps/ReviewStep.vue\"\n\nconst router = useRouter()\nconst store = useRequestStore()\n\n// Step configuration (totalSteps, stepTitles, etc.)\nconst {\n\ttotalSteps,\n\tstepTitles,\n\tusesConfigurableSteps,\n\tshouldShowMeetingBanner,\n\tgetCurrentStepTitle,\n\tgetCurrentStepConfig,\n\tgetCouncilName,\n} = useStepConfiguration()\n\n// Modal management\nconst {\n\tshowSaveDraftModal,\n\tshowValidationModal,\n\tshowMeetingModal,\n\tshowSubmissionSuccessModal,\n\tsubmissionResult,\n\thandleBookMeeting,\n\thandleMeetingBooked,\n\thandleSaveDraft,\n\thandleSaveAndClose,\n\thandleSubmit,\n\thandleViewRequestFromModal,\n\thandleGoToDashboardFromModal,\n} = useRequestModals()\n\n// Navigation (with validation callback)\nconst {\n\tcanNavigateNext,\n\tcanSaveDraft,\n\tvalidationErrors,\n\thandleNext,\n\thandlePrevious,\n\tgoBack,\n} = useRequestFormNavigation({\n\tgetCurrentStepConfig,\n\ttotalSteps,\n\tusesConfigurableSteps,\n\tonValidationError: () => {\n\t\tshowValidationModal.value = true\n\t},\n})\n\n// Lifecycle (initialization, route guards, request types)\nconst {\n\trequestTypes,\n\tselectedRequestTypeDetails,\n\tselectRequestType,\n\tinitialize,\n\tsetupRouteGuard,\n\tsetupAgeValidation,\n} = useRequestLifecycle()\n\n// Setup route guard and age calculation (validation comes from field config)\nsetupRouteGuard()\nsetupAgeValidation()\n\n// Check if current request type is Resource Consent\nconst isResourceConsent = computed(() => {\n\tconst requestType = store.formData.request_type || \"\"\n\treturn requestType.toLowerCase().includes(\"resource consent\")\n})\n\n// Format application fee for display\nconst formatApplicationFee = (fee) => {\n\tif (!fee && fee !== 0) return \"Free\"\n\tif (fee === 0) return \"Free\"\n\t// Check if it's Philippines (PHP) or NZ (NZD)\n\tconst isPH = store.formData.council?.includes(\"TAYTAY\") || store.formData.council?.includes(\"PH\")\n\tconst currency = isPH ? \"PHP\" : \"NZD\"\n\tconst symbol = isPH ? \"\" : \"$\"\n\treturn `${symbol}${Number(fee).toLocaleString(\"en\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ${currency}`\n}\n\n// Initialize on mount\nonMounted(() => {\n\tinitialize()\n})\n</script>"],"file":"assets/NewRequest-Dx791JTj.js"}