const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/errorStore-DxnSSE2j.js","assets/vue-vendor-B0shnPjy.js"])))=>i.map(i=>d[i]);
var g=Object.defineProperty;var _=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var h=(o,e,t)=>e in o?g(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,y=(o,e)=>{for(var t in e||(e={}))R.call(e,t)&&h(o,t,e[t]);if(_)for(var t of _(e))q.call(e,t)&&h(o,t,e[t]);return o};var c=(o,e,t)=>new Promise((u,i)=>{var d=s=>{try{a(t.next(s))}catch(n){i(n)}},r=s=>{try{a(t.throw(s))}catch(n){i(n)}},a=s=>s.done?u(s.value):Promise.resolve(s.value).then(d,r);a((t=t.apply(o,e)).next())});import{a as x,_ as S}from"./frappe-ui-D6fYUZUl.js";class E{constructor(){this.defaultOptions={onError:this.handleError.bind(this),onSuccess:this.handleSuccess.bind(this)}}createResource(e){return x(y(y({},this.defaultOptions),e))}handleError(e){console.error("[API Error]",e);const t=e!=null&&e.exc_type?e.exc_type:(e==null?void 0:e.message)||"An unexpected error occurred";return S(()=>c(this,null,function*(){const{useErrorStore:u}=yield import("./errorStore-DxnSSE2j.js");return{useErrorStore:u}}),__vite__mapDeps([0,1])).then(({useErrorStore:u})=>{u().addError({message:t,type:"api_error",context:e})}).catch(u=>{console.error("Could not add error to store:",u)}),{error:t}}handleSuccess(e){return e}call(u){return c(this,arguments,function*(e,t={}){try{console.log(`[BaseAPIClient] Calling ${e} with args:`,t),console.log("[BaseAPIClient] Args JSON:",JSON.stringify(t,null,2));const i={"Content-Type":"application/json"};window.csrf_token&&(i["X-Frappe-CSRF-Token"]=window.csrf_token);const d=yield fetch("/api/method/"+e,{method:"POST",headers:i,credentials:"include",body:JSON.stringify(t)});if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const r=yield d.json();if(r.exc)throw new Error(r.exc);return r.message}catch(i){throw this.handleError(i),i}})}uploadFile(u){return c(this,arguments,function*(e,t={}){for(let r=0;r<=3;r++)try{const a=new FormData;a.append("file",e),t.doctype&&a.append("doctype",t.doctype),t.docname&&a.append("docname",t.docname),t.fieldname&&a.append("fieldname",t.fieldname),t.is_private!==void 0&&a.append("is_private",t.is_private?"1":"0");const s={};window.csrf_token&&(s["X-Frappe-CSRF-Token"]=window.csrf_token);const n=yield fetch("/api/method/upload_file",{method:"POST",headers:s,credentials:"include",body:a});if(!n.ok){const p=yield n.json().catch(()=>({}));if(n.status===500&&p.exc_type==="OSError"&&r<3){const f=1e3*Math.pow(2,r);console.log(`File upload failed (attempt ${r+1}/4). Retrying in ${f}ms...`),yield new Promise(w=>setTimeout(w,f));continue}throw new Error(`Upload failed (${n.status}): ${p.exception||n.statusText}`)}const m=yield n.json();if(m.exc){if(m.exc_type==="OSError"&&r<3){const p=1e3*Math.pow(2,r);console.log(`File upload failed with OSError (attempt ${r+1}/4). Retrying in ${p}ms...`),yield new Promise(f=>setTimeout(f,p));continue}throw new Error(m.exc)}return m.message}catch(a){if(r===3)throw this.handleError(a),a;const s=1e3*Math.pow(2,r);console.log(`Upload error (attempt ${r+1}/4): ${a.message}. Retrying in ${s}ms...`),yield new Promise(n=>setTimeout(n,s))}})}}const l=new E;class T{createDraft(e,t){return c(this,null,function*(){return l.call("councilsonline.api.create_draft_request",{data:e,current_step:t})})}getRequest(e){return l.createResource({url:"frappe.client.get",params:{doctype:"Request",name:e},auto:!0})}getRequestTypeConfig(e){return l.createResource({url:"councilsonline.api.get_request_type_config",params:{request_type_code:e},auto:!0,cache:["request-type-config",e]})}clearRequestTypeConfigCache(){Object.keys(localStorage).filter(t=>t.startsWith("request-type-config")).forEach(t=>localStorage.removeItem(t))}updateRequest(e,t){return c(this,null,function*(){return l.call("frappe.client.set_value",{doctype:"Request",name:e,fieldname:t})})}submitRequest(e){return c(this,null,function*(){return l.call("councilsonline.api.submit_request",{request_id:e})})}getUserRequests(){return l.createResource({url:"councilsonline.api.get_user_requests",auto:!0,cache:["user-requests"]})}getRequestsByStatus(e){return l.createResource({url:"frappe.client.get_list",params:{doctype:"Request",filters:{status:e},fields:["name","request_type","requester_name","status","created_at","brief_description"],order_by:"modified desc"},auto:!0})}deleteDraft(e){return c(this,null,function*(){return l.call("frappe.client.delete",{doctype:"Request",name:e})})}getRequestWithApplication(e){return c(this,null,function*(){return l.call("councilsonline.api.get_request_with_application",{request_id:e})})}validateStep(e,t,u){return c(this,null,function*(){return l.call("councilsonline.api.validate_request_step",{request_id:e,step_number:t,step_data:u})})}}const P=new T;export{P as r};
//# sourceMappingURL=request.service--9QsRanG.js.map
